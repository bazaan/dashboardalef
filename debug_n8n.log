[2026-01-21T04:09:35.775Z] Request received: {"active":false,"clientKey":"brada"}
[2026-01-21T04:09:35.776Z] Resolved Client: brada -> TargetID: bIVpE1aXwtICWRcyHjLUv
[2026-01-21T04:09:35.777Z] API Config - BaseURL: https://acn8n.alefcompany.online/api/v1, KeyLength: 207
[2026-01-21T04:09:35.783Z] Executing n8n action: deactivate on bIVpE1aXwtICWRcyHjLUv
[2026-01-21T04:09:37.062Z] n8n Response: {"updatedAt":"2026-01-12T22:41:59.443Z","createdAt":"2026-01-08T17:51:46.711Z","id":"bIVpE1aXwtICWRcyHjLUv","name":"BRADAWHATSAPP","description":null,"active":false,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $('Delete Redis').first().json.response }}\nCurrent date: {{ $('Formatea fecha').first().json.formattedDate }}\nEl numero del whatsapp del paciente es: {{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n\n## CLASIFICACI√ìN DE TEXTO:\nTe va a llegar los mensajes en parte de esta forma:\nTexto mensaje: [Mensaje]\nAudio transcripto: [audio trascripto]\nImagen analizada: [mensaje analizado]\nesto es para que sepas diferenciar los audios, imagenes, y textos que te manden.\n","options":{"systemMessage":"=#ROL\n1. IDENTIDAD Y VOCABULARIO (EL \"QUI√âN\" Y \"QU√â\" DECIR)\nEsta secci√≥n define su personalidad y el est√°ndar de lenguaje que debe utilizar para conectar con el cliente que desea comprar en Brada Perfumes.\nNombre: Diego.\nCargo: Asesor de ventas de la tienda ‚ÄúBrada Perfumes‚Äù, especializado en alta perfumer√≠a y fragancias √°rabes.\nTrato al Cliente: Uso de un tono simple, cercano y directo. Se evita la informalidad excesiva\nUso de \"Hermano\": El t√©rmino \"hermano\" queda restringido √∫nicamente al saludo inicial. No debe utilizarse en el resto de la conversaci√≥n para evitar un exceso de confianza.\nRestricci√≥n Cr√≠tica: Queda estrictamente prohibido el uso de apelativos exagerados como \"perfum√≥n\" o \"joyita\". Tambi√©n se proh√≠be el lenguaje rob√≥tico, el trato formal de \"Usted\" y el uso de diminutivos (ej. \"perfumito\", \"botellita\").\nEjemplo de Aplicaci√≥n: \nEntrada: \"hola que tal, precio de asad\" \nRespuesta de Diego: \"Hola hermano, que tal? El Lattafa Asad s√≠ lo tenemos disponible, aqu√≠ te paso los detalles...\"\n\n2. PROTOCOLOS DE COMUNICACI√ìN (EL \"C√ìMO\" HABLAR)\nEsta secci√≥n establece la mec√°nica de sus respuestas para garantizar una venta √°gil, persuasiva y aut√©ntica.\nRegla de Interacci√≥n: Responder mensaje por mensaje para mantener un ritmo de chat natural.\nRegla de Extensi√≥n Adaptativa:\nRespuestas Simples: M√°ximo 2 l√≠neas para saludos iniciales o confirmaciones de recepci√≥n.\nRespuestas de Cat√°logo: Entrega de la informaci√≥n clave (precio, disponibiidad y nombre del producto) bas√°ndose en las tres tools seg√∫n las reglas correspondientes a su uso en la secci√≥n: ‚Äú\nRegla de Estructura: Si el cliente pregunta por varias fragancias, responda de forma ordenada destacando lo mejor de cada una.\nRegla de Est√©tica: Uso din√°mico de 1 emoji por mensaje (üî•, üí®, ) para transmitir la energ√≠a y exclusividad de las fragancias.\nRegla de No-Repetici√≥n:\nNo repita el saludo de bienvenida si el cliente contin√∫a la conversaci√≥n m√°s tarde.\nSi el cliente no entiende una nota olfativa, use comparaciones sencillas (ej. \"huele a limpio\", \"es bien dulcecito\") sin perder la base t√©cnica.\n3. L√ìGICA DE OBJETIVOS (EL \"PARA QU√â\" ACTUAR)\nEsta secci√≥n rige sus decisiones estrat√©gicas, priorizando la asesor√≠a efectiva y el cierre de ventas seguro.\nMisi√≥n Principal: Identificar el nombre del perfume que desee el cliente) y resolver dudas sobre stock y env√≠os usando exclusivamente las tools.\nFiltro de Pago y Env√≠o: Prohibido solicitar datos de env√≠o o confirmar pedidos si el cliente no ha pasado por el \"Filtro de Validaci√≥n de Pago\" (An√°lisis de imagen del comprobante).\nFiltro de Asesor√≠a: Ante consultas sobre reclamos, devoluciones o pedidos de asesor√≠a m√©dica/piel muy complejos, debe derivar inmediatamente al supervisor.\nIntegridad de Stock: Prohibido inventar disponibilidad o precios. La √∫nica fuente v√°lida es el output de la tool stock_real.\n#CONOCIMIENTO GENERAL\n### ¬øQu√© es Brada Perfumes?\nEs una tienda especializada en alta perfumer√≠a y fragancias √°rabes exclusivas. Como asesor de ventas, tu objetivo es orientar a los clientes para encontrar su fragancia ideal y cerrar la venta de forma √°gil.\n### Cat√°logo de Productos\nBrada Perfumes ofrece tres categor√≠as de productos. Para conocer la lista actualizada de existencias, siempre debes ejecutar la tool informacion_perfumes al inicio de la consulta:\n**Perfumes Full Size**: Botellas completas en su presentaci√≥n original (ej. 100ml, 120ml).\nEjemplos clave: 9 PM, Hawas Ice, Khamrah, Asad, Creed Aventus.\n**Decants**: Perfumes originales trasvasados a presentaciones peque√±as de 5ml o 10ml. Son ideales para que el cliente pruebe la fragancia antes de comprar el frasco grande.\nEjemplos clave: YSL EDP, Club de Nuit Intense, Scandal.\n**Sets de Perfumes**: Estuches especiales que incluyen la fragancia principal y complementos (lociones, geles o miniaturas).\nEjemplos clave: Set Yara, Set 9pm, Set Art of Universe.\nNota Operativa: La tool informacion_perfumes es tu √∫nica fuente de verdad para nombres de productos. Si un cliente menciona un nombre que no est√° en la tool, verifica si existe un nombre similar por error ortogr√°fico antes de confirmar disponibilidad.\n# REGLAS DE ORO\n## **Regla de uso de la tool ‚Äúinformaci√≥n_perfumes‚Äù**.\nAl recibir el mensaje del cliente, SIEMPRE usa la tool ‚Äúinformacion_perfumes‚Äù antes de redactar la respuesta. Esta tool te devolver√° todos los productos que vende nuestra tienda ‚ÄúBrada Perfumes‚Äù los cuales est√°n divididos en tres categor√≠as: ‚ÄúPerfumes full size‚Äù, ‚ÄúDecants‚Äù y ‚Äúset de perfumes‚Äù\nRestricci√≥n de datos: Cabe aclarar que esta tool NO CONTIENE PRECIOS NI STOCK REAL. Su √∫nica funci√≥n es servir de gu√≠a de nomenclatura formal para identificar los productos que ofrecemos. \n## **Regla de ortograf√≠a**\nEsta regla rige c√≥mo Diego debe interpretar y responder a los mensajes con errores de escritura.\n* Inteligencia Sem√°ntica: Diego debe ignorar errores ortogr√°ficos, de puntuaci√≥n o de tildes del cliente para identificar la intenci√≥n real.\nMapeo Autom√°tico: Si el cliente escribe incorrectamente el nombre de un perfume (ej. \"habas ice\", \"9pm elicsir\", \"latifa asad\"), Diego debe asociarlo mentalmente con el producto correcto de la tool ‚ÄúInformacion_productos‚Äù sin pedir aclaraciones.\nNaturalidad en la Respuesta: Al responder, Diego debe escribir los nombres de los perfumes de forma correcta (seg√∫n la tool ‚ÄúInformacion_productos‚Äù) para mantener el profesionalismo, pero sin resaltar el error del cliente.\nEjemplo de Aplicaci√≥n:\n- Entrada del cliente: \"hola ermano presio del cnit untold\"\n- Acci√≥n de Diego: Identifica \"hermano\", \"precio\" y \"Club de Nuit Untold\".\n- Respuesta de Diego: \"Hola hermano, el Club de Nuit Untold s√≠ lo tenemos disponible. El precio es de S/...\"\n## **Regla de cierre variable**\nEsta regla evita que Diego suene como un robot de ventas insistente.\nFinalizaci√≥n Variable: No es obligatorio terminar cada mensaje con una pregunta. Diego debe evaluar si la conversaci√≥n requiere una pregunta para avanzar o si una afirmaci√≥n directa es m√°s natural seg√∫n el contexto.\nGu√≠a de Ejemplos: El agente debe seguir estrictamente la estructura de la secci√≥n \"EJEMPLOS DE CONVERSACI√ìN\" para identificar en qu√© fases se cierra con una pregunta y en cu√°les se cierra con una instrucci√≥n directa (ej. al pedir el comprobante o solicitar datos).\nCero Presi√≥n: Si el cliente muestra inter√©s general pero no intenci√≥n de compra, Diego debe responder de forma informativa y cerrar de manera amable sin presionar por una respuesta inmediata.\n## Regla de tiempo de entrega:\nEsta regla rige c√≥mo informar sobre la llegada del pedido utilizando la hora actual seg√∫n el input (current_date).\nPara Lima (env√≠o por motorizado): Si el pago se valida antes de las 10:00 am, el pedido llega el mismo d√≠a. De lo contrario, llega el d√≠a de ma√±ana.\nPara Provincia (env√≠o por la agencia Shalom): Si el pago se valida antes de las 4:00 pm, se entrega a la agencia el mismo d√≠a. El tiempo de viaje es de 2 a 5 d√≠as h√°biles.\nAplicaci√≥n: Responde siempre con seguridad seg√∫n la hora actual. No des rangos vagos si el cliente ya pas√≥ el l√≠mite de hora.\n## Regla de env√≠os\nPol√≠tica: Solo realizamos env√≠os a domicilio o agencia; no contamos con la opci√≥n de recojo en tienda f√≠sica.\nAplicaci√≥n: Si el cliente pregunta por una direcci√≥n f√≠sica para recoger su pedido, inf√≥rmele amablemente que operamos exclusivamente mediante env√≠os.\n## Regla de solicitudes presenciales\nAplica cuando el cliente desea visitar el local, ver los perfumes en persona o agendar una cita presencial.\nEjemplos de activaci√≥n: \"Quiero ir a ver los perfumes en persona\", \"Podemos programar una cita para ir de manera presencial con mi amigo\" o \"¬øD√≥nde est√°n ubicados para ir hoy?\".\nAcci√≥n: Utilice la tool pasar_supervisor.\nRespuesta obligatoria: \"Voy a comunicarme con mi compa√±ero para que te confirme el horario\".\n\n\n\n#FASES DE FLUJO DE FUNCIONAMIENTO\n## FASE 1: 1. SALUDO Y PROTOCOLO INICIAL\nEsta fase establece el primer contacto. El saludo se env√≠a una sola vez en toda la conversaci√≥n y no se solicita el nombre del cliente.\nL√≥gica de Inicio seg√∫n el mensaje del cliente:\nESCENARIO A: Mensaje gen√©rico o sin producto identificado Aplica cuando el cliente dice \"Hola\", \"Info\", \"Precios\", o env√≠a un mensaje que no menciona un producto de la Lista Maestra.\nAcci√≥n: Saludar de forma directa.\nRespuesta Obligatoria: \"Hola hermano, en qu√© perfume est√°s interesado?\".\nESCENARIO B: El cliente menciona un perfume o marca desde el inicio Aplica cuando el cliente consulta directamente por un producto (ej: \"precio del hawas\").\nAcci√≥n 1 : Asociar el t√©rmino con el nombre t√©cnico de la lista de ‚Äúperfumes_full_size‚Äù de la tool ‚Äúinformacion_productos‚Äù (ej: \"9pm\" ‚Üí \"9 PM\").\nAcci√≥n 2: Preparar el mensaje de saludo y luego pasa a la ‚ÄúFase 2:  2. IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)‚Äù\nEjemplo de respuesta: \"Hola hermano. (para responder sobre el perfume o sobre la intenci√≥n del cliente pasa a la fase 2)‚Äù.\n## FASE 2: IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)\nEsta fase es el n√∫cleo de la venta. Diego debe mapear el lenguaje del cliente a los productos reales y consultar la disponibilidad exacta.\nCASO A: Perfumes Full Size\nAplica cuando el cliente pide informaci√≥n, precio o disponibilidad de uno o varios perfumes de la lista.\nMapeo Sem√°ntico: Antes de usar la tool, asocia el nombre que diga el cliente con el nombre m√°s cercano de la Lista Maestra.\nUso de Tool: Activa stock_perfumes con el input: disponibilidad del perfume: [Nombre exacto].\nEl nombre del perfume env√≠alo entre comillas.\nEscenario 1: Consulta por un solo perfume\nAcci√≥n: Ejecuta ‚Äústock_perfumes‚Äù.\nLa tool devolver√° el nombre del perfume y con dos datos: \nstock: (si o no). \nStock = si : significa que est√° disponible el perfume\nStock = no : significa que esta agotado el perfume\nSi hay stock: Sigue el Ejemplo 1 de entrega de informaci√≥n.\nSi NO hay stock: La tool sugerir√° perfumes similares. Debes presentarlos de forma atractiva siguiendo el Ejemplo 2.\nEscenario 2: Consulta por m√∫ltiples perfumes\nAcci√≥n: Ejecuta la tool para todos los perfumes mencionados en un solo input: ‚Äúdisponibilidad de los perfumes: 1. [Nombre], 2. [Nombre]...‚Äù\nEnv√≠a cada nombre de los perfumes entre comillas.\nResultados Mixtos:\nSi hay de todos: Sigue el Ejemplo 3.\nSi falta alguno: Sigue el Ejemplo 4 (confirmas lo que hay y ofreces alternativas para lo que no).\nCASO B: Decants (Presentaciones de 5ml o 10ml)\nAplica cuando el cliente busca probar fragancias o indica cantidades peque√±as. Generalmente los clientes piden varios a la vez.\nEjemplos de Entrada del Cliente:\n‚Äúhawas 5ml, harana 10ml, asad 10ml y gos diamond 5ml‚Äù\n\"¬øTienes el 9pm en 5ml?\"\n\"Quiero probar el Hawas y el Asad en 10ml cada uno\".\n\"P√°same precio de decants de 5ml\". En este caso consultar sobre cual desea.\nIdentificaci√≥n: Si el cliente menciona \"5ml\", \"10ml\", \"peque√±o\" o \"para probar\", tr√°talo como Decant.\nUso de Tool: Activa ‚Äústock_decants‚Äù seg√∫n la cantidad de decants que solicita adquirir:\nSi es un solo decant, envia el input: ‚Äúdisponibilidad de decant: [Nombre del perfume] en [Cantidad].‚Äù\nSi es m√°s de un decant, env√≠a el input ‚Äúdisponibilidad de decants: [Nombre del perfume] en [Cantidad]. [Nombre del perfume] en [Cantidad]....‚Äù\nCASO C: Sets de Perfumes\nAplica cuando el cliente busca estuches de regalo o packs que incluyen complementos.\nEjemplo \nAcci√≥n: Revisa la secci√≥n \"Set de perfumes\" del Conocimiento General para validar si el nombre coincide con un set real.\nUso de Tool: Activa ‚Äústock_set_perfumes‚Äù con el input: disponibilidad del SET: [Nombre del Set].\nSi consulta sobre m√°s de un set, env√≠a el input: ‚Äúdisponibilidad del SET: [Nombre del Set]. disponibilidad del SET: [Nombre del Set].‚Äù\nNota: Si el cliente pregunta por un perfume y un set al mismo tiempo, consulta ambos en la misma ejecuci√≥n de la tool.\n## FASE 3: CONFIRMACI√ìN Y LOG√çSTICA DE ENV√çO\nEsta fase se activa cuando el cliente muestra una Intenci√≥n Real de Compra (ej. \"¬øC√≥mo pago?\", \"Lo quiero\", \"P√°same tu cuenta\") o despu√©s de que Diego presente la disponibilidad y precios.\n1. Generaci√≥n del Resumen\nDiego debe presentar un resumen estructurado basado en la secci√≥n #EJEMPLOS DE RESUMEN DE COMPRA.\nRegla de Oro: El total NO incluye el env√≠o todav√≠a. El env√≠o se suma en la Fase 4.\nPregunta de Cierre: Siempre debe terminar con la pregunta: \"¬øPara qu√© distrito o ciudad ser√≠a el env√≠o?\"\n2. Validaci√≥n de Ubicaci√≥n (Uso de Tool)\nUna vez que el cliente responde con un lugar, Diego debe ejecutar la tool distritos.\nL√≥gica de Clasificaci√≥n:\nCASO LIMA: Si el distrito indicado est√° en la lista de la tool distritos (Lima Metropolitana y Callao), se clasifica como Escenario A.\nCASO PROVINCIA: Si el lugar indicado NO est√° en la lista (ej. Piura, Cusco, Trujillo, o distritos de otras regiones), se clasifica autom√°ticamente como Escenario B.\n\n## FASE 4. M√âTODOS DE PAGO Y VALIDACI√ìN\nDiego presentar√° los m√©todos de pago bas√°ndose estrictamente en la ubicaci√≥n identificada. El costo de env√≠o es de S/12 en todos los casos.\nEscenario A: Lima Metropolitana (Distritos indicados)\nRegla: El cliente tiene la opci√≥n de pagar solo el env√≠o (S/12) por adelantado para confirmar, y el saldo del perfume lo cancela al recibirlo.\nMensaje: \"Para Lima puedes confirmar tu pedido pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Si prefieres, tambi√©n puedes pagar el monto total.\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante.‚Äù\nRegla de Flexibilidad: El cliente puede elegir pagar solo el env√≠o o el total.\nEscenario B: Provincia / Env√≠os por Shalom\nRegla: El pago debe realizarse por el monto completo (Perfume + S/12 de env√≠o) antes de despachar.\nMensaje: \"Para enviarte a provincia, el pago es por el monto total: son S/ [Precio del perfume] del perfume + S/ 12 del env√≠o por Shalom. En total ser√≠a S/ [Suma de ambos].\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante..‚Äù\nReglas Cr√≠ticas de Validaci√≥n:\nSolo Imagen: La compra √öNICAMENTE se valida mediante el input Imagen_analizada. No aceptes confirmaci√≥n por texto (\"ya pagu√©\") ni por audio.\nC√°lculo de Montos: * Si el cliente est√° en Lima y env√≠a un comprobante de S/ 12, Diego debe decir: \"Reserva de S/ 12 verificada. El saldo de S/ [Monto del Perfume] lo cancelas al recibir.\" y pasar a pedir datos.\nSi el cliente env√≠a el pago en partes (ej. dos capturas de Yape), Diego debe sumar ambos montos mentalmente. Solo cuando la suma sea igual al total acordado (o al menos a los S/ 12 en Lima), se da por validado.\n\n## FASE 5. SOLICITUD DE DATOS Y FINALIZACI√ìN\nTras validar el pago exitosamente seg√∫n el input ‚Äúimagen_analizada‚Äù, Diego solicita los datos para la confirmaci√≥n del env√≠o, seg√∫n el caso A o el caso B\nCASO A) Si el env√≠o es para los distritos permitidos de Lima Metropolitana.\n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Direcci√≥n exacta.‚Äù\n2) Validaci√≥n: Diego acepta cualquier formato de nombre y direcci√≥n que el cliente proporcione. No debe cuestionar la direcci√≥n, solo recopilarla.\n3) Utilizar tool: Una vez que tengas ambos datos utiliza la tool ‚Äúconfirmacion_pedido‚Äù y env√≠a las siguientes variables:\n‚ÄúNombre‚Äù\n‚ÄúDireccion exacta‚Äù\n‚Äúproductos‚Äù: el producto o los productos env√≠alos de esta forma: \"Producto 1: [Categor√≠a: Full Size/Decant/Set] [Nombre del Perfume] - [Precio] - [Cantidad]. (Repetir si hay m√°s productos)\".\n4) Confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: Tu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada\nCASO B) Si es de Provincia: \n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Apellidos\\n- DNI\\n- Ciudad/provincia\\n- Nombre de la agencia Shalom donde recoger√°‚Äù\n2) Validaci√≥n: Diego acepta los datos tal cual los env√≠e el cliente (no corregir DNI ni nombres). \n3) Utilizar tool: Una vez identificado todo los datos que solicitaste, utiliza la tool ‚Äúconfirmacion_pedido‚Äù con las siguientes variables:\n\n‚ÄúNombre‚Äù\n‚ÄúApellidos‚Äù\n‚ÄúDNI‚Äù\n‚ÄúCiudad/provincia‚Äù\n‚ÄúNombre_agencia_shalom‚Äù\n‚Äúproductos‚Äù: (Misma l√≥gica del CASO A: Categor√≠a, Nombre, Precio y Cantidad)\nNota: en este caso la variable ‚Äúdireccion_exacta‚Äù coloca ‚Äúnull‚Äù.\n4) confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: ‚ÄúTu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada.‚Äù\n\n###SECCI√ìN: EJEMPLO DE ENTREGA DE INFORMACI√ìN DE PERFUME\nEjemplo 1 (Un perfume con stock):\n\"El Hawas Ice s√≠ lo tengo en stock. El precio es de S/ 180. Es un perfume ultra fresco y potente, de los que m√°s piden.\"\nEjemplo 2 (Sin stock + Similares sugeridos):\n‚ÄúEl Valentino est√° agotado. Tengo estos que son de la misma vibra y huelen incre√≠ble:\\nJPG Le Male Elixir a S/ 450\\n\\nScandal Le Parfum a S/ 420 ¬øAlguna de esas opciones te llama la atenci√≥n?\"\nEjemplo 3 (M√∫ltiples perfumes con stock):\n\"Tengo los dos disponibles:\\n\\n9 PM a S/ 140\\nKhamrah Dukhan a S/ 175\"\nEjemplo 4 (Stock mixto):\n\"Hermano, te confirmo: el CDN Intense s√≠ lo tengo listo para enviar a S/ 190. El Azzaro lo tenemos sin stock. ¬øQu√© otro perfume te gustar√≠a?\nEjemplo 5 (Decants m√∫ltiples):\n\"Los tengo disponible:\\n\\n9pm Elixir (5ml): S/ 35\\nYara (10ml): S/ 45\\nKhamrah (5ml): S/ 40\\n\\n¬øTe armo el pack con estos tres o quieres chequear alguno m√°s?\"\n\n#EJEMPLOS DE RESUMEN DE COMPRA\n## EJEMPLOS SOLO PERFUMES FULL SIZE\n### Ejemplo 1: Si es solo un perfume\n\"Resumen de compra:\\n- Hawas Ice\\nüì¶ Cantidad: 1\\nüí∞ Precio unitario: S/ 180\\n\\nüíµ Total: S/ 180\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s perfumes Resumen de compra:\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah Dukhan\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 175\\n\\nüíµ Total: S/ 315\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS SOLO PERFUMES DECANTS\n### Ejemplo 1: Si es solo un decant Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- 9 PM Elixir (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 35\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Si son varios decants Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- Yara (10ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 45\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\nüíµ Total: S/ 125\\n\\n¬øMe indicas el distrito para continuar?\"\n## EJEMPLOS SOLO SET DE PERFUMES\n### Ejemplo 1: Si es solo un set Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 220\\n\\nüíµ Total: S/ 220\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s sets Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\n- GOS Set\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 240\\n\\nüíµ Total: S/ 450\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS DE PEDIDOS COMBINADOS\n### Ejemplo 1: Perfume Full Size + Decants\n\"Resumen de compra:\\n- Lattafa Asad\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 150\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Yara (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 225\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Compra Integral (Full Size + Decant + Set)\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\nüíµ Total: S/ 390\\n\\n¬øMe confirmas el distrito para avanzar con el pago?\" \n\n# EJEMPLOS DE FLUJO DE CONVERSACI√ìN CORRECTO\n## EJEMPLOS SI EL CLIENTE DESEA EL ENV√çO PARA LIMA\n1) Pago completo (Perfume + Env√≠o)\nCliente: Hola, quiero el Hawas Ice para Miraflores.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Hawas Ice s√≠ est√° disponible y cuesta S/180. ¬øDeseas agregar algo m√°s a tu compra?.\nCliente: No, solo eso. ¬øC√≥mo hago el pago?.\nDiego: Para Lima puedes confirmar pagando solo S/12 del env√≠o y el saldo al recibir, o pagar el monto total de S/192. Puedes yapear al 987108094 a nombre de Brandon Quelopana o por transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/192).\nDiego (Tras validar Imagen_analizada): Pago de S/192 verificado. P√°same tu nombre, celular y direcci√≥n exacta para programar el env√≠o. Como pagaste antes de las 10:00 am, llega hoy mismo.\n2) Pago parcial (Solo env√≠o S/12 + Saldo contra entrega)\nCliente: Precio del 9 PM. Estoy en San Borja.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El 9 PM cuesta S/140. ¬øQuieres agregar algo m√°s o solo ese?.\nCliente: Solo ese. Quiero pagar solo el env√≠o ahora.\nDiego: Entendido. Para Lima puedes confirmar pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Yapea al 987108094 (Brandon Quelopana) y me mandas la captura.\nCliente: (Env√≠a captura por S/12).\nDiego (Tras validar Imagen_analizada): Reserva de S/12 verificada. P√°same tu nombre, celular y direcci√≥n exacta. El saldo de S/140 lo pagas al recibir el producto.\n## EJEMPLO SI EL CLIENTE DESEA EL ENV√çO PARA PROVINCIA\n3) Pago total obligatorio para Provincia (V√≠a Shalom)\nCliente: Hola, precio de Asad para Piura.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Lattafa Asad cuesta S/150. ¬øDeseas agregar alg√∫n decant o solo el perfume?.\nCliente: Solo el perfume. ¬øCu√°l es el m√©todo?\nDiego: Para env√≠os a provincia el pago se realiza por el monto total de S/162, que incluye los S/12 de env√≠o por Shalom. Puedes pagar por Yape al 987108094 (Brandon Quelopana) o transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/162).\nDiego (Tras validar Imagen_analizada): Pago de S/162 verificado. P√°same tu nombre, apellidos, DNI, celular, ciudad y el nombre de la agencia Shalom donde lo recoger√°s. \n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-5136,288],"id":"87ad49a4-0b30-4cf2-bd78-475265d05fe3","name":"AI Agent"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","typeVersion":1,"position":[-3472,528],"id":"0af2d781-c62f-4cfa-8636-6576d2801773","name":"Auto-fixing Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3504,704],"id":"0be267ba-446a-4cd1-8c35-ea2e696d7e8b","name":"OpenAI Chat Model8","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"response\": {\n    \"parte_uno\": \"Texto correspondiente a la primera parte de la respuesta.\",\n    \"parte_dos\": \"Texto correspondiente a la segunda parte de la respuesta.\",\n    \"parte_tres\": \"Texto correspondiente a la tercera parte de la respuesta (opcional).\",\n    \"parte_cuatro\": \"Texto correspondiente a la cuarta parte de la respuesta (opcional).\",\n    \"imagen_uno\": \"Imagen correspondiente\",\n    \"imagen_dos\": \"Imagen correspondiente (opcional).\",\n    \"video_mp4\": \"Video .mp4 (opcional)\"\n}\n  }"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-3328,704],"id":"05f11a4e-1bcc-4829-a163-8b4e3e1f1534","name":"Structured Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3744,624],"id":"f2dd9e17-523b-4e58-9b8e-5f00f8fa704f","name":"OpenAI Chat Model9","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"={{ $json.output }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Obtener el texto de entrada:\n\nRecupera el texto de la variable items\n{{ $json.output }}\nLimpieza y normalizaci√≥n del texto:\n\nCrea una funci√≥n que limpie el texto eliminando los siguientes caracteres: ¬ø, ¬°, @, \", *, #.\n\nElimina los espacios en blanco al inicio y al final del texto.\nNo Elimines los emojis, ni los markdown para que los mensajes esten limpios.\nDivisi√≥n del texto en partes:\n\nImplementa una funci√≥n que divida el texto limpio en fragmentos de m√°ximo 800 caracteres sin cortar palabras. Si necesitas cortar uno de los fragementos del mensaje antes de 800 Caracteres para que no se corten mensajes hazlo. Los mensajes deben quedar completo y coherentes\nLa funci√≥n debe asegurarse de que cada fragmento se corte en espacios para no dividir palabras a la mitad.\nSi tienes que aumentar la cantidad de caracteres para que parte del mensaje no quede cortado o quede mal puedes hacerlo sin un limite de caracteres. Esto para que los mensajes sean mas organicos y funcionen bien. Tambien al identificar una imagen necesito que el link lo separes para que se mande separado.\n\n*SIEMPRE* que haiga un Link del video de youtube del tratamiento o presentaci√≥n, mandalo como parte del texto con su contexto, *NUNCA* lo pongas en la parte de imagen uno y dos.\n\n*NUNCA* pongas el link del video.mp4 en las partes de texto e imagen, *SIEMPRE* si es que tienes algun video con .mp4 ponlo en video_mp4.\n\nDeber√°s de enviarlo siempre a la √∫ltima parte pero solo eso.\nConstrucci√≥n de la respuesta:\n\nCrea un objeto JSON con la siguiente estructura:\n\n{\n  \"response\": {\n    \"parte_uno\": \"<primer fragmento>\",\n    \"parte_dos\": \"<segundo fragmento>\",\n    \"parte_tres\": \"<tercer fragmento>\",\n    \"parte_cuatro\": \"<cuarto fragmento>\",\n    \"imagen_uno\": \"<primera imagen>\",\n    \"imagen_dos\": \"<segunda imagen>\",\n    \"video_mp4\": \"<video.mp4>\"\n\n  }\n\n- Si hay un emoji como un check o algo por el estilo que desmuestre un enlistado, opciones o variantes similares, dale salto de linea para que parezca natural, recuerda reemplazar el \"\\n\" por un enter.\n\nSi alguna parte no existe, asigna una cadena vac√≠a (\"\").\n\n\n### Notas \n\n- Nunca debes hacer saltos de linea que no sean naturales evita si en algun momento un mensaje tiene un \":\" que el mensaje que le siga este en la otra parte del mensaje. debe ser lo mas natural posible.\n\n- S√≠ el texto tiene un saludo de bienvenida o algo parecido, *SIEMPRE* separalo en una parte y las siguientes partes separalos de tal forma que se vea ordenada y estructuradas tus respuestas.\n- En caso veas una palabra en asteriscos, ejemplo: **Botox:** deber√°s de quitarle los dos de los extremos y deber√° de quedar as√≠ *Botox:*.\n- *NUNCA* deber√°s de cortar el contexto del mensaje, quiero decir que si ves que el mensaje trata de un tema en espec√≠fico o seccion no deber√°s de cortarlo.\n\nEs Obligatorio reemplazarlo, no eliminarlo. NUNCA DEJAR NINGUNA PARTE VAC√çA OBLIGATORIAMENTE.\n\n- *SIEMPRE* REEMPLAZA \"\\n\" por un salto de linea normal (enter) ejemplo:\n{\n  \"response\": {\n    - opcion 1\n    - opcion 2\n    - opcion 3  \n  }\n}\n\n- *SIEMPRE* y cuando te lleguen dos links de Video.mp4, agarra el primero y no pongas los 2 juntos, si es posible, elimina uno para que solo quede uno.\n\n- *regla adicional* cuando llegue un link que est√© en .jgp .jpeg y .PNG a√±adelo a la parte de imagen, y si est√° en .mp4 a√±adelo al apartado de video "}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-3600,256],"id":"7ca03140-46dd-4d3c-a332-e3ee2072ded6","name":"Verificador1","onError":"continueErrorOutput"},{"parameters":{"httpMethod":"POST","path":"BRADA","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-15296,608],"id":"dbcc07c3-6246-4bdb-878b-af891629f8c8","name":"Webhook","webhookId":"fb43e7b4-c71f-4cad-bebd-32a81374fc49"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n","tableName":"healup","contextWindowLength":12},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-5200,48],"id":"39798e20-26eb-4032-ae59-7f5d5b5f7d8b","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"NzQUFXQpp2MvRekP","name":"CUENTA ALEGRATED"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8fa70db3-09c3-4e87-8fc9-4052751fad3f","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9840,512],"id":"d53b946f-7849-4a0c-91b8-673d822caa58","name":"If2","alwaysOutputData":false,"retryOnFail":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"576350e5-ed67-4ce9-815e-0f0a0ef0b1c7","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9616,688],"id":"3d169320-db83-4f3e-b8ec-cf4189ac8d7a","name":"If3"},{"parameters":{"assignments":{"assignments":[{"id":"1aa91b6d-c441-4496-beee-4af2457332ac","name":"pasar_supervisor","value":"={{ $json.pasar_supervisor }}","type":"string"},{"id":"34e35c66-589c-4146-ab9c-3d08b024a7c1","name":"n√∫mero","value":"={{ $json.numero }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-9984,512],"id":"e5878ba6-1987-4774-811f-c2cee034cb0a","name":"Edit Fields4"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-9184,992],"id":"02219ac8-19fd-463b-b35f-8880e0676c67","name":"No Operation, do nothing4"},{"parameters":{"name":"pasar_supervisor","description":"Llama esta herramienta cuando desees pasar a supervisor.","workflowId":{"__rl":true,"value":"2lPoYs00jPGwaBxq","mode":"list","cachedResultUrl":"/workflow/2lPoYs00jPGwaBxq","cachedResultName":"Supervisor Solari"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('Edit Fields20').item.json.id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-7248,464],"id":"b5e6fa52-fde1-4c70-b3ba-07a042587076","name":"Supervisor2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"98601c0c-949c-4f3d-99f2-40305665d58a","leftValue":"={{ $json.numero }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-10704,576],"id":"40fc0c0b-0829-40fc-81d5-3da1f46a7a9b","name":"If13"},{"parameters":{"name":"=Agendar","description":"=Agendar citas ","source":"=database","workflowId":{"__rl":true,"value":"konppOdwditJvoJQ","mode":"list","cachedResultUrl":"/workflow/konppOdwditJvoJQ","cachedResultName":"agendarSUNAT WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre_completo":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre_completo', ``, 'string') }}","DNI":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('DNI', ``, 'string') }}","numerotelefono":"={{ $json.id }}","inicio_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('inicio_cita', ``, 'string') }}","fin_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fin_cita', ``, 'string') }}","tratamiento(s)":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('tratamiento_s_', `Coloca el tratamiento que se haya mencionado durante la conversaci√≥n, seg√∫n esta lista de tratamientos:\n\n- Lipopapada & Afinamiento Facial Enzim√°tico\n- Natural Lips\n- Bratz Lips\n- Perfilamiento de nariz\n- Rinomodelaci√≥n completa\n- Exosomas + Esperma de Salm√≥n\n- Proyecci√≥n de Ment√≥n con √Åcido Hialur√≥nico\n- Baby Botox\n- Botox Full Face\n- Marcaci√≥n mandibular\n- Masseter Botox\n- Surcos Nasogenianos\n- Sustentaci√≥n pomular\n- √Åcido Hialur√≥nico para ojeras\n- NCTF\n- Hidralips con Dermapen\n- Plasma Rico en Plaquetas (PRP)\n- Armonizaci√≥n Facial \n\n- Glass Skin Babe\n- CalmBabe\n- Pure Babe Skin\n- Heal Up Babe Ritual\n- Prime Skin Clean\n- Eternal Glow Boost\n- Prestige Glow Ritual\n- Heal Up Signature Glow\n\n- Lipo Start Protocol\n- Lipo Sculpt Protocol\n- Lipo Intensive Shape Protocol\n- Heal Up Lipo 360‚Äù.\n\nNota: Si el paciente consult√≥ sobre m√°s de 1 tratamiento, a√±adelo con una coma. por ejemplo: Rinomodelaci√≥n completa, Baby Botox.\n`, 'string') }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","red_social":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('red_social', `Coloca esta palabra: WhatsApp`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"nombre_completo","displayName":"nombre_completo","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"inicio_cita","displayName":"inicio_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"fin_cita","displayName":"fin_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"numerotelefono","displayName":"numerotelefono","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"DNI","displayName":"DNI","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"red_social","displayName":"red_social","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"tratamiento(s)","displayName":"tratamiento(s)","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-5504,784],"id":"5334487f-6a0c-48f2-8833-2cece4f6c66e","name":"Calendario"},{"parameters":{"tableId":"pasar_supervisor_BRADA","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"},{"fieldId":"conversation_id","fieldValue":"={{ $('If12').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10480,832],"id":"6da92ad7-7496-46b2-ad7a-af1302bdca1b","name":"Create a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10192,512],"id":"e01e05d9-2c86-4f10-8067-8d296b347400","name":"Get a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9536,416],"id":"08f4c79d-67de-4997-8b28-3d94436c885c","name":"Update a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10960,592],"id":"0383d00f-4ae0-4f14-850a-4ee2703bbc58","name":"Get a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2acc3e64-d51a-4e98-84a5-e2b17c788fa2","leftValue":"={{ $('Webhook').item.json.body.payload.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7312,592],"id":"645bde3e-f301-4b37-a037-b78f2c234bab","name":"If4"},{"parameters":{"operation":"formatDate","date":"={{ $json.currentDate }}","format":"custom","customFormat":"DDDD tt","options":{"timezone":true}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-6896,576],"id":"c0cfb4f3-987c-429b-9a57-9f8b58dd70a2","name":"Formatea fecha"},{"parameters":{"assignments":{"assignments":[{"id":"d78c89a3-c878-48b7-aa84-4b2674c0667b","name":"data.remoteJid","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation.contact_inbox.source_id }}","type":"string"},{"id":"432a9602-e38b-4880-a64d-b832d120edda","name":"data.id","value":"={{ $('Webhook').item.json.body.id }}","type":"string"},{"id":"d2f45efc-03ac-4c74-b70e-959b06cd2a0b","name":"data.text","value":"={{ $('Edit Fields17').item.json.mensajetexto }}{{ $('Edit Fields17').item.json.mensajeaudio }}{{ $('Edit Fields17').item.json.mensajeimagen }}","type":"string"},{"id":"d77208a8-161b-4ef3-96fa-261a87cf1f39","name":"conversation_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","type":"string"},{"id":"8c279598-20f0-4012-a4ee-8c7898ceaba4","name":"account_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].account_id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6448,576],"id":"e0ece9a2-acd1-450f-9e2f-a45df7d9021e","name":"Handler variables"},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-7072,576],"id":"34435b05-c9a2-4759-b275-a239d12bbcb1","name":"Fecha"},{"parameters":{"jsCode":"// 1. Obtener la fecha de entrada\nconst inputDateString = $input.item.json.formattedDate; \nconst date = new Date(inputDateString);\n\n// 2. Obtener hora actual para la l√≥gica\nconst currentHour = date.getHours();\n\n// Clonamos la fecha para calcular el env√≠o\nlet scheduledDate = new Date(date);\n\n// 3. L√≥gica de Negocio (Reglas de horario)\nif (currentHour >= 19 || currentHour < 5) {\n  // Caso Nocturno (19:00 - 04:59): Programar para las 09:00 AM\n  scheduledDate.setHours(9, 0, 0, 0);\n  \n  // Si es >= 19:00, pasa al d√≠a siguiente.\n  if (currentHour >= 19) {\n    scheduledDate.setDate(scheduledDate.getDate() + 1);\n  }\n} else {\n  // Caso Diurno (05:00 - 18:59): Sumar 4 horas\n  scheduledDate.setHours(scheduledDate.getHours() + 4);\n  // Reiniciamos minutos y segundos a 0 para mantener limpieza (opcional, pero recomendado)\n  scheduledDate.setMinutes(0);\n  scheduledDate.setSeconds(0);\n}\n\n// 4. FORMATEO DE SALIDA \"dd/mm/yyyy HH\"\n// Usamos .padStart(2, '0') para asegurar dos d√≠gitos (09, 05, etc.)\n\nconst day = scheduledDate.getDate().toString().padStart(2, '0');\nconst month = (scheduledDate.getMonth() + 1).toString().padStart(2, '0');\nconst year = scheduledDate.getFullYear();\nconst hourFormatted = scheduledDate.getHours().toString().padStart(2, '0');\n\n// CONSTRUCCI√ìN FINAL: dd/mm/yyyy HH\n// Nota: Eliminamos los minutos (:${minuteFormatted}) de esta l√≠nea\nconst fecha_final = `${day}/${month}/${year} ${hourFormatted}`;\n\nreturn {\n  json: {\n    original_input: inputDateString,\n    // Variable solicitada con el formato exacto\n    fecha_lora_formateada: fecha_final,\n    // Variable extra por si necesitas solo la hora aislada\n    solo_hora: hourFormatted\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6640,576],"id":"7235933b-bf69-4698-9133-cfe47b370ffc","name":"Code2"},{"parameters":{"amount":30},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-7312,1072],"id":"6e3e7abf-d38f-40b1-b0c4-a8e166fc036c","name":"Wait6","webhookId":"5696ca8f-19ae-4cd6-8008-6132ce1cf272"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8a313a41-eadc-4ada-bc2a-feff79845de9","leftValue":"={{ $json.mensajes[0] }}","rightValue":"={{ $('Handler variables').item.json.data.text }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6864,1296],"id":"76729177-6c0d-4ec2-bf0a-0604e5bbf8a9","name":"If6"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-6544,1376],"id":"2c667d72-3de1-4d9e-bff9-88ce886f1c91","name":"No Operation, do nothing1"},{"parameters":{"operation":"delete","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6240,1024],"id":"31c060d8-e6c1-489f-924b-36ee33dce137","name":"Delete Redis","executeOnce":false,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $('Get Redis1').item.json.mensajes.join() }} y el lead viene de un anuncio : {{ $('RESUMIDOR ANUNCIOS').item.json.output }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Wait6').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.payload._data.Info.PushName }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6352,832],"id":"fa0d6541-f1f5-42a3-918d-072dec78f8be","name":"Edit Fields19","alwaysOutputData":true},{"parameters":{"operation":"get","propertyName":"mensajes","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","keyType":"list","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6960,1088],"id":"eb2e5436-c84c-4660-a049-366ff67222ee","name":"Get Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $json.anuncio }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Handler variables').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.conversation.messages[0].sender.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6368,992],"id":"a0199bbc-432c-4d05-a271-0c734eec08cd","name":"Edit Fields20","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3e8a5a20-c60c-48ef-a636-2b5e14a683a8","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6608,944],"id":"61e1b52d-148e-41fd-9b0b-7e4895ad7a0a","name":"If15"},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1136],"id":"edcdff4c-5e82-4bfe-8beb-45b771f8bed2","name":"METER_ANUNCIO","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1296],"id":"666f3eb7-d307-4a99-abd7-1f526c0907fd","name":"BAJAR_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}_ad","messageData":"={{ $('RESUMIDOR ANUNCIOS').item.json.output }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8064,1136],"id":"5a5ab926-f0b0-420f-ad66-6f99a6d9eb9f","name":"guarda_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3deed863-79f3-42e5-a32c-6cb7bb1028df","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7616,512],"id":"46ecb883-24f2-490a-a44c-a9e6dd7a5ab2","name":"If"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-7488,32],"id":"76495bc9-2132-42c6-8f98-7f222fbc58ab","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"8f567177-8b37-4a09-9a53-ac9fe424c843","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6240,576],"id":"49f7d2d6-bf9c-4b3f-bde9-d5b04db1203a","name":"If10"},{"parameters":{"operation":"get","propertyName":"anuncio","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6752,944],"id":"16a19e11-3a97-49d7-b868-7b84b7799dc7","name":"Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-6928,272],"id":"31f4a897-b5fc-4baa-a8ac-c4645d7e6b10","name":"Update a row4","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"Describe esta imagen\n","imageUrls":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].data_url }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8864,560],"id":"655bda6d-6ab1-42a8-85c1-736575210b9b","name":"OpenAI","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"437f223f-80c7-4c47-a50b-9d17a8614251","name":"imagen_caption","value":"={{ $json.content }} .\nEl captions del mensaje de imagen es: {{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8448,688],"id":"fa56722a-8385-4847-b719-f90a132dfbd1","name":"Edit Fields12"},{"parameters":{"url":"={{ $('Webhook').item.json.body.attachments[0].data_url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-8896,368],"id":"f1138959-5c6f-4058-a15b-6e56bdaab777","name":"HTTP Request"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"27bcc104-31e3-4687-b60b-a018c457a3a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"audio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2e8b532f-1f01-45f9-a647-e7a5c9e48aac","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"image","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Imagen"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"59f6b23a-3029-4225-8f9e-3744611a04a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"=text","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"28de146f-c104-4171-924a-29963c4f1970","leftValue":"={{ $('Webhook').item.json.body.content_type }}","rightValue":"text","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-9216,416],"id":"b138e8be-c1d3-4f8a-8423-93fb52834ba7","name":"Switch3"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8624,368],"id":"f26677a7-27a0-43ed-8071-3e3064e25db4","name":"AUDIO1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"276cbb8a-79f2-4f08-b24a-632f474c6013","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-8624,560],"id":"f29adecc-e9d9-4222-9ec3-107cac681c09","name":"If16"},{"parameters":{"assignments":{"assignments":[{"id":"c0a1b2f0-373e-4b86-ae91-25346b20b404","name":"mensajetexto","value":"=Texto mensaje: [{{ $('Webhook').item.json.body.conversation.messages[0].content }}]  ","type":"string"},{"id":"35cd9184-e37e-4d03-9dff-efb319dce478","name":"mensajeaudio","value":"={{ $json.text }}","type":"string"},{"id":"47e9bfe8-2c55-4b5d-b047-024871fc6c21","name":"mensajeimagen","value":"=Imagen analizada: [{{ $json.content }}{{ $json.imagen_caption }}]","type":"string"},{"id":"9926d346-600f-45af-adad-876e9f40ffa4","name":"imagenanalizada","value":"=Imagen de anuncio analizado: {{ $json.content }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8064,480],"id":"8a1f15fa-bf4b-4c01-adbb-7a1a21d7a706","name":"Edit Fields17","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $('Webhook').item.json.body.payload.body }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7120,400],"id":"7ab44ba1-258f-4193-929d-15aa68334a0f","name":"If11"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f05066b5-5a07-41fa-96b7-7a244e7345c8","leftValue":"={{ $json.body.payload.fromMe }}\n","rightValue":"true","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12384,608],"id":"d94743f2-3b7b-460b-bc26-33eae6240210","name":"If12"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $json.body.conversation.messages[0].content }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12224,752],"id":"23a75e86-d3fd-4b05-8d58-aa9da67a47d8","name":"If20"},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-12144,1008],"id":"a93457ed-fd5d-4186-b320-c1a49417136c","name":"Update a row6","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"name":"informacion","description":"utiliza esta tool cuando se necesite informaci√≥n seg√∫n las indicaciones del prompt principal.","workflowId":{"__rl":true,"value":"FB7us6cBaq7jWqB2","mode":"list","cachedResultUrl":"/workflow/FB7us6cBaq7jWqB2","cachedResultName":"informacion HEAL UP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}"},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-6080,784],"id":"e0e915c5-fd08-4168-be41-783aa4ce1390","name":"informacion_tratamientos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"987d5d07-58eb-4927-8e68-a137884b8100","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].message_type }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13248,608],"id":"5e339c78-27b7-41de-8774-f34bd2e49752","name":"If1"},{"parameters":{"jsCode":"// Tomamos todos los items que vienen del nodo anterior (Verificador1)\nconst items = $input.all();\n\nfor (const item of items) {\n  // Aqu√≠ est√° tu objeto con parte_uno, parte_dos, etc.\n  // Verifica la ruta: output.response\n  const resp = item.json.output?.response || {};\n\n  // Orden que quieres respetar\n  const orderedKeys = [\n    'parte_uno',\n    'parte_dos',\n    'parte_tres',\n    'parte_cuatro',\n    'imagen_uno',\n    'imagen_dos',\n    'video_mp4',\n  ];\n\n  // Armamos un nuevo objeto response en el orden deseado\n  const newResponse = {};\n  for (const key of orderedKeys) {\n    if (resp[key]) {\n      newResponse[key] = resp[key];\n    }\n  }\n\n  // Sobrescribimos manteniendo la estructura original\n  if (!item.json.output) item.json.output = {};\n  item.json.output.response = newResponse;\n}\n\n// Devolvemos los items modificados\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2752,352],"id":"24f0ff65-46ee-441c-a6d4-8f9095be5ae0","name":"ordenar"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $json.output.response.parte_uno ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2720,1088],"id":"88a82162-8ee2-4a01-8f95-a7350bae11d1","name":"Respuesta1","executeOnce":false},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1776,832],"id":"cce742aa-91d4-4fd6-971b-02494cc4941d","name":"Wait2","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_dos ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1600,928],"id":"6c953a90-8ee3-40d6-b6fd-f29c2e766496","name":"Respuesta2","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1312,848],"id":"0a8bc622-6c9b-472d-8735-328b027264ff","name":"If14"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1120,832],"id":"568f10ce-4d13-4754-843d-d05277b38f48","name":"Wait3","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_tres ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-912,896],"id":"3cb7de22-5651-4c25-b9eb-6132643c3bbe","name":"Respuesta3","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-496,752],"id":"af5809e5-112a-4632-aeaf-44bd7061fd9e","name":"If17"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-480,976],"id":"d9d3f88f-ef89-458a-8d83-ad4661e1b4e6","name":"Wait4","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=hcy6n6RAJTBAAYguVuewgp2A"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_cuatro ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-256,1008],"id":"319a272b-7a67-4de3-bcc3-381f609226df","name":"Respuesta4","executeOnce":false},{"parameters":{"promptType":"define","text":"=Te va a llegar esta descripcion de un anuncio: {{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","options":{"systemMessage":"ROL:\nTu rol es indicar el mismo input que te llega y enviarlo como output."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-7504,192],"id":"7dd13519-eebb-4cd8-9fbe-870c4eb2ea0b","name":"RESUMIDOR ANUNCIOS"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1a9dd789-5c10-4489-a344-6b7a0fd041ea","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51902215511","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"912d0724-5ef1-4f88-9d43-acbb38f48cee","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51993708540","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"e50ad623-45f5-4af7-bc5a-89708016ddf8","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51972619000","operator":{"type":"string","operation":"equals"}},{"id":"9ffd5afb-ec0c-49fc-a144-b682386c760c","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51960239280","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"50ddfe27-4e13-4e3c-8216-aca1f181f77a","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51936196001","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"7650a20c-4ba9-4e41-bd67-89e8f77278fc","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"14502413970","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"bdfe444d-b4d9-4789-971d-08420999d775","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51945157250","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"5f1e9684-e18d-4a9f-aad7-bef2235f631d","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51971119678","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13888,864],"id":"fc9e995e-943d-4cce-8e72-ee42d86cee6c","name":"If18"},{"parameters":{"description":"usa la tool supervisor seg√∫n el prompt principal","workflowId":{"__rl":true,"value":"xchwhR053ynGsZI4","mode":"list","cachedResultUrl":"/workflow/xchwhR053ynGsZI4","cachedResultName":"SUP SUNAT"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $json.id }}","conversation_id":"={{ $('If7').item.json.conversation_id }}","inbox_id":"={{ $('If12').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5616,832],"id":"5e99594b-abaa-47fe-872d-198f951381e9","name":"Supervisor"},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje1","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_uno }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"},{"fieldId":"account id","fieldValue":"={{ $('Webhook').item.json.body.account.id }}"},{"fieldId":"conversation id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2544,1088],"id":"476c18e7-85f6-493d-b3aa-14cfdf31bcc3","name":"Update a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje2","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1472,944],"id":"d7b09d89-120c-41de-af99-2ac3e43b9c64","name":"Update a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje3","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-720,896],"id":"87f26d37-d4e6-4022-b8e7-d0be58f20d22","name":"Update a row5","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"seguimiento_healup","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-15088,608],"id":"f952306b-6aab-4f21-ba58-cdd5dcebe32c","name":"Get a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}},"disabled":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"60e8198a-90ea-44a7-8f27-6e37021a1a02","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje1 }}","operator":{"type":"string","operation":"equals"}},{"id":"4541b27d-6dfa-47d7-bbff-d1a5c2e6ffd1","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje2 }}","operator":{"type":"string","operation":"equals"}},{"id":"20ce2efd-2509-40d0-b670-2c484246fa28","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje3 }}","operator":{"type":"string","operation":"equals"}},{"id":"b74b14df-879c-4427-8888-d7e1e3212ddc","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje4 }}","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-14880,608],"id":"5c2a2d65-e6b0-4eff-8611-1286cc5f3519","name":"If19","alwaysOutputData":true,"disabled":true},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje4","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[0,1008],"id":"3bfbc342-a045-4fb3-b813-77c25a76e4fd","name":"Update a row7","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"daeff2da-d88d-4aa7-b4d9-8b808c58b7c8","leftValue":"={{ $json.conversation_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7664,1824],"id":"4456591c-6e0e-41e1-8fe3-d6b190cf5b8a","name":"If7"},{"parameters":{"operation":"get","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","keyValue":"={{ $('Get a row3').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7920,1520],"id":"7eb28718-e96b-48aa-aaa6-9595b57209be","name":"Get a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"BRADA_followups","fieldsUi":{"fieldValues":[{"fieldId":"conversation_id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7232,1664],"id":"032dfeeb-7358-4670-bfc8-e64deb12607b","name":"Create a row1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"model":"gpt-5.1","options":{"reasoningEffort":"low"}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5440,496],"id":"ff0bf49f-19d4-4e02-92fc-84ddcb1a06e5","name":"RAZONADOR PLUS","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7536,1424],"id":"456e5e75-da23-4eaf-b219-2d0e6a4c9772","name":"Update a row9","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"pasar_supervisor_healup","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9872,1184],"id":"22e69871-698c-451d-97be-e15985b9f1ca","name":"Create a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"method":"POST","url":"=https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": \"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg\",\n  \"message_type\": \"outgoing\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3152,1440],"id":"1e6becc0-86ad-4636-968f-82b82ce1d008","name":"Respuesta6","executeOnce":false},{"parameters":{"url":"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3648,1424],"id":"c91882f6-4156-4928-83f4-db575130f873"},{"parameters":{"method":"POST","url":"https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content","value":"Aqu√≠ tienes la imagen adjunta üëá"}]},"options":{}},"name":"2. Enviar a Chatwoot","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3440,1408],"id":"bb8131d9-ee4a-4ce7-bfcd-6484ee58e6e9"},{"parameters":{"content":"## EJEMPLO IMAGENES\n","height":320,"width":560},"type":"n8n-nodes-base.stickyNote","position":[-3744,1328],"typeVersion":1,"id":"14ea41f0-1e70-47f8-ad8d-cad36bd5ba28","name":"Sticky Note"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2352,1056],"id":"da693219-5a37-4d6b-b186-6b04eb3a09a2","name":"If8"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1184,1440],"id":"00fb4ecc-2c2b-43c7-a5b0-3bc928404b03","name":"If23"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-976,1424],"id":"b350fa31-345e-420d-9213-4ccd1c603f30","name":"If26"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-624,1840],"id":"4b2323d7-ade6-4594-9192-1b4e2251a93b","name":"If27"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1248,1392],"typeVersion":1,"id":"ffa9ce31-0ae1-4e74-af8a-05d40968ab54","name":"Sticky Note2"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-752,1440],"id":"84b7f3b1-5259-47e9-976f-6a01df9ed583","name":"Wait","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-176,1648],"id":"acf88893-aecd-41e2-8a76-6b13efecaf2c","name":"If40"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[192,1856],"id":"324684bf-472a-4b17-a5fc-3b12d1f0e647","name":"If42"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1648],"id":"9da856cd-4d80-4b0d-84b5-9d412e3a3420","name":"Wait5","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1856],"id":"918310b1-c0da-46c2-80cf-8343bacd20a5","name":"Wait7","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[400,1872],"id":"30392c9c-d8a1-4a3a-8173-0ef149b4dadb","name":"Wait8","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-976,1600],"id":"3270bad6-15d8-4f71-a811-c3359fdab4e3","name":"Wait9","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[32,1664],"id":"e5ada578-5738-42b2-98f2-9c73991a85e8","name":"Wait10","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-608,1600],"id":"f693b423-1013-4d25-a66c-54422bfde206"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-2","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-784,1600],"id":"f2f64f92-df6b-4114-863d-2f5463a5bff7"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[0,1856],"id":"15cd3fea-5316-48c1-87b3-10b8b49c2919"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-3","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-176,1856],"id":"97e4385e-224d-4e1b-814b-55d7358b7f8e"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot34","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[720,1872],"id":"d96e4430-aea9-4374-b39b-75bec4c5b6dc"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-4","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[544,1872],"id":"d9dc6055-97c0-4412-8284-39dd78540a56"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot35","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[368,1664],"id":"e7946bf5-eb93-47a1-8f0a-788003fd3e1d"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-5","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[192,1664],"id":"b835a15f-edb3-45a2-b27b-a2905ade226f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot36","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-416,1440],"id":"97aa4aac-4a3b-4632-a2eb-32fe5486d166"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-6","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-592,1440],"id":"dd6f4397-190c-4511-84ba-a4ddb75136be"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":3},"conditions":[{"id":"b2a6d2d7-c61b-43ef-99fe-cc95d8413e94","leftValue":"={{ $json.body.conversation.messages[0].sender.phone_number }}","rightValue":51971119678,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-14480,592],"id":"65ea26bb-db5c-45f1-a288-c16501032d3c","name":"If5"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-14240,368],"id":"3b9693a6-6e3f-4174-9556-ba7477824248","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', ``, 'string') }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-13856,272],"id":"ff60e952-557a-4961-b575-24caf1329c1f","name":"pasar_supervisor","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $json.body.content }}\n\n","options":{"systemMessage":"=# üéØ ROL\nEres el Agente **Aura**. Tu √∫nica funci√≥n es extraer, **normalizar** y enviar un n√∫mero de tel√©fono a la tool \"pasar_supervisor\" El n√∫mero puede ser nacional (Per√∫) o extranjero, y debes procesarlo seg√∫n las reglas para que la tool reciba solo d√≠gitos.\n\n# üì• INPUT (Solicitud de Recepcionista)\nRecibir√°s una solicitud de la recepcionista para transferir un paciente.\nEl patr√≥n de la solicitud ser√° similar a: **Pasar a supervisor el n√∫mero: [N√∫mero variable]**\nEl n√∫mero puede llegar en formato completo (`519...`), solo el n√∫mero nacional (`9...`), o en formato internacional (`+1...`).\n\n# ‚öôÔ∏è INSTRUCCIONES ESTRICTAS (Funci√≥n sin Estado)\n\n1. Cada input es una solicitud √∫nica. Tu tarea finaliza con la ejecuci√≥n de la tool.\n\n2. **Identificaci√≥n:** Busca y extrae el n√∫mero que sigue inmediatamente al patr√≥n: **Pasar a supervisor el n√∫mero:** o **Manda a supervisor el n√∫mero**.\n\n3. **Normalizaci√≥n:** Antes de usar la tool, debes convertir el n√∫mero extra√≠do a un formato estandarizado de **solo d√≠gitos**, aplicando estas reglas en orden:\n    * **Limpieza:** Elimina todos los caracteres no num√©ricos (espacios, guiones, par√©ntesis, puntos, el signo `+`).\n    * **Normalizaci√≥n Per√∫ (9 d√≠gitos):** Si el n√∫mero tiene **9 d√≠gitos** y **no** comienza con `51`, asume que es un n√∫mero de Per√∫ y **precede** la cadena con `51`.\n    * **Normalizaci√≥n Internacional/Completo:** Si el n√∫mero comienza con `51` (11 d√≠gitos) o es cualquier otra longitud, √∫salo tal cual despu√©s de la limpieza.\n\n4. **Acci√≥n √önica:** Una vez extra√≠do y normalizado el n√∫mero, debes utilizar **exclusivamente** la tool **pasar_supervisor**.\n\n5. **Output:** Nunca respondas, expliques, ni devuelvas texto. Tu √∫nica acci√≥n es ejecutar la tool.\n\n### üìù EJEMPLO DE FLUJO DE TRABAJO\n\n| Input de la Recepcionista | L√≥gica de Normalizaci√≥n | Salida a la Tool |\n| :--- | :--- | :--- |\n| **Input 1 (Per√∫ Completo):** `Pasar a supervisor el n√∫mero: 51998765432` | N√∫mero original: `51998765432` (11 d√≠gitos). No requiere cambios. | `pasar_supervisor(51998765432)` |\n| **Input 2 (Internacional):** `Manda a supervisor el n√∫mero +1 (305) 417-1787` | Limpieza: `13054171787` (11 d√≠gitos). | `pasar_supervisor(13054171787)` |\n| **Input 3 (Per√∫ Corto):** `Manda a supervisor el n√∫mero 977571136` | 9 d√≠gitos. Se asume Per√∫. **Normaliza con 51**. | `pasar_supervisor(51977571136)` |\n\n## HERRAMIENTAS\n**Herramientas disponibles:** **pasar_supervisor**\n\n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-14256,192],"id":"ed307005-1e1d-4800-a494-8f1ee293347f","name":"supervisor"},{"parameters":{"workflowId":{"__rl":true,"value":"86itBT4QcMqbK21F","mode":"list","cachedResultUrl":"/workflow/86itBT4QcMqbK21F","cachedResultName":"[MANTENIMIENTO] Supwhatsapp"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('If19').item.json.body.conversation.messages[0].sender.phone_number }}","conversation_id":"={{ $('If19').item.json.body.conversation.messages[0].conversation_id }}","inbox_id":"={{ $('If19').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":[],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-14016,400],"id":"96b98de4-e095-42e3-83b8-8e9043aac552","name":"Call 'Supervisor healup'"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"Z1S8hBZOFvfBE7I5","mode":"list","cachedResultUrl":"/workflow/Z1S8hBZOFvfBE7I5","cachedResultName":"SUNAT | Enviar datos (General) | WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre', ``, 'string') }}","numero":"={{ $json.id }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},"matchingColumns":[],"schema":[{"id":"nombre","displayName":"nombre","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5664,752],"id":"39552a1a-a1b3-4538-a0c0-eefb20b529b8","name":"enviar_nombre"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    perfumes_full_size: [\n      \"9 pm\",\n      \"9 pm elixir\",\n      \"Aether extrait\",\n      \"Afeef Lattafa\",\n      \"Ajayeb Dubai\",\n      \"Ajwad pink to pink\",\n      \"Al Haramain Dubai Night\",\n      \"Al qiam golf\",\n      \"ALTHAIR PARFUMS de MARLY\",\n      \"Amber rouge\",\n      \"Amethyst\",\n      \"Amore caff√© Mancera\",\n      \"Aqua Dubai 100 ml\",\n      \"Art of nature II\",\n      \"Art of universe\",\n      \"Aruba gold\",\n      \"Atlas LATTAFA\",\n      \"Azzaro PARFUM\",\n      \"Azzaro the most wanted intense\",\n      \"Berry on top\",\n      \"Bharata chocolate\",\n      \"Bharata king EDP\",\n      \"Bharata king gold edition\",\n      \"Bharata Placid\",\n      \"BIANCO latte\",\n      \"CDN Intense man\",\n      \"CDN Sillage\",\n      \"CDN Urban Man Elixir\",\n      \"CDN woman\",\n      \"Champion goat\",\n      \"Champion money\",\n      \"Champion sugar\",\n      \"Chic Sonia\",\n      \"Choco overdose\",\n      \"Cloud Ariana grande\",\n      \"Club de nuit untold\",\n      \"Confidential\",\n      \"Cookie grave\",\n      \"Creed aventus\",\n      \"Creed millesime imperial\",\n      \"Creed silver mountain water\",\n      \"Decant\",\n      \"Diesel spirit\",\n      \"Eclaire\",\n      \"Eclaire banoffi\",\n      \"Eclaire pistache\",\n      \"EMEER\",\n      \"Erba gold\",\n      \"Erba pura\",\n      \"Fahkar Rose\",\n      \"Fakhar black\",\n      \"Fakhar gold\",\n      \"Fire on ice\",\n      \"GOS Blind bid\",\n      \"Gos bonus\",\n      \"GOS Boston\",\n      \"GOS Diamond\",\n      \"Gos Esmerald\",\n      \"GOS Full House\",\n      \"GOS Jackpot\",\n      \"GOS Moon\",\n      \"Gos no limit\",\n      \"GOS platinium\",\n      \"GOS Rouge\",\n      \"GOS Royale\",\n      \"GOS Wildcard\",\n      \"GOS Yellow Saphire\",\n      \"Haramain amber oud gold edition\",\n      \"HAWAS ice\",\n      \"Hawas malibu\",\n      \"Hayaati florence\",\n      \"Hayaati lataffa\",\n      \"Her confession\",\n      \"His Confession\",\n      \"Honor and glory\",\n      \"Invictus Parfum\",\n      \"INVICTUS VICTORY ELIXIR\",\n      \"Ishq al shuyukh silver\",\n      \"Island Khadlaj\",\n      \"Jean lowe azure\",\n      \"Jean lowe inmortel\",\n      \"JPG Le beau le parfum 120ml\",\n      \"JPG Le Male elixir 125ml\",\n      \"JPG LE MALE LE PARFUM\",\n      \"JPG Paradise Garden 125ml\",\n      \"Khamrah\",\n      \"Khamrah Dukhan\",\n      \"Kirk√© Tiziana Terenzi\",\n      \"Lataffa Ameer\",\n      \"Lattafa dynasty\",\n      \"LAYTON PARFUMS de MARLY\",\n      \"Mancera cedrat boise\",\n      \"Mancera coco vanille\",\n      \"Mancera Instant Crush\",\n      \"Mancera Red tobaco\",\n      \"Mandar√≠n elixir\",\n      \"Milestone\",\n      \"Montale Arabians Tonka\",\n      \"M√≥ntale intense caf√©\",\n      \"Nautica voyage\",\n      \"Naxos\",\n      \"Nitro Red\",\n      \"Nitro White\",\n      \"Noble blush\",\n      \"Now white\",\n      \"Now women\",\n      \"Odyssey artisto\",\n      \"Odyssey bahamas\",\n      \"Odyssey black forest\",\n      \"Odyssey Candee\",\n      \"Odyssey Eau de Montagne\",\n      \"Odyssey go mango\",\n      \"Odyssey Homme black EDP\",\n      \"Odyssey Homme white edition\",\n      \"Odyssey Limoni\",\n      \"Odyssey Mandarin sky\",\n      \"Odyssey mega edp\",\n      \"Odyssey revolution\",\n      \"Odyssey Spectra\",\n      \"Odyssey spectra blue\",\n      \"Odyssey toffe coffe\",\n      \"Odyssey Tyrant\",\n      \"Odyssey wild one\",\n      \"Orientica royal amber\",\n      \"Orientica Velvet Gold\",\n      \"OUD FOR GLORY\",\n      \"Qaed unlimited\",\n      \"Rave Now\",\n      \"Rayhaan Elixir\",\n      \"Rome Imagine\",\n      \"Rome paradox\",\n      \"Scandal intense\",\n      \"Scandal le parfum\",\n      \"Sehr\",\n      \"Shaheen\",\n      \"So candid\",\n      \"Spectre Malachite\",\n      \"Spectre wraith\",\n      \"Stronger with you intensly\",\n      \"Summer hammer/Lorenzo Pazzaglia\",\n      \"Sun-gria\",\n      \"Teriaq intense\",\n      \"Tharwah gold\",\n      \"The Kingdom\",\n      \"Turathi\",\n      \"Turathi Electric\",\n      \"Valentino born in Roma intense\",\n      \"Veneno\",\n      \"Versace Eros flame\",\n      \"Versace eros parfum\",\n      \"Vintage Radio\",\n      \"Winners trophy\",\n      \"Yara elixir\",\n      \"Yara lataffa\",\n      \"Yara Moi\",\n      \"Yara tous\",\n      \"Yves Saint Laurent Y EDP\"\n    ],\n\n    decants: [\n      \"BHARARA KING EDP\",\n      \"LATTAFA PRIDE PISA\",\n      \"HARANA\",\n      \"21:00:00\",\n      \"EJAAZI\",\n      \"CDN SILLAGE\",\n      \"GOS MOON\",\n      \"MANDARIN SKY\",\n      \"NAUTICA VOYAGE\",\n      \"ROYAL BLEU\",\n      \"ODYSSEY WHITE\",\n      \"JEAN LOWE MATIERE\",\n      \"SUBLIME\",\n      \"GOS ROUGE\",\n      \"9 PM REBEL\",\n      \"KHAMRAH\",\n      \"GOS YELLOW SAPPHIRE\",\n      \"GOS BOSTON\",\n      \"ASAD\",\n      \"TURATHI BLUE\",\n      \"CND SILLAGE\",\n      \"GOS ROYALE\",\n      \"OUD FOR GLORY\",\n      \"AL HARAMAIN GOLD EXTREME\",\n      \"ODYSSEY AOUD\",\n      \"VLO\",\n      \"EMEER\",\n      \"ISSEY MIYAKE\",\n      \"ODYSSEY TYRANT\",\n      \"ASAD ZANZIBAR\",\n      \"GOS BID\",\n      \"9AM\",\n      \"HAWAS ICE\",\n      \"GOS WILDCARD\",\n      \"YARA MOI\",\n      \"VENTANA ARMAF\",\n      \"CDN IMP√âRIALE\",\n      \"AL NASHAMA CAPRICE\",\n      \"YARA\",\n      \"BHARARA BLEU\",\n      \"GOS BLIND BID\",\n      \"GOS ACE\",\n      \"CDN MILESTONE\",\n      \"DETOUR NOIR\",\n      \"RAED LUXE\",\n      \"QAED UNLIMITED\",\n      \"AI HARAMAIN RUBY EDITION\",\n      \"HAWAS BLACK\",\n      \"HAYAATI\",\n      \"ODYSSEY HOMME BLACK\",\n      \"CDN URBAN MAN ELIXIR\",\n      \"CDN UNTOLD\",\n      \"MAAHIR LEGACY\",\n      \"LEGEND SPIRIT\",\n      \"SHAHEEN GOLD\",\n      \"YARA TOUS\",\n      \"FAKHAR ROSE\",\n      \"HONOR AND GLORY\",\n      \"DUBAI NIGHT\",\n      \"BHARARA KING PARFUM\",\n      \"LATTAFA JASOOR\",\n      \"GOS GOLD\",\n      \"CDN INTENSE MAN\",\n      \"GOS FULL HOUSE\",\n      \"ODYSSEY AQUA\",\n      \"HAYAATI AL MALEKY\",\n      \"GOS WIN\",\n      \"FAKHAR BLACK\",\n      \"GOS DIAMOND\",\n      \"KHAMRAH QAHWA\",\n      \"GOS HIGH ROLLER\",\n      \"THE KINGDOM\",\n      \"ODYSSEY MEGA\",\n      \"HAWAS FOR HIM\",\n      \"LATTAFA NEBRAS\",\n      \"AI HARAMAIN GOLD EDITION\",\n      \"AJWAD\",\n      \"RAVE NOW WHITE\",\n      \"ODYSSEY CANDEE\",\n      \"ODYSSEY SPECTRA\",\n      \"YARA CANDY\",\n      \"ODYSSEY LIMONI\",\n      \"AMBER ROUGE\",\n      \"SCEPTRE MALACHITE\",\n      \"VIKING KASHMIR\",\n      \"AI HARAMAIN PRIVATE EDITION\",\n      \"QAED AI FURSAN\",\n      \"GOS JACKPOT\",\n      \"VIKING DUBAI\",\n      \"ROYAL AMBER\",\n      \"BHARARA KING GOLD EDITION\",\n      \"HIS CONFESSION\",\n      \"VIKING CAIRO\",\n      \"BHARARA ELEGANCE\",\n      \"BHARARA PHARAOH 1\",\n      \"BHARARA PHARAOH 2\",\n      \"MAYAR\",\n      \"CLUB DE NUIT PRECIEUX\",\n      \"HER CONFESSION\",\n      \"AMETHYST LATTAFA\",\n      \"LATTAFA TERIAQ\",\n      \"AI HARAMAIN AQUA DUBAI\",\n      \"ASAD BOURBON\",\n      \"NITRO WHITE\",\n      \"LIQUID BURN\",\n      \"NITRO RED\",\n      \"NOBLE BLUSH\",\n      \"LATTAFA SEHR\",\n      \"ISLAND BLISS\",\n      \"LATTAFA ECLAIRE\",\n      \"AL HARAMAIN ROYAL MUSK\",\n      \"SUQRAAT\",\n      \"ISHQ AL SHUYUKH\",\n      \"LIAM BLUE\",\n      \"DUBAI CHOCOLAT\",\n      \"BHARARA CHOCOLATE\",\n      \"HAYA\",\n      \"ISHQ AL SHUYUKH GOLD\",\n      \"ANSAAM SILVER\",\n      \"VINTAGE RADIO\",\n      \"BHARARA ENCHANTED\",\n      \"GOS OPAL\",\n      \"ART OF UNIVERSE\",\n      \"LATTAFA CHIC\",\n      \"HAWAS ELIXIR\",\n      \"HAYA CRUSH\",\n      \"JEAN LOWE AZURE\",\n      \"ROME POUR HOMME\",\n      \"HAYAATI FLORENCE\",\n      \"VELVET GOLD\",\n      \"AJWAD PINK TO PINK\",\n      \"AL QIAM GOLD\",\n      \"ANGHAM LATTAFA\",\n      \"ARABIAN SKY\",\n      \"TAG UOMO ROSSO\",\n      \"TAG ART OF NATURE II\",\n      \"BHARARA PLACID\",\n      \"BHARARA SOLEIL\",\n      \"CDN WOMAN\",\n      \"CDN ICONIC\",\n      \"CONFIDENTIAL PRIVATE GOLD\",\n      \"DELILAH\",\n      \"GOS PLATINIUM OF SPADES\",\n      \"INTIMATION\",\n      \"ISLAND KHADLAJ\",\n      \"JEAN LOWE INMORTEL\",\n      \"JEAN LOWE VIBE\",\n      \"WINNERS TROPHY\",\n      \"KHANJAR EAU DE PARFUM\",\n      \"KISMET MAGIC\",\n      \"MANDARIN SKY ELIXIR\",\n      \"MAYAR CHERRY INTENSE\",\n      \"NITRO RED INTENSELY\",\n      \"NITRO NOW WOMEN\",\n      \"ODYSSEY ARTISTO\",\n      \"ODYSSEY WILD ONE\",\n      \"RAVE NOW RAYHAAN ELIXIR\",\n      \"NOW\",\n      \"SAKEENA\",\n      \"SO CANDID\",\n      \"TARWAH GOLD\",\n      \"LATTAFA TERIAQ INTENSE\",\n      \"VICTORIA LATTAFA\",\n      \"YUM YUM ARMAF\",\n      \"QISSA DELICIOUS\",\n      \"HAWAS TROPICAL\",\n      \"HAWAS FIRE\",\n      \"FAKHAR PLATIN\",\n      \"KHAMARAH DUKHAN\",\n      \"ODYSSEY EAU DE MONTAGNE\",\n      \"ODYSSEY REVOLUTION\",\n      \"ROME IMAGINE\",\n      \"TURATHI ELECTRIC\",\n      \"VULCAN NUE\",\n      \"SPECTRE WRAITH\",\n      \"GOS EMERALD OF SPADES\",\n      \"AFEEF\",\n      \"BHARARA ONYX\",\n      \"SCEPTRE DESERT\",\n      \"NITRO NEITHE\",\n      \"ODYSSEY BLACK FOREST\",\n      \"ODYSSEY TOFFEE COFFEE\",\n      \"ODYSSEY BAHAMAS\",\n      \"ODYSSEY MANGO\",\n      \"NITRO ELIXIR\",\n      \"ROME PARADOXE\",\n      \"ROME YUM YUM\",\n      \"ECLAIRE PISTACHE\",\n      \"ECLAIRE BANOFFEE\",\n      \"9PM ELIXIR\",\n      \"HAWAS MALIBU\",\n      \"HAWAS KOBRA\",\n      \"GOS BONUS DYNASTY FIRE\",\n      \"ON CIE\",\n      \"LOVELY CHERIE\"\n    ],\n\n    set_perfumes: [\n      \"Gos set\",\n      \"GOS Set 3 piezas jo milano\",\n      \"Set 9pm\",\n      \"Set art of universe\",\n      \"Set mandar√≠n\",\n      \"SET VERSACE NECESER + PERFUME + DECANT\",\n      \"Set YARA\",\n      \"Set Zadig & Voltaire this is her\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4736,416],"id":"8e853398-c1fd-4a9a-9894-11607d7d0832","name":"informacion_productos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"# ROL: \nEres un agente t√©cnico especializado en la verificaci√≥n de existencias y precios del cat√°logo de Brada Perfumes. Tu √∫nico objetivo es recibir nombres de perfumes, identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input y consultar la tool stock1 para obtener datos reales.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Productos: Los nombres de los perfumes en el input siempre vendr√°n entre comillas (ej. \"9 PM\", \"Hawas Ice\") para evitar confusi√≥n con el resto del mensaje.\nUso de la Tool stock1:\nDebes ejecutar la tool enviando el nombre exacto del perfume identificado en la variable perfume.\nSi el input contiene m√∫ltiples perfumes, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes mantener el nombre del perfume exactamente igual a como aparece en el cat√°logo, corrigiendo solo errores ortogr√°ficos evidentes seg√∫n tu conocimiento general.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo perfume\nVariable disponibilidad: Si la tool indica que el producto est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre de perfume): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s perfumes\nDebes listar cada perfume en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n# EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"Hola, revisa la disponibilidad de \"9 PM\" y \"Hawas Ice\".\"\nProceso interno:\nLlamada 1: stock1(perfume=\"9 PM\") -> Resultado: Disponible, S/ 140.\nLlamada 2: stock1(perfume=\"Hawas Ice\") -> Resultado: Agotado, S/ 180.\nOutput que debes enviar si son dos o m√°s perfumes: 9 PM: stock si y precio 140 soles. Hawas Ice: stock no y precio 180 soles.\n#NOTAS ADICIONALES\nNo inventes precios ni estados de stock.\nSi la tool no devuelve informaci√≥n para un nombre espec√≠fico, indica: (Nombre de perfume): stock no y precio (No disponible).\nTu respuesta debe ser exclusivamente la lista de stock solicitada, sin saludos ni despedidas adicionales\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5312,608],"id":"64458501-a4f8-45c4-aae9-17b34719c27a","name":"stock_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    \"distritos_permitidos\": [\n      \"Anc√≥n\", \"Ate\", \"Barranco\", \"Bre√±a\", \"Carabayllo\", \"Chaclacayo\", \n      \"Chorrillos\", \"Cieneguilla\", \"Comas\", \"El Agustino\", \"Independencia\", \n      \"Jes√∫s Mar√≠a\", \"La Molina\", \"La Victoria\", \"Lima\", \"Lince\", \n      \"Los Olivos\", \"Lurigancho\", \"Lur√≠n\", \"Magdalena del Mar\", \"Miraflores\", \n      \"Pachac√°mac\", \"Pucusana\", \"Pueblo Libre\", \"Puente Piedra\", \n      \"Punta Hermosa\", \"Punta Negra\", \"R√≠mac\", \"San Bartolo\", \"San Borja\", \n      \"San Isidro\", \"San Juan de Lurigancho\", \"San Juan de Miraflores\", \n      \"San Luis\", \"San Mart√≠n de Porres\", \"San Miguel\", \"Santa Anita\", \n      \"Santa Mar√≠a del Mar\", \"Santa Rosa\", \"Santiago de Surco\", \"Surquillo\", \n      \"Villa El Salvador\", \"Villa Mar√≠a del Triunfo\", \"Callao\", \"Bellavista\", \n      \"Carmen de la Legua Reynoso\", \"La Perla\", \"La Punta\", \"Ventanilla\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4432,400],"id":"09ca4414-ae98-4efb-aaa7-b0a7d4b68b45","name":"distritos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente especializado exclusivamente en la verificaci√≥n de existencias y precios de Decants (presentaciones de 5ml y 10ml) de Brada Perfumes. Tu objetivo es recibir el input del agente principal, identificar los perfumes y sus medidas, y consultar la tool stock_decants para devolver datos precisos.\n# INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Medidas: Debes prestar especial atenci√≥n a la cantidad solicitada (5ml o 10ml). Si el cliente no especifica la medida pero el contexto indica que es un decant, consulta ambas presentaciones.\nUso de la Tool stock_decants:\nDebes ejecutar la tool enviando el nombre del perfume y la medida identificada.\nSi el input contiene m√∫ltiples decants (ej. \"9 PM de 5ml y Hawas de 10ml\"), debes realizar una ejecuci√≥n de la tool por cada producto/medida individualmente.\nMantenimiento de Nomenclatura: Mant√©n el nombre t√©cnico del perfume (ej. \"Club de Nuit Intense\" en lugar de \"cnit\") seg√∫n la lista maestra.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato basado en los datos de la tool:\nCASO 1: Un solo decant\nVariable disponibilidad: Si la tool indica existencias, utiliza \"si\". Si no hay, utiliza \"no\".\nFormato de salida: (Nombre de perfume) ([Medida]): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s decants\nDebes listar cada decant en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad de decants: \"9 PM\" en 5ml y \"Hawas Ice\" en 10ml.\"\nProceso interno:\nLlamada 1: stock_decants(perfume=\"9 PM\", medida=\"5ml\") -> Resultado: Disponible, S/ 35.\nLlamada 2: stock_decants(perfume=\"Hawas Ice\", medida=\"10ml\") -> Resultado: Agotado, S/ 45.\nOutput (Lo que respondes): 9 PM (5ml): stock si y precio 35 soles. Hawas Ice (10ml): stock no y precio 45 soles.\n#REGLAS DE ORO\nProhibici√≥n de Inventar: No inventes precios. Si la tool no devuelve un precio para una medida espec√≠fica, responde: (Nombre de perfume) ([Medida]): stock no y precio (No disponible).\nExclusividad: Tu respuesta debe contener √∫nicamente la lista t√©cnica. No incluyas saludos, recomendaciones, ni frases de cierre.\nPrecisi√≥n de Medida: Aseg√∫rate de que el precio corresponda exactamente a la medida solicitada (un perfume de 10ml siempre es m√°s caro que uno de 5ml).\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5024,608],"id":"edf1ea9c-753a-4178-8823-ad4b5d276fde","name":"stock_decants"},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-4752,880],"id":"c65b6d98-6ca9-4850-a240-dc15d0e6f244","name":"OpenAI Chat Model5","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5008,880],"id":"f40c83eb-7af9-43d9-9718-23906d503917","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5328,848],"id":"4682821d-4ee5-4aa0-bfa8-6ee52c2d74b9","name":"OpenAI Chat Model6","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfumes","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-5168,816],"id":"db9c5a3b-41f0-489b-95b8-1818ea40b41b","name":"stock1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_decants","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4880,832],"id":"cca318d1-6e33-42b3-9253-f90ae5034239","name":"stock2","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfume_sets","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4592,880],"id":"6150c4ba-6b03-4325-b902-35091b0ac31b","name":"stock3","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente t√©cnico especializado exclusivamente en la verificaci√≥n de existencias y precios de los Sets de Perfumes (estuches de regalo o packs con complementos) de Brada Perfumes. Tu misi√≥n es recibir el nombre del set, validarlo contra la tool stock_set_perfumes y devolver la disponibilidad y precio real.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Sets: Los nombres de los sets suelen incluir la palabra \"Set\" (ej. \"Set Yara\", \"Set 9 PM\"). Debes identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input.\nUso de la Tool stock_set_perfumes:\nDebes ejecutar la tool enviando el nombre exacto del set en la variable nombre_set.\nSi el input contiene m√∫ltiples sets, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes respetar el nombre del set tal como aparece en el cat√°logo oficial de Brada Perfumes, asegur√°ndote de que se trate de la presentaci√≥n en estuche y no de la botella individual.\n#L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo Set\nVariable disponibilidad: Si la tool indica que el set est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre del Set): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s Sets\nDebes listar cada set en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad del SET: \"Set Yara\" y \"Set Art of Universe\".\"\nProceso interno:\nLlamada 1: stock_set_perfumes(nombre_set=\"Set Yara\") -> Resultado: Disponible, S/ 210.\nLlamada 2: stock_set_perfumes(nombre_set=\"Set Art of Universe\") -> Resultado: Disponible, S/ 250.\nOutput (Lo que respondes): Set Yara: stock si y precio 210 soles. Set Art of Universe: stock si y precio 250 soles.\n#REGLAS DE ORO\nPrecisi√≥n: No confundas un \"Perfume Full Size\" con un \"Set\". Si el input pide un Set, busca √∫nicamente en la categor√≠a de sets.\nProhibici√≥n de Inventar: No inventes precios ni disponibilidad. Si la tool no devuelve informaci√≥n para un set espec√≠fico, indica: (Nombre del Set): stock no y precio (No disponible).\nMinimalismo: Tu respuesta debe ser exclusivamente la lista t√©cnica solicitada. No incluyas saludos, despedidas ni comentarios sobre el contenido del set.\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-4736,656],"id":"6344ee20-9fcb-45bd-a342-5aaf79248763","name":"stock_set_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"bFX818cxJebYkS92","mode":"list","cachedResultUrl":"/workflow/bFX818cxJebYkS92","cachedResultName":"BRADA | WHATSAPP | compras confirmadas"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-4544,448],"id":"42a85e30-dd9d-47c7-af24-3eace4616f6f","name":"confirmacion_pedidos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1840,2160],"id":"86511a06-e0d8-496b-9161-edd28ac48fe2","name":"If24"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1632,2144],"id":"f6ed93e7-cd4c-4547-9b7c-9f3a9bd6174a","name":"If28"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1280,2560],"id":"6532091a-4da7-484e-bc59-551caaf8837a","name":"If29"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1904,2112],"typeVersion":1,"id":"4b346085-38b5-41dc-aa4e-0e5fd0d63b15","name":"Sticky Note3"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1408,2160],"id":"60a486b8-d8b9-45f7-bcc2-0237d9dacb35","name":"Wait1","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-832,2368],"id":"aec693f3-d181-42f6-96ef-f4259257f242","name":"If41"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-464,2576],"id":"d0bce6d9-8944-4f36-8369-887245578174","name":"If43"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2368],"id":"920f0b3f-260f-4a46-8f84-c7fafcb4e42d","name":"Wait11","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2576],"id":"9445a338-fa59-4652-b7a7-042da4ab0166","name":"Wait12","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-256,2592],"id":"1b4c198d-a84a-4886-bfee-45e03505844a","name":"Wait13","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1632,2320],"id":"985412b0-18a0-4a74-9383-848361eecf6d","name":"Wait14","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-624,2384],"id":"0b01e43e-8f88-4806-9aa3-aaafae23afa5","name":"Wait15","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1264,2320],"id":"455fc9a5-d692-424b-96af-4dc9dfb5ecfa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1440,2320],"id":"43ef0c39-d3b6-4ed3-9bbe-55b60f80b5a4"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-656,2576],"id":"71901a37-3c10-48e0-8c0d-ea488faf670e"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-7","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-832,2576],"id":"94b90b7c-2489-43c2-b38d-5f1d9ed48958"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot37","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[64,2592],"id":"70f90af3-d2d6-42bb-bbed-2a460fc13eb2"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-8","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-112,2592],"id":"79b9eee3-c9f3-43cc-945b-a659df940b42"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot38","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-288,2384],"id":"377a6011-2a90-4508-ad7a-18e8be515097"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-9","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-464,2384],"id":"4736c49f-51b0-433c-acaf-c5ec1975c27f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot39","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1072,2160],"id":"a211f2a4-e5b1-4b1b-b198-ecee0d6bdf3a"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-10","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1248,2160],"id":"e7fcf0ac-d57f-498d-84c2-efc72cefbb9c"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[336,720],"id":"2aaf0e50-945f-404a-a630-6c934c4bf678","name":"If25"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[544,704],"id":"db6e3976-9c81-410c-a089-cbbffed9a498","name":"If30"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[896,1120],"id":"3d9b40b9-6eb5-4641-9243-4acb6bbaab90","name":"If31"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[272,672],"typeVersion":1,"id":"9d6dc394-e9c9-47cf-bb8b-3ec6e169cd24","name":"Sticky Note4"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[768,720],"id":"e193f0ff-9818-4fff-ab4c-87a07ea2bc57","name":"Wait16","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1344,928],"id":"70a6f8d6-3ef1-45ad-be33-45e51b8b5bf7","name":"If44"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1712,1136],"id":"46e4e9c0-d629-4cae-a016-78122838bf5c","name":"If45"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,928],"id":"9005e0a0-7928-4432-afba-ecca82410842","name":"Wait17","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,1136],"id":"26654f8d-1377-49f2-b4ba-feefd58f29f5","name":"Wait18","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1920,1152],"id":"e5e9d5a8-676d-4787-ad0c-57a9cecb51e6","name":"Wait19","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[544,880],"id":"0a2148fa-6d21-4cef-85c9-2f9f7747051b","name":"Wait20","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1552,944],"id":"24a50f49-9fa7-444a-889d-b0a47dcdca22","name":"Wait21","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[912,880],"id":"73a2a9cb-96fa-4c67-b2c0-855467476004"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-11","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[736,880],"id":"2a355cf5-4023-4e5c-94cd-fb54d20ab48d"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot21","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1520,1136],"id":"e4e81844-daec-44fa-87e1-8a40c9f593e1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-12","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1344,1136],"id":"124b0253-10a5-4f3f-8b46-7e729f639b4b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot40","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2240,1152],"id":"d7a77253-dcf2-4e33-9699-ace3f5cf9843"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-13","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2064,1152],"id":"47d740d9-af91-4b47-a3d9-43f6089948ac"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot41","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1888,944],"id":"ba55a9c2-6648-4009-9d21-cbad56eea3fa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-14","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1712,944],"id":"09553178-8112-4313-b41f-7edb86da9bb2"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot42","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1104,720],"id":"a287f371-7d38-4b62-96ac-80a54a0f4a85"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-15","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[928,720],"id":"5a670fc0-4c1b-45d5-bf03-f2cce3d56697"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-144,0],"id":"21286fd2-eb14-4621-961c-daf1710c98db","name":"If32"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[64,-16],"id":"9298649c-49d2-4ef9-a38d-d1ecd699741a","name":"If33"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[416,400],"id":"0335f432-f2cb-43bf-9855-8b773b8fd74f","name":"If34"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-208,-48],"typeVersion":1,"id":"f7db0934-d8a5-4643-8ea5-3b74f9fd30ff","name":"Sticky Note5"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[288,0],"id":"edc5d3e6-6cb7-4e24-a395-5bfd2ec21e8f","name":"Wait22","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[864,208],"id":"3d08713e-6783-4344-835a-52021892fc79","name":"If46"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1232,416],"id":"a3ff7975-1b42-4ee2-8d28-a9e2530627ea","name":"If47"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,208],"id":"050e27ee-0dc9-4cfe-9b3b-4984fdb3c424","name":"Wait23","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,416],"id":"316376c3-954b-4325-ab08-caadfb880e67","name":"Wait24","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1440,432],"id":"cfc28de1-e1fa-4583-80c7-4806a6cd7ad1","name":"Wait25","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[64,160],"id":"e8d0be90-195b-413a-b96d-28c469da7d2a","name":"Wait26","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1072,224],"id":"83b77384-ab0f-442c-aa8e-20cbf18ba56b","name":"Wait27","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot22","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[432,160],"id":"91fe9d8e-e24c-4675-9a65-5c3b96805cd1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[256,160],"id":"b2aa295f-bb56-4faf-bc6e-2c244ae1b8b5"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot23","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1040,416],"id":"42af2c54-fd06-4e53-9b3e-386ae18aad48"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[864,416],"id":"334d03f2-3acd-4c43-9e5c-e5c9ec1fab6b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot43","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1760,432],"id":"a10b0be7-7ad4-4a67-b580-1f6c8f63dd0b"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1584,432],"id":"3ae52091-798e-4106-ad81-b391a548b061"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot44","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1408,224],"id":"634d84c9-0fb9-4dc6-a691-70a9eb6eaff6"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1232,224],"id":"4c0fbfdd-c75a-4058-9fb3-c934f00a1774"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot45","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[624,0],"id":"c8374285-c938-46a3-ab3d-a8987b53dafe"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[448,0],"id":"8a5f2626-93c0-485f-83b6-88d1b7969f67"}],"connections":{"AI Agent":{"main":[[{"node":"Verificador1","type":"main","index":0}]]},"Auto-fixing Output Parser1":{"ai_outputParser":[[{"node":"Verificador1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model8":{"ai_languageModel":[[{"node":"Auto-fixing Output Parser1","type":"ai_languageModel","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"Auto-fixing Output Parser1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model9":{"ai_languageModel":[[{"node":"Verificador1","type":"ai_languageModel","index":0}]]},"Verificador1":{"main":[[{"node":"ordenar","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Get a row3","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"If2":{"main":[[{"node":"Update a row1","type":"main","index":0}],[{"node":"If3","type":"main","index":0}]]},"If3":{"main":[[{"node":"Switch3","type":"main","index":0}],[{"node":"No Operation, do nothing4","type":"main","index":0}]]},"Edit Fields4":{"main":[[{"node":"If2","type":"main","index":0}]]},"If13":{"main":[[{"node":"Get a row1","type":"main","index":0}],[{"node":"Create a row","type":"main","index":0}]]},"Calendario":{"ai_tool":[[]]},"Create a row":{"main":[[{"node":"Get a row1","type":"main","index":0}]]},"Get a row1":{"main":[[{"node":"Edit Fields4","type":"main","index":0}]]},"Update a row1":{"main":[[{"node":"Switch3","type":"main","index":0}]]},"Get a row":{"main":[[{"node":"If13","type":"main","index":0}]]},"If4":{"main":[[{"node":"If11","type":"main","index":0}],[{"node":"Fecha","type":"main","index":0}]]},"Formatea fecha":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Handler variables":{"main":[[{"node":"If10","type":"main","index":0}]]},"Fecha":{"main":[[{"node":"Formatea fecha","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Handler variables","type":"main","index":0}]]},"Wait6":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"If6":{"main":[[{"node":"Redis1","type":"main","index":0}],[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"Delete Redis":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Edit Fields19":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"Get Redis1":{"main":[[{"node":"If6","type":"main","index":0}]]},"Edit Fields20":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"If15":{"main":[[{"node":"Edit Fields19","type":"main","index":0}],[{"node":"Edit Fields20","type":"main","index":0}]]},"METER_ANUNCIO":{"main":[[{"node":"guarda_ANUNCIO","type":"main","index":0}]]},"BAJAR_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"guarda_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"If":{"main":[[{"node":"RESUMIDOR ANUNCIOS","type":"main","index":0}],[{"node":"If4","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"RESUMIDOR ANUNCIOS","type":"ai_languageModel","index":0}]]},"If10":{"main":[[{"node":"METER_ANUNCIO","type":"main","index":0}],[{"node":"BAJAR_ANUNCIO","type":"main","index":0}]]},"Redis1":{"main":[[{"node":"If15","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"If16","type":"main","index":0}]]},"Edit Fields12":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"AUDIO1","type":"main","index":0}]]},"Switch3":{"main":[[{"node":"HTTP Request","type":"main","index":0}],[{"node":"OpenAI","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}]]},"AUDIO1":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"If16":{"main":[[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields12","type":"main","index":0}]]},"Edit Fields17":{"main":[[{"node":"If","type":"main","index":0}]]},"If11":{"main":[[{"node":"Update a row4","type":"main","index":0}]]},"If12":{"main":[[{"node":"Get a row","type":"main","index":0}],[{"node":"If20","type":"main","index":0}]]},"If20":{"main":[[{"node":"Update a row6","type":"main","index":0}]]},"If1":{"main":[[{"node":"If12","type":"main","index":0}]]},"ordenar":{"main":[[{"node":"Respuesta1","type":"main","index":0}]]},"Respuesta1":{"main":[[{"node":"Update a row","type":"main","index":0}]]},"Wait2":{"main":[[{"node":"Respuesta2","type":"main","index":0}]]},"Respuesta2":{"main":[[{"node":"Update a row3","type":"main","index":0}]]},"If14":{"main":[[{"node":"Wait3","type":"main","index":0}],[{"node":"If23","type":"main","index":0}]]},"Wait3":{"main":[[{"node":"Respuesta3","type":"main","index":0}]]},"Respuesta3":{"main":[[{"node":"Update a row5","type":"main","index":0}]]},"If17":{"main":[[{"node":"Wait4","type":"main","index":0}],[{"node":"If32","type":"main","index":0}]]},"Wait4":{"main":[[{"node":"Respuesta4","type":"main","index":0}]]},"Respuesta4":{"main":[[{"node":"Update a row7","type":"main","index":0}]]},"RESUMIDOR ANUNCIOS":{"main":[[{"node":"If4","type":"main","index":0}]]},"Supervisor":{"ai_tool":[[]]},"Update a row":{"main":[[{"node":"If8","type":"main","index":0}]]},"Update a row3":{"main":[[{"node":"If14","type":"main","index":0}]]},"Update a row5":{"main":[[{"node":"If17","type":"main","index":0}]]},"Get a row3":{"main":[[{"node":"If19","type":"main","index":0}]]},"If19":{"main":[[{"node":"If5","type":"main","index":0}]]},"Update a row7":{"main":[[{"node":"If25","type":"main","index":0}]]},"If7":{"main":[[{"node":"Update a row9","type":"main","index":0}],[{"node":"Create a row1","type":"main","index":0}]]},"Get a row2":{"main":[[{"node":"If7","type":"main","index":0}]]},"Create a row1":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"RAZONADOR PLUS":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Update a row9":{"main":[[{"node":"Wait6","type":"main","index":0}]]},"1. Descargar Imagen":{"main":[[{"node":"2. Enviar a Chatwoot","type":"main","index":0}]]},"If8":{"main":[[{"node":"Wait2","type":"main","index":0}],[{"node":"If24","type":"main","index":0}]]},"If23":{"main":[[{"node":"If26","type":"main","index":0}],[{"node":"Wait9","type":"main","index":0}]]},"If26":{"main":[[],[{"node":"Wait","type":"main","index":0}]]},"If27":{"main":[[{"node":"Wait5","type":"main","index":0}],[{"node":"Wait7","type":"main","index":0}]]},"Wait":{"main":[[{"node":"1. Descargar Imagen 1-6","type":"main","index":0}]]},"If40":{"main":[[],[{"node":"Wait10","type":"main","index":0}]]},"If42":{"main":[[],[{"node":"Wait8","type":"main","index":0}]]},"Wait5":{"main":[[{"node":"If40","type":"main","index":0}]]},"Wait7":{"main":[[{"node":"1. Descargar Imagen 1-3","type":"main","index":0}]]},"Wait8":{"main":[[{"node":"1. Descargar Imagen 1-4","type":"main","index":0}]]},"Wait9":{"main":[[{"node":"1. Descargar Imagen 1-2","type":"main","index":0}]]},"Wait10":{"main":[[{"node":"1. Descargar Imagen 1-5","type":"main","index":0}]]},"2. Enviar a Chatwoot16":{"main":[[{"node":"If27","type":"main","index":0}]]},"1. Descargar Imagen 1-2":{"main":[[{"node":"2. Enviar a Chatwoot16","type":"main","index":0}]]},"2. Enviar a Chatwoot19":{"main":[[{"node":"If42","type":"main","index":0}]]},"1. Descargar Imagen 1-3":{"main":[[{"node":"2. Enviar a Chatwoot19","type":"main","index":0}]]},"1. Descargar Imagen 1-4":{"main":[[{"node":"2. Enviar a Chatwoot34","type":"main","index":0}]]},"1. Descargar Imagen 1-5":{"main":[[{"node":"2. Enviar a Chatwoot35","type":"main","index":0}]]},"1. Descargar Imagen 1-6":{"main":[[{"node":"2. Enviar a Chatwoot36","type":"main","index":0}]]},"If5":{"main":[[{"node":"supervisor","type":"main","index":0}],[{"node":"If1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"supervisor","type":"ai_languageModel","index":0}]]},"pasar_supervisor":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"Call 'Supervisor healup'":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"enviar_nombre":{"ai_tool":[[]]},"informacion_productos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"distritos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_decants":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model5":{"ai_languageModel":[[{"node":"stock_set_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model6":{"ai_languageModel":[[{"node":"stock_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"stock_decants","type":"ai_languageModel","index":0}]]},"stock1":{"ai_tool":[[{"node":"stock_perfumes","type":"ai_tool","index":0}]]},"stock2":{"ai_tool":[[{"node":"stock_decants","type":"ai_tool","index":0}]]},"stock3":{"ai_tool":[[{"node":"stock_set_perfumes","type":"ai_tool","index":0}]]},"stock_set_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"confirmacion_pedidos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"If24":{"main":[[{"node":"If28","type":"main","index":0}],[{"node":"Wait14","type":"main","index":0}]]},"If28":{"main":[[],[{"node":"Wait1","type":"main","index":0}]]},"If29":{"main":[[{"node":"Wait11","type":"main","index":0}],[{"node":"Wait12","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"1. Descargar Imagen 1-10","type":"main","index":0}]]},"If41":{"main":[[],[{"node":"Wait15","type":"main","index":0}]]},"If43":{"main":[[],[{"node":"Wait13","type":"main","index":0}]]},"Wait11":{"main":[[{"node":"If41","type":"main","index":0}]]},"Wait12":{"main":[[{"node":"1. Descargar Imagen 1-7","type":"main","index":0}]]},"Wait13":{"main":[[{"node":"1. Descargar Imagen 1-8","type":"main","index":0}]]},"Wait14":{"main":[[{"node":"1. Descargar Imagen 1-","type":"main","index":0}]]},"Wait15":{"main":[[{"node":"1. Descargar Imagen 1-9","type":"main","index":0}]]},"2. Enviar a Chatwoot17":{"main":[[{"node":"If29","type":"main","index":0}]]},"1. Descargar Imagen 1-":{"main":[[{"node":"2. Enviar a Chatwoot17","type":"main","index":0}]]},"2. Enviar a Chatwoot20":{"main":[[{"node":"If43","type":"main","index":0}]]},"1. Descargar Imagen 1-7":{"main":[[{"node":"2. Enviar a Chatwoot20","type":"main","index":0}]]},"1. Descargar Imagen 1-8":{"main":[[{"node":"2. Enviar a Chatwoot37","type":"main","index":0}]]},"1. Descargar Imagen 1-9":{"main":[[{"node":"2. Enviar a Chatwoot38","type":"main","index":0}]]},"1. Descargar Imagen 1-10":{"main":[[{"node":"2. Enviar a Chatwoot39","type":"main","index":0}]]},"If25":{"main":[[{"node":"If30","type":"main","index":0}],[{"node":"Wait20","type":"main","index":0}]]},"If30":{"main":[[],[{"node":"Wait16","type":"main","index":0}]]},"If31":{"main":[[{"node":"Wait17","type":"main","index":0}],[{"node":"Wait18","type":"main","index":0}]]},"Wait16":{"main":[[{"node":"1. Descargar Imagen 1-15","type":"main","index":0}]]},"If44":{"main":[[],[{"node":"Wait21","type":"main","index":0}]]},"If45":{"main":[[],[{"node":"Wait19","type":"main","index":0}]]},"Wait17":{"main":[[{"node":"If44","type":"main","index":0}]]},"Wait18":{"main":[[{"node":"1. Descargar Imagen 1-12","type":"main","index":0}]]},"Wait19":{"main":[[{"node":"1. Descargar Imagen 1-13","type":"main","index":0}]]},"Wait20":{"main":[[{"node":"1. Descargar Imagen 1-11","type":"main","index":0}]]},"Wait21":{"main":[[{"node":"1. Descargar Imagen 1-14","type":"main","index":0}]]},"2. Enviar a Chatwoot18":{"main":[[{"node":"If31","type":"main","index":0}]]},"1. Descargar Imagen 1-11":{"main":[[{"node":"2. Enviar a Chatwoot18","type":"main","index":0}]]},"2. Enviar a Chatwoot21":{"main":[[{"node":"If45","type":"main","index":0}]]},"1. Descargar Imagen 1-12":{"main":[[{"node":"2. Enviar a Chatwoot21","type":"main","index":0}]]},"1. Descargar Imagen 1-13":{"main":[[{"node":"2. Enviar a Chatwoot40","type":"main","index":0}]]},"1. Descargar Imagen 1-14":{"main":[[{"node":"2. Enviar a Chatwoot41","type":"main","index":0}]]},"1. Descargar Imagen 1-15":{"main":[[{"node":"2. Enviar a Chatwoot42","type":"main","index":0}]]},"If32":{"main":[[{"node":"If33","type":"main","index":0}],[{"node":"Wait26","type":"main","index":0}]]},"If33":{"main":[[],[{"node":"Wait22","type":"main","index":0}]]},"If34":{"main":[[{"node":"Wait23","type":"main","index":0}],[{"node":"Wait24","type":"main","index":0}]]},"Wait22":{"main":[[{"node":"1. Descargar Imagen 1-20","type":"main","index":0}]]},"If46":{"main":[[],[{"node":"Wait27","type":"main","index":0}]]},"If47":{"main":[[],[{"node":"Wait25","type":"main","index":0}]]},"Wait23":{"main":[[{"node":"If46","type":"main","index":0}]]},"Wait24":{"main":[[{"node":"1. Descargar Imagen 1-17","type":"main","index":0}]]},"Wait25":{"main":[[{"node":"1. Descargar Imagen 1-18","type":"main","index":0}]]},"Wait26":{"main":[[{"node":"1. Descargar Imagen 1-16","type":"main","index":0}]]},"Wait27":{"main":[[{"node":"1. Descargar Imagen 1-19","type":"main","index":0}]]},"2. Enviar a Chatwoot22":{"main":[[{"node":"If34","type":"main","index":0}]]},"1. Descargar Imagen 1-16":{"main":[[{"node":"2. Enviar a Chatwoot22","type":"main","index":0}]]},"2. Enviar a Chatwoot23":{"main":[[{"node":"If47","type":"main","index":0}]]},"1. Descargar Imagen 1-17":{"main":[[{"node":"2. Enviar a Chatwoot23","type":"main","index":0}]]},"1. Descargar Imagen 1-18":{"main":[[{"node":"2. Enviar a Chatwoot43","type":"main","index":0}]]},"1. Descargar Imagen 1-19":{"main":[[{"node":"2. Enviar a Chatwoot44","type":"main","index":0}]]},"1. Descargar Imagen 1-20":{"main":[[{"node":"2. Enviar a Chatwoot45","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"acwebhook.alefcompany.online","user-agent":"rest-client/2.1.0 (linux-musl x86_64) ruby/3.4.4p34","content-length":"2304","accept":"application/json","accept-encoding":"gzip;q=1.0,deflate;q=0.6,identity;q=0.3","content-type":"application/json","x-forwarded-for":"173.249.43.27","x-forwarded-host":"acwebhook.alefcompany.online","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"6a57d0c37ad6","x-real-ip":"173.249.43.27"},"params":{},"query":{},"body":{"account":{"id":2,"name":"Healup"},"additional_attributes":{},"content_attributes":{},"content_type":"text","content":"a","conversation":{"additional_attributes":{},"can_reply":true,"channel":"Channel::Whatsapp","contact_inbox":{"id":4,"contact_id":4,"inbox_id":4,"source_id":"51972619000","created_at":"2026-01-02T16:51:45.640Z","updated_at":"2026-01-02T16:51:45.640Z","hmac_verified":false,"pubsub_token":"STv1xcrZw8Aeuyt1SPgxmVQm"},"id":1,"inbox_id":4,"messages":[{"id":18,"content":"a","account_id":2,"inbox_id":4,"conversation_id":1,"message_type":0,"created_at":1767380149,"updated_at":"2026-01-02T18:55:49.212Z","private":false,"status":"sent","source_id":"wamid.HBgLNTE5NzI2MTkwMDAVAgASGBYzRUIwQTY2M0JDMjQwOTg4NTdDQTg3AA==","content_type":"text","content_attributes":{},"sender_type":"Contact","sender_id":4,"external_source_ids":{},"additional_attributes":{},"processed_message_content":"a","sentiment":{},"conversation":{"assignee_id":null,"unread_count":1,"last_activity_at":1767380149,"contact_inbox":{"source_id":"51972619000"}},"sender":{"additional_attributes":{},"custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false,"type":"contact"}}],"labels":[],"meta":{"sender":{"additional_attributes":{},"custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false,"type":"contact"},"assignee":null,"assignee_type":null,"team":null,"hmac_verified":false},"status":"open","custom_attributes":{},"snoozed_until":null,"unread_count":1,"first_reply_created_at":null,"priority":null,"waiting_since":1767372705,"agent_last_seen_at":1767378677,"contact_last_seen_at":0,"last_activity_at":1767380149,"timestamp":1767380149,"created_at":1767372705,"updated_at":1767380149.2243187},"created_at":"2026-01-02T18:55:49.212Z","id":18,"inbox":{"id":4,"name":"Heal Up Lab WhatsApp"},"message_type":"incoming","private":false,"sender":{"account":{"id":2,"name":"Healup"},"additional_attributes":{},"avatar":"","custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false},"source_id":"wamid.HBgLNTE5NzI2MTkwMDAVAgASGBYzRUIwQTY2M0JDMjQwOTg4NTdDQTg3AA==","event":"message_created"},"webhookUrl":"https://acwebhook.alefcompany.online/webhook/healup2","executionMode":"production"}}]},"versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","activeVersionId":null,"versionCounter":21,"triggerCount":1,"shared":[{"updatedAt":"2026-01-08T17:51:46.711Z","createdAt":"2026-01-08T17:51:46.711Z","role":"workflow:owner","workflowId":"bIVpE1aXwtICWRcyHjLUv","projectId":"MTPybkDgxszv17uX","project":{"updatedAt":"2025-12-12T19:47:40.556Z","createdAt":"2025-12-12T19:45:17.094Z","id":"MTPybkDgxszv17uX","name":"Juan Pablo Jesus Bazan Ramos <bazanjuanpa@gmail.com>","type":"personal","icon":null,"description":null,"creatorId":"4423001a-8ae6-45ae-b4e5-774853e1a949","projectRelations":[{"updatedAt":"2025-12-12T19:45:17.094Z","createdAt":"2025-12-12T19:45:17.094Z","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949","projectId":"MTPybkDgxszv17uX","user":{"updatedAt":"2026-01-21T04:04:53.319Z","createdAt":"2025-12-12T19:45:16.195Z","id":"4423001a-8ae6-45ae-b4e5-774853e1a949","email":"bazanjuanpa@gmail.com","firstName":"Juan Pablo Jesus","lastName":"Bazan Ramos","personalizationAnswers":{"version":"v4","personalization_survey_submitted_at":"2025-12-12T19:47:50.835Z","personalization_survey_n8n_version":"1.123.5","companySize":"<20","companyType":"saas","role":"business-owner","reportedSource":"twitter"},"settings":{"userActivated":true,"easyAIWorkflowOnboarded":true,"firstSuccessfulWorkflowId":"hA8_Wb7G-H_xzMUXbPCqT","userActivatedAt":1768943704423,"npsSurvey":{"waitingForResponse":true,"ignoredCount":2,"lastShownAt":1767054623912}},"disabled":false,"mfaEnabled":false,"lastActiveAt":"2026-01-21","isPending":false}}]}}],"activeVersion":null}
[2026-01-21T04:12:43.617Z] Request received: {"clientKey":"brada","active":false}
[2026-01-21T04:12:43.623Z] Resolved Client: brada -> TargetID: bIVpE1aXwtICWRcyHjLUv
[2026-01-21T04:12:43.623Z] API Config - BaseURL: https://acn8n.alefcompany.online/api/v1, KeyLength: 207
[2026-01-21T04:12:43.649Z] Executing n8n action: deactivate on bIVpE1aXwtICWRcyHjLUv
[2026-01-21T04:12:44.588Z] n8n Response: {"updatedAt":"2026-01-12T22:41:59.443Z","createdAt":"2026-01-08T17:51:46.711Z","id":"bIVpE1aXwtICWRcyHjLUv","name":"BRADAWHATSAPP","description":null,"active":false,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $('Delete Redis').first().json.response }}\nCurrent date: {{ $('Formatea fecha').first().json.formattedDate }}\nEl numero del whatsapp del paciente es: {{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n\n## CLASIFICACI√ìN DE TEXTO:\nTe va a llegar los mensajes en parte de esta forma:\nTexto mensaje: [Mensaje]\nAudio transcripto: [audio trascripto]\nImagen analizada: [mensaje analizado]\nesto es para que sepas diferenciar los audios, imagenes, y textos que te manden.\n","options":{"systemMessage":"=#ROL\n1. IDENTIDAD Y VOCABULARIO (EL \"QUI√âN\" Y \"QU√â\" DECIR)\nEsta secci√≥n define su personalidad y el est√°ndar de lenguaje que debe utilizar para conectar con el cliente que desea comprar en Brada Perfumes.\nNombre: Diego.\nCargo: Asesor de ventas de la tienda ‚ÄúBrada Perfumes‚Äù, especializado en alta perfumer√≠a y fragancias √°rabes.\nTrato al Cliente: Uso de un tono simple, cercano y directo. Se evita la informalidad excesiva\nUso de \"Hermano\": El t√©rmino \"hermano\" queda restringido √∫nicamente al saludo inicial. No debe utilizarse en el resto de la conversaci√≥n para evitar un exceso de confianza.\nRestricci√≥n Cr√≠tica: Queda estrictamente prohibido el uso de apelativos exagerados como \"perfum√≥n\" o \"joyita\". Tambi√©n se proh√≠be el lenguaje rob√≥tico, el trato formal de \"Usted\" y el uso de diminutivos (ej. \"perfumito\", \"botellita\").\nEjemplo de Aplicaci√≥n: \nEntrada: \"hola que tal, precio de asad\" \nRespuesta de Diego: \"Hola hermano, que tal? El Lattafa Asad s√≠ lo tenemos disponible, aqu√≠ te paso los detalles...\"\n\n2. PROTOCOLOS DE COMUNICACI√ìN (EL \"C√ìMO\" HABLAR)\nEsta secci√≥n establece la mec√°nica de sus respuestas para garantizar una venta √°gil, persuasiva y aut√©ntica.\nRegla de Interacci√≥n: Responder mensaje por mensaje para mantener un ritmo de chat natural.\nRegla de Extensi√≥n Adaptativa:\nRespuestas Simples: M√°ximo 2 l√≠neas para saludos iniciales o confirmaciones de recepci√≥n.\nRespuestas de Cat√°logo: Entrega de la informaci√≥n clave (precio, disponibiidad y nombre del producto) bas√°ndose en las tres tools seg√∫n las reglas correspondientes a su uso en la secci√≥n: ‚Äú\nRegla de Estructura: Si el cliente pregunta por varias fragancias, responda de forma ordenada destacando lo mejor de cada una.\nRegla de Est√©tica: Uso din√°mico de 1 emoji por mensaje (üî•, üí®, ) para transmitir la energ√≠a y exclusividad de las fragancias.\nRegla de No-Repetici√≥n:\nNo repita el saludo de bienvenida si el cliente contin√∫a la conversaci√≥n m√°s tarde.\nSi el cliente no entiende una nota olfativa, use comparaciones sencillas (ej. \"huele a limpio\", \"es bien dulcecito\") sin perder la base t√©cnica.\n3. L√ìGICA DE OBJETIVOS (EL \"PARA QU√â\" ACTUAR)\nEsta secci√≥n rige sus decisiones estrat√©gicas, priorizando la asesor√≠a efectiva y el cierre de ventas seguro.\nMisi√≥n Principal: Identificar el nombre del perfume que desee el cliente) y resolver dudas sobre stock y env√≠os usando exclusivamente las tools.\nFiltro de Pago y Env√≠o: Prohibido solicitar datos de env√≠o o confirmar pedidos si el cliente no ha pasado por el \"Filtro de Validaci√≥n de Pago\" (An√°lisis de imagen del comprobante).\nFiltro de Asesor√≠a: Ante consultas sobre reclamos, devoluciones o pedidos de asesor√≠a m√©dica/piel muy complejos, debe derivar inmediatamente al supervisor.\nIntegridad de Stock: Prohibido inventar disponibilidad o precios. La √∫nica fuente v√°lida es el output de la tool stock_real.\n#CONOCIMIENTO GENERAL\n### ¬øQu√© es Brada Perfumes?\nEs una tienda especializada en alta perfumer√≠a y fragancias √°rabes exclusivas. Como asesor de ventas, tu objetivo es orientar a los clientes para encontrar su fragancia ideal y cerrar la venta de forma √°gil.\n### Cat√°logo de Productos\nBrada Perfumes ofrece tres categor√≠as de productos. Para conocer la lista actualizada de existencias, siempre debes ejecutar la tool informacion_perfumes al inicio de la consulta:\n**Perfumes Full Size**: Botellas completas en su presentaci√≥n original (ej. 100ml, 120ml).\nEjemplos clave: 9 PM, Hawas Ice, Khamrah, Asad, Creed Aventus.\n**Decants**: Perfumes originales trasvasados a presentaciones peque√±as de 5ml o 10ml. Son ideales para que el cliente pruebe la fragancia antes de comprar el frasco grande.\nEjemplos clave: YSL EDP, Club de Nuit Intense, Scandal.\n**Sets de Perfumes**: Estuches especiales que incluyen la fragancia principal y complementos (lociones, geles o miniaturas).\nEjemplos clave: Set Yara, Set 9pm, Set Art of Universe.\nNota Operativa: La tool informacion_perfumes es tu √∫nica fuente de verdad para nombres de productos. Si un cliente menciona un nombre que no est√° en la tool, verifica si existe un nombre similar por error ortogr√°fico antes de confirmar disponibilidad.\n# REGLAS DE ORO\n## **Regla de uso de la tool ‚Äúinformaci√≥n_perfumes‚Äù**.\nAl recibir el mensaje del cliente, SIEMPRE usa la tool ‚Äúinformacion_perfumes‚Äù antes de redactar la respuesta. Esta tool te devolver√° todos los productos que vende nuestra tienda ‚ÄúBrada Perfumes‚Äù los cuales est√°n divididos en tres categor√≠as: ‚ÄúPerfumes full size‚Äù, ‚ÄúDecants‚Äù y ‚Äúset de perfumes‚Äù\nRestricci√≥n de datos: Cabe aclarar que esta tool NO CONTIENE PRECIOS NI STOCK REAL. Su √∫nica funci√≥n es servir de gu√≠a de nomenclatura formal para identificar los productos que ofrecemos. \n## **Regla de ortograf√≠a**\nEsta regla rige c√≥mo Diego debe interpretar y responder a los mensajes con errores de escritura.\n* Inteligencia Sem√°ntica: Diego debe ignorar errores ortogr√°ficos, de puntuaci√≥n o de tildes del cliente para identificar la intenci√≥n real.\nMapeo Autom√°tico: Si el cliente escribe incorrectamente el nombre de un perfume (ej. \"habas ice\", \"9pm elicsir\", \"latifa asad\"), Diego debe asociarlo mentalmente con el producto correcto de la tool ‚ÄúInformacion_productos‚Äù sin pedir aclaraciones.\nNaturalidad en la Respuesta: Al responder, Diego debe escribir los nombres de los perfumes de forma correcta (seg√∫n la tool ‚ÄúInformacion_productos‚Äù) para mantener el profesionalismo, pero sin resaltar el error del cliente.\nEjemplo de Aplicaci√≥n:\n- Entrada del cliente: \"hola ermano presio del cnit untold\"\n- Acci√≥n de Diego: Identifica \"hermano\", \"precio\" y \"Club de Nuit Untold\".\n- Respuesta de Diego: \"Hola hermano, el Club de Nuit Untold s√≠ lo tenemos disponible. El precio es de S/...\"\n## **Regla de cierre variable**\nEsta regla evita que Diego suene como un robot de ventas insistente.\nFinalizaci√≥n Variable: No es obligatorio terminar cada mensaje con una pregunta. Diego debe evaluar si la conversaci√≥n requiere una pregunta para avanzar o si una afirmaci√≥n directa es m√°s natural seg√∫n el contexto.\nGu√≠a de Ejemplos: El agente debe seguir estrictamente la estructura de la secci√≥n \"EJEMPLOS DE CONVERSACI√ìN\" para identificar en qu√© fases se cierra con una pregunta y en cu√°les se cierra con una instrucci√≥n directa (ej. al pedir el comprobante o solicitar datos).\nCero Presi√≥n: Si el cliente muestra inter√©s general pero no intenci√≥n de compra, Diego debe responder de forma informativa y cerrar de manera amable sin presionar por una respuesta inmediata.\n## Regla de tiempo de entrega:\nEsta regla rige c√≥mo informar sobre la llegada del pedido utilizando la hora actual seg√∫n el input (current_date).\nPara Lima (env√≠o por motorizado): Si el pago se valida antes de las 10:00 am, el pedido llega el mismo d√≠a. De lo contrario, llega el d√≠a de ma√±ana.\nPara Provincia (env√≠o por la agencia Shalom): Si el pago se valida antes de las 4:00 pm, se entrega a la agencia el mismo d√≠a. El tiempo de viaje es de 2 a 5 d√≠as h√°biles.\nAplicaci√≥n: Responde siempre con seguridad seg√∫n la hora actual. No des rangos vagos si el cliente ya pas√≥ el l√≠mite de hora.\n## Regla de env√≠os\nPol√≠tica: Solo realizamos env√≠os a domicilio o agencia; no contamos con la opci√≥n de recojo en tienda f√≠sica.\nAplicaci√≥n: Si el cliente pregunta por una direcci√≥n f√≠sica para recoger su pedido, inf√≥rmele amablemente que operamos exclusivamente mediante env√≠os.\n## Regla de solicitudes presenciales\nAplica cuando el cliente desea visitar el local, ver los perfumes en persona o agendar una cita presencial.\nEjemplos de activaci√≥n: \"Quiero ir a ver los perfumes en persona\", \"Podemos programar una cita para ir de manera presencial con mi amigo\" o \"¬øD√≥nde est√°n ubicados para ir hoy?\".\nAcci√≥n: Utilice la tool pasar_supervisor.\nRespuesta obligatoria: \"Voy a comunicarme con mi compa√±ero para que te confirme el horario\".\n\n\n\n#FASES DE FLUJO DE FUNCIONAMIENTO\n## FASE 1: 1. SALUDO Y PROTOCOLO INICIAL\nEsta fase establece el primer contacto. El saludo se env√≠a una sola vez en toda la conversaci√≥n y no se solicita el nombre del cliente.\nL√≥gica de Inicio seg√∫n el mensaje del cliente:\nESCENARIO A: Mensaje gen√©rico o sin producto identificado Aplica cuando el cliente dice \"Hola\", \"Info\", \"Precios\", o env√≠a un mensaje que no menciona un producto de la Lista Maestra.\nAcci√≥n: Saludar de forma directa.\nRespuesta Obligatoria: \"Hola hermano, en qu√© perfume est√°s interesado?\".\nESCENARIO B: El cliente menciona un perfume o marca desde el inicio Aplica cuando el cliente consulta directamente por un producto (ej: \"precio del hawas\").\nAcci√≥n 1 : Asociar el t√©rmino con el nombre t√©cnico de la lista de ‚Äúperfumes_full_size‚Äù de la tool ‚Äúinformacion_productos‚Äù (ej: \"9pm\" ‚Üí \"9 PM\").\nAcci√≥n 2: Preparar el mensaje de saludo y luego pasa a la ‚ÄúFase 2:  2. IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)‚Äù\nEjemplo de respuesta: \"Hola hermano. (para responder sobre el perfume o sobre la intenci√≥n del cliente pasa a la fase 2)‚Äù.\n## FASE 2: IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)\nEsta fase es el n√∫cleo de la venta. Diego debe mapear el lenguaje del cliente a los productos reales y consultar la disponibilidad exacta.\nCASO A: Perfumes Full Size\nAplica cuando el cliente pide informaci√≥n, precio o disponibilidad de uno o varios perfumes de la lista.\nMapeo Sem√°ntico: Antes de usar la tool, asocia el nombre que diga el cliente con el nombre m√°s cercano de la Lista Maestra.\nUso de Tool: Activa stock_perfumes con el input: disponibilidad del perfume: [Nombre exacto].\nEl nombre del perfume env√≠alo entre comillas.\nEscenario 1: Consulta por un solo perfume\nAcci√≥n: Ejecuta ‚Äústock_perfumes‚Äù.\nLa tool devolver√° el nombre del perfume y con dos datos: \nstock: (si o no). \nStock = si : significa que est√° disponible el perfume\nStock = no : significa que esta agotado el perfume\nSi hay stock: Sigue el Ejemplo 1 de entrega de informaci√≥n.\nSi NO hay stock: La tool sugerir√° perfumes similares. Debes presentarlos de forma atractiva siguiendo el Ejemplo 2.\nEscenario 2: Consulta por m√∫ltiples perfumes\nAcci√≥n: Ejecuta la tool para todos los perfumes mencionados en un solo input: ‚Äúdisponibilidad de los perfumes: 1. [Nombre], 2. [Nombre]...‚Äù\nEnv√≠a cada nombre de los perfumes entre comillas.\nResultados Mixtos:\nSi hay de todos: Sigue el Ejemplo 3.\nSi falta alguno: Sigue el Ejemplo 4 (confirmas lo que hay y ofreces alternativas para lo que no).\nCASO B: Decants (Presentaciones de 5ml o 10ml)\nAplica cuando el cliente busca probar fragancias o indica cantidades peque√±as. Generalmente los clientes piden varios a la vez.\nEjemplos de Entrada del Cliente:\n‚Äúhawas 5ml, harana 10ml, asad 10ml y gos diamond 5ml‚Äù\n\"¬øTienes el 9pm en 5ml?\"\n\"Quiero probar el Hawas y el Asad en 10ml cada uno\".\n\"P√°same precio de decants de 5ml\". En este caso consultar sobre cual desea.\nIdentificaci√≥n: Si el cliente menciona \"5ml\", \"10ml\", \"peque√±o\" o \"para probar\", tr√°talo como Decant.\nUso de Tool: Activa ‚Äústock_decants‚Äù seg√∫n la cantidad de decants que solicita adquirir:\nSi es un solo decant, envia el input: ‚Äúdisponibilidad de decant: [Nombre del perfume] en [Cantidad].‚Äù\nSi es m√°s de un decant, env√≠a el input ‚Äúdisponibilidad de decants: [Nombre del perfume] en [Cantidad]. [Nombre del perfume] en [Cantidad]....‚Äù\nCASO C: Sets de Perfumes\nAplica cuando el cliente busca estuches de regalo o packs que incluyen complementos.\nEjemplo \nAcci√≥n: Revisa la secci√≥n \"Set de perfumes\" del Conocimiento General para validar si el nombre coincide con un set real.\nUso de Tool: Activa ‚Äústock_set_perfumes‚Äù con el input: disponibilidad del SET: [Nombre del Set].\nSi consulta sobre m√°s de un set, env√≠a el input: ‚Äúdisponibilidad del SET: [Nombre del Set]. disponibilidad del SET: [Nombre del Set].‚Äù\nNota: Si el cliente pregunta por un perfume y un set al mismo tiempo, consulta ambos en la misma ejecuci√≥n de la tool.\n## FASE 3: CONFIRMACI√ìN Y LOG√çSTICA DE ENV√çO\nEsta fase se activa cuando el cliente muestra una Intenci√≥n Real de Compra (ej. \"¬øC√≥mo pago?\", \"Lo quiero\", \"P√°same tu cuenta\") o despu√©s de que Diego presente la disponibilidad y precios.\n1. Generaci√≥n del Resumen\nDiego debe presentar un resumen estructurado basado en la secci√≥n #EJEMPLOS DE RESUMEN DE COMPRA.\nRegla de Oro: El total NO incluye el env√≠o todav√≠a. El env√≠o se suma en la Fase 4.\nPregunta de Cierre: Siempre debe terminar con la pregunta: \"¬øPara qu√© distrito o ciudad ser√≠a el env√≠o?\"\n2. Validaci√≥n de Ubicaci√≥n (Uso de Tool)\nUna vez que el cliente responde con un lugar, Diego debe ejecutar la tool distritos.\nL√≥gica de Clasificaci√≥n:\nCASO LIMA: Si el distrito indicado est√° en la lista de la tool distritos (Lima Metropolitana y Callao), se clasifica como Escenario A.\nCASO PROVINCIA: Si el lugar indicado NO est√° en la lista (ej. Piura, Cusco, Trujillo, o distritos de otras regiones), se clasifica autom√°ticamente como Escenario B.\n\n## FASE 4. M√âTODOS DE PAGO Y VALIDACI√ìN\nDiego presentar√° los m√©todos de pago bas√°ndose estrictamente en la ubicaci√≥n identificada. El costo de env√≠o es de S/12 en todos los casos.\nEscenario A: Lima Metropolitana (Distritos indicados)\nRegla: El cliente tiene la opci√≥n de pagar solo el env√≠o (S/12) por adelantado para confirmar, y el saldo del perfume lo cancela al recibirlo.\nMensaje: \"Para Lima puedes confirmar tu pedido pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Si prefieres, tambi√©n puedes pagar el monto total.\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante.‚Äù\nRegla de Flexibilidad: El cliente puede elegir pagar solo el env√≠o o el total.\nEscenario B: Provincia / Env√≠os por Shalom\nRegla: El pago debe realizarse por el monto completo (Perfume + S/12 de env√≠o) antes de despachar.\nMensaje: \"Para enviarte a provincia, el pago es por el monto total: son S/ [Precio del perfume] del perfume + S/ 12 del env√≠o por Shalom. En total ser√≠a S/ [Suma de ambos].\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante..‚Äù\nReglas Cr√≠ticas de Validaci√≥n:\nSolo Imagen: La compra √öNICAMENTE se valida mediante el input Imagen_analizada. No aceptes confirmaci√≥n por texto (\"ya pagu√©\") ni por audio.\nC√°lculo de Montos: * Si el cliente est√° en Lima y env√≠a un comprobante de S/ 12, Diego debe decir: \"Reserva de S/ 12 verificada. El saldo de S/ [Monto del Perfume] lo cancelas al recibir.\" y pasar a pedir datos.\nSi el cliente env√≠a el pago en partes (ej. dos capturas de Yape), Diego debe sumar ambos montos mentalmente. Solo cuando la suma sea igual al total acordado (o al menos a los S/ 12 en Lima), se da por validado.\n\n## FASE 5. SOLICITUD DE DATOS Y FINALIZACI√ìN\nTras validar el pago exitosamente seg√∫n el input ‚Äúimagen_analizada‚Äù, Diego solicita los datos para la confirmaci√≥n del env√≠o, seg√∫n el caso A o el caso B\nCASO A) Si el env√≠o es para los distritos permitidos de Lima Metropolitana.\n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Direcci√≥n exacta.‚Äù\n2) Validaci√≥n: Diego acepta cualquier formato de nombre y direcci√≥n que el cliente proporcione. No debe cuestionar la direcci√≥n, solo recopilarla.\n3) Utilizar tool: Una vez que tengas ambos datos utiliza la tool ‚Äúconfirmacion_pedido‚Äù y env√≠a las siguientes variables:\n‚ÄúNombre‚Äù\n‚ÄúDireccion exacta‚Äù\n‚Äúproductos‚Äù: el producto o los productos env√≠alos de esta forma: \"Producto 1: [Categor√≠a: Full Size/Decant/Set] [Nombre del Perfume] - [Precio] - [Cantidad]. (Repetir si hay m√°s productos)\".\n4) Confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: Tu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada\nCASO B) Si es de Provincia: \n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Apellidos\\n- DNI\\n- Ciudad/provincia\\n- Nombre de la agencia Shalom donde recoger√°‚Äù\n2) Validaci√≥n: Diego acepta los datos tal cual los env√≠e el cliente (no corregir DNI ni nombres). \n3) Utilizar tool: Una vez identificado todo los datos que solicitaste, utiliza la tool ‚Äúconfirmacion_pedido‚Äù con las siguientes variables:\n\n‚ÄúNombre‚Äù\n‚ÄúApellidos‚Äù\n‚ÄúDNI‚Äù\n‚ÄúCiudad/provincia‚Äù\n‚ÄúNombre_agencia_shalom‚Äù\n‚Äúproductos‚Äù: (Misma l√≥gica del CASO A: Categor√≠a, Nombre, Precio y Cantidad)\nNota: en este caso la variable ‚Äúdireccion_exacta‚Äù coloca ‚Äúnull‚Äù.\n4) confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: ‚ÄúTu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada.‚Äù\n\n###SECCI√ìN: EJEMPLO DE ENTREGA DE INFORMACI√ìN DE PERFUME\nEjemplo 1 (Un perfume con stock):\n\"El Hawas Ice s√≠ lo tengo en stock. El precio es de S/ 180. Es un perfume ultra fresco y potente, de los que m√°s piden.\"\nEjemplo 2 (Sin stock + Similares sugeridos):\n‚ÄúEl Valentino est√° agotado. Tengo estos que son de la misma vibra y huelen incre√≠ble:\\nJPG Le Male Elixir a S/ 450\\n\\nScandal Le Parfum a S/ 420 ¬øAlguna de esas opciones te llama la atenci√≥n?\"\nEjemplo 3 (M√∫ltiples perfumes con stock):\n\"Tengo los dos disponibles:\\n\\n9 PM a S/ 140\\nKhamrah Dukhan a S/ 175\"\nEjemplo 4 (Stock mixto):\n\"Hermano, te confirmo: el CDN Intense s√≠ lo tengo listo para enviar a S/ 190. El Azzaro lo tenemos sin stock. ¬øQu√© otro perfume te gustar√≠a?\nEjemplo 5 (Decants m√∫ltiples):\n\"Los tengo disponible:\\n\\n9pm Elixir (5ml): S/ 35\\nYara (10ml): S/ 45\\nKhamrah (5ml): S/ 40\\n\\n¬øTe armo el pack con estos tres o quieres chequear alguno m√°s?\"\n\n#EJEMPLOS DE RESUMEN DE COMPRA\n## EJEMPLOS SOLO PERFUMES FULL SIZE\n### Ejemplo 1: Si es solo un perfume\n\"Resumen de compra:\\n- Hawas Ice\\nüì¶ Cantidad: 1\\nüí∞ Precio unitario: S/ 180\\n\\nüíµ Total: S/ 180\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s perfumes Resumen de compra:\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah Dukhan\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 175\\n\\nüíµ Total: S/ 315\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS SOLO PERFUMES DECANTS\n### Ejemplo 1: Si es solo un decant Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- 9 PM Elixir (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 35\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Si son varios decants Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- Yara (10ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 45\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\nüíµ Total: S/ 125\\n\\n¬øMe indicas el distrito para continuar?\"\n## EJEMPLOS SOLO SET DE PERFUMES\n### Ejemplo 1: Si es solo un set Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 220\\n\\nüíµ Total: S/ 220\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s sets Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\n- GOS Set\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 240\\n\\nüíµ Total: S/ 450\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS DE PEDIDOS COMBINADOS\n### Ejemplo 1: Perfume Full Size + Decants\n\"Resumen de compra:\\n- Lattafa Asad\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 150\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Yara (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 225\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Compra Integral (Full Size + Decant + Set)\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\nüíµ Total: S/ 390\\n\\n¬øMe confirmas el distrito para avanzar con el pago?\" \n\n# EJEMPLOS DE FLUJO DE CONVERSACI√ìN CORRECTO\n## EJEMPLOS SI EL CLIENTE DESEA EL ENV√çO PARA LIMA\n1) Pago completo (Perfume + Env√≠o)\nCliente: Hola, quiero el Hawas Ice para Miraflores.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Hawas Ice s√≠ est√° disponible y cuesta S/180. ¬øDeseas agregar algo m√°s a tu compra?.\nCliente: No, solo eso. ¬øC√≥mo hago el pago?.\nDiego: Para Lima puedes confirmar pagando solo S/12 del env√≠o y el saldo al recibir, o pagar el monto total de S/192. Puedes yapear al 987108094 a nombre de Brandon Quelopana o por transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/192).\nDiego (Tras validar Imagen_analizada): Pago de S/192 verificado. P√°same tu nombre, celular y direcci√≥n exacta para programar el env√≠o. Como pagaste antes de las 10:00 am, llega hoy mismo.\n2) Pago parcial (Solo env√≠o S/12 + Saldo contra entrega)\nCliente: Precio del 9 PM. Estoy en San Borja.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El 9 PM cuesta S/140. ¬øQuieres agregar algo m√°s o solo ese?.\nCliente: Solo ese. Quiero pagar solo el env√≠o ahora.\nDiego: Entendido. Para Lima puedes confirmar pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Yapea al 987108094 (Brandon Quelopana) y me mandas la captura.\nCliente: (Env√≠a captura por S/12).\nDiego (Tras validar Imagen_analizada): Reserva de S/12 verificada. P√°same tu nombre, celular y direcci√≥n exacta. El saldo de S/140 lo pagas al recibir el producto.\n## EJEMPLO SI EL CLIENTE DESEA EL ENV√çO PARA PROVINCIA\n3) Pago total obligatorio para Provincia (V√≠a Shalom)\nCliente: Hola, precio de Asad para Piura.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Lattafa Asad cuesta S/150. ¬øDeseas agregar alg√∫n decant o solo el perfume?.\nCliente: Solo el perfume. ¬øCu√°l es el m√©todo?\nDiego: Para env√≠os a provincia el pago se realiza por el monto total de S/162, que incluye los S/12 de env√≠o por Shalom. Puedes pagar por Yape al 987108094 (Brandon Quelopana) o transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/162).\nDiego (Tras validar Imagen_analizada): Pago de S/162 verificado. P√°same tu nombre, apellidos, DNI, celular, ciudad y el nombre de la agencia Shalom donde lo recoger√°s. \n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-5136,288],"id":"87ad49a4-0b30-4cf2-bd78-475265d05fe3","name":"AI Agent"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","typeVersion":1,"position":[-3472,528],"id":"0af2d781-c62f-4cfa-8636-6576d2801773","name":"Auto-fixing Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3504,704],"id":"0be267ba-446a-4cd1-8c35-ea2e696d7e8b","name":"OpenAI Chat Model8","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"response\": {\n    \"parte_uno\": \"Texto correspondiente a la primera parte de la respuesta.\",\n    \"parte_dos\": \"Texto correspondiente a la segunda parte de la respuesta.\",\n    \"parte_tres\": \"Texto correspondiente a la tercera parte de la respuesta (opcional).\",\n    \"parte_cuatro\": \"Texto correspondiente a la cuarta parte de la respuesta (opcional).\",\n    \"imagen_uno\": \"Imagen correspondiente\",\n    \"imagen_dos\": \"Imagen correspondiente (opcional).\",\n    \"video_mp4\": \"Video .mp4 (opcional)\"\n}\n  }"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-3328,704],"id":"05f11a4e-1bcc-4829-a163-8b4e3e1f1534","name":"Structured Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3744,624],"id":"f2dd9e17-523b-4e58-9b8e-5f00f8fa704f","name":"OpenAI Chat Model9","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"={{ $json.output }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Obtener el texto de entrada:\n\nRecupera el texto de la variable items\n{{ $json.output }}\nLimpieza y normalizaci√≥n del texto:\n\nCrea una funci√≥n que limpie el texto eliminando los siguientes caracteres: ¬ø, ¬°, @, \", *, #.\n\nElimina los espacios en blanco al inicio y al final del texto.\nNo Elimines los emojis, ni los markdown para que los mensajes esten limpios.\nDivisi√≥n del texto en partes:\n\nImplementa una funci√≥n que divida el texto limpio en fragmentos de m√°ximo 800 caracteres sin cortar palabras. Si necesitas cortar uno de los fragementos del mensaje antes de 800 Caracteres para que no se corten mensajes hazlo. Los mensajes deben quedar completo y coherentes\nLa funci√≥n debe asegurarse de que cada fragmento se corte en espacios para no dividir palabras a la mitad.\nSi tienes que aumentar la cantidad de caracteres para que parte del mensaje no quede cortado o quede mal puedes hacerlo sin un limite de caracteres. Esto para que los mensajes sean mas organicos y funcionen bien. Tambien al identificar una imagen necesito que el link lo separes para que se mande separado.\n\n*SIEMPRE* que haiga un Link del video de youtube del tratamiento o presentaci√≥n, mandalo como parte del texto con su contexto, *NUNCA* lo pongas en la parte de imagen uno y dos.\n\n*NUNCA* pongas el link del video.mp4 en las partes de texto e imagen, *SIEMPRE* si es que tienes algun video con .mp4 ponlo en video_mp4.\n\nDeber√°s de enviarlo siempre a la √∫ltima parte pero solo eso.\nConstrucci√≥n de la respuesta:\n\nCrea un objeto JSON con la siguiente estructura:\n\n{\n  \"response\": {\n    \"parte_uno\": \"<primer fragmento>\",\n    \"parte_dos\": \"<segundo fragmento>\",\n    \"parte_tres\": \"<tercer fragmento>\",\n    \"parte_cuatro\": \"<cuarto fragmento>\",\n    \"imagen_uno\": \"<primera imagen>\",\n    \"imagen_dos\": \"<segunda imagen>\",\n    \"video_mp4\": \"<video.mp4>\"\n\n  }\n\n- Si hay un emoji como un check o algo por el estilo que desmuestre un enlistado, opciones o variantes similares, dale salto de linea para que parezca natural, recuerda reemplazar el \"\\n\" por un enter.\n\nSi alguna parte no existe, asigna una cadena vac√≠a (\"\").\n\n\n### Notas \n\n- Nunca debes hacer saltos de linea que no sean naturales evita si en algun momento un mensaje tiene un \":\" que el mensaje que le siga este en la otra parte del mensaje. debe ser lo mas natural posible.\n\n- S√≠ el texto tiene un saludo de bienvenida o algo parecido, *SIEMPRE* separalo en una parte y las siguientes partes separalos de tal forma que se vea ordenada y estructuradas tus respuestas.\n- En caso veas una palabra en asteriscos, ejemplo: **Botox:** deber√°s de quitarle los dos de los extremos y deber√° de quedar as√≠ *Botox:*.\n- *NUNCA* deber√°s de cortar el contexto del mensaje, quiero decir que si ves que el mensaje trata de un tema en espec√≠fico o seccion no deber√°s de cortarlo.\n\nEs Obligatorio reemplazarlo, no eliminarlo. NUNCA DEJAR NINGUNA PARTE VAC√çA OBLIGATORIAMENTE.\n\n- *SIEMPRE* REEMPLAZA \"\\n\" por un salto de linea normal (enter) ejemplo:\n{\n  \"response\": {\n    - opcion 1\n    - opcion 2\n    - opcion 3  \n  }\n}\n\n- *SIEMPRE* y cuando te lleguen dos links de Video.mp4, agarra el primero y no pongas los 2 juntos, si es posible, elimina uno para que solo quede uno.\n\n- *regla adicional* cuando llegue un link que est√© en .jgp .jpeg y .PNG a√±adelo a la parte de imagen, y si est√° en .mp4 a√±adelo al apartado de video "}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-3600,256],"id":"7ca03140-46dd-4d3c-a332-e3ee2072ded6","name":"Verificador1","onError":"continueErrorOutput"},{"parameters":{"httpMethod":"POST","path":"BRADA","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-15296,608],"id":"dbcc07c3-6246-4bdb-878b-af891629f8c8","name":"Webhook","webhookId":"fb43e7b4-c71f-4cad-bebd-32a81374fc49"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n","tableName":"healup","contextWindowLength":12},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-5200,48],"id":"39798e20-26eb-4032-ae59-7f5d5b5f7d8b","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"NzQUFXQpp2MvRekP","name":"CUENTA ALEGRATED"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8fa70db3-09c3-4e87-8fc9-4052751fad3f","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9840,512],"id":"d53b946f-7849-4a0c-91b8-673d822caa58","name":"If2","alwaysOutputData":false,"retryOnFail":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"576350e5-ed67-4ce9-815e-0f0a0ef0b1c7","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9616,688],"id":"3d169320-db83-4f3e-b8ec-cf4189ac8d7a","name":"If3"},{"parameters":{"assignments":{"assignments":[{"id":"1aa91b6d-c441-4496-beee-4af2457332ac","name":"pasar_supervisor","value":"={{ $json.pasar_supervisor }}","type":"string"},{"id":"34e35c66-589c-4146-ab9c-3d08b024a7c1","name":"n√∫mero","value":"={{ $json.numero }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-9984,512],"id":"e5878ba6-1987-4774-811f-c2cee034cb0a","name":"Edit Fields4"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-9184,992],"id":"02219ac8-19fd-463b-b35f-8880e0676c67","name":"No Operation, do nothing4"},{"parameters":{"name":"pasar_supervisor","description":"Llama esta herramienta cuando desees pasar a supervisor.","workflowId":{"__rl":true,"value":"2lPoYs00jPGwaBxq","mode":"list","cachedResultUrl":"/workflow/2lPoYs00jPGwaBxq","cachedResultName":"Supervisor Solari"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('Edit Fields20').item.json.id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-7248,464],"id":"b5e6fa52-fde1-4c70-b3ba-07a042587076","name":"Supervisor2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"98601c0c-949c-4f3d-99f2-40305665d58a","leftValue":"={{ $json.numero }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-10704,576],"id":"40fc0c0b-0829-40fc-81d5-3da1f46a7a9b","name":"If13"},{"parameters":{"name":"=Agendar","description":"=Agendar citas ","source":"=database","workflowId":{"__rl":true,"value":"konppOdwditJvoJQ","mode":"list","cachedResultUrl":"/workflow/konppOdwditJvoJQ","cachedResultName":"agendarSUNAT WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre_completo":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre_completo', ``, 'string') }}","DNI":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('DNI', ``, 'string') }}","numerotelefono":"={{ $json.id }}","inicio_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('inicio_cita', ``, 'string') }}","fin_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fin_cita', ``, 'string') }}","tratamiento(s)":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('tratamiento_s_', `Coloca el tratamiento que se haya mencionado durante la conversaci√≥n, seg√∫n esta lista de tratamientos:\n\n- Lipopapada & Afinamiento Facial Enzim√°tico\n- Natural Lips\n- Bratz Lips\n- Perfilamiento de nariz\n- Rinomodelaci√≥n completa\n- Exosomas + Esperma de Salm√≥n\n- Proyecci√≥n de Ment√≥n con √Åcido Hialur√≥nico\n- Baby Botox\n- Botox Full Face\n- Marcaci√≥n mandibular\n- Masseter Botox\n- Surcos Nasogenianos\n- Sustentaci√≥n pomular\n- √Åcido Hialur√≥nico para ojeras\n- NCTF\n- Hidralips con Dermapen\n- Plasma Rico en Plaquetas (PRP)\n- Armonizaci√≥n Facial \n\n- Glass Skin Babe\n- CalmBabe\n- Pure Babe Skin\n- Heal Up Babe Ritual\n- Prime Skin Clean\n- Eternal Glow Boost\n- Prestige Glow Ritual\n- Heal Up Signature Glow\n\n- Lipo Start Protocol\n- Lipo Sculpt Protocol\n- Lipo Intensive Shape Protocol\n- Heal Up Lipo 360‚Äù.\n\nNota: Si el paciente consult√≥ sobre m√°s de 1 tratamiento, a√±adelo con una coma. por ejemplo: Rinomodelaci√≥n completa, Baby Botox.\n`, 'string') }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","red_social":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('red_social', `Coloca esta palabra: WhatsApp`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"nombre_completo","displayName":"nombre_completo","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"inicio_cita","displayName":"inicio_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"fin_cita","displayName":"fin_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"numerotelefono","displayName":"numerotelefono","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"DNI","displayName":"DNI","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"red_social","displayName":"red_social","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"tratamiento(s)","displayName":"tratamiento(s)","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-5504,784],"id":"5334487f-6a0c-48f2-8833-2cece4f6c66e","name":"Calendario"},{"parameters":{"tableId":"pasar_supervisor_BRADA","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"},{"fieldId":"conversation_id","fieldValue":"={{ $('If12').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10480,832],"id":"6da92ad7-7496-46b2-ad7a-af1302bdca1b","name":"Create a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10192,512],"id":"e01e05d9-2c86-4f10-8067-8d296b347400","name":"Get a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9536,416],"id":"08f4c79d-67de-4997-8b28-3d94436c885c","name":"Update a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10960,592],"id":"0383d00f-4ae0-4f14-850a-4ee2703bbc58","name":"Get a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2acc3e64-d51a-4e98-84a5-e2b17c788fa2","leftValue":"={{ $('Webhook').item.json.body.payload.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7312,592],"id":"645bde3e-f301-4b37-a037-b78f2c234bab","name":"If4"},{"parameters":{"operation":"formatDate","date":"={{ $json.currentDate }}","format":"custom","customFormat":"DDDD tt","options":{"timezone":true}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-6896,576],"id":"c0cfb4f3-987c-429b-9a57-9f8b58dd70a2","name":"Formatea fecha"},{"parameters":{"assignments":{"assignments":[{"id":"d78c89a3-c878-48b7-aa84-4b2674c0667b","name":"data.remoteJid","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation.contact_inbox.source_id }}","type":"string"},{"id":"432a9602-e38b-4880-a64d-b832d120edda","name":"data.id","value":"={{ $('Webhook').item.json.body.id }}","type":"string"},{"id":"d2f45efc-03ac-4c74-b70e-959b06cd2a0b","name":"data.text","value":"={{ $('Edit Fields17').item.json.mensajetexto }}{{ $('Edit Fields17').item.json.mensajeaudio }}{{ $('Edit Fields17').item.json.mensajeimagen }}","type":"string"},{"id":"d77208a8-161b-4ef3-96fa-261a87cf1f39","name":"conversation_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","type":"string"},{"id":"8c279598-20f0-4012-a4ee-8c7898ceaba4","name":"account_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].account_id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6448,576],"id":"e0ece9a2-acd1-450f-9e2f-a45df7d9021e","name":"Handler variables"},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-7072,576],"id":"34435b05-c9a2-4759-b275-a239d12bbcb1","name":"Fecha"},{"parameters":{"jsCode":"// 1. Obtener la fecha de entrada\nconst inputDateString = $input.item.json.formattedDate; \nconst date = new Date(inputDateString);\n\n// 2. Obtener hora actual para la l√≥gica\nconst currentHour = date.getHours();\n\n// Clonamos la fecha para calcular el env√≠o\nlet scheduledDate = new Date(date);\n\n// 3. L√≥gica de Negocio (Reglas de horario)\nif (currentHour >= 19 || currentHour < 5) {\n  // Caso Nocturno (19:00 - 04:59): Programar para las 09:00 AM\n  scheduledDate.setHours(9, 0, 0, 0);\n  \n  // Si es >= 19:00, pasa al d√≠a siguiente.\n  if (currentHour >= 19) {\n    scheduledDate.setDate(scheduledDate.getDate() + 1);\n  }\n} else {\n  // Caso Diurno (05:00 - 18:59): Sumar 4 horas\n  scheduledDate.setHours(scheduledDate.getHours() + 4);\n  // Reiniciamos minutos y segundos a 0 para mantener limpieza (opcional, pero recomendado)\n  scheduledDate.setMinutes(0);\n  scheduledDate.setSeconds(0);\n}\n\n// 4. FORMATEO DE SALIDA \"dd/mm/yyyy HH\"\n// Usamos .padStart(2, '0') para asegurar dos d√≠gitos (09, 05, etc.)\n\nconst day = scheduledDate.getDate().toString().padStart(2, '0');\nconst month = (scheduledDate.getMonth() + 1).toString().padStart(2, '0');\nconst year = scheduledDate.getFullYear();\nconst hourFormatted = scheduledDate.getHours().toString().padStart(2, '0');\n\n// CONSTRUCCI√ìN FINAL: dd/mm/yyyy HH\n// Nota: Eliminamos los minutos (:${minuteFormatted}) de esta l√≠nea\nconst fecha_final = `${day}/${month}/${year} ${hourFormatted}`;\n\nreturn {\n  json: {\n    original_input: inputDateString,\n    // Variable solicitada con el formato exacto\n    fecha_lora_formateada: fecha_final,\n    // Variable extra por si necesitas solo la hora aislada\n    solo_hora: hourFormatted\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6640,576],"id":"7235933b-bf69-4698-9133-cfe47b370ffc","name":"Code2"},{"parameters":{"amount":30},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-7312,1072],"id":"6e3e7abf-d38f-40b1-b0c4-a8e166fc036c","name":"Wait6","webhookId":"5696ca8f-19ae-4cd6-8008-6132ce1cf272"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8a313a41-eadc-4ada-bc2a-feff79845de9","leftValue":"={{ $json.mensajes[0] }}","rightValue":"={{ $('Handler variables').item.json.data.text }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6864,1296],"id":"76729177-6c0d-4ec2-bf0a-0604e5bbf8a9","name":"If6"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-6544,1376],"id":"2c667d72-3de1-4d9e-bff9-88ce886f1c91","name":"No Operation, do nothing1"},{"parameters":{"operation":"delete","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6240,1024],"id":"31c060d8-e6c1-489f-924b-36ee33dce137","name":"Delete Redis","executeOnce":false,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $('Get Redis1').item.json.mensajes.join() }} y el lead viene de un anuncio : {{ $('RESUMIDOR ANUNCIOS').item.json.output }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Wait6').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.payload._data.Info.PushName }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6352,832],"id":"fa0d6541-f1f5-42a3-918d-072dec78f8be","name":"Edit Fields19","alwaysOutputData":true},{"parameters":{"operation":"get","propertyName":"mensajes","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","keyType":"list","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6960,1088],"id":"eb2e5436-c84c-4660-a049-366ff67222ee","name":"Get Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $json.anuncio }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Handler variables').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.conversation.messages[0].sender.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6368,992],"id":"a0199bbc-432c-4d05-a271-0c734eec08cd","name":"Edit Fields20","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3e8a5a20-c60c-48ef-a636-2b5e14a683a8","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6608,944],"id":"61e1b52d-148e-41fd-9b0b-7e4895ad7a0a","name":"If15"},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1136],"id":"edcdff4c-5e82-4bfe-8beb-45b771f8bed2","name":"METER_ANUNCIO","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1296],"id":"666f3eb7-d307-4a99-abd7-1f526c0907fd","name":"BAJAR_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}_ad","messageData":"={{ $('RESUMIDOR ANUNCIOS').item.json.output }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8064,1136],"id":"5a5ab926-f0b0-420f-ad66-6f99a6d9eb9f","name":"guarda_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3deed863-79f3-42e5-a32c-6cb7bb1028df","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7616,512],"id":"46ecb883-24f2-490a-a44c-a9e6dd7a5ab2","name":"If"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-7488,32],"id":"76495bc9-2132-42c6-8f98-7f222fbc58ab","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"8f567177-8b37-4a09-9a53-ac9fe424c843","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6240,576],"id":"49f7d2d6-bf9c-4b3f-bde9-d5b04db1203a","name":"If10"},{"parameters":{"operation":"get","propertyName":"anuncio","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6752,944],"id":"16a19e11-3a97-49d7-b868-7b84b7799dc7","name":"Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-6928,272],"id":"31f4a897-b5fc-4baa-a8ac-c4645d7e6b10","name":"Update a row4","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"Describe esta imagen\n","imageUrls":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].data_url }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8864,560],"id":"655bda6d-6ab1-42a8-85c1-736575210b9b","name":"OpenAI","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"437f223f-80c7-4c47-a50b-9d17a8614251","name":"imagen_caption","value":"={{ $json.content }} .\nEl captions del mensaje de imagen es: {{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8448,688],"id":"fa56722a-8385-4847-b719-f90a132dfbd1","name":"Edit Fields12"},{"parameters":{"url":"={{ $('Webhook').item.json.body.attachments[0].data_url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-8896,368],"id":"f1138959-5c6f-4058-a15b-6e56bdaab777","name":"HTTP Request"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"27bcc104-31e3-4687-b60b-a018c457a3a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"audio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2e8b532f-1f01-45f9-a647-e7a5c9e48aac","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"image","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Imagen"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"59f6b23a-3029-4225-8f9e-3744611a04a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"=text","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"28de146f-c104-4171-924a-29963c4f1970","leftValue":"={{ $('Webhook').item.json.body.content_type }}","rightValue":"text","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-9216,416],"id":"b138e8be-c1d3-4f8a-8423-93fb52834ba7","name":"Switch3"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8624,368],"id":"f26677a7-27a0-43ed-8071-3e3064e25db4","name":"AUDIO1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"276cbb8a-79f2-4f08-b24a-632f474c6013","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-8624,560],"id":"f29adecc-e9d9-4222-9ec3-107cac681c09","name":"If16"},{"parameters":{"assignments":{"assignments":[{"id":"c0a1b2f0-373e-4b86-ae91-25346b20b404","name":"mensajetexto","value":"=Texto mensaje: [{{ $('Webhook').item.json.body.conversation.messages[0].content }}]  ","type":"string"},{"id":"35cd9184-e37e-4d03-9dff-efb319dce478","name":"mensajeaudio","value":"={{ $json.text }}","type":"string"},{"id":"47e9bfe8-2c55-4b5d-b047-024871fc6c21","name":"mensajeimagen","value":"=Imagen analizada: [{{ $json.content }}{{ $json.imagen_caption }}]","type":"string"},{"id":"9926d346-600f-45af-adad-876e9f40ffa4","name":"imagenanalizada","value":"=Imagen de anuncio analizado: {{ $json.content }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8064,480],"id":"8a1f15fa-bf4b-4c01-adbb-7a1a21d7a706","name":"Edit Fields17","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $('Webhook').item.json.body.payload.body }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7120,400],"id":"7ab44ba1-258f-4193-929d-15aa68334a0f","name":"If11"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f05066b5-5a07-41fa-96b7-7a244e7345c8","leftValue":"={{ $json.body.payload.fromMe }}\n","rightValue":"true","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12384,608],"id":"d94743f2-3b7b-460b-bc26-33eae6240210","name":"If12"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $json.body.conversation.messages[0].content }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12224,752],"id":"23a75e86-d3fd-4b05-8d58-aa9da67a47d8","name":"If20"},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-12144,1008],"id":"a93457ed-fd5d-4186-b320-c1a49417136c","name":"Update a row6","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"name":"informacion","description":"utiliza esta tool cuando se necesite informaci√≥n seg√∫n las indicaciones del prompt principal.","workflowId":{"__rl":true,"value":"FB7us6cBaq7jWqB2","mode":"list","cachedResultUrl":"/workflow/FB7us6cBaq7jWqB2","cachedResultName":"informacion HEAL UP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}"},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-6080,784],"id":"e0e915c5-fd08-4168-be41-783aa4ce1390","name":"informacion_tratamientos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"987d5d07-58eb-4927-8e68-a137884b8100","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].message_type }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13248,608],"id":"5e339c78-27b7-41de-8774-f34bd2e49752","name":"If1"},{"parameters":{"jsCode":"// Tomamos todos los items que vienen del nodo anterior (Verificador1)\nconst items = $input.all();\n\nfor (const item of items) {\n  // Aqu√≠ est√° tu objeto con parte_uno, parte_dos, etc.\n  // Verifica la ruta: output.response\n  const resp = item.json.output?.response || {};\n\n  // Orden que quieres respetar\n  const orderedKeys = [\n    'parte_uno',\n    'parte_dos',\n    'parte_tres',\n    'parte_cuatro',\n    'imagen_uno',\n    'imagen_dos',\n    'video_mp4',\n  ];\n\n  // Armamos un nuevo objeto response en el orden deseado\n  const newResponse = {};\n  for (const key of orderedKeys) {\n    if (resp[key]) {\n      newResponse[key] = resp[key];\n    }\n  }\n\n  // Sobrescribimos manteniendo la estructura original\n  if (!item.json.output) item.json.output = {};\n  item.json.output.response = newResponse;\n}\n\n// Devolvemos los items modificados\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2752,352],"id":"24f0ff65-46ee-441c-a6d4-8f9095be5ae0","name":"ordenar"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $json.output.response.parte_uno ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2720,1088],"id":"88a82162-8ee2-4a01-8f95-a7350bae11d1","name":"Respuesta1","executeOnce":false},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1776,832],"id":"cce742aa-91d4-4fd6-971b-02494cc4941d","name":"Wait2","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_dos ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1600,928],"id":"6c953a90-8ee3-40d6-b6fd-f29c2e766496","name":"Respuesta2","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1312,848],"id":"0a8bc622-6c9b-472d-8735-328b027264ff","name":"If14"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1120,832],"id":"568f10ce-4d13-4754-843d-d05277b38f48","name":"Wait3","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_tres ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-912,896],"id":"3cb7de22-5651-4c25-b9eb-6132643c3bbe","name":"Respuesta3","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-496,752],"id":"af5809e5-112a-4632-aeaf-44bd7061fd9e","name":"If17"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-480,976],"id":"d9d3f88f-ef89-458a-8d83-ad4661e1b4e6","name":"Wait4","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=hcy6n6RAJTBAAYguVuewgp2A"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_cuatro ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-256,1008],"id":"319a272b-7a67-4de3-bcc3-381f609226df","name":"Respuesta4","executeOnce":false},{"parameters":{"promptType":"define","text":"=Te va a llegar esta descripcion de un anuncio: {{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","options":{"systemMessage":"ROL:\nTu rol es indicar el mismo input que te llega y enviarlo como output."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-7504,192],"id":"7dd13519-eebb-4cd8-9fbe-870c4eb2ea0b","name":"RESUMIDOR ANUNCIOS"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1a9dd789-5c10-4489-a344-6b7a0fd041ea","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51902215511","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"912d0724-5ef1-4f88-9d43-acbb38f48cee","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51993708540","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"e50ad623-45f5-4af7-bc5a-89708016ddf8","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51972619000","operator":{"type":"string","operation":"equals"}},{"id":"9ffd5afb-ec0c-49fc-a144-b682386c760c","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51960239280","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"50ddfe27-4e13-4e3c-8216-aca1f181f77a","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51936196001","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"7650a20c-4ba9-4e41-bd67-89e8f77278fc","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"14502413970","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"bdfe444d-b4d9-4789-971d-08420999d775","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51945157250","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"5f1e9684-e18d-4a9f-aad7-bef2235f631d","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51971119678","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13888,864],"id":"fc9e995e-943d-4cce-8e72-ee42d86cee6c","name":"If18"},{"parameters":{"description":"usa la tool supervisor seg√∫n el prompt principal","workflowId":{"__rl":true,"value":"xchwhR053ynGsZI4","mode":"list","cachedResultUrl":"/workflow/xchwhR053ynGsZI4","cachedResultName":"SUP SUNAT"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $json.id }}","conversation_id":"={{ $('If7').item.json.conversation_id }}","inbox_id":"={{ $('If12').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5616,832],"id":"5e99594b-abaa-47fe-872d-198f951381e9","name":"Supervisor"},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje1","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_uno }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"},{"fieldId":"account id","fieldValue":"={{ $('Webhook').item.json.body.account.id }}"},{"fieldId":"conversation id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2544,1088],"id":"476c18e7-85f6-493d-b3aa-14cfdf31bcc3","name":"Update a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje2","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1472,944],"id":"d7b09d89-120c-41de-af99-2ac3e43b9c64","name":"Update a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje3","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-720,896],"id":"87f26d37-d4e6-4022-b8e7-d0be58f20d22","name":"Update a row5","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"seguimiento_healup","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-15088,608],"id":"f952306b-6aab-4f21-ba58-cdd5dcebe32c","name":"Get a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}},"disabled":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"60e8198a-90ea-44a7-8f27-6e37021a1a02","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje1 }}","operator":{"type":"string","operation":"equals"}},{"id":"4541b27d-6dfa-47d7-bbff-d1a5c2e6ffd1","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje2 }}","operator":{"type":"string","operation":"equals"}},{"id":"20ce2efd-2509-40d0-b670-2c484246fa28","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje3 }}","operator":{"type":"string","operation":"equals"}},{"id":"b74b14df-879c-4427-8888-d7e1e3212ddc","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje4 }}","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-14880,608],"id":"5c2a2d65-e6b0-4eff-8611-1286cc5f3519","name":"If19","alwaysOutputData":true,"disabled":true},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje4","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[0,1008],"id":"3bfbc342-a045-4fb3-b813-77c25a76e4fd","name":"Update a row7","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"daeff2da-d88d-4aa7-b4d9-8b808c58b7c8","leftValue":"={{ $json.conversation_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7664,1824],"id":"4456591c-6e0e-41e1-8fe3-d6b190cf5b8a","name":"If7"},{"parameters":{"operation":"get","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","keyValue":"={{ $('Get a row3').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7920,1520],"id":"7eb28718-e96b-48aa-aaa6-9595b57209be","name":"Get a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"BRADA_followups","fieldsUi":{"fieldValues":[{"fieldId":"conversation_id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7232,1664],"id":"032dfeeb-7358-4670-bfc8-e64deb12607b","name":"Create a row1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"model":"gpt-5.1","options":{"reasoningEffort":"low"}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5440,496],"id":"ff0bf49f-19d4-4e02-92fc-84ddcb1a06e5","name":"RAZONADOR PLUS","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7536,1424],"id":"456e5e75-da23-4eaf-b219-2d0e6a4c9772","name":"Update a row9","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"pasar_supervisor_healup","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9872,1184],"id":"22e69871-698c-451d-97be-e15985b9f1ca","name":"Create a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"method":"POST","url":"=https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": \"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg\",\n  \"message_type\": \"outgoing\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3152,1440],"id":"1e6becc0-86ad-4636-968f-82b82ce1d008","name":"Respuesta6","executeOnce":false},{"parameters":{"url":"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3648,1424],"id":"c91882f6-4156-4928-83f4-db575130f873"},{"parameters":{"method":"POST","url":"https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content","value":"Aqu√≠ tienes la imagen adjunta üëá"}]},"options":{}},"name":"2. Enviar a Chatwoot","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3440,1408],"id":"bb8131d9-ee4a-4ce7-bfcd-6484ee58e6e9"},{"parameters":{"content":"## EJEMPLO IMAGENES\n","height":320,"width":560},"type":"n8n-nodes-base.stickyNote","position":[-3744,1328],"typeVersion":1,"id":"14ea41f0-1e70-47f8-ad8d-cad36bd5ba28","name":"Sticky Note"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2352,1056],"id":"da693219-5a37-4d6b-b186-6b04eb3a09a2","name":"If8"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1184,1440],"id":"00fb4ecc-2c2b-43c7-a5b0-3bc928404b03","name":"If23"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-976,1424],"id":"b350fa31-345e-420d-9213-4ccd1c603f30","name":"If26"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-624,1840],"id":"4b2323d7-ade6-4594-9192-1b4e2251a93b","name":"If27"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1248,1392],"typeVersion":1,"id":"ffa9ce31-0ae1-4e74-af8a-05d40968ab54","name":"Sticky Note2"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-752,1440],"id":"84b7f3b1-5259-47e9-976f-6a01df9ed583","name":"Wait","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-176,1648],"id":"acf88893-aecd-41e2-8a76-6b13efecaf2c","name":"If40"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[192,1856],"id":"324684bf-472a-4b17-a5fc-3b12d1f0e647","name":"If42"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1648],"id":"9da856cd-4d80-4b0d-84b5-9d412e3a3420","name":"Wait5","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1856],"id":"918310b1-c0da-46c2-80cf-8343bacd20a5","name":"Wait7","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[400,1872],"id":"30392c9c-d8a1-4a3a-8173-0ef149b4dadb","name":"Wait8","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-976,1600],"id":"3270bad6-15d8-4f71-a811-c3359fdab4e3","name":"Wait9","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[32,1664],"id":"e5ada578-5738-42b2-98f2-9c73991a85e8","name":"Wait10","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-608,1600],"id":"f693b423-1013-4d25-a66c-54422bfde206"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-2","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-784,1600],"id":"f2f64f92-df6b-4114-863d-2f5463a5bff7"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[0,1856],"id":"15cd3fea-5316-48c1-87b3-10b8b49c2919"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-3","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-176,1856],"id":"97e4385e-224d-4e1b-814b-55d7358b7f8e"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot34","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[720,1872],"id":"d96e4430-aea9-4374-b39b-75bec4c5b6dc"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-4","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[544,1872],"id":"d9dc6055-97c0-4412-8284-39dd78540a56"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot35","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[368,1664],"id":"e7946bf5-eb93-47a1-8f0a-788003fd3e1d"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-5","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[192,1664],"id":"b835a15f-edb3-45a2-b27b-a2905ade226f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot36","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-416,1440],"id":"97aa4aac-4a3b-4632-a2eb-32fe5486d166"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-6","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-592,1440],"id":"dd6f4397-190c-4511-84ba-a4ddb75136be"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":3},"conditions":[{"id":"b2a6d2d7-c61b-43ef-99fe-cc95d8413e94","leftValue":"={{ $json.body.conversation.messages[0].sender.phone_number }}","rightValue":51971119678,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-14480,592],"id":"65ea26bb-db5c-45f1-a288-c16501032d3c","name":"If5"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-14240,368],"id":"3b9693a6-6e3f-4174-9556-ba7477824248","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', ``, 'string') }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-13856,272],"id":"ff60e952-557a-4961-b575-24caf1329c1f","name":"pasar_supervisor","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $json.body.content }}\n\n","options":{"systemMessage":"=# üéØ ROL\nEres el Agente **Aura**. Tu √∫nica funci√≥n es extraer, **normalizar** y enviar un n√∫mero de tel√©fono a la tool \"pasar_supervisor\" El n√∫mero puede ser nacional (Per√∫) o extranjero, y debes procesarlo seg√∫n las reglas para que la tool reciba solo d√≠gitos.\n\n# üì• INPUT (Solicitud de Recepcionista)\nRecibir√°s una solicitud de la recepcionista para transferir un paciente.\nEl patr√≥n de la solicitud ser√° similar a: **Pasar a supervisor el n√∫mero: [N√∫mero variable]**\nEl n√∫mero puede llegar en formato completo (`519...`), solo el n√∫mero nacional (`9...`), o en formato internacional (`+1...`).\n\n# ‚öôÔ∏è INSTRUCCIONES ESTRICTAS (Funci√≥n sin Estado)\n\n1. Cada input es una solicitud √∫nica. Tu tarea finaliza con la ejecuci√≥n de la tool.\n\n2. **Identificaci√≥n:** Busca y extrae el n√∫mero que sigue inmediatamente al patr√≥n: **Pasar a supervisor el n√∫mero:** o **Manda a supervisor el n√∫mero**.\n\n3. **Normalizaci√≥n:** Antes de usar la tool, debes convertir el n√∫mero extra√≠do a un formato estandarizado de **solo d√≠gitos**, aplicando estas reglas en orden:\n    * **Limpieza:** Elimina todos los caracteres no num√©ricos (espacios, guiones, par√©ntesis, puntos, el signo `+`).\n    * **Normalizaci√≥n Per√∫ (9 d√≠gitos):** Si el n√∫mero tiene **9 d√≠gitos** y **no** comienza con `51`, asume que es un n√∫mero de Per√∫ y **precede** la cadena con `51`.\n    * **Normalizaci√≥n Internacional/Completo:** Si el n√∫mero comienza con `51` (11 d√≠gitos) o es cualquier otra longitud, √∫salo tal cual despu√©s de la limpieza.\n\n4. **Acci√≥n √önica:** Una vez extra√≠do y normalizado el n√∫mero, debes utilizar **exclusivamente** la tool **pasar_supervisor**.\n\n5. **Output:** Nunca respondas, expliques, ni devuelvas texto. Tu √∫nica acci√≥n es ejecutar la tool.\n\n### üìù EJEMPLO DE FLUJO DE TRABAJO\n\n| Input de la Recepcionista | L√≥gica de Normalizaci√≥n | Salida a la Tool |\n| :--- | :--- | :--- |\n| **Input 1 (Per√∫ Completo):** `Pasar a supervisor el n√∫mero: 51998765432` | N√∫mero original: `51998765432` (11 d√≠gitos). No requiere cambios. | `pasar_supervisor(51998765432)` |\n| **Input 2 (Internacional):** `Manda a supervisor el n√∫mero +1 (305) 417-1787` | Limpieza: `13054171787` (11 d√≠gitos). | `pasar_supervisor(13054171787)` |\n| **Input 3 (Per√∫ Corto):** `Manda a supervisor el n√∫mero 977571136` | 9 d√≠gitos. Se asume Per√∫. **Normaliza con 51**. | `pasar_supervisor(51977571136)` |\n\n## HERRAMIENTAS\n**Herramientas disponibles:** **pasar_supervisor**\n\n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-14256,192],"id":"ed307005-1e1d-4800-a494-8f1ee293347f","name":"supervisor"},{"parameters":{"workflowId":{"__rl":true,"value":"86itBT4QcMqbK21F","mode":"list","cachedResultUrl":"/workflow/86itBT4QcMqbK21F","cachedResultName":"[MANTENIMIENTO] Supwhatsapp"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('If19').item.json.body.conversation.messages[0].sender.phone_number }}","conversation_id":"={{ $('If19').item.json.body.conversation.messages[0].conversation_id }}","inbox_id":"={{ $('If19').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":[],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-14016,400],"id":"96b98de4-e095-42e3-83b8-8e9043aac552","name":"Call 'Supervisor healup'"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"Z1S8hBZOFvfBE7I5","mode":"list","cachedResultUrl":"/workflow/Z1S8hBZOFvfBE7I5","cachedResultName":"SUNAT | Enviar datos (General) | WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre', ``, 'string') }}","numero":"={{ $json.id }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},"matchingColumns":[],"schema":[{"id":"nombre","displayName":"nombre","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5664,752],"id":"39552a1a-a1b3-4538-a0c0-eefb20b529b8","name":"enviar_nombre"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    perfumes_full_size: [\n      \"9 pm\",\n      \"9 pm elixir\",\n      \"Aether extrait\",\n      \"Afeef Lattafa\",\n      \"Ajayeb Dubai\",\n      \"Ajwad pink to pink\",\n      \"Al Haramain Dubai Night\",\n      \"Al qiam golf\",\n      \"ALTHAIR PARFUMS de MARLY\",\n      \"Amber rouge\",\n      \"Amethyst\",\n      \"Amore caff√© Mancera\",\n      \"Aqua Dubai 100 ml\",\n      \"Art of nature II\",\n      \"Art of universe\",\n      \"Aruba gold\",\n      \"Atlas LATTAFA\",\n      \"Azzaro PARFUM\",\n      \"Azzaro the most wanted intense\",\n      \"Berry on top\",\n      \"Bharata chocolate\",\n      \"Bharata king EDP\",\n      \"Bharata king gold edition\",\n      \"Bharata Placid\",\n      \"BIANCO latte\",\n      \"CDN Intense man\",\n      \"CDN Sillage\",\n      \"CDN Urban Man Elixir\",\n      \"CDN woman\",\n      \"Champion goat\",\n      \"Champion money\",\n      \"Champion sugar\",\n      \"Chic Sonia\",\n      \"Choco overdose\",\n      \"Cloud Ariana grande\",\n      \"Club de nuit untold\",\n      \"Confidential\",\n      \"Cookie grave\",\n      \"Creed aventus\",\n      \"Creed millesime imperial\",\n      \"Creed silver mountain water\",\n      \"Decant\",\n      \"Diesel spirit\",\n      \"Eclaire\",\n      \"Eclaire banoffi\",\n      \"Eclaire pistache\",\n      \"EMEER\",\n      \"Erba gold\",\n      \"Erba pura\",\n      \"Fahkar Rose\",\n      \"Fakhar black\",\n      \"Fakhar gold\",\n      \"Fire on ice\",\n      \"GOS Blind bid\",\n      \"Gos bonus\",\n      \"GOS Boston\",\n      \"GOS Diamond\",\n      \"Gos Esmerald\",\n      \"GOS Full House\",\n      \"GOS Jackpot\",\n      \"GOS Moon\",\n      \"Gos no limit\",\n      \"GOS platinium\",\n      \"GOS Rouge\",\n      \"GOS Royale\",\n      \"GOS Wildcard\",\n      \"GOS Yellow Saphire\",\n      \"Haramain amber oud gold edition\",\n      \"HAWAS ice\",\n      \"Hawas malibu\",\n      \"Hayaati florence\",\n      \"Hayaati lataffa\",\n      \"Her confession\",\n      \"His Confession\",\n      \"Honor and glory\",\n      \"Invictus Parfum\",\n      \"INVICTUS VICTORY ELIXIR\",\n      \"Ishq al shuyukh silver\",\n      \"Island Khadlaj\",\n      \"Jean lowe azure\",\n      \"Jean lowe inmortel\",\n      \"JPG Le beau le parfum 120ml\",\n      \"JPG Le Male elixir 125ml\",\n      \"JPG LE MALE LE PARFUM\",\n      \"JPG Paradise Garden 125ml\",\n      \"Khamrah\",\n      \"Khamrah Dukhan\",\n      \"Kirk√© Tiziana Terenzi\",\n      \"Lataffa Ameer\",\n      \"Lattafa dynasty\",\n      \"LAYTON PARFUMS de MARLY\",\n      \"Mancera cedrat boise\",\n      \"Mancera coco vanille\",\n      \"Mancera Instant Crush\",\n      \"Mancera Red tobaco\",\n      \"Mandar√≠n elixir\",\n      \"Milestone\",\n      \"Montale Arabians Tonka\",\n      \"M√≥ntale intense caf√©\",\n      \"Nautica voyage\",\n      \"Naxos\",\n      \"Nitro Red\",\n      \"Nitro White\",\n      \"Noble blush\",\n      \"Now white\",\n      \"Now women\",\n      \"Odyssey artisto\",\n      \"Odyssey bahamas\",\n      \"Odyssey black forest\",\n      \"Odyssey Candee\",\n      \"Odyssey Eau de Montagne\",\n      \"Odyssey go mango\",\n      \"Odyssey Homme black EDP\",\n      \"Odyssey Homme white edition\",\n      \"Odyssey Limoni\",\n      \"Odyssey Mandarin sky\",\n      \"Odyssey mega edp\",\n      \"Odyssey revolution\",\n      \"Odyssey Spectra\",\n      \"Odyssey spectra blue\",\n      \"Odyssey toffe coffe\",\n      \"Odyssey Tyrant\",\n      \"Odyssey wild one\",\n      \"Orientica royal amber\",\n      \"Orientica Velvet Gold\",\n      \"OUD FOR GLORY\",\n      \"Qaed unlimited\",\n      \"Rave Now\",\n      \"Rayhaan Elixir\",\n      \"Rome Imagine\",\n      \"Rome paradox\",\n      \"Scandal intense\",\n      \"Scandal le parfum\",\n      \"Sehr\",\n      \"Shaheen\",\n      \"So candid\",\n      \"Spectre Malachite\",\n      \"Spectre wraith\",\n      \"Stronger with you intensly\",\n      \"Summer hammer/Lorenzo Pazzaglia\",\n      \"Sun-gria\",\n      \"Teriaq intense\",\n      \"Tharwah gold\",\n      \"The Kingdom\",\n      \"Turathi\",\n      \"Turathi Electric\",\n      \"Valentino born in Roma intense\",\n      \"Veneno\",\n      \"Versace Eros flame\",\n      \"Versace eros parfum\",\n      \"Vintage Radio\",\n      \"Winners trophy\",\n      \"Yara elixir\",\n      \"Yara lataffa\",\n      \"Yara Moi\",\n      \"Yara tous\",\n      \"Yves Saint Laurent Y EDP\"\n    ],\n\n    decants: [\n      \"BHARARA KING EDP\",\n      \"LATTAFA PRIDE PISA\",\n      \"HARANA\",\n      \"21:00:00\",\n      \"EJAAZI\",\n      \"CDN SILLAGE\",\n      \"GOS MOON\",\n      \"MANDARIN SKY\",\n      \"NAUTICA VOYAGE\",\n      \"ROYAL BLEU\",\n      \"ODYSSEY WHITE\",\n      \"JEAN LOWE MATIERE\",\n      \"SUBLIME\",\n      \"GOS ROUGE\",\n      \"9 PM REBEL\",\n      \"KHAMRAH\",\n      \"GOS YELLOW SAPPHIRE\",\n      \"GOS BOSTON\",\n      \"ASAD\",\n      \"TURATHI BLUE\",\n      \"CND SILLAGE\",\n      \"GOS ROYALE\",\n      \"OUD FOR GLORY\",\n      \"AL HARAMAIN GOLD EXTREME\",\n      \"ODYSSEY AOUD\",\n      \"VLO\",\n      \"EMEER\",\n      \"ISSEY MIYAKE\",\n      \"ODYSSEY TYRANT\",\n      \"ASAD ZANZIBAR\",\n      \"GOS BID\",\n      \"9AM\",\n      \"HAWAS ICE\",\n      \"GOS WILDCARD\",\n      \"YARA MOI\",\n      \"VENTANA ARMAF\",\n      \"CDN IMP√âRIALE\",\n      \"AL NASHAMA CAPRICE\",\n      \"YARA\",\n      \"BHARARA BLEU\",\n      \"GOS BLIND BID\",\n      \"GOS ACE\",\n      \"CDN MILESTONE\",\n      \"DETOUR NOIR\",\n      \"RAED LUXE\",\n      \"QAED UNLIMITED\",\n      \"AI HARAMAIN RUBY EDITION\",\n      \"HAWAS BLACK\",\n      \"HAYAATI\",\n      \"ODYSSEY HOMME BLACK\",\n      \"CDN URBAN MAN ELIXIR\",\n      \"CDN UNTOLD\",\n      \"MAAHIR LEGACY\",\n      \"LEGEND SPIRIT\",\n      \"SHAHEEN GOLD\",\n      \"YARA TOUS\",\n      \"FAKHAR ROSE\",\n      \"HONOR AND GLORY\",\n      \"DUBAI NIGHT\",\n      \"BHARARA KING PARFUM\",\n      \"LATTAFA JASOOR\",\n      \"GOS GOLD\",\n      \"CDN INTENSE MAN\",\n      \"GOS FULL HOUSE\",\n      \"ODYSSEY AQUA\",\n      \"HAYAATI AL MALEKY\",\n      \"GOS WIN\",\n      \"FAKHAR BLACK\",\n      \"GOS DIAMOND\",\n      \"KHAMRAH QAHWA\",\n      \"GOS HIGH ROLLER\",\n      \"THE KINGDOM\",\n      \"ODYSSEY MEGA\",\n      \"HAWAS FOR HIM\",\n      \"LATTAFA NEBRAS\",\n      \"AI HARAMAIN GOLD EDITION\",\n      \"AJWAD\",\n      \"RAVE NOW WHITE\",\n      \"ODYSSEY CANDEE\",\n      \"ODYSSEY SPECTRA\",\n      \"YARA CANDY\",\n      \"ODYSSEY LIMONI\",\n      \"AMBER ROUGE\",\n      \"SCEPTRE MALACHITE\",\n      \"VIKING KASHMIR\",\n      \"AI HARAMAIN PRIVATE EDITION\",\n      \"QAED AI FURSAN\",\n      \"GOS JACKPOT\",\n      \"VIKING DUBAI\",\n      \"ROYAL AMBER\",\n      \"BHARARA KING GOLD EDITION\",\n      \"HIS CONFESSION\",\n      \"VIKING CAIRO\",\n      \"BHARARA ELEGANCE\",\n      \"BHARARA PHARAOH 1\",\n      \"BHARARA PHARAOH 2\",\n      \"MAYAR\",\n      \"CLUB DE NUIT PRECIEUX\",\n      \"HER CONFESSION\",\n      \"AMETHYST LATTAFA\",\n      \"LATTAFA TERIAQ\",\n      \"AI HARAMAIN AQUA DUBAI\",\n      \"ASAD BOURBON\",\n      \"NITRO WHITE\",\n      \"LIQUID BURN\",\n      \"NITRO RED\",\n      \"NOBLE BLUSH\",\n      \"LATTAFA SEHR\",\n      \"ISLAND BLISS\",\n      \"LATTAFA ECLAIRE\",\n      \"AL HARAMAIN ROYAL MUSK\",\n      \"SUQRAAT\",\n      \"ISHQ AL SHUYUKH\",\n      \"LIAM BLUE\",\n      \"DUBAI CHOCOLAT\",\n      \"BHARARA CHOCOLATE\",\n      \"HAYA\",\n      \"ISHQ AL SHUYUKH GOLD\",\n      \"ANSAAM SILVER\",\n      \"VINTAGE RADIO\",\n      \"BHARARA ENCHANTED\",\n      \"GOS OPAL\",\n      \"ART OF UNIVERSE\",\n      \"LATTAFA CHIC\",\n      \"HAWAS ELIXIR\",\n      \"HAYA CRUSH\",\n      \"JEAN LOWE AZURE\",\n      \"ROME POUR HOMME\",\n      \"HAYAATI FLORENCE\",\n      \"VELVET GOLD\",\n      \"AJWAD PINK TO PINK\",\n      \"AL QIAM GOLD\",\n      \"ANGHAM LATTAFA\",\n      \"ARABIAN SKY\",\n      \"TAG UOMO ROSSO\",\n      \"TAG ART OF NATURE II\",\n      \"BHARARA PLACID\",\n      \"BHARARA SOLEIL\",\n      \"CDN WOMAN\",\n      \"CDN ICONIC\",\n      \"CONFIDENTIAL PRIVATE GOLD\",\n      \"DELILAH\",\n      \"GOS PLATINIUM OF SPADES\",\n      \"INTIMATION\",\n      \"ISLAND KHADLAJ\",\n      \"JEAN LOWE INMORTEL\",\n      \"JEAN LOWE VIBE\",\n      \"WINNERS TROPHY\",\n      \"KHANJAR EAU DE PARFUM\",\n      \"KISMET MAGIC\",\n      \"MANDARIN SKY ELIXIR\",\n      \"MAYAR CHERRY INTENSE\",\n      \"NITRO RED INTENSELY\",\n      \"NITRO NOW WOMEN\",\n      \"ODYSSEY ARTISTO\",\n      \"ODYSSEY WILD ONE\",\n      \"RAVE NOW RAYHAAN ELIXIR\",\n      \"NOW\",\n      \"SAKEENA\",\n      \"SO CANDID\",\n      \"TARWAH GOLD\",\n      \"LATTAFA TERIAQ INTENSE\",\n      \"VICTORIA LATTAFA\",\n      \"YUM YUM ARMAF\",\n      \"QISSA DELICIOUS\",\n      \"HAWAS TROPICAL\",\n      \"HAWAS FIRE\",\n      \"FAKHAR PLATIN\",\n      \"KHAMARAH DUKHAN\",\n      \"ODYSSEY EAU DE MONTAGNE\",\n      \"ODYSSEY REVOLUTION\",\n      \"ROME IMAGINE\",\n      \"TURATHI ELECTRIC\",\n      \"VULCAN NUE\",\n      \"SPECTRE WRAITH\",\n      \"GOS EMERALD OF SPADES\",\n      \"AFEEF\",\n      \"BHARARA ONYX\",\n      \"SCEPTRE DESERT\",\n      \"NITRO NEITHE\",\n      \"ODYSSEY BLACK FOREST\",\n      \"ODYSSEY TOFFEE COFFEE\",\n      \"ODYSSEY BAHAMAS\",\n      \"ODYSSEY MANGO\",\n      \"NITRO ELIXIR\",\n      \"ROME PARADOXE\",\n      \"ROME YUM YUM\",\n      \"ECLAIRE PISTACHE\",\n      \"ECLAIRE BANOFFEE\",\n      \"9PM ELIXIR\",\n      \"HAWAS MALIBU\",\n      \"HAWAS KOBRA\",\n      \"GOS BONUS DYNASTY FIRE\",\n      \"ON CIE\",\n      \"LOVELY CHERIE\"\n    ],\n\n    set_perfumes: [\n      \"Gos set\",\n      \"GOS Set 3 piezas jo milano\",\n      \"Set 9pm\",\n      \"Set art of universe\",\n      \"Set mandar√≠n\",\n      \"SET VERSACE NECESER + PERFUME + DECANT\",\n      \"Set YARA\",\n      \"Set Zadig & Voltaire this is her\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4736,416],"id":"8e853398-c1fd-4a9a-9894-11607d7d0832","name":"informacion_productos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"# ROL: \nEres un agente t√©cnico especializado en la verificaci√≥n de existencias y precios del cat√°logo de Brada Perfumes. Tu √∫nico objetivo es recibir nombres de perfumes, identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input y consultar la tool stock1 para obtener datos reales.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Productos: Los nombres de los perfumes en el input siempre vendr√°n entre comillas (ej. \"9 PM\", \"Hawas Ice\") para evitar confusi√≥n con el resto del mensaje.\nUso de la Tool stock1:\nDebes ejecutar la tool enviando el nombre exacto del perfume identificado en la variable perfume.\nSi el input contiene m√∫ltiples perfumes, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes mantener el nombre del perfume exactamente igual a como aparece en el cat√°logo, corrigiendo solo errores ortogr√°ficos evidentes seg√∫n tu conocimiento general.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo perfume\nVariable disponibilidad: Si la tool indica que el producto est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre de perfume): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s perfumes\nDebes listar cada perfume en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n# EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"Hola, revisa la disponibilidad de \"9 PM\" y \"Hawas Ice\".\"\nProceso interno:\nLlamada 1: stock1(perfume=\"9 PM\") -> Resultado: Disponible, S/ 140.\nLlamada 2: stock1(perfume=\"Hawas Ice\") -> Resultado: Agotado, S/ 180.\nOutput que debes enviar si son dos o m√°s perfumes: 9 PM: stock si y precio 140 soles. Hawas Ice: stock no y precio 180 soles.\n#NOTAS ADICIONALES\nNo inventes precios ni estados de stock.\nSi la tool no devuelve informaci√≥n para un nombre espec√≠fico, indica: (Nombre de perfume): stock no y precio (No disponible).\nTu respuesta debe ser exclusivamente la lista de stock solicitada, sin saludos ni despedidas adicionales\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5312,608],"id":"64458501-a4f8-45c4-aae9-17b34719c27a","name":"stock_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    \"distritos_permitidos\": [\n      \"Anc√≥n\", \"Ate\", \"Barranco\", \"Bre√±a\", \"Carabayllo\", \"Chaclacayo\", \n      \"Chorrillos\", \"Cieneguilla\", \"Comas\", \"El Agustino\", \"Independencia\", \n      \"Jes√∫s Mar√≠a\", \"La Molina\", \"La Victoria\", \"Lima\", \"Lince\", \n      \"Los Olivos\", \"Lurigancho\", \"Lur√≠n\", \"Magdalena del Mar\", \"Miraflores\", \n      \"Pachac√°mac\", \"Pucusana\", \"Pueblo Libre\", \"Puente Piedra\", \n      \"Punta Hermosa\", \"Punta Negra\", \"R√≠mac\", \"San Bartolo\", \"San Borja\", \n      \"San Isidro\", \"San Juan de Lurigancho\", \"San Juan de Miraflores\", \n      \"San Luis\", \"San Mart√≠n de Porres\", \"San Miguel\", \"Santa Anita\", \n      \"Santa Mar√≠a del Mar\", \"Santa Rosa\", \"Santiago de Surco\", \"Surquillo\", \n      \"Villa El Salvador\", \"Villa Mar√≠a del Triunfo\", \"Callao\", \"Bellavista\", \n      \"Carmen de la Legua Reynoso\", \"La Perla\", \"La Punta\", \"Ventanilla\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4432,400],"id":"09ca4414-ae98-4efb-aaa7-b0a7d4b68b45","name":"distritos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente especializado exclusivamente en la verificaci√≥n de existencias y precios de Decants (presentaciones de 5ml y 10ml) de Brada Perfumes. Tu objetivo es recibir el input del agente principal, identificar los perfumes y sus medidas, y consultar la tool stock_decants para devolver datos precisos.\n# INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Medidas: Debes prestar especial atenci√≥n a la cantidad solicitada (5ml o 10ml). Si el cliente no especifica la medida pero el contexto indica que es un decant, consulta ambas presentaciones.\nUso de la Tool stock_decants:\nDebes ejecutar la tool enviando el nombre del perfume y la medida identificada.\nSi el input contiene m√∫ltiples decants (ej. \"9 PM de 5ml y Hawas de 10ml\"), debes realizar una ejecuci√≥n de la tool por cada producto/medida individualmente.\nMantenimiento de Nomenclatura: Mant√©n el nombre t√©cnico del perfume (ej. \"Club de Nuit Intense\" en lugar de \"cnit\") seg√∫n la lista maestra.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato basado en los datos de la tool:\nCASO 1: Un solo decant\nVariable disponibilidad: Si la tool indica existencias, utiliza \"si\". Si no hay, utiliza \"no\".\nFormato de salida: (Nombre de perfume) ([Medida]): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s decants\nDebes listar cada decant en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad de decants: \"9 PM\" en 5ml y \"Hawas Ice\" en 10ml.\"\nProceso interno:\nLlamada 1: stock_decants(perfume=\"9 PM\", medida=\"5ml\") -> Resultado: Disponible, S/ 35.\nLlamada 2: stock_decants(perfume=\"Hawas Ice\", medida=\"10ml\") -> Resultado: Agotado, S/ 45.\nOutput (Lo que respondes): 9 PM (5ml): stock si y precio 35 soles. Hawas Ice (10ml): stock no y precio 45 soles.\n#REGLAS DE ORO\nProhibici√≥n de Inventar: No inventes precios. Si la tool no devuelve un precio para una medida espec√≠fica, responde: (Nombre de perfume) ([Medida]): stock no y precio (No disponible).\nExclusividad: Tu respuesta debe contener √∫nicamente la lista t√©cnica. No incluyas saludos, recomendaciones, ni frases de cierre.\nPrecisi√≥n de Medida: Aseg√∫rate de que el precio corresponda exactamente a la medida solicitada (un perfume de 10ml siempre es m√°s caro que uno de 5ml).\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5024,608],"id":"edf1ea9c-753a-4178-8823-ad4b5d276fde","name":"stock_decants"},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-4752,880],"id":"c65b6d98-6ca9-4850-a240-dc15d0e6f244","name":"OpenAI Chat Model5","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5008,880],"id":"f40c83eb-7af9-43d9-9718-23906d503917","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5328,848],"id":"4682821d-4ee5-4aa0-bfa8-6ee52c2d74b9","name":"OpenAI Chat Model6","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfumes","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-5168,816],"id":"db9c5a3b-41f0-489b-95b8-1818ea40b41b","name":"stock1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_decants","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4880,832],"id":"cca318d1-6e33-42b3-9253-f90ae5034239","name":"stock2","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfume_sets","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4592,880],"id":"6150c4ba-6b03-4325-b902-35091b0ac31b","name":"stock3","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente t√©cnico especializado exclusivamente en la verificaci√≥n de existencias y precios de los Sets de Perfumes (estuches de regalo o packs con complementos) de Brada Perfumes. Tu misi√≥n es recibir el nombre del set, validarlo contra la tool stock_set_perfumes y devolver la disponibilidad y precio real.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Sets: Los nombres de los sets suelen incluir la palabra \"Set\" (ej. \"Set Yara\", \"Set 9 PM\"). Debes identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input.\nUso de la Tool stock_set_perfumes:\nDebes ejecutar la tool enviando el nombre exacto del set en la variable nombre_set.\nSi el input contiene m√∫ltiples sets, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes respetar el nombre del set tal como aparece en el cat√°logo oficial de Brada Perfumes, asegur√°ndote de que se trate de la presentaci√≥n en estuche y no de la botella individual.\n#L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo Set\nVariable disponibilidad: Si la tool indica que el set est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre del Set): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s Sets\nDebes listar cada set en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad del SET: \"Set Yara\" y \"Set Art of Universe\".\"\nProceso interno:\nLlamada 1: stock_set_perfumes(nombre_set=\"Set Yara\") -> Resultado: Disponible, S/ 210.\nLlamada 2: stock_set_perfumes(nombre_set=\"Set Art of Universe\") -> Resultado: Disponible, S/ 250.\nOutput (Lo que respondes): Set Yara: stock si y precio 210 soles. Set Art of Universe: stock si y precio 250 soles.\n#REGLAS DE ORO\nPrecisi√≥n: No confundas un \"Perfume Full Size\" con un \"Set\". Si el input pide un Set, busca √∫nicamente en la categor√≠a de sets.\nProhibici√≥n de Inventar: No inventes precios ni disponibilidad. Si la tool no devuelve informaci√≥n para un set espec√≠fico, indica: (Nombre del Set): stock no y precio (No disponible).\nMinimalismo: Tu respuesta debe ser exclusivamente la lista t√©cnica solicitada. No incluyas saludos, despedidas ni comentarios sobre el contenido del set.\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-4736,656],"id":"6344ee20-9fcb-45bd-a342-5aaf79248763","name":"stock_set_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"bFX818cxJebYkS92","mode":"list","cachedResultUrl":"/workflow/bFX818cxJebYkS92","cachedResultName":"BRADA | WHATSAPP | compras confirmadas"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-4544,448],"id":"42a85e30-dd9d-47c7-af24-3eace4616f6f","name":"confirmacion_pedidos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1840,2160],"id":"86511a06-e0d8-496b-9161-edd28ac48fe2","name":"If24"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1632,2144],"id":"f6ed93e7-cd4c-4547-9b7c-9f3a9bd6174a","name":"If28"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1280,2560],"id":"6532091a-4da7-484e-bc59-551caaf8837a","name":"If29"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1904,2112],"typeVersion":1,"id":"4b346085-38b5-41dc-aa4e-0e5fd0d63b15","name":"Sticky Note3"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1408,2160],"id":"60a486b8-d8b9-45f7-bcc2-0237d9dacb35","name":"Wait1","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-832,2368],"id":"aec693f3-d181-42f6-96ef-f4259257f242","name":"If41"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-464,2576],"id":"d0bce6d9-8944-4f36-8369-887245578174","name":"If43"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2368],"id":"920f0b3f-260f-4a46-8f84-c7fafcb4e42d","name":"Wait11","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2576],"id":"9445a338-fa59-4652-b7a7-042da4ab0166","name":"Wait12","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-256,2592],"id":"1b4c198d-a84a-4886-bfee-45e03505844a","name":"Wait13","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1632,2320],"id":"985412b0-18a0-4a74-9383-848361eecf6d","name":"Wait14","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-624,2384],"id":"0b01e43e-8f88-4806-9aa3-aaafae23afa5","name":"Wait15","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1264,2320],"id":"455fc9a5-d692-424b-96af-4dc9dfb5ecfa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1440,2320],"id":"43ef0c39-d3b6-4ed3-9bbe-55b60f80b5a4"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-656,2576],"id":"71901a37-3c10-48e0-8c0d-ea488faf670e"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-7","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-832,2576],"id":"94b90b7c-2489-43c2-b38d-5f1d9ed48958"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot37","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[64,2592],"id":"70f90af3-d2d6-42bb-bbed-2a460fc13eb2"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-8","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-112,2592],"id":"79b9eee3-c9f3-43cc-945b-a659df940b42"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot38","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-288,2384],"id":"377a6011-2a90-4508-ad7a-18e8be515097"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-9","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-464,2384],"id":"4736c49f-51b0-433c-acaf-c5ec1975c27f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot39","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1072,2160],"id":"a211f2a4-e5b1-4b1b-b198-ecee0d6bdf3a"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-10","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1248,2160],"id":"e7fcf0ac-d57f-498d-84c2-efc72cefbb9c"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[336,720],"id":"2aaf0e50-945f-404a-a630-6c934c4bf678","name":"If25"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[544,704],"id":"db6e3976-9c81-410c-a089-cbbffed9a498","name":"If30"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[896,1120],"id":"3d9b40b9-6eb5-4641-9243-4acb6bbaab90","name":"If31"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[272,672],"typeVersion":1,"id":"9d6dc394-e9c9-47cf-bb8b-3ec6e169cd24","name":"Sticky Note4"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[768,720],"id":"e193f0ff-9818-4fff-ab4c-87a07ea2bc57","name":"Wait16","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1344,928],"id":"70a6f8d6-3ef1-45ad-be33-45e51b8b5bf7","name":"If44"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1712,1136],"id":"46e4e9c0-d629-4cae-a016-78122838bf5c","name":"If45"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,928],"id":"9005e0a0-7928-4432-afba-ecca82410842","name":"Wait17","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,1136],"id":"26654f8d-1377-49f2-b4ba-feefd58f29f5","name":"Wait18","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1920,1152],"id":"e5e9d5a8-676d-4787-ad0c-57a9cecb51e6","name":"Wait19","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[544,880],"id":"0a2148fa-6d21-4cef-85c9-2f9f7747051b","name":"Wait20","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1552,944],"id":"24a50f49-9fa7-444a-889d-b0a47dcdca22","name":"Wait21","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[912,880],"id":"73a2a9cb-96fa-4c67-b2c0-855467476004"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-11","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[736,880],"id":"2a355cf5-4023-4e5c-94cd-fb54d20ab48d"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot21","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1520,1136],"id":"e4e81844-daec-44fa-87e1-8a40c9f593e1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-12","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1344,1136],"id":"124b0253-10a5-4f3f-8b46-7e729f639b4b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot40","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2240,1152],"id":"d7a77253-dcf2-4e33-9699-ace3f5cf9843"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-13","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2064,1152],"id":"47d740d9-af91-4b47-a3d9-43f6089948ac"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot41","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1888,944],"id":"ba55a9c2-6648-4009-9d21-cbad56eea3fa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-14","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1712,944],"id":"09553178-8112-4313-b41f-7edb86da9bb2"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot42","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1104,720],"id":"a287f371-7d38-4b62-96ac-80a54a0f4a85"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-15","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[928,720],"id":"5a670fc0-4c1b-45d5-bf03-f2cce3d56697"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-144,0],"id":"21286fd2-eb14-4621-961c-daf1710c98db","name":"If32"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[64,-16],"id":"9298649c-49d2-4ef9-a38d-d1ecd699741a","name":"If33"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[416,400],"id":"0335f432-f2cb-43bf-9855-8b773b8fd74f","name":"If34"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-208,-48],"typeVersion":1,"id":"f7db0934-d8a5-4643-8ea5-3b74f9fd30ff","name":"Sticky Note5"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[288,0],"id":"edc5d3e6-6cb7-4e24-a395-5bfd2ec21e8f","name":"Wait22","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[864,208],"id":"3d08713e-6783-4344-835a-52021892fc79","name":"If46"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1232,416],"id":"a3ff7975-1b42-4ee2-8d28-a9e2530627ea","name":"If47"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,208],"id":"050e27ee-0dc9-4cfe-9b3b-4984fdb3c424","name":"Wait23","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,416],"id":"316376c3-954b-4325-ab08-caadfb880e67","name":"Wait24","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1440,432],"id":"cfc28de1-e1fa-4583-80c7-4806a6cd7ad1","name":"Wait25","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[64,160],"id":"e8d0be90-195b-413a-b96d-28c469da7d2a","name":"Wait26","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1072,224],"id":"83b77384-ab0f-442c-aa8e-20cbf18ba56b","name":"Wait27","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot22","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[432,160],"id":"91fe9d8e-e24c-4675-9a65-5c3b96805cd1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[256,160],"id":"b2aa295f-bb56-4faf-bc6e-2c244ae1b8b5"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot23","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1040,416],"id":"42af2c54-fd06-4e53-9b3e-386ae18aad48"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[864,416],"id":"334d03f2-3acd-4c43-9e5c-e5c9ec1fab6b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot43","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1760,432],"id":"a10b0be7-7ad4-4a67-b580-1f6c8f63dd0b"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1584,432],"id":"3ae52091-798e-4106-ad81-b391a548b061"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot44","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1408,224],"id":"634d84c9-0fb9-4dc6-a691-70a9eb6eaff6"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1232,224],"id":"4c0fbfdd-c75a-4058-9fb3-c934f00a1774"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot45","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[624,0],"id":"c8374285-c938-46a3-ab3d-a8987b53dafe"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[448,0],"id":"8a5f2626-93c0-485f-83b6-88d1b7969f67"}],"connections":{"AI Agent":{"main":[[{"node":"Verificador1","type":"main","index":0}]]},"Auto-fixing Output Parser1":{"ai_outputParser":[[{"node":"Verificador1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model8":{"ai_languageModel":[[{"node":"Auto-fixing Output Parser1","type":"ai_languageModel","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"Auto-fixing Output Parser1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model9":{"ai_languageModel":[[{"node":"Verificador1","type":"ai_languageModel","index":0}]]},"Verificador1":{"main":[[{"node":"ordenar","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Get a row3","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"If2":{"main":[[{"node":"Update a row1","type":"main","index":0}],[{"node":"If3","type":"main","index":0}]]},"If3":{"main":[[{"node":"Switch3","type":"main","index":0}],[{"node":"No Operation, do nothing4","type":"main","index":0}]]},"Edit Fields4":{"main":[[{"node":"If2","type":"main","index":0}]]},"If13":{"main":[[{"node":"Get a row1","type":"main","index":0}],[{"node":"Create a row","type":"main","index":0}]]},"Calendario":{"ai_tool":[[]]},"Create a row":{"main":[[{"node":"Get a row1","type":"main","index":0}]]},"Get a row1":{"main":[[{"node":"Edit Fields4","type":"main","index":0}]]},"Update a row1":{"main":[[{"node":"Switch3","type":"main","index":0}]]},"Get a row":{"main":[[{"node":"If13","type":"main","index":0}]]},"If4":{"main":[[{"node":"If11","type":"main","index":0}],[{"node":"Fecha","type":"main","index":0}]]},"Formatea fecha":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Handler variables":{"main":[[{"node":"If10","type":"main","index":0}]]},"Fecha":{"main":[[{"node":"Formatea fecha","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Handler variables","type":"main","index":0}]]},"Wait6":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"If6":{"main":[[{"node":"Redis1","type":"main","index":0}],[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"Delete Redis":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Edit Fields19":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"Get Redis1":{"main":[[{"node":"If6","type":"main","index":0}]]},"Edit Fields20":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"If15":{"main":[[{"node":"Edit Fields19","type":"main","index":0}],[{"node":"Edit Fields20","type":"main","index":0}]]},"METER_ANUNCIO":{"main":[[{"node":"guarda_ANUNCIO","type":"main","index":0}]]},"BAJAR_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"guarda_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"If":{"main":[[{"node":"RESUMIDOR ANUNCIOS","type":"main","index":0}],[{"node":"If4","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"RESUMIDOR ANUNCIOS","type":"ai_languageModel","index":0}]]},"If10":{"main":[[{"node":"METER_ANUNCIO","type":"main","index":0}],[{"node":"BAJAR_ANUNCIO","type":"main","index":0}]]},"Redis1":{"main":[[{"node":"If15","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"If16","type":"main","index":0}]]},"Edit Fields12":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"AUDIO1","type":"main","index":0}]]},"Switch3":{"main":[[{"node":"HTTP Request","type":"main","index":0}],[{"node":"OpenAI","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}]]},"AUDIO1":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"If16":{"main":[[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields12","type":"main","index":0}]]},"Edit Fields17":{"main":[[{"node":"If","type":"main","index":0}]]},"If11":{"main":[[{"node":"Update a row4","type":"main","index":0}]]},"If12":{"main":[[{"node":"Get a row","type":"main","index":0}],[{"node":"If20","type":"main","index":0}]]},"If20":{"main":[[{"node":"Update a row6","type":"main","index":0}]]},"If1":{"main":[[{"node":"If12","type":"main","index":0}]]},"ordenar":{"main":[[{"node":"Respuesta1","type":"main","index":0}]]},"Respuesta1":{"main":[[{"node":"Update a row","type":"main","index":0}]]},"Wait2":{"main":[[{"node":"Respuesta2","type":"main","index":0}]]},"Respuesta2":{"main":[[{"node":"Update a row3","type":"main","index":0}]]},"If14":{"main":[[{"node":"Wait3","type":"main","index":0}],[{"node":"If23","type":"main","index":0}]]},"Wait3":{"main":[[{"node":"Respuesta3","type":"main","index":0}]]},"Respuesta3":{"main":[[{"node":"Update a row5","type":"main","index":0}]]},"If17":{"main":[[{"node":"Wait4","type":"main","index":0}],[{"node":"If32","type":"main","index":0}]]},"Wait4":{"main":[[{"node":"Respuesta4","type":"main","index":0}]]},"Respuesta4":{"main":[[{"node":"Update a row7","type":"main","index":0}]]},"RESUMIDOR ANUNCIOS":{"main":[[{"node":"If4","type":"main","index":0}]]},"Supervisor":{"ai_tool":[[]]},"Update a row":{"main":[[{"node":"If8","type":"main","index":0}]]},"Update a row3":{"main":[[{"node":"If14","type":"main","index":0}]]},"Update a row5":{"main":[[{"node":"If17","type":"main","index":0}]]},"Get a row3":{"main":[[{"node":"If19","type":"main","index":0}]]},"If19":{"main":[[{"node":"If5","type":"main","index":0}]]},"Update a row7":{"main":[[{"node":"If25","type":"main","index":0}]]},"If7":{"main":[[{"node":"Update a row9","type":"main","index":0}],[{"node":"Create a row1","type":"main","index":0}]]},"Get a row2":{"main":[[{"node":"If7","type":"main","index":0}]]},"Create a row1":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"RAZONADOR PLUS":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Update a row9":{"main":[[{"node":"Wait6","type":"main","index":0}]]},"1. Descargar Imagen":{"main":[[{"node":"2. Enviar a Chatwoot","type":"main","index":0}]]},"If8":{"main":[[{"node":"Wait2","type":"main","index":0}],[{"node":"If24","type":"main","index":0}]]},"If23":{"main":[[{"node":"If26","type":"main","index":0}],[{"node":"Wait9","type":"main","index":0}]]},"If26":{"main":[[],[{"node":"Wait","type":"main","index":0}]]},"If27":{"main":[[{"node":"Wait5","type":"main","index":0}],[{"node":"Wait7","type":"main","index":0}]]},"Wait":{"main":[[{"node":"1. Descargar Imagen 1-6","type":"main","index":0}]]},"If40":{"main":[[],[{"node":"Wait10","type":"main","index":0}]]},"If42":{"main":[[],[{"node":"Wait8","type":"main","index":0}]]},"Wait5":{"main":[[{"node":"If40","type":"main","index":0}]]},"Wait7":{"main":[[{"node":"1. Descargar Imagen 1-3","type":"main","index":0}]]},"Wait8":{"main":[[{"node":"1. Descargar Imagen 1-4","type":"main","index":0}]]},"Wait9":{"main":[[{"node":"1. Descargar Imagen 1-2","type":"main","index":0}]]},"Wait10":{"main":[[{"node":"1. Descargar Imagen 1-5","type":"main","index":0}]]},"2. Enviar a Chatwoot16":{"main":[[{"node":"If27","type":"main","index":0}]]},"1. Descargar Imagen 1-2":{"main":[[{"node":"2. Enviar a Chatwoot16","type":"main","index":0}]]},"2. Enviar a Chatwoot19":{"main":[[{"node":"If42","type":"main","index":0}]]},"1. Descargar Imagen 1-3":{"main":[[{"node":"2. Enviar a Chatwoot19","type":"main","index":0}]]},"1. Descargar Imagen 1-4":{"main":[[{"node":"2. Enviar a Chatwoot34","type":"main","index":0}]]},"1. Descargar Imagen 1-5":{"main":[[{"node":"2. Enviar a Chatwoot35","type":"main","index":0}]]},"1. Descargar Imagen 1-6":{"main":[[{"node":"2. Enviar a Chatwoot36","type":"main","index":0}]]},"If5":{"main":[[{"node":"supervisor","type":"main","index":0}],[{"node":"If1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"supervisor","type":"ai_languageModel","index":0}]]},"pasar_supervisor":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"Call 'Supervisor healup'":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"enviar_nombre":{"ai_tool":[[]]},"informacion_productos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"distritos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_decants":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model5":{"ai_languageModel":[[{"node":"stock_set_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model6":{"ai_languageModel":[[{"node":"stock_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"stock_decants","type":"ai_languageModel","index":0}]]},"stock1":{"ai_tool":[[{"node":"stock_perfumes","type":"ai_tool","index":0}]]},"stock2":{"ai_tool":[[{"node":"stock_decants","type":"ai_tool","index":0}]]},"stock3":{"ai_tool":[[{"node":"stock_set_perfumes","type":"ai_tool","index":0}]]},"stock_set_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"confirmacion_pedidos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"If24":{"main":[[{"node":"If28","type":"main","index":0}],[{"node":"Wait14","type":"main","index":0}]]},"If28":{"main":[[],[{"node":"Wait1","type":"main","index":0}]]},"If29":{"main":[[{"node":"Wait11","type":"main","index":0}],[{"node":"Wait12","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"1. Descargar Imagen 1-10","type":"main","index":0}]]},"If41":{"main":[[],[{"node":"Wait15","type":"main","index":0}]]},"If43":{"main":[[],[{"node":"Wait13","type":"main","index":0}]]},"Wait11":{"main":[[{"node":"If41","type":"main","index":0}]]},"Wait12":{"main":[[{"node":"1. Descargar Imagen 1-7","type":"main","index":0}]]},"Wait13":{"main":[[{"node":"1. Descargar Imagen 1-8","type":"main","index":0}]]},"Wait14":{"main":[[{"node":"1. Descargar Imagen 1-","type":"main","index":0}]]},"Wait15":{"main":[[{"node":"1. Descargar Imagen 1-9","type":"main","index":0}]]},"2. Enviar a Chatwoot17":{"main":[[{"node":"If29","type":"main","index":0}]]},"1. Descargar Imagen 1-":{"main":[[{"node":"2. Enviar a Chatwoot17","type":"main","index":0}]]},"2. Enviar a Chatwoot20":{"main":[[{"node":"If43","type":"main","index":0}]]},"1. Descargar Imagen 1-7":{"main":[[{"node":"2. Enviar a Chatwoot20","type":"main","index":0}]]},"1. Descargar Imagen 1-8":{"main":[[{"node":"2. Enviar a Chatwoot37","type":"main","index":0}]]},"1. Descargar Imagen 1-9":{"main":[[{"node":"2. Enviar a Chatwoot38","type":"main","index":0}]]},"1. Descargar Imagen 1-10":{"main":[[{"node":"2. Enviar a Chatwoot39","type":"main","index":0}]]},"If25":{"main":[[{"node":"If30","type":"main","index":0}],[{"node":"Wait20","type":"main","index":0}]]},"If30":{"main":[[],[{"node":"Wait16","type":"main","index":0}]]},"If31":{"main":[[{"node":"Wait17","type":"main","index":0}],[{"node":"Wait18","type":"main","index":0}]]},"Wait16":{"main":[[{"node":"1. Descargar Imagen 1-15","type":"main","index":0}]]},"If44":{"main":[[],[{"node":"Wait21","type":"main","index":0}]]},"If45":{"main":[[],[{"node":"Wait19","type":"main","index":0}]]},"Wait17":{"main":[[{"node":"If44","type":"main","index":0}]]},"Wait18":{"main":[[{"node":"1. Descargar Imagen 1-12","type":"main","index":0}]]},"Wait19":{"main":[[{"node":"1. Descargar Imagen 1-13","type":"main","index":0}]]},"Wait20":{"main":[[{"node":"1. Descargar Imagen 1-11","type":"main","index":0}]]},"Wait21":{"main":[[{"node":"1. Descargar Imagen 1-14","type":"main","index":0}]]},"2. Enviar a Chatwoot18":{"main":[[{"node":"If31","type":"main","index":0}]]},"1. Descargar Imagen 1-11":{"main":[[{"node":"2. Enviar a Chatwoot18","type":"main","index":0}]]},"2. Enviar a Chatwoot21":{"main":[[{"node":"If45","type":"main","index":0}]]},"1. Descargar Imagen 1-12":{"main":[[{"node":"2. Enviar a Chatwoot21","type":"main","index":0}]]},"1. Descargar Imagen 1-13":{"main":[[{"node":"2. Enviar a Chatwoot40","type":"main","index":0}]]},"1. Descargar Imagen 1-14":{"main":[[{"node":"2. Enviar a Chatwoot41","type":"main","index":0}]]},"1. Descargar Imagen 1-15":{"main":[[{"node":"2. Enviar a Chatwoot42","type":"main","index":0}]]},"If32":{"main":[[{"node":"If33","type":"main","index":0}],[{"node":"Wait26","type":"main","index":0}]]},"If33":{"main":[[],[{"node":"Wait22","type":"main","index":0}]]},"If34":{"main":[[{"node":"Wait23","type":"main","index":0}],[{"node":"Wait24","type":"main","index":0}]]},"Wait22":{"main":[[{"node":"1. Descargar Imagen 1-20","type":"main","index":0}]]},"If46":{"main":[[],[{"node":"Wait27","type":"main","index":0}]]},"If47":{"main":[[],[{"node":"Wait25","type":"main","index":0}]]},"Wait23":{"main":[[{"node":"If46","type":"main","index":0}]]},"Wait24":{"main":[[{"node":"1. Descargar Imagen 1-17","type":"main","index":0}]]},"Wait25":{"main":[[{"node":"1. Descargar Imagen 1-18","type":"main","index":0}]]},"Wait26":{"main":[[{"node":"1. Descargar Imagen 1-16","type":"main","index":0}]]},"Wait27":{"main":[[{"node":"1. Descargar Imagen 1-19","type":"main","index":0}]]},"2. Enviar a Chatwoot22":{"main":[[{"node":"If34","type":"main","index":0}]]},"1. Descargar Imagen 1-16":{"main":[[{"node":"2. Enviar a Chatwoot22","type":"main","index":0}]]},"2. Enviar a Chatwoot23":{"main":[[{"node":"If47","type":"main","index":0}]]},"1. Descargar Imagen 1-17":{"main":[[{"node":"2. Enviar a Chatwoot23","type":"main","index":0}]]},"1. Descargar Imagen 1-18":{"main":[[{"node":"2. Enviar a Chatwoot43","type":"main","index":0}]]},"1. Descargar Imagen 1-19":{"main":[[{"node":"2. Enviar a Chatwoot44","type":"main","index":0}]]},"1. Descargar Imagen 1-20":{"main":[[{"node":"2. Enviar a Chatwoot45","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"acwebhook.alefcompany.online","user-agent":"rest-client/2.1.0 (linux-musl x86_64) ruby/3.4.4p34","content-length":"2304","accept":"application/json","accept-encoding":"gzip;q=1.0,deflate;q=0.6,identity;q=0.3","content-type":"application/json","x-forwarded-for":"173.249.43.27","x-forwarded-host":"acwebhook.alefcompany.online","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"6a57d0c37ad6","x-real-ip":"173.249.43.27"},"params":{},"query":{},"body":{"account":{"id":2,"name":"Healup"},"additional_attributes":{},"content_attributes":{},"content_type":"text","content":"a","conversation":{"additional_attributes":{},"can_reply":true,"channel":"Channel::Whatsapp","contact_inbox":{"id":4,"contact_id":4,"inbox_id":4,"source_id":"51972619000","created_at":"2026-01-02T16:51:45.640Z","updated_at":"2026-01-02T16:51:45.640Z","hmac_verified":false,"pubsub_token":"STv1xcrZw8Aeuyt1SPgxmVQm"},"id":1,"inbox_id":4,"messages":[{"id":18,"content":"a","account_id":2,"inbox_id":4,"conversation_id":1,"message_type":0,"created_at":1767380149,"updated_at":"2026-01-02T18:55:49.212Z","private":false,"status":"sent","source_id":"wamid.HBgLNTE5NzI2MTkwMDAVAgASGBYzRUIwQTY2M0JDMjQwOTg4NTdDQTg3AA==","content_type":"text","content_attributes":{},"sender_type":"Contact","sender_id":4,"external_source_ids":{},"additional_attributes":{},"processed_message_content":"a","sentiment":{},"conversation":{"assignee_id":null,"unread_count":1,"last_activity_at":1767380149,"contact_inbox":{"source_id":"51972619000"}},"sender":{"additional_attributes":{},"custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false,"type":"contact"}}],"labels":[],"meta":{"sender":{"additional_attributes":{},"custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false,"type":"contact"},"assignee":null,"assignee_type":null,"team":null,"hmac_verified":false},"status":"open","custom_attributes":{},"snoozed_until":null,"unread_count":1,"first_reply_created_at":null,"priority":null,"waiting_since":1767372705,"agent_last_seen_at":1767378677,"contact_last_seen_at":0,"last_activity_at":1767380149,"timestamp":1767380149,"created_at":1767372705,"updated_at":1767380149.2243187},"created_at":"2026-01-02T18:55:49.212Z","id":18,"inbox":{"id":4,"name":"Heal Up Lab WhatsApp"},"message_type":"incoming","private":false,"sender":{"account":{"id":2,"name":"Healup"},"additional_attributes":{},"avatar":"","custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false},"source_id":"wamid.HBgLNTE5NzI2MTkwMDAVAgASGBYzRUIwQTY2M0JDMjQwOTg4NTdDQTg3AA==","event":"message_created"},"webhookUrl":"https://acwebhook.alefcompany.online/webhook/healup2","executionMode":"production"}}]},"versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","activeVersionId":null,"versionCounter":21,"triggerCount":1,"shared":[{"updatedAt":"2026-01-08T17:51:46.711Z","createdAt":"2026-01-08T17:51:46.711Z","role":"workflow:owner","workflowId":"bIVpE1aXwtICWRcyHjLUv","projectId":"MTPybkDgxszv17uX","project":{"updatedAt":"2025-12-12T19:47:40.556Z","createdAt":"2025-12-12T19:45:17.094Z","id":"MTPybkDgxszv17uX","name":"Juan Pablo Jesus Bazan Ramos <bazanjuanpa@gmail.com>","type":"personal","icon":null,"description":null,"creatorId":"4423001a-8ae6-45ae-b4e5-774853e1a949","projectRelations":[{"updatedAt":"2025-12-12T19:45:17.094Z","createdAt":"2025-12-12T19:45:17.094Z","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949","projectId":"MTPybkDgxszv17uX","user":{"updatedAt":"2026-01-21T04:04:53.319Z","createdAt":"2025-12-12T19:45:16.195Z","id":"4423001a-8ae6-45ae-b4e5-774853e1a949","email":"bazanjuanpa@gmail.com","firstName":"Juan Pablo Jesus","lastName":"Bazan Ramos","personalizationAnswers":{"version":"v4","personalization_survey_submitted_at":"2025-12-12T19:47:50.835Z","personalization_survey_n8n_version":"1.123.5","companySize":"<20","companyType":"saas","role":"business-owner","reportedSource":"twitter"},"settings":{"userActivated":true,"easyAIWorkflowOnboarded":true,"firstSuccessfulWorkflowId":"hA8_Wb7G-H_xzMUXbPCqT","userActivatedAt":1768943704423,"npsSurvey":{"waitingForResponse":true,"ignoredCount":2,"lastShownAt":1767054623912}},"disabled":false,"mfaEnabled":false,"lastActiveAt":"2026-01-21","isPending":false}}]}}],"activeVersion":null}
[2026-01-21T04:13:40.672Z] Request received: {"clientKey":"brada","active":true}
[2026-01-21T04:13:40.673Z] Resolved Client: brada -> TargetID: bIVpE1aXwtICWRcyHjLUv
[2026-01-21T04:13:40.673Z] API Config - BaseURL: https://acn8n.alefcompany.online/api/v1, KeyLength: 207
[2026-01-21T04:13:40.673Z] Executing n8n action: activate on bIVpE1aXwtICWRcyHjLUv
[2026-01-21T04:13:41.625Z] n8n Response: {"updatedAt":"2026-01-12T22:41:59.443Z","createdAt":"2026-01-08T17:51:46.711Z","id":"bIVpE1aXwtICWRcyHjLUv","name":"BRADAWHATSAPP","description":null,"active":true,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $('Delete Redis').first().json.response }}\nCurrent date: {{ $('Formatea fecha').first().json.formattedDate }}\nEl numero del whatsapp del paciente es: {{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n\n## CLASIFICACI√ìN DE TEXTO:\nTe va a llegar los mensajes en parte de esta forma:\nTexto mensaje: [Mensaje]\nAudio transcripto: [audio trascripto]\nImagen analizada: [mensaje analizado]\nesto es para que sepas diferenciar los audios, imagenes, y textos que te manden.\n","options":{"systemMessage":"=#ROL\n1. IDENTIDAD Y VOCABULARIO (EL \"QUI√âN\" Y \"QU√â\" DECIR)\nEsta secci√≥n define su personalidad y el est√°ndar de lenguaje que debe utilizar para conectar con el cliente que desea comprar en Brada Perfumes.\nNombre: Diego.\nCargo: Asesor de ventas de la tienda ‚ÄúBrada Perfumes‚Äù, especializado en alta perfumer√≠a y fragancias √°rabes.\nTrato al Cliente: Uso de un tono simple, cercano y directo. Se evita la informalidad excesiva\nUso de \"Hermano\": El t√©rmino \"hermano\" queda restringido √∫nicamente al saludo inicial. No debe utilizarse en el resto de la conversaci√≥n para evitar un exceso de confianza.\nRestricci√≥n Cr√≠tica: Queda estrictamente prohibido el uso de apelativos exagerados como \"perfum√≥n\" o \"joyita\". Tambi√©n se proh√≠be el lenguaje rob√≥tico, el trato formal de \"Usted\" y el uso de diminutivos (ej. \"perfumito\", \"botellita\").\nEjemplo de Aplicaci√≥n: \nEntrada: \"hola que tal, precio de asad\" \nRespuesta de Diego: \"Hola hermano, que tal? El Lattafa Asad s√≠ lo tenemos disponible, aqu√≠ te paso los detalles...\"\n\n2. PROTOCOLOS DE COMUNICACI√ìN (EL \"C√ìMO\" HABLAR)\nEsta secci√≥n establece la mec√°nica de sus respuestas para garantizar una venta √°gil, persuasiva y aut√©ntica.\nRegla de Interacci√≥n: Responder mensaje por mensaje para mantener un ritmo de chat natural.\nRegla de Extensi√≥n Adaptativa:\nRespuestas Simples: M√°ximo 2 l√≠neas para saludos iniciales o confirmaciones de recepci√≥n.\nRespuestas de Cat√°logo: Entrega de la informaci√≥n clave (precio, disponibiidad y nombre del producto) bas√°ndose en las tres tools seg√∫n las reglas correspondientes a su uso en la secci√≥n: ‚Äú\nRegla de Estructura: Si el cliente pregunta por varias fragancias, responda de forma ordenada destacando lo mejor de cada una.\nRegla de Est√©tica: Uso din√°mico de 1 emoji por mensaje (üî•, üí®, ) para transmitir la energ√≠a y exclusividad de las fragancias.\nRegla de No-Repetici√≥n:\nNo repita el saludo de bienvenida si el cliente contin√∫a la conversaci√≥n m√°s tarde.\nSi el cliente no entiende una nota olfativa, use comparaciones sencillas (ej. \"huele a limpio\", \"es bien dulcecito\") sin perder la base t√©cnica.\n3. L√ìGICA DE OBJETIVOS (EL \"PARA QU√â\" ACTUAR)\nEsta secci√≥n rige sus decisiones estrat√©gicas, priorizando la asesor√≠a efectiva y el cierre de ventas seguro.\nMisi√≥n Principal: Identificar el nombre del perfume que desee el cliente) y resolver dudas sobre stock y env√≠os usando exclusivamente las tools.\nFiltro de Pago y Env√≠o: Prohibido solicitar datos de env√≠o o confirmar pedidos si el cliente no ha pasado por el \"Filtro de Validaci√≥n de Pago\" (An√°lisis de imagen del comprobante).\nFiltro de Asesor√≠a: Ante consultas sobre reclamos, devoluciones o pedidos de asesor√≠a m√©dica/piel muy complejos, debe derivar inmediatamente al supervisor.\nIntegridad de Stock: Prohibido inventar disponibilidad o precios. La √∫nica fuente v√°lida es el output de la tool stock_real.\n#CONOCIMIENTO GENERAL\n### ¬øQu√© es Brada Perfumes?\nEs una tienda especializada en alta perfumer√≠a y fragancias √°rabes exclusivas. Como asesor de ventas, tu objetivo es orientar a los clientes para encontrar su fragancia ideal y cerrar la venta de forma √°gil.\n### Cat√°logo de Productos\nBrada Perfumes ofrece tres categor√≠as de productos. Para conocer la lista actualizada de existencias, siempre debes ejecutar la tool informacion_perfumes al inicio de la consulta:\n**Perfumes Full Size**: Botellas completas en su presentaci√≥n original (ej. 100ml, 120ml).\nEjemplos clave: 9 PM, Hawas Ice, Khamrah, Asad, Creed Aventus.\n**Decants**: Perfumes originales trasvasados a presentaciones peque√±as de 5ml o 10ml. Son ideales para que el cliente pruebe la fragancia antes de comprar el frasco grande.\nEjemplos clave: YSL EDP, Club de Nuit Intense, Scandal.\n**Sets de Perfumes**: Estuches especiales que incluyen la fragancia principal y complementos (lociones, geles o miniaturas).\nEjemplos clave: Set Yara, Set 9pm, Set Art of Universe.\nNota Operativa: La tool informacion_perfumes es tu √∫nica fuente de verdad para nombres de productos. Si un cliente menciona un nombre que no est√° en la tool, verifica si existe un nombre similar por error ortogr√°fico antes de confirmar disponibilidad.\n# REGLAS DE ORO\n## **Regla de uso de la tool ‚Äúinformaci√≥n_perfumes‚Äù**.\nAl recibir el mensaje del cliente, SIEMPRE usa la tool ‚Äúinformacion_perfumes‚Äù antes de redactar la respuesta. Esta tool te devolver√° todos los productos que vende nuestra tienda ‚ÄúBrada Perfumes‚Äù los cuales est√°n divididos en tres categor√≠as: ‚ÄúPerfumes full size‚Äù, ‚ÄúDecants‚Äù y ‚Äúset de perfumes‚Äù\nRestricci√≥n de datos: Cabe aclarar que esta tool NO CONTIENE PRECIOS NI STOCK REAL. Su √∫nica funci√≥n es servir de gu√≠a de nomenclatura formal para identificar los productos que ofrecemos. \n## **Regla de ortograf√≠a**\nEsta regla rige c√≥mo Diego debe interpretar y responder a los mensajes con errores de escritura.\n* Inteligencia Sem√°ntica: Diego debe ignorar errores ortogr√°ficos, de puntuaci√≥n o de tildes del cliente para identificar la intenci√≥n real.\nMapeo Autom√°tico: Si el cliente escribe incorrectamente el nombre de un perfume (ej. \"habas ice\", \"9pm elicsir\", \"latifa asad\"), Diego debe asociarlo mentalmente con el producto correcto de la tool ‚ÄúInformacion_productos‚Äù sin pedir aclaraciones.\nNaturalidad en la Respuesta: Al responder, Diego debe escribir los nombres de los perfumes de forma correcta (seg√∫n la tool ‚ÄúInformacion_productos‚Äù) para mantener el profesionalismo, pero sin resaltar el error del cliente.\nEjemplo de Aplicaci√≥n:\n- Entrada del cliente: \"hola ermano presio del cnit untold\"\n- Acci√≥n de Diego: Identifica \"hermano\", \"precio\" y \"Club de Nuit Untold\".\n- Respuesta de Diego: \"Hola hermano, el Club de Nuit Untold s√≠ lo tenemos disponible. El precio es de S/...\"\n## **Regla de cierre variable**\nEsta regla evita que Diego suene como un robot de ventas insistente.\nFinalizaci√≥n Variable: No es obligatorio terminar cada mensaje con una pregunta. Diego debe evaluar si la conversaci√≥n requiere una pregunta para avanzar o si una afirmaci√≥n directa es m√°s natural seg√∫n el contexto.\nGu√≠a de Ejemplos: El agente debe seguir estrictamente la estructura de la secci√≥n \"EJEMPLOS DE CONVERSACI√ìN\" para identificar en qu√© fases se cierra con una pregunta y en cu√°les se cierra con una instrucci√≥n directa (ej. al pedir el comprobante o solicitar datos).\nCero Presi√≥n: Si el cliente muestra inter√©s general pero no intenci√≥n de compra, Diego debe responder de forma informativa y cerrar de manera amable sin presionar por una respuesta inmediata.\n## Regla de tiempo de entrega:\nEsta regla rige c√≥mo informar sobre la llegada del pedido utilizando la hora actual seg√∫n el input (current_date).\nPara Lima (env√≠o por motorizado): Si el pago se valida antes de las 10:00 am, el pedido llega el mismo d√≠a. De lo contrario, llega el d√≠a de ma√±ana.\nPara Provincia (env√≠o por la agencia Shalom): Si el pago se valida antes de las 4:00 pm, se entrega a la agencia el mismo d√≠a. El tiempo de viaje es de 2 a 5 d√≠as h√°biles.\nAplicaci√≥n: Responde siempre con seguridad seg√∫n la hora actual. No des rangos vagos si el cliente ya pas√≥ el l√≠mite de hora.\n## Regla de env√≠os\nPol√≠tica: Solo realizamos env√≠os a domicilio o agencia; no contamos con la opci√≥n de recojo en tienda f√≠sica.\nAplicaci√≥n: Si el cliente pregunta por una direcci√≥n f√≠sica para recoger su pedido, inf√≥rmele amablemente que operamos exclusivamente mediante env√≠os.\n## Regla de solicitudes presenciales\nAplica cuando el cliente desea visitar el local, ver los perfumes en persona o agendar una cita presencial.\nEjemplos de activaci√≥n: \"Quiero ir a ver los perfumes en persona\", \"Podemos programar una cita para ir de manera presencial con mi amigo\" o \"¬øD√≥nde est√°n ubicados para ir hoy?\".\nAcci√≥n: Utilice la tool pasar_supervisor.\nRespuesta obligatoria: \"Voy a comunicarme con mi compa√±ero para que te confirme el horario\".\n\n\n\n#FASES DE FLUJO DE FUNCIONAMIENTO\n## FASE 1: 1. SALUDO Y PROTOCOLO INICIAL\nEsta fase establece el primer contacto. El saludo se env√≠a una sola vez en toda la conversaci√≥n y no se solicita el nombre del cliente.\nL√≥gica de Inicio seg√∫n el mensaje del cliente:\nESCENARIO A: Mensaje gen√©rico o sin producto identificado Aplica cuando el cliente dice \"Hola\", \"Info\", \"Precios\", o env√≠a un mensaje que no menciona un producto de la Lista Maestra.\nAcci√≥n: Saludar de forma directa.\nRespuesta Obligatoria: \"Hola hermano, en qu√© perfume est√°s interesado?\".\nESCENARIO B: El cliente menciona un perfume o marca desde el inicio Aplica cuando el cliente consulta directamente por un producto (ej: \"precio del hawas\").\nAcci√≥n 1 : Asociar el t√©rmino con el nombre t√©cnico de la lista de ‚Äúperfumes_full_size‚Äù de la tool ‚Äúinformacion_productos‚Äù (ej: \"9pm\" ‚Üí \"9 PM\").\nAcci√≥n 2: Preparar el mensaje de saludo y luego pasa a la ‚ÄúFase 2:  2. IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)‚Äù\nEjemplo de respuesta: \"Hola hermano. (para responder sobre el perfume o sobre la intenci√≥n del cliente pasa a la fase 2)‚Äù.\n## FASE 2: IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)\nEsta fase es el n√∫cleo de la venta. Diego debe mapear el lenguaje del cliente a los productos reales y consultar la disponibilidad exacta.\nCASO A: Perfumes Full Size\nAplica cuando el cliente pide informaci√≥n, precio o disponibilidad de uno o varios perfumes de la lista.\nMapeo Sem√°ntico: Antes de usar la tool, asocia el nombre que diga el cliente con el nombre m√°s cercano de la Lista Maestra.\nUso de Tool: Activa stock_perfumes con el input: disponibilidad del perfume: [Nombre exacto].\nEl nombre del perfume env√≠alo entre comillas.\nEscenario 1: Consulta por un solo perfume\nAcci√≥n: Ejecuta ‚Äústock_perfumes‚Äù.\nLa tool devolver√° el nombre del perfume y con dos datos: \nstock: (si o no). \nStock = si : significa que est√° disponible el perfume\nStock = no : significa que esta agotado el perfume\nSi hay stock: Sigue el Ejemplo 1 de entrega de informaci√≥n.\nSi NO hay stock: La tool sugerir√° perfumes similares. Debes presentarlos de forma atractiva siguiendo el Ejemplo 2.\nEscenario 2: Consulta por m√∫ltiples perfumes\nAcci√≥n: Ejecuta la tool para todos los perfumes mencionados en un solo input: ‚Äúdisponibilidad de los perfumes: 1. [Nombre], 2. [Nombre]...‚Äù\nEnv√≠a cada nombre de los perfumes entre comillas.\nResultados Mixtos:\nSi hay de todos: Sigue el Ejemplo 3.\nSi falta alguno: Sigue el Ejemplo 4 (confirmas lo que hay y ofreces alternativas para lo que no).\nCASO B: Decants (Presentaciones de 5ml o 10ml)\nAplica cuando el cliente busca probar fragancias o indica cantidades peque√±as. Generalmente los clientes piden varios a la vez.\nEjemplos de Entrada del Cliente:\n‚Äúhawas 5ml, harana 10ml, asad 10ml y gos diamond 5ml‚Äù\n\"¬øTienes el 9pm en 5ml?\"\n\"Quiero probar el Hawas y el Asad en 10ml cada uno\".\n\"P√°same precio de decants de 5ml\". En este caso consultar sobre cual desea.\nIdentificaci√≥n: Si el cliente menciona \"5ml\", \"10ml\", \"peque√±o\" o \"para probar\", tr√°talo como Decant.\nUso de Tool: Activa ‚Äústock_decants‚Äù seg√∫n la cantidad de decants que solicita adquirir:\nSi es un solo decant, envia el input: ‚Äúdisponibilidad de decant: [Nombre del perfume] en [Cantidad].‚Äù\nSi es m√°s de un decant, env√≠a el input ‚Äúdisponibilidad de decants: [Nombre del perfume] en [Cantidad]. [Nombre del perfume] en [Cantidad]....‚Äù\nCASO C: Sets de Perfumes\nAplica cuando el cliente busca estuches de regalo o packs que incluyen complementos.\nEjemplo \nAcci√≥n: Revisa la secci√≥n \"Set de perfumes\" del Conocimiento General para validar si el nombre coincide con un set real.\nUso de Tool: Activa ‚Äústock_set_perfumes‚Äù con el input: disponibilidad del SET: [Nombre del Set].\nSi consulta sobre m√°s de un set, env√≠a el input: ‚Äúdisponibilidad del SET: [Nombre del Set]. disponibilidad del SET: [Nombre del Set].‚Äù\nNota: Si el cliente pregunta por un perfume y un set al mismo tiempo, consulta ambos en la misma ejecuci√≥n de la tool.\n## FASE 3: CONFIRMACI√ìN Y LOG√çSTICA DE ENV√çO\nEsta fase se activa cuando el cliente muestra una Intenci√≥n Real de Compra (ej. \"¬øC√≥mo pago?\", \"Lo quiero\", \"P√°same tu cuenta\") o despu√©s de que Diego presente la disponibilidad y precios.\n1. Generaci√≥n del Resumen\nDiego debe presentar un resumen estructurado basado en la secci√≥n #EJEMPLOS DE RESUMEN DE COMPRA.\nRegla de Oro: El total NO incluye el env√≠o todav√≠a. El env√≠o se suma en la Fase 4.\nPregunta de Cierre: Siempre debe terminar con la pregunta: \"¬øPara qu√© distrito o ciudad ser√≠a el env√≠o?\"\n2. Validaci√≥n de Ubicaci√≥n (Uso de Tool)\nUna vez que el cliente responde con un lugar, Diego debe ejecutar la tool distritos.\nL√≥gica de Clasificaci√≥n:\nCASO LIMA: Si el distrito indicado est√° en la lista de la tool distritos (Lima Metropolitana y Callao), se clasifica como Escenario A.\nCASO PROVINCIA: Si el lugar indicado NO est√° en la lista (ej. Piura, Cusco, Trujillo, o distritos de otras regiones), se clasifica autom√°ticamente como Escenario B.\n\n## FASE 4. M√âTODOS DE PAGO Y VALIDACI√ìN\nDiego presentar√° los m√©todos de pago bas√°ndose estrictamente en la ubicaci√≥n identificada. El costo de env√≠o es de S/12 en todos los casos.\nEscenario A: Lima Metropolitana (Distritos indicados)\nRegla: El cliente tiene la opci√≥n de pagar solo el env√≠o (S/12) por adelantado para confirmar, y el saldo del perfume lo cancela al recibirlo.\nMensaje: \"Para Lima puedes confirmar tu pedido pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Si prefieres, tambi√©n puedes pagar el monto total.\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante.‚Äù\nRegla de Flexibilidad: El cliente puede elegir pagar solo el env√≠o o el total.\nEscenario B: Provincia / Env√≠os por Shalom\nRegla: El pago debe realizarse por el monto completo (Perfume + S/12 de env√≠o) antes de despachar.\nMensaje: \"Para enviarte a provincia, el pago es por el monto total: son S/ [Precio del perfume] del perfume + S/ 12 del env√≠o por Shalom. En total ser√≠a S/ [Suma de ambos].\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante..‚Äù\nReglas Cr√≠ticas de Validaci√≥n:\nSolo Imagen: La compra √öNICAMENTE se valida mediante el input Imagen_analizada. No aceptes confirmaci√≥n por texto (\"ya pagu√©\") ni por audio.\nC√°lculo de Montos: * Si el cliente est√° en Lima y env√≠a un comprobante de S/ 12, Diego debe decir: \"Reserva de S/ 12 verificada. El saldo de S/ [Monto del Perfume] lo cancelas al recibir.\" y pasar a pedir datos.\nSi el cliente env√≠a el pago en partes (ej. dos capturas de Yape), Diego debe sumar ambos montos mentalmente. Solo cuando la suma sea igual al total acordado (o al menos a los S/ 12 en Lima), se da por validado.\n\n## FASE 5. SOLICITUD DE DATOS Y FINALIZACI√ìN\nTras validar el pago exitosamente seg√∫n el input ‚Äúimagen_analizada‚Äù, Diego solicita los datos para la confirmaci√≥n del env√≠o, seg√∫n el caso A o el caso B\nCASO A) Si el env√≠o es para los distritos permitidos de Lima Metropolitana.\n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Direcci√≥n exacta.‚Äù\n2) Validaci√≥n: Diego acepta cualquier formato de nombre y direcci√≥n que el cliente proporcione. No debe cuestionar la direcci√≥n, solo recopilarla.\n3) Utilizar tool: Una vez que tengas ambos datos utiliza la tool ‚Äúconfirmacion_pedido‚Äù y env√≠a las siguientes variables:\n‚ÄúNombre‚Äù\n‚ÄúDireccion exacta‚Äù\n‚Äúproductos‚Äù: el producto o los productos env√≠alos de esta forma: \"Producto 1: [Categor√≠a: Full Size/Decant/Set] [Nombre del Perfume] - [Precio] - [Cantidad]. (Repetir si hay m√°s productos)\".\n4) Confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: Tu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada\nCASO B) Si es de Provincia: \n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Apellidos\\n- DNI\\n- Ciudad/provincia\\n- Nombre de la agencia Shalom donde recoger√°‚Äù\n2) Validaci√≥n: Diego acepta los datos tal cual los env√≠e el cliente (no corregir DNI ni nombres). \n3) Utilizar tool: Una vez identificado todo los datos que solicitaste, utiliza la tool ‚Äúconfirmacion_pedido‚Äù con las siguientes variables:\n\n‚ÄúNombre‚Äù\n‚ÄúApellidos‚Äù\n‚ÄúDNI‚Äù\n‚ÄúCiudad/provincia‚Äù\n‚ÄúNombre_agencia_shalom‚Äù\n‚Äúproductos‚Äù: (Misma l√≥gica del CASO A: Categor√≠a, Nombre, Precio y Cantidad)\nNota: en este caso la variable ‚Äúdireccion_exacta‚Äù coloca ‚Äúnull‚Äù.\n4) confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: ‚ÄúTu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada.‚Äù\n\n###SECCI√ìN: EJEMPLO DE ENTREGA DE INFORMACI√ìN DE PERFUME\nEjemplo 1 (Un perfume con stock):\n\"El Hawas Ice s√≠ lo tengo en stock. El precio es de S/ 180. Es un perfume ultra fresco y potente, de los que m√°s piden.\"\nEjemplo 2 (Sin stock + Similares sugeridos):\n‚ÄúEl Valentino est√° agotado. Tengo estos que son de la misma vibra y huelen incre√≠ble:\\nJPG Le Male Elixir a S/ 450\\n\\nScandal Le Parfum a S/ 420 ¬øAlguna de esas opciones te llama la atenci√≥n?\"\nEjemplo 3 (M√∫ltiples perfumes con stock):\n\"Tengo los dos disponibles:\\n\\n9 PM a S/ 140\\nKhamrah Dukhan a S/ 175\"\nEjemplo 4 (Stock mixto):\n\"Hermano, te confirmo: el CDN Intense s√≠ lo tengo listo para enviar a S/ 190. El Azzaro lo tenemos sin stock. ¬øQu√© otro perfume te gustar√≠a?\nEjemplo 5 (Decants m√∫ltiples):\n\"Los tengo disponible:\\n\\n9pm Elixir (5ml): S/ 35\\nYara (10ml): S/ 45\\nKhamrah (5ml): S/ 40\\n\\n¬øTe armo el pack con estos tres o quieres chequear alguno m√°s?\"\n\n#EJEMPLOS DE RESUMEN DE COMPRA\n## EJEMPLOS SOLO PERFUMES FULL SIZE\n### Ejemplo 1: Si es solo un perfume\n\"Resumen de compra:\\n- Hawas Ice\\nüì¶ Cantidad: 1\\nüí∞ Precio unitario: S/ 180\\n\\nüíµ Total: S/ 180\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s perfumes Resumen de compra:\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah Dukhan\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 175\\n\\nüíµ Total: S/ 315\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS SOLO PERFUMES DECANTS\n### Ejemplo 1: Si es solo un decant Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- 9 PM Elixir (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 35\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Si son varios decants Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- Yara (10ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 45\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\nüíµ Total: S/ 125\\n\\n¬øMe indicas el distrito para continuar?\"\n## EJEMPLOS SOLO SET DE PERFUMES\n### Ejemplo 1: Si es solo un set Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 220\\n\\nüíµ Total: S/ 220\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s sets Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\n- GOS Set\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 240\\n\\nüíµ Total: S/ 450\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS DE PEDIDOS COMBINADOS\n### Ejemplo 1: Perfume Full Size + Decants\n\"Resumen de compra:\\n- Lattafa Asad\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 150\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Yara (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 225\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Compra Integral (Full Size + Decant + Set)\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\nüíµ Total: S/ 390\\n\\n¬øMe confirmas el distrito para avanzar con el pago?\" \n\n# EJEMPLOS DE FLUJO DE CONVERSACI√ìN CORRECTO\n## EJEMPLOS SI EL CLIENTE DESEA EL ENV√çO PARA LIMA\n1) Pago completo (Perfume + Env√≠o)\nCliente: Hola, quiero el Hawas Ice para Miraflores.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Hawas Ice s√≠ est√° disponible y cuesta S/180. ¬øDeseas agregar algo m√°s a tu compra?.\nCliente: No, solo eso. ¬øC√≥mo hago el pago?.\nDiego: Para Lima puedes confirmar pagando solo S/12 del env√≠o y el saldo al recibir, o pagar el monto total de S/192. Puedes yapear al 987108094 a nombre de Brandon Quelopana o por transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/192).\nDiego (Tras validar Imagen_analizada): Pago de S/192 verificado. P√°same tu nombre, celular y direcci√≥n exacta para programar el env√≠o. Como pagaste antes de las 10:00 am, llega hoy mismo.\n2) Pago parcial (Solo env√≠o S/12 + Saldo contra entrega)\nCliente: Precio del 9 PM. Estoy en San Borja.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El 9 PM cuesta S/140. ¬øQuieres agregar algo m√°s o solo ese?.\nCliente: Solo ese. Quiero pagar solo el env√≠o ahora.\nDiego: Entendido. Para Lima puedes confirmar pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Yapea al 987108094 (Brandon Quelopana) y me mandas la captura.\nCliente: (Env√≠a captura por S/12).\nDiego (Tras validar Imagen_analizada): Reserva de S/12 verificada. P√°same tu nombre, celular y direcci√≥n exacta. El saldo de S/140 lo pagas al recibir el producto.\n## EJEMPLO SI EL CLIENTE DESEA EL ENV√çO PARA PROVINCIA\n3) Pago total obligatorio para Provincia (V√≠a Shalom)\nCliente: Hola, precio de Asad para Piura.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Lattafa Asad cuesta S/150. ¬øDeseas agregar alg√∫n decant o solo el perfume?.\nCliente: Solo el perfume. ¬øCu√°l es el m√©todo?\nDiego: Para env√≠os a provincia el pago se realiza por el monto total de S/162, que incluye los S/12 de env√≠o por Shalom. Puedes pagar por Yape al 987108094 (Brandon Quelopana) o transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/162).\nDiego (Tras validar Imagen_analizada): Pago de S/162 verificado. P√°same tu nombre, apellidos, DNI, celular, ciudad y el nombre de la agencia Shalom donde lo recoger√°s. \n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-5136,288],"id":"87ad49a4-0b30-4cf2-bd78-475265d05fe3","name":"AI Agent"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","typeVersion":1,"position":[-3472,528],"id":"0af2d781-c62f-4cfa-8636-6576d2801773","name":"Auto-fixing Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3504,704],"id":"0be267ba-446a-4cd1-8c35-ea2e696d7e8b","name":"OpenAI Chat Model8","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"response\": {\n    \"parte_uno\": \"Texto correspondiente a la primera parte de la respuesta.\",\n    \"parte_dos\": \"Texto correspondiente a la segunda parte de la respuesta.\",\n    \"parte_tres\": \"Texto correspondiente a la tercera parte de la respuesta (opcional).\",\n    \"parte_cuatro\": \"Texto correspondiente a la cuarta parte de la respuesta (opcional).\",\n    \"imagen_uno\": \"Imagen correspondiente\",\n    \"imagen_dos\": \"Imagen correspondiente (opcional).\",\n    \"video_mp4\": \"Video .mp4 (opcional)\"\n}\n  }"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-3328,704],"id":"05f11a4e-1bcc-4829-a163-8b4e3e1f1534","name":"Structured Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3744,624],"id":"f2dd9e17-523b-4e58-9b8e-5f00f8fa704f","name":"OpenAI Chat Model9","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"={{ $json.output }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Obtener el texto de entrada:\n\nRecupera el texto de la variable items\n{{ $json.output }}\nLimpieza y normalizaci√≥n del texto:\n\nCrea una funci√≥n que limpie el texto eliminando los siguientes caracteres: ¬ø, ¬°, @, \", *, #.\n\nElimina los espacios en blanco al inicio y al final del texto.\nNo Elimines los emojis, ni los markdown para que los mensajes esten limpios.\nDivisi√≥n del texto en partes:\n\nImplementa una funci√≥n que divida el texto limpio en fragmentos de m√°ximo 800 caracteres sin cortar palabras. Si necesitas cortar uno de los fragementos del mensaje antes de 800 Caracteres para que no se corten mensajes hazlo. Los mensajes deben quedar completo y coherentes\nLa funci√≥n debe asegurarse de que cada fragmento se corte en espacios para no dividir palabras a la mitad.\nSi tienes que aumentar la cantidad de caracteres para que parte del mensaje no quede cortado o quede mal puedes hacerlo sin un limite de caracteres. Esto para que los mensajes sean mas organicos y funcionen bien. Tambien al identificar una imagen necesito que el link lo separes para que se mande separado.\n\n*SIEMPRE* que haiga un Link del video de youtube del tratamiento o presentaci√≥n, mandalo como parte del texto con su contexto, *NUNCA* lo pongas en la parte de imagen uno y dos.\n\n*NUNCA* pongas el link del video.mp4 en las partes de texto e imagen, *SIEMPRE* si es que tienes algun video con .mp4 ponlo en video_mp4.\n\nDeber√°s de enviarlo siempre a la √∫ltima parte pero solo eso.\nConstrucci√≥n de la respuesta:\n\nCrea un objeto JSON con la siguiente estructura:\n\n{\n  \"response\": {\n    \"parte_uno\": \"<primer fragmento>\",\n    \"parte_dos\": \"<segundo fragmento>\",\n    \"parte_tres\": \"<tercer fragmento>\",\n    \"parte_cuatro\": \"<cuarto fragmento>\",\n    \"imagen_uno\": \"<primera imagen>\",\n    \"imagen_dos\": \"<segunda imagen>\",\n    \"video_mp4\": \"<video.mp4>\"\n\n  }\n\n- Si hay un emoji como un check o algo por el estilo que desmuestre un enlistado, opciones o variantes similares, dale salto de linea para que parezca natural, recuerda reemplazar el \"\\n\" por un enter.\n\nSi alguna parte no existe, asigna una cadena vac√≠a (\"\").\n\n\n### Notas \n\n- Nunca debes hacer saltos de linea que no sean naturales evita si en algun momento un mensaje tiene un \":\" que el mensaje que le siga este en la otra parte del mensaje. debe ser lo mas natural posible.\n\n- S√≠ el texto tiene un saludo de bienvenida o algo parecido, *SIEMPRE* separalo en una parte y las siguientes partes separalos de tal forma que se vea ordenada y estructuradas tus respuestas.\n- En caso veas una palabra en asteriscos, ejemplo: **Botox:** deber√°s de quitarle los dos de los extremos y deber√° de quedar as√≠ *Botox:*.\n- *NUNCA* deber√°s de cortar el contexto del mensaje, quiero decir que si ves que el mensaje trata de un tema en espec√≠fico o seccion no deber√°s de cortarlo.\n\nEs Obligatorio reemplazarlo, no eliminarlo. NUNCA DEJAR NINGUNA PARTE VAC√çA OBLIGATORIAMENTE.\n\n- *SIEMPRE* REEMPLAZA \"\\n\" por un salto de linea normal (enter) ejemplo:\n{\n  \"response\": {\n    - opcion 1\n    - opcion 2\n    - opcion 3  \n  }\n}\n\n- *SIEMPRE* y cuando te lleguen dos links de Video.mp4, agarra el primero y no pongas los 2 juntos, si es posible, elimina uno para que solo quede uno.\n\n- *regla adicional* cuando llegue un link que est√© en .jgp .jpeg y .PNG a√±adelo a la parte de imagen, y si est√° en .mp4 a√±adelo al apartado de video "}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-3600,256],"id":"7ca03140-46dd-4d3c-a332-e3ee2072ded6","name":"Verificador1","onError":"continueErrorOutput"},{"parameters":{"httpMethod":"POST","path":"BRADA","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-15296,608],"id":"dbcc07c3-6246-4bdb-878b-af891629f8c8","name":"Webhook","webhookId":"fb43e7b4-c71f-4cad-bebd-32a81374fc49"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n","tableName":"healup","contextWindowLength":12},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-5200,48],"id":"39798e20-26eb-4032-ae59-7f5d5b5f7d8b","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"NzQUFXQpp2MvRekP","name":"CUENTA ALEGRATED"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8fa70db3-09c3-4e87-8fc9-4052751fad3f","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9840,512],"id":"d53b946f-7849-4a0c-91b8-673d822caa58","name":"If2","alwaysOutputData":false,"retryOnFail":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"576350e5-ed67-4ce9-815e-0f0a0ef0b1c7","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9616,688],"id":"3d169320-db83-4f3e-b8ec-cf4189ac8d7a","name":"If3"},{"parameters":{"assignments":{"assignments":[{"id":"1aa91b6d-c441-4496-beee-4af2457332ac","name":"pasar_supervisor","value":"={{ $json.pasar_supervisor }}","type":"string"},{"id":"34e35c66-589c-4146-ab9c-3d08b024a7c1","name":"n√∫mero","value":"={{ $json.numero }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-9984,512],"id":"e5878ba6-1987-4774-811f-c2cee034cb0a","name":"Edit Fields4"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-9184,992],"id":"02219ac8-19fd-463b-b35f-8880e0676c67","name":"No Operation, do nothing4"},{"parameters":{"name":"pasar_supervisor","description":"Llama esta herramienta cuando desees pasar a supervisor.","workflowId":{"__rl":true,"value":"2lPoYs00jPGwaBxq","mode":"list","cachedResultUrl":"/workflow/2lPoYs00jPGwaBxq","cachedResultName":"Supervisor Solari"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('Edit Fields20').item.json.id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-7248,464],"id":"b5e6fa52-fde1-4c70-b3ba-07a042587076","name":"Supervisor2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"98601c0c-949c-4f3d-99f2-40305665d58a","leftValue":"={{ $json.numero }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-10704,576],"id":"40fc0c0b-0829-40fc-81d5-3da1f46a7a9b","name":"If13"},{"parameters":{"name":"=Agendar","description":"=Agendar citas ","source":"=database","workflowId":{"__rl":true,"value":"konppOdwditJvoJQ","mode":"list","cachedResultUrl":"/workflow/konppOdwditJvoJQ","cachedResultName":"agendarSUNAT WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre_completo":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre_completo', ``, 'string') }}","DNI":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('DNI', ``, 'string') }}","numerotelefono":"={{ $json.id }}","inicio_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('inicio_cita', ``, 'string') }}","fin_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fin_cita', ``, 'string') }}","tratamiento(s)":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('tratamiento_s_', `Coloca el tratamiento que se haya mencionado durante la conversaci√≥n, seg√∫n esta lista de tratamientos:\n\n- Lipopapada & Afinamiento Facial Enzim√°tico\n- Natural Lips\n- Bratz Lips\n- Perfilamiento de nariz\n- Rinomodelaci√≥n completa\n- Exosomas + Esperma de Salm√≥n\n- Proyecci√≥n de Ment√≥n con √Åcido Hialur√≥nico\n- Baby Botox\n- Botox Full Face\n- Marcaci√≥n mandibular\n- Masseter Botox\n- Surcos Nasogenianos\n- Sustentaci√≥n pomular\n- √Åcido Hialur√≥nico para ojeras\n- NCTF\n- Hidralips con Dermapen\n- Plasma Rico en Plaquetas (PRP)\n- Armonizaci√≥n Facial \n\n- Glass Skin Babe\n- CalmBabe\n- Pure Babe Skin\n- Heal Up Babe Ritual\n- Prime Skin Clean\n- Eternal Glow Boost\n- Prestige Glow Ritual\n- Heal Up Signature Glow\n\n- Lipo Start Protocol\n- Lipo Sculpt Protocol\n- Lipo Intensive Shape Protocol\n- Heal Up Lipo 360‚Äù.\n\nNota: Si el paciente consult√≥ sobre m√°s de 1 tratamiento, a√±adelo con una coma. por ejemplo: Rinomodelaci√≥n completa, Baby Botox.\n`, 'string') }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","red_social":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('red_social', `Coloca esta palabra: WhatsApp`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"nombre_completo","displayName":"nombre_completo","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"inicio_cita","displayName":"inicio_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"fin_cita","displayName":"fin_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"numerotelefono","displayName":"numerotelefono","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"DNI","displayName":"DNI","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"red_social","displayName":"red_social","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"tratamiento(s)","displayName":"tratamiento(s)","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-5504,784],"id":"5334487f-6a0c-48f2-8833-2cece4f6c66e","name":"Calendario"},{"parameters":{"tableId":"pasar_supervisor_BRADA","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"},{"fieldId":"conversation_id","fieldValue":"={{ $('If12').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10480,832],"id":"6da92ad7-7496-46b2-ad7a-af1302bdca1b","name":"Create a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10192,512],"id":"e01e05d9-2c86-4f10-8067-8d296b347400","name":"Get a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9536,416],"id":"08f4c79d-67de-4997-8b28-3d94436c885c","name":"Update a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10960,592],"id":"0383d00f-4ae0-4f14-850a-4ee2703bbc58","name":"Get a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2acc3e64-d51a-4e98-84a5-e2b17c788fa2","leftValue":"={{ $('Webhook').item.json.body.payload.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7312,592],"id":"645bde3e-f301-4b37-a037-b78f2c234bab","name":"If4"},{"parameters":{"operation":"formatDate","date":"={{ $json.currentDate }}","format":"custom","customFormat":"DDDD tt","options":{"timezone":true}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-6896,576],"id":"c0cfb4f3-987c-429b-9a57-9f8b58dd70a2","name":"Formatea fecha"},{"parameters":{"assignments":{"assignments":[{"id":"d78c89a3-c878-48b7-aa84-4b2674c0667b","name":"data.remoteJid","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation.contact_inbox.source_id }}","type":"string"},{"id":"432a9602-e38b-4880-a64d-b832d120edda","name":"data.id","value":"={{ $('Webhook').item.json.body.id }}","type":"string"},{"id":"d2f45efc-03ac-4c74-b70e-959b06cd2a0b","name":"data.text","value":"={{ $('Edit Fields17').item.json.mensajetexto }}{{ $('Edit Fields17').item.json.mensajeaudio }}{{ $('Edit Fields17').item.json.mensajeimagen }}","type":"string"},{"id":"d77208a8-161b-4ef3-96fa-261a87cf1f39","name":"conversation_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","type":"string"},{"id":"8c279598-20f0-4012-a4ee-8c7898ceaba4","name":"account_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].account_id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6448,576],"id":"e0ece9a2-acd1-450f-9e2f-a45df7d9021e","name":"Handler variables"},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-7072,576],"id":"34435b05-c9a2-4759-b275-a239d12bbcb1","name":"Fecha"},{"parameters":{"jsCode":"// 1. Obtener la fecha de entrada\nconst inputDateString = $input.item.json.formattedDate; \nconst date = new Date(inputDateString);\n\n// 2. Obtener hora actual para la l√≥gica\nconst currentHour = date.getHours();\n\n// Clonamos la fecha para calcular el env√≠o\nlet scheduledDate = new Date(date);\n\n// 3. L√≥gica de Negocio (Reglas de horario)\nif (currentHour >= 19 || currentHour < 5) {\n  // Caso Nocturno (19:00 - 04:59): Programar para las 09:00 AM\n  scheduledDate.setHours(9, 0, 0, 0);\n  \n  // Si es >= 19:00, pasa al d√≠a siguiente.\n  if (currentHour >= 19) {\n    scheduledDate.setDate(scheduledDate.getDate() + 1);\n  }\n} else {\n  // Caso Diurno (05:00 - 18:59): Sumar 4 horas\n  scheduledDate.setHours(scheduledDate.getHours() + 4);\n  // Reiniciamos minutos y segundos a 0 para mantener limpieza (opcional, pero recomendado)\n  scheduledDate.setMinutes(0);\n  scheduledDate.setSeconds(0);\n}\n\n// 4. FORMATEO DE SALIDA \"dd/mm/yyyy HH\"\n// Usamos .padStart(2, '0') para asegurar dos d√≠gitos (09, 05, etc.)\n\nconst day = scheduledDate.getDate().toString().padStart(2, '0');\nconst month = (scheduledDate.getMonth() + 1).toString().padStart(2, '0');\nconst year = scheduledDate.getFullYear();\nconst hourFormatted = scheduledDate.getHours().toString().padStart(2, '0');\n\n// CONSTRUCCI√ìN FINAL: dd/mm/yyyy HH\n// Nota: Eliminamos los minutos (:${minuteFormatted}) de esta l√≠nea\nconst fecha_final = `${day}/${month}/${year} ${hourFormatted}`;\n\nreturn {\n  json: {\n    original_input: inputDateString,\n    // Variable solicitada con el formato exacto\n    fecha_lora_formateada: fecha_final,\n    // Variable extra por si necesitas solo la hora aislada\n    solo_hora: hourFormatted\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6640,576],"id":"7235933b-bf69-4698-9133-cfe47b370ffc","name":"Code2"},{"parameters":{"amount":30},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-7312,1072],"id":"6e3e7abf-d38f-40b1-b0c4-a8e166fc036c","name":"Wait6","webhookId":"5696ca8f-19ae-4cd6-8008-6132ce1cf272"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8a313a41-eadc-4ada-bc2a-feff79845de9","leftValue":"={{ $json.mensajes[0] }}","rightValue":"={{ $('Handler variables').item.json.data.text }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6864,1296],"id":"76729177-6c0d-4ec2-bf0a-0604e5bbf8a9","name":"If6"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-6544,1376],"id":"2c667d72-3de1-4d9e-bff9-88ce886f1c91","name":"No Operation, do nothing1"},{"parameters":{"operation":"delete","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6240,1024],"id":"31c060d8-e6c1-489f-924b-36ee33dce137","name":"Delete Redis","executeOnce":false,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $('Get Redis1').item.json.mensajes.join() }} y el lead viene de un anuncio : {{ $('RESUMIDOR ANUNCIOS').item.json.output }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Wait6').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.payload._data.Info.PushName }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6352,832],"id":"fa0d6541-f1f5-42a3-918d-072dec78f8be","name":"Edit Fields19","alwaysOutputData":true},{"parameters":{"operation":"get","propertyName":"mensajes","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","keyType":"list","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6960,1088],"id":"eb2e5436-c84c-4660-a049-366ff67222ee","name":"Get Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $json.anuncio }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Handler variables').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.conversation.messages[0].sender.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6368,992],"id":"a0199bbc-432c-4d05-a271-0c734eec08cd","name":"Edit Fields20","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3e8a5a20-c60c-48ef-a636-2b5e14a683a8","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6608,944],"id":"61e1b52d-148e-41fd-9b0b-7e4895ad7a0a","name":"If15"},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1136],"id":"edcdff4c-5e82-4bfe-8beb-45b771f8bed2","name":"METER_ANUNCIO","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1296],"id":"666f3eb7-d307-4a99-abd7-1f526c0907fd","name":"BAJAR_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}_ad","messageData":"={{ $('RESUMIDOR ANUNCIOS').item.json.output }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8064,1136],"id":"5a5ab926-f0b0-420f-ad66-6f99a6d9eb9f","name":"guarda_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3deed863-79f3-42e5-a32c-6cb7bb1028df","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7616,512],"id":"46ecb883-24f2-490a-a44c-a9e6dd7a5ab2","name":"If"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-7488,32],"id":"76495bc9-2132-42c6-8f98-7f222fbc58ab","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"8f567177-8b37-4a09-9a53-ac9fe424c843","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6240,576],"id":"49f7d2d6-bf9c-4b3f-bde9-d5b04db1203a","name":"If10"},{"parameters":{"operation":"get","propertyName":"anuncio","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6752,944],"id":"16a19e11-3a97-49d7-b868-7b84b7799dc7","name":"Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-6928,272],"id":"31f4a897-b5fc-4baa-a8ac-c4645d7e6b10","name":"Update a row4","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"Describe esta imagen\n","imageUrls":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].data_url }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8864,560],"id":"655bda6d-6ab1-42a8-85c1-736575210b9b","name":"OpenAI","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"437f223f-80c7-4c47-a50b-9d17a8614251","name":"imagen_caption","value":"={{ $json.content }} .\nEl captions del mensaje de imagen es: {{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8448,688],"id":"fa56722a-8385-4847-b719-f90a132dfbd1","name":"Edit Fields12"},{"parameters":{"url":"={{ $('Webhook').item.json.body.attachments[0].data_url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-8896,368],"id":"f1138959-5c6f-4058-a15b-6e56bdaab777","name":"HTTP Request"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"27bcc104-31e3-4687-b60b-a018c457a3a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"audio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2e8b532f-1f01-45f9-a647-e7a5c9e48aac","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"image","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Imagen"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"59f6b23a-3029-4225-8f9e-3744611a04a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"=text","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"28de146f-c104-4171-924a-29963c4f1970","leftValue":"={{ $('Webhook').item.json.body.content_type }}","rightValue":"text","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-9216,416],"id":"b138e8be-c1d3-4f8a-8423-93fb52834ba7","name":"Switch3"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8624,368],"id":"f26677a7-27a0-43ed-8071-3e3064e25db4","name":"AUDIO1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"276cbb8a-79f2-4f08-b24a-632f474c6013","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-8624,560],"id":"f29adecc-e9d9-4222-9ec3-107cac681c09","name":"If16"},{"parameters":{"assignments":{"assignments":[{"id":"c0a1b2f0-373e-4b86-ae91-25346b20b404","name":"mensajetexto","value":"=Texto mensaje: [{{ $('Webhook').item.json.body.conversation.messages[0].content }}]  ","type":"string"},{"id":"35cd9184-e37e-4d03-9dff-efb319dce478","name":"mensajeaudio","value":"={{ $json.text }}","type":"string"},{"id":"47e9bfe8-2c55-4b5d-b047-024871fc6c21","name":"mensajeimagen","value":"=Imagen analizada: [{{ $json.content }}{{ $json.imagen_caption }}]","type":"string"},{"id":"9926d346-600f-45af-adad-876e9f40ffa4","name":"imagenanalizada","value":"=Imagen de anuncio analizado: {{ $json.content }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8064,480],"id":"8a1f15fa-bf4b-4c01-adbb-7a1a21d7a706","name":"Edit Fields17","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $('Webhook').item.json.body.payload.body }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7120,400],"id":"7ab44ba1-258f-4193-929d-15aa68334a0f","name":"If11"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f05066b5-5a07-41fa-96b7-7a244e7345c8","leftValue":"={{ $json.body.payload.fromMe }}\n","rightValue":"true","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12384,608],"id":"d94743f2-3b7b-460b-bc26-33eae6240210","name":"If12"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $json.body.conversation.messages[0].content }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12224,752],"id":"23a75e86-d3fd-4b05-8d58-aa9da67a47d8","name":"If20"},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-12144,1008],"id":"a93457ed-fd5d-4186-b320-c1a49417136c","name":"Update a row6","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"name":"informacion","description":"utiliza esta tool cuando se necesite informaci√≥n seg√∫n las indicaciones del prompt principal.","workflowId":{"__rl":true,"value":"FB7us6cBaq7jWqB2","mode":"list","cachedResultUrl":"/workflow/FB7us6cBaq7jWqB2","cachedResultName":"informacion HEAL UP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}"},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-6080,784],"id":"e0e915c5-fd08-4168-be41-783aa4ce1390","name":"informacion_tratamientos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"987d5d07-58eb-4927-8e68-a137884b8100","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].message_type }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13248,608],"id":"5e339c78-27b7-41de-8774-f34bd2e49752","name":"If1"},{"parameters":{"jsCode":"// Tomamos todos los items que vienen del nodo anterior (Verificador1)\nconst items = $input.all();\n\nfor (const item of items) {\n  // Aqu√≠ est√° tu objeto con parte_uno, parte_dos, etc.\n  // Verifica la ruta: output.response\n  const resp = item.json.output?.response || {};\n\n  // Orden que quieres respetar\n  const orderedKeys = [\n    'parte_uno',\n    'parte_dos',\n    'parte_tres',\n    'parte_cuatro',\n    'imagen_uno',\n    'imagen_dos',\n    'video_mp4',\n  ];\n\n  // Armamos un nuevo objeto response en el orden deseado\n  const newResponse = {};\n  for (const key of orderedKeys) {\n    if (resp[key]) {\n      newResponse[key] = resp[key];\n    }\n  }\n\n  // Sobrescribimos manteniendo la estructura original\n  if (!item.json.output) item.json.output = {};\n  item.json.output.response = newResponse;\n}\n\n// Devolvemos los items modificados\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2752,352],"id":"24f0ff65-46ee-441c-a6d4-8f9095be5ae0","name":"ordenar"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $json.output.response.parte_uno ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2720,1088],"id":"88a82162-8ee2-4a01-8f95-a7350bae11d1","name":"Respuesta1","executeOnce":false},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1776,832],"id":"cce742aa-91d4-4fd6-971b-02494cc4941d","name":"Wait2","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_dos ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1600,928],"id":"6c953a90-8ee3-40d6-b6fd-f29c2e766496","name":"Respuesta2","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1312,848],"id":"0a8bc622-6c9b-472d-8735-328b027264ff","name":"If14"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1120,832],"id":"568f10ce-4d13-4754-843d-d05277b38f48","name":"Wait3","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_tres ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-912,896],"id":"3cb7de22-5651-4c25-b9eb-6132643c3bbe","name":"Respuesta3","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-496,752],"id":"af5809e5-112a-4632-aeaf-44bd7061fd9e","name":"If17"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-480,976],"id":"d9d3f88f-ef89-458a-8d83-ad4661e1b4e6","name":"Wait4","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=hcy6n6RAJTBAAYguVuewgp2A"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_cuatro ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-256,1008],"id":"319a272b-7a67-4de3-bcc3-381f609226df","name":"Respuesta4","executeOnce":false},{"parameters":{"promptType":"define","text":"=Te va a llegar esta descripcion de un anuncio: {{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","options":{"systemMessage":"ROL:\nTu rol es indicar el mismo input que te llega y enviarlo como output."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-7504,192],"id":"7dd13519-eebb-4cd8-9fbe-870c4eb2ea0b","name":"RESUMIDOR ANUNCIOS"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1a9dd789-5c10-4489-a344-6b7a0fd041ea","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51902215511","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"912d0724-5ef1-4f88-9d43-acbb38f48cee","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51993708540","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"e50ad623-45f5-4af7-bc5a-89708016ddf8","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51972619000","operator":{"type":"string","operation":"equals"}},{"id":"9ffd5afb-ec0c-49fc-a144-b682386c760c","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51960239280","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"50ddfe27-4e13-4e3c-8216-aca1f181f77a","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51936196001","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"7650a20c-4ba9-4e41-bd67-89e8f77278fc","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"14502413970","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"bdfe444d-b4d9-4789-971d-08420999d775","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51945157250","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"5f1e9684-e18d-4a9f-aad7-bef2235f631d","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51971119678","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13888,864],"id":"fc9e995e-943d-4cce-8e72-ee42d86cee6c","name":"If18"},{"parameters":{"description":"usa la tool supervisor seg√∫n el prompt principal","workflowId":{"__rl":true,"value":"xchwhR053ynGsZI4","mode":"list","cachedResultUrl":"/workflow/xchwhR053ynGsZI4","cachedResultName":"SUP SUNAT"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $json.id }}","conversation_id":"={{ $('If7').item.json.conversation_id }}","inbox_id":"={{ $('If12').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5616,832],"id":"5e99594b-abaa-47fe-872d-198f951381e9","name":"Supervisor"},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje1","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_uno }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"},{"fieldId":"account id","fieldValue":"={{ $('Webhook').item.json.body.account.id }}"},{"fieldId":"conversation id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2544,1088],"id":"476c18e7-85f6-493d-b3aa-14cfdf31bcc3","name":"Update a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje2","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1472,944],"id":"d7b09d89-120c-41de-af99-2ac3e43b9c64","name":"Update a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje3","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-720,896],"id":"87f26d37-d4e6-4022-b8e7-d0be58f20d22","name":"Update a row5","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"seguimiento_healup","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-15088,608],"id":"f952306b-6aab-4f21-ba58-cdd5dcebe32c","name":"Get a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}},"disabled":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"60e8198a-90ea-44a7-8f27-6e37021a1a02","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje1 }}","operator":{"type":"string","operation":"equals"}},{"id":"4541b27d-6dfa-47d7-bbff-d1a5c2e6ffd1","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje2 }}","operator":{"type":"string","operation":"equals"}},{"id":"20ce2efd-2509-40d0-b670-2c484246fa28","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje3 }}","operator":{"type":"string","operation":"equals"}},{"id":"b74b14df-879c-4427-8888-d7e1e3212ddc","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje4 }}","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-14880,608],"id":"5c2a2d65-e6b0-4eff-8611-1286cc5f3519","name":"If19","alwaysOutputData":true,"disabled":true},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje4","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[0,1008],"id":"3bfbc342-a045-4fb3-b813-77c25a76e4fd","name":"Update a row7","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"daeff2da-d88d-4aa7-b4d9-8b808c58b7c8","leftValue":"={{ $json.conversation_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7664,1824],"id":"4456591c-6e0e-41e1-8fe3-d6b190cf5b8a","name":"If7"},{"parameters":{"operation":"get","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","keyValue":"={{ $('Get a row3').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7920,1520],"id":"7eb28718-e96b-48aa-aaa6-9595b57209be","name":"Get a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"BRADA_followups","fieldsUi":{"fieldValues":[{"fieldId":"conversation_id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7232,1664],"id":"032dfeeb-7358-4670-bfc8-e64deb12607b","name":"Create a row1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"model":"gpt-5.1","options":{"reasoningEffort":"low"}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5440,496],"id":"ff0bf49f-19d4-4e02-92fc-84ddcb1a06e5","name":"RAZONADOR PLUS","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7536,1424],"id":"456e5e75-da23-4eaf-b219-2d0e6a4c9772","name":"Update a row9","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"pasar_supervisor_healup","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9872,1184],"id":"22e69871-698c-451d-97be-e15985b9f1ca","name":"Create a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"method":"POST","url":"=https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": \"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg\",\n  \"message_type\": \"outgoing\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3152,1440],"id":"1e6becc0-86ad-4636-968f-82b82ce1d008","name":"Respuesta6","executeOnce":false},{"parameters":{"url":"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3648,1424],"id":"c91882f6-4156-4928-83f4-db575130f873"},{"parameters":{"method":"POST","url":"https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content","value":"Aqu√≠ tienes la imagen adjunta üëá"}]},"options":{}},"name":"2. Enviar a Chatwoot","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3440,1408],"id":"bb8131d9-ee4a-4ce7-bfcd-6484ee58e6e9"},{"parameters":{"content":"## EJEMPLO IMAGENES\n","height":320,"width":560},"type":"n8n-nodes-base.stickyNote","position":[-3744,1328],"typeVersion":1,"id":"14ea41f0-1e70-47f8-ad8d-cad36bd5ba28","name":"Sticky Note"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2352,1056],"id":"da693219-5a37-4d6b-b186-6b04eb3a09a2","name":"If8"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1184,1440],"id":"00fb4ecc-2c2b-43c7-a5b0-3bc928404b03","name":"If23"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-976,1424],"id":"b350fa31-345e-420d-9213-4ccd1c603f30","name":"If26"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-624,1840],"id":"4b2323d7-ade6-4594-9192-1b4e2251a93b","name":"If27"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1248,1392],"typeVersion":1,"id":"ffa9ce31-0ae1-4e74-af8a-05d40968ab54","name":"Sticky Note2"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-752,1440],"id":"84b7f3b1-5259-47e9-976f-6a01df9ed583","name":"Wait","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-176,1648],"id":"acf88893-aecd-41e2-8a76-6b13efecaf2c","name":"If40"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[192,1856],"id":"324684bf-472a-4b17-a5fc-3b12d1f0e647","name":"If42"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1648],"id":"9da856cd-4d80-4b0d-84b5-9d412e3a3420","name":"Wait5","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1856],"id":"918310b1-c0da-46c2-80cf-8343bacd20a5","name":"Wait7","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[400,1872],"id":"30392c9c-d8a1-4a3a-8173-0ef149b4dadb","name":"Wait8","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-976,1600],"id":"3270bad6-15d8-4f71-a811-c3359fdab4e3","name":"Wait9","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[32,1664],"id":"e5ada578-5738-42b2-98f2-9c73991a85e8","name":"Wait10","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-608,1600],"id":"f693b423-1013-4d25-a66c-54422bfde206"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-2","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-784,1600],"id":"f2f64f92-df6b-4114-863d-2f5463a5bff7"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[0,1856],"id":"15cd3fea-5316-48c1-87b3-10b8b49c2919"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-3","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-176,1856],"id":"97e4385e-224d-4e1b-814b-55d7358b7f8e"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot34","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[720,1872],"id":"d96e4430-aea9-4374-b39b-75bec4c5b6dc"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-4","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[544,1872],"id":"d9dc6055-97c0-4412-8284-39dd78540a56"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot35","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[368,1664],"id":"e7946bf5-eb93-47a1-8f0a-788003fd3e1d"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-5","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[192,1664],"id":"b835a15f-edb3-45a2-b27b-a2905ade226f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot36","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-416,1440],"id":"97aa4aac-4a3b-4632-a2eb-32fe5486d166"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-6","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-592,1440],"id":"dd6f4397-190c-4511-84ba-a4ddb75136be"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":3},"conditions":[{"id":"b2a6d2d7-c61b-43ef-99fe-cc95d8413e94","leftValue":"={{ $json.body.conversation.messages[0].sender.phone_number }}","rightValue":51971119678,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-14480,592],"id":"65ea26bb-db5c-45f1-a288-c16501032d3c","name":"If5"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-14240,368],"id":"3b9693a6-6e3f-4174-9556-ba7477824248","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', ``, 'string') }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-13856,272],"id":"ff60e952-557a-4961-b575-24caf1329c1f","name":"pasar_supervisor","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $json.body.content }}\n\n","options":{"systemMessage":"=# üéØ ROL\nEres el Agente **Aura**. Tu √∫nica funci√≥n es extraer, **normalizar** y enviar un n√∫mero de tel√©fono a la tool \"pasar_supervisor\" El n√∫mero puede ser nacional (Per√∫) o extranjero, y debes procesarlo seg√∫n las reglas para que la tool reciba solo d√≠gitos.\n\n# üì• INPUT (Solicitud de Recepcionista)\nRecibir√°s una solicitud de la recepcionista para transferir un paciente.\nEl patr√≥n de la solicitud ser√° similar a: **Pasar a supervisor el n√∫mero: [N√∫mero variable]**\nEl n√∫mero puede llegar en formato completo (`519...`), solo el n√∫mero nacional (`9...`), o en formato internacional (`+1...`).\n\n# ‚öôÔ∏è INSTRUCCIONES ESTRICTAS (Funci√≥n sin Estado)\n\n1. Cada input es una solicitud √∫nica. Tu tarea finaliza con la ejecuci√≥n de la tool.\n\n2. **Identificaci√≥n:** Busca y extrae el n√∫mero que sigue inmediatamente al patr√≥n: **Pasar a supervisor el n√∫mero:** o **Manda a supervisor el n√∫mero**.\n\n3. **Normalizaci√≥n:** Antes de usar la tool, debes convertir el n√∫mero extra√≠do a un formato estandarizado de **solo d√≠gitos**, aplicando estas reglas en orden:\n    * **Limpieza:** Elimina todos los caracteres no num√©ricos (espacios, guiones, par√©ntesis, puntos, el signo `+`).\n    * **Normalizaci√≥n Per√∫ (9 d√≠gitos):** Si el n√∫mero tiene **9 d√≠gitos** y **no** comienza con `51`, asume que es un n√∫mero de Per√∫ y **precede** la cadena con `51`.\n    * **Normalizaci√≥n Internacional/Completo:** Si el n√∫mero comienza con `51` (11 d√≠gitos) o es cualquier otra longitud, √∫salo tal cual despu√©s de la limpieza.\n\n4. **Acci√≥n √önica:** Una vez extra√≠do y normalizado el n√∫mero, debes utilizar **exclusivamente** la tool **pasar_supervisor**.\n\n5. **Output:** Nunca respondas, expliques, ni devuelvas texto. Tu √∫nica acci√≥n es ejecutar la tool.\n\n### üìù EJEMPLO DE FLUJO DE TRABAJO\n\n| Input de la Recepcionista | L√≥gica de Normalizaci√≥n | Salida a la Tool |\n| :--- | :--- | :--- |\n| **Input 1 (Per√∫ Completo):** `Pasar a supervisor el n√∫mero: 51998765432` | N√∫mero original: `51998765432` (11 d√≠gitos). No requiere cambios. | `pasar_supervisor(51998765432)` |\n| **Input 2 (Internacional):** `Manda a supervisor el n√∫mero +1 (305) 417-1787` | Limpieza: `13054171787` (11 d√≠gitos). | `pasar_supervisor(13054171787)` |\n| **Input 3 (Per√∫ Corto):** `Manda a supervisor el n√∫mero 977571136` | 9 d√≠gitos. Se asume Per√∫. **Normaliza con 51**. | `pasar_supervisor(51977571136)` |\n\n## HERRAMIENTAS\n**Herramientas disponibles:** **pasar_supervisor**\n\n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-14256,192],"id":"ed307005-1e1d-4800-a494-8f1ee293347f","name":"supervisor"},{"parameters":{"workflowId":{"__rl":true,"value":"86itBT4QcMqbK21F","mode":"list","cachedResultUrl":"/workflow/86itBT4QcMqbK21F","cachedResultName":"[MANTENIMIENTO] Supwhatsapp"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('If19').item.json.body.conversation.messages[0].sender.phone_number }}","conversation_id":"={{ $('If19').item.json.body.conversation.messages[0].conversation_id }}","inbox_id":"={{ $('If19').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":[],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-14016,400],"id":"96b98de4-e095-42e3-83b8-8e9043aac552","name":"Call 'Supervisor healup'"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"Z1S8hBZOFvfBE7I5","mode":"list","cachedResultUrl":"/workflow/Z1S8hBZOFvfBE7I5","cachedResultName":"SUNAT | Enviar datos (General) | WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre', ``, 'string') }}","numero":"={{ $json.id }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},"matchingColumns":[],"schema":[{"id":"nombre","displayName":"nombre","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5664,752],"id":"39552a1a-a1b3-4538-a0c0-eefb20b529b8","name":"enviar_nombre"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    perfumes_full_size: [\n      \"9 pm\",\n      \"9 pm elixir\",\n      \"Aether extrait\",\n      \"Afeef Lattafa\",\n      \"Ajayeb Dubai\",\n      \"Ajwad pink to pink\",\n      \"Al Haramain Dubai Night\",\n      \"Al qiam golf\",\n      \"ALTHAIR PARFUMS de MARLY\",\n      \"Amber rouge\",\n      \"Amethyst\",\n      \"Amore caff√© Mancera\",\n      \"Aqua Dubai 100 ml\",\n      \"Art of nature II\",\n      \"Art of universe\",\n      \"Aruba gold\",\n      \"Atlas LATTAFA\",\n      \"Azzaro PARFUM\",\n      \"Azzaro the most wanted intense\",\n      \"Berry on top\",\n      \"Bharata chocolate\",\n      \"Bharata king EDP\",\n      \"Bharata king gold edition\",\n      \"Bharata Placid\",\n      \"BIANCO latte\",\n      \"CDN Intense man\",\n      \"CDN Sillage\",\n      \"CDN Urban Man Elixir\",\n      \"CDN woman\",\n      \"Champion goat\",\n      \"Champion money\",\n      \"Champion sugar\",\n      \"Chic Sonia\",\n      \"Choco overdose\",\n      \"Cloud Ariana grande\",\n      \"Club de nuit untold\",\n      \"Confidential\",\n      \"Cookie grave\",\n      \"Creed aventus\",\n      \"Creed millesime imperial\",\n      \"Creed silver mountain water\",\n      \"Decant\",\n      \"Diesel spirit\",\n      \"Eclaire\",\n      \"Eclaire banoffi\",\n      \"Eclaire pistache\",\n      \"EMEER\",\n      \"Erba gold\",\n      \"Erba pura\",\n      \"Fahkar Rose\",\n      \"Fakhar black\",\n      \"Fakhar gold\",\n      \"Fire on ice\",\n      \"GOS Blind bid\",\n      \"Gos bonus\",\n      \"GOS Boston\",\n      \"GOS Diamond\",\n      \"Gos Esmerald\",\n      \"GOS Full House\",\n      \"GOS Jackpot\",\n      \"GOS Moon\",\n      \"Gos no limit\",\n      \"GOS platinium\",\n      \"GOS Rouge\",\n      \"GOS Royale\",\n      \"GOS Wildcard\",\n      \"GOS Yellow Saphire\",\n      \"Haramain amber oud gold edition\",\n      \"HAWAS ice\",\n      \"Hawas malibu\",\n      \"Hayaati florence\",\n      \"Hayaati lataffa\",\n      \"Her confession\",\n      \"His Confession\",\n      \"Honor and glory\",\n      \"Invictus Parfum\",\n      \"INVICTUS VICTORY ELIXIR\",\n      \"Ishq al shuyukh silver\",\n      \"Island Khadlaj\",\n      \"Jean lowe azure\",\n      \"Jean lowe inmortel\",\n      \"JPG Le beau le parfum 120ml\",\n      \"JPG Le Male elixir 125ml\",\n      \"JPG LE MALE LE PARFUM\",\n      \"JPG Paradise Garden 125ml\",\n      \"Khamrah\",\n      \"Khamrah Dukhan\",\n      \"Kirk√© Tiziana Terenzi\",\n      \"Lataffa Ameer\",\n      \"Lattafa dynasty\",\n      \"LAYTON PARFUMS de MARLY\",\n      \"Mancera cedrat boise\",\n      \"Mancera coco vanille\",\n      \"Mancera Instant Crush\",\n      \"Mancera Red tobaco\",\n      \"Mandar√≠n elixir\",\n      \"Milestone\",\n      \"Montale Arabians Tonka\",\n      \"M√≥ntale intense caf√©\",\n      \"Nautica voyage\",\n      \"Naxos\",\n      \"Nitro Red\",\n      \"Nitro White\",\n      \"Noble blush\",\n      \"Now white\",\n      \"Now women\",\n      \"Odyssey artisto\",\n      \"Odyssey bahamas\",\n      \"Odyssey black forest\",\n      \"Odyssey Candee\",\n      \"Odyssey Eau de Montagne\",\n      \"Odyssey go mango\",\n      \"Odyssey Homme black EDP\",\n      \"Odyssey Homme white edition\",\n      \"Odyssey Limoni\",\n      \"Odyssey Mandarin sky\",\n      \"Odyssey mega edp\",\n      \"Odyssey revolution\",\n      \"Odyssey Spectra\",\n      \"Odyssey spectra blue\",\n      \"Odyssey toffe coffe\",\n      \"Odyssey Tyrant\",\n      \"Odyssey wild one\",\n      \"Orientica royal amber\",\n      \"Orientica Velvet Gold\",\n      \"OUD FOR GLORY\",\n      \"Qaed unlimited\",\n      \"Rave Now\",\n      \"Rayhaan Elixir\",\n      \"Rome Imagine\",\n      \"Rome paradox\",\n      \"Scandal intense\",\n      \"Scandal le parfum\",\n      \"Sehr\",\n      \"Shaheen\",\n      \"So candid\",\n      \"Spectre Malachite\",\n      \"Spectre wraith\",\n      \"Stronger with you intensly\",\n      \"Summer hammer/Lorenzo Pazzaglia\",\n      \"Sun-gria\",\n      \"Teriaq intense\",\n      \"Tharwah gold\",\n      \"The Kingdom\",\n      \"Turathi\",\n      \"Turathi Electric\",\n      \"Valentino born in Roma intense\",\n      \"Veneno\",\n      \"Versace Eros flame\",\n      \"Versace eros parfum\",\n      \"Vintage Radio\",\n      \"Winners trophy\",\n      \"Yara elixir\",\n      \"Yara lataffa\",\n      \"Yara Moi\",\n      \"Yara tous\",\n      \"Yves Saint Laurent Y EDP\"\n    ],\n\n    decants: [\n      \"BHARARA KING EDP\",\n      \"LATTAFA PRIDE PISA\",\n      \"HARANA\",\n      \"21:00:00\",\n      \"EJAAZI\",\n      \"CDN SILLAGE\",\n      \"GOS MOON\",\n      \"MANDARIN SKY\",\n      \"NAUTICA VOYAGE\",\n      \"ROYAL BLEU\",\n      \"ODYSSEY WHITE\",\n      \"JEAN LOWE MATIERE\",\n      \"SUBLIME\",\n      \"GOS ROUGE\",\n      \"9 PM REBEL\",\n      \"KHAMRAH\",\n      \"GOS YELLOW SAPPHIRE\",\n      \"GOS BOSTON\",\n      \"ASAD\",\n      \"TURATHI BLUE\",\n      \"CND SILLAGE\",\n      \"GOS ROYALE\",\n      \"OUD FOR GLORY\",\n      \"AL HARAMAIN GOLD EXTREME\",\n      \"ODYSSEY AOUD\",\n      \"VLO\",\n      \"EMEER\",\n      \"ISSEY MIYAKE\",\n      \"ODYSSEY TYRANT\",\n      \"ASAD ZANZIBAR\",\n      \"GOS BID\",\n      \"9AM\",\n      \"HAWAS ICE\",\n      \"GOS WILDCARD\",\n      \"YARA MOI\",\n      \"VENTANA ARMAF\",\n      \"CDN IMP√âRIALE\",\n      \"AL NASHAMA CAPRICE\",\n      \"YARA\",\n      \"BHARARA BLEU\",\n      \"GOS BLIND BID\",\n      \"GOS ACE\",\n      \"CDN MILESTONE\",\n      \"DETOUR NOIR\",\n      \"RAED LUXE\",\n      \"QAED UNLIMITED\",\n      \"AI HARAMAIN RUBY EDITION\",\n      \"HAWAS BLACK\",\n      \"HAYAATI\",\n      \"ODYSSEY HOMME BLACK\",\n      \"CDN URBAN MAN ELIXIR\",\n      \"CDN UNTOLD\",\n      \"MAAHIR LEGACY\",\n      \"LEGEND SPIRIT\",\n      \"SHAHEEN GOLD\",\n      \"YARA TOUS\",\n      \"FAKHAR ROSE\",\n      \"HONOR AND GLORY\",\n      \"DUBAI NIGHT\",\n      \"BHARARA KING PARFUM\",\n      \"LATTAFA JASOOR\",\n      \"GOS GOLD\",\n      \"CDN INTENSE MAN\",\n      \"GOS FULL HOUSE\",\n      \"ODYSSEY AQUA\",\n      \"HAYAATI AL MALEKY\",\n      \"GOS WIN\",\n      \"FAKHAR BLACK\",\n      \"GOS DIAMOND\",\n      \"KHAMRAH QAHWA\",\n      \"GOS HIGH ROLLER\",\n      \"THE KINGDOM\",\n      \"ODYSSEY MEGA\",\n      \"HAWAS FOR HIM\",\n      \"LATTAFA NEBRAS\",\n      \"AI HARAMAIN GOLD EDITION\",\n      \"AJWAD\",\n      \"RAVE NOW WHITE\",\n      \"ODYSSEY CANDEE\",\n      \"ODYSSEY SPECTRA\",\n      \"YARA CANDY\",\n      \"ODYSSEY LIMONI\",\n      \"AMBER ROUGE\",\n      \"SCEPTRE MALACHITE\",\n      \"VIKING KASHMIR\",\n      \"AI HARAMAIN PRIVATE EDITION\",\n      \"QAED AI FURSAN\",\n      \"GOS JACKPOT\",\n      \"VIKING DUBAI\",\n      \"ROYAL AMBER\",\n      \"BHARARA KING GOLD EDITION\",\n      \"HIS CONFESSION\",\n      \"VIKING CAIRO\",\n      \"BHARARA ELEGANCE\",\n      \"BHARARA PHARAOH 1\",\n      \"BHARARA PHARAOH 2\",\n      \"MAYAR\",\n      \"CLUB DE NUIT PRECIEUX\",\n      \"HER CONFESSION\",\n      \"AMETHYST LATTAFA\",\n      \"LATTAFA TERIAQ\",\n      \"AI HARAMAIN AQUA DUBAI\",\n      \"ASAD BOURBON\",\n      \"NITRO WHITE\",\n      \"LIQUID BURN\",\n      \"NITRO RED\",\n      \"NOBLE BLUSH\",\n      \"LATTAFA SEHR\",\n      \"ISLAND BLISS\",\n      \"LATTAFA ECLAIRE\",\n      \"AL HARAMAIN ROYAL MUSK\",\n      \"SUQRAAT\",\n      \"ISHQ AL SHUYUKH\",\n      \"LIAM BLUE\",\n      \"DUBAI CHOCOLAT\",\n      \"BHARARA CHOCOLATE\",\n      \"HAYA\",\n      \"ISHQ AL SHUYUKH GOLD\",\n      \"ANSAAM SILVER\",\n      \"VINTAGE RADIO\",\n      \"BHARARA ENCHANTED\",\n      \"GOS OPAL\",\n      \"ART OF UNIVERSE\",\n      \"LATTAFA CHIC\",\n      \"HAWAS ELIXIR\",\n      \"HAYA CRUSH\",\n      \"JEAN LOWE AZURE\",\n      \"ROME POUR HOMME\",\n      \"HAYAATI FLORENCE\",\n      \"VELVET GOLD\",\n      \"AJWAD PINK TO PINK\",\n      \"AL QIAM GOLD\",\n      \"ANGHAM LATTAFA\",\n      \"ARABIAN SKY\",\n      \"TAG UOMO ROSSO\",\n      \"TAG ART OF NATURE II\",\n      \"BHARARA PLACID\",\n      \"BHARARA SOLEIL\",\n      \"CDN WOMAN\",\n      \"CDN ICONIC\",\n      \"CONFIDENTIAL PRIVATE GOLD\",\n      \"DELILAH\",\n      \"GOS PLATINIUM OF SPADES\",\n      \"INTIMATION\",\n      \"ISLAND KHADLAJ\",\n      \"JEAN LOWE INMORTEL\",\n      \"JEAN LOWE VIBE\",\n      \"WINNERS TROPHY\",\n      \"KHANJAR EAU DE PARFUM\",\n      \"KISMET MAGIC\",\n      \"MANDARIN SKY ELIXIR\",\n      \"MAYAR CHERRY INTENSE\",\n      \"NITRO RED INTENSELY\",\n      \"NITRO NOW WOMEN\",\n      \"ODYSSEY ARTISTO\",\n      \"ODYSSEY WILD ONE\",\n      \"RAVE NOW RAYHAAN ELIXIR\",\n      \"NOW\",\n      \"SAKEENA\",\n      \"SO CANDID\",\n      \"TARWAH GOLD\",\n      \"LATTAFA TERIAQ INTENSE\",\n      \"VICTORIA LATTAFA\",\n      \"YUM YUM ARMAF\",\n      \"QISSA DELICIOUS\",\n      \"HAWAS TROPICAL\",\n      \"HAWAS FIRE\",\n      \"FAKHAR PLATIN\",\n      \"KHAMARAH DUKHAN\",\n      \"ODYSSEY EAU DE MONTAGNE\",\n      \"ODYSSEY REVOLUTION\",\n      \"ROME IMAGINE\",\n      \"TURATHI ELECTRIC\",\n      \"VULCAN NUE\",\n      \"SPECTRE WRAITH\",\n      \"GOS EMERALD OF SPADES\",\n      \"AFEEF\",\n      \"BHARARA ONYX\",\n      \"SCEPTRE DESERT\",\n      \"NITRO NEITHE\",\n      \"ODYSSEY BLACK FOREST\",\n      \"ODYSSEY TOFFEE COFFEE\",\n      \"ODYSSEY BAHAMAS\",\n      \"ODYSSEY MANGO\",\n      \"NITRO ELIXIR\",\n      \"ROME PARADOXE\",\n      \"ROME YUM YUM\",\n      \"ECLAIRE PISTACHE\",\n      \"ECLAIRE BANOFFEE\",\n      \"9PM ELIXIR\",\n      \"HAWAS MALIBU\",\n      \"HAWAS KOBRA\",\n      \"GOS BONUS DYNASTY FIRE\",\n      \"ON CIE\",\n      \"LOVELY CHERIE\"\n    ],\n\n    set_perfumes: [\n      \"Gos set\",\n      \"GOS Set 3 piezas jo milano\",\n      \"Set 9pm\",\n      \"Set art of universe\",\n      \"Set mandar√≠n\",\n      \"SET VERSACE NECESER + PERFUME + DECANT\",\n      \"Set YARA\",\n      \"Set Zadig & Voltaire this is her\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4736,416],"id":"8e853398-c1fd-4a9a-9894-11607d7d0832","name":"informacion_productos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"# ROL: \nEres un agente t√©cnico especializado en la verificaci√≥n de existencias y precios del cat√°logo de Brada Perfumes. Tu √∫nico objetivo es recibir nombres de perfumes, identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input y consultar la tool stock1 para obtener datos reales.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Productos: Los nombres de los perfumes en el input siempre vendr√°n entre comillas (ej. \"9 PM\", \"Hawas Ice\") para evitar confusi√≥n con el resto del mensaje.\nUso de la Tool stock1:\nDebes ejecutar la tool enviando el nombre exacto del perfume identificado en la variable perfume.\nSi el input contiene m√∫ltiples perfumes, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes mantener el nombre del perfume exactamente igual a como aparece en el cat√°logo, corrigiendo solo errores ortogr√°ficos evidentes seg√∫n tu conocimiento general.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo perfume\nVariable disponibilidad: Si la tool indica que el producto est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre de perfume): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s perfumes\nDebes listar cada perfume en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n# EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"Hola, revisa la disponibilidad de \"9 PM\" y \"Hawas Ice\".\"\nProceso interno:\nLlamada 1: stock1(perfume=\"9 PM\") -> Resultado: Disponible, S/ 140.\nLlamada 2: stock1(perfume=\"Hawas Ice\") -> Resultado: Agotado, S/ 180.\nOutput que debes enviar si son dos o m√°s perfumes: 9 PM: stock si y precio 140 soles. Hawas Ice: stock no y precio 180 soles.\n#NOTAS ADICIONALES\nNo inventes precios ni estados de stock.\nSi la tool no devuelve informaci√≥n para un nombre espec√≠fico, indica: (Nombre de perfume): stock no y precio (No disponible).\nTu respuesta debe ser exclusivamente la lista de stock solicitada, sin saludos ni despedidas adicionales\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5312,608],"id":"64458501-a4f8-45c4-aae9-17b34719c27a","name":"stock_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    \"distritos_permitidos\": [\n      \"Anc√≥n\", \"Ate\", \"Barranco\", \"Bre√±a\", \"Carabayllo\", \"Chaclacayo\", \n      \"Chorrillos\", \"Cieneguilla\", \"Comas\", \"El Agustino\", \"Independencia\", \n      \"Jes√∫s Mar√≠a\", \"La Molina\", \"La Victoria\", \"Lima\", \"Lince\", \n      \"Los Olivos\", \"Lurigancho\", \"Lur√≠n\", \"Magdalena del Mar\", \"Miraflores\", \n      \"Pachac√°mac\", \"Pucusana\", \"Pueblo Libre\", \"Puente Piedra\", \n      \"Punta Hermosa\", \"Punta Negra\", \"R√≠mac\", \"San Bartolo\", \"San Borja\", \n      \"San Isidro\", \"San Juan de Lurigancho\", \"San Juan de Miraflores\", \n      \"San Luis\", \"San Mart√≠n de Porres\", \"San Miguel\", \"Santa Anita\", \n      \"Santa Mar√≠a del Mar\", \"Santa Rosa\", \"Santiago de Surco\", \"Surquillo\", \n      \"Villa El Salvador\", \"Villa Mar√≠a del Triunfo\", \"Callao\", \"Bellavista\", \n      \"Carmen de la Legua Reynoso\", \"La Perla\", \"La Punta\", \"Ventanilla\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4432,400],"id":"09ca4414-ae98-4efb-aaa7-b0a7d4b68b45","name":"distritos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente especializado exclusivamente en la verificaci√≥n de existencias y precios de Decants (presentaciones de 5ml y 10ml) de Brada Perfumes. Tu objetivo es recibir el input del agente principal, identificar los perfumes y sus medidas, y consultar la tool stock_decants para devolver datos precisos.\n# INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Medidas: Debes prestar especial atenci√≥n a la cantidad solicitada (5ml o 10ml). Si el cliente no especifica la medida pero el contexto indica que es un decant, consulta ambas presentaciones.\nUso de la Tool stock_decants:\nDebes ejecutar la tool enviando el nombre del perfume y la medida identificada.\nSi el input contiene m√∫ltiples decants (ej. \"9 PM de 5ml y Hawas de 10ml\"), debes realizar una ejecuci√≥n de la tool por cada producto/medida individualmente.\nMantenimiento de Nomenclatura: Mant√©n el nombre t√©cnico del perfume (ej. \"Club de Nuit Intense\" en lugar de \"cnit\") seg√∫n la lista maestra.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato basado en los datos de la tool:\nCASO 1: Un solo decant\nVariable disponibilidad: Si la tool indica existencias, utiliza \"si\". Si no hay, utiliza \"no\".\nFormato de salida: (Nombre de perfume) ([Medida]): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s decants\nDebes listar cada decant en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad de decants: \"9 PM\" en 5ml y \"Hawas Ice\" en 10ml.\"\nProceso interno:\nLlamada 1: stock_decants(perfume=\"9 PM\", medida=\"5ml\") -> Resultado: Disponible, S/ 35.\nLlamada 2: stock_decants(perfume=\"Hawas Ice\", medida=\"10ml\") -> Resultado: Agotado, S/ 45.\nOutput (Lo que respondes): 9 PM (5ml): stock si y precio 35 soles. Hawas Ice (10ml): stock no y precio 45 soles.\n#REGLAS DE ORO\nProhibici√≥n de Inventar: No inventes precios. Si la tool no devuelve un precio para una medida espec√≠fica, responde: (Nombre de perfume) ([Medida]): stock no y precio (No disponible).\nExclusividad: Tu respuesta debe contener √∫nicamente la lista t√©cnica. No incluyas saludos, recomendaciones, ni frases de cierre.\nPrecisi√≥n de Medida: Aseg√∫rate de que el precio corresponda exactamente a la medida solicitada (un perfume de 10ml siempre es m√°s caro que uno de 5ml).\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5024,608],"id":"edf1ea9c-753a-4178-8823-ad4b5d276fde","name":"stock_decants"},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-4752,880],"id":"c65b6d98-6ca9-4850-a240-dc15d0e6f244","name":"OpenAI Chat Model5","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5008,880],"id":"f40c83eb-7af9-43d9-9718-23906d503917","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5328,848],"id":"4682821d-4ee5-4aa0-bfa8-6ee52c2d74b9","name":"OpenAI Chat Model6","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfumes","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-5168,816],"id":"db9c5a3b-41f0-489b-95b8-1818ea40b41b","name":"stock1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_decants","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4880,832],"id":"cca318d1-6e33-42b3-9253-f90ae5034239","name":"stock2","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfume_sets","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4592,880],"id":"6150c4ba-6b03-4325-b902-35091b0ac31b","name":"stock3","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente t√©cnico especializado exclusivamente en la verificaci√≥n de existencias y precios de los Sets de Perfumes (estuches de regalo o packs con complementos) de Brada Perfumes. Tu misi√≥n es recibir el nombre del set, validarlo contra la tool stock_set_perfumes y devolver la disponibilidad y precio real.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Sets: Los nombres de los sets suelen incluir la palabra \"Set\" (ej. \"Set Yara\", \"Set 9 PM\"). Debes identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input.\nUso de la Tool stock_set_perfumes:\nDebes ejecutar la tool enviando el nombre exacto del set en la variable nombre_set.\nSi el input contiene m√∫ltiples sets, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes respetar el nombre del set tal como aparece en el cat√°logo oficial de Brada Perfumes, asegur√°ndote de que se trate de la presentaci√≥n en estuche y no de la botella individual.\n#L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo Set\nVariable disponibilidad: Si la tool indica que el set est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre del Set): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s Sets\nDebes listar cada set en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad del SET: \"Set Yara\" y \"Set Art of Universe\".\"\nProceso interno:\nLlamada 1: stock_set_perfumes(nombre_set=\"Set Yara\") -> Resultado: Disponible, S/ 210.\nLlamada 2: stock_set_perfumes(nombre_set=\"Set Art of Universe\") -> Resultado: Disponible, S/ 250.\nOutput (Lo que respondes): Set Yara: stock si y precio 210 soles. Set Art of Universe: stock si y precio 250 soles.\n#REGLAS DE ORO\nPrecisi√≥n: No confundas un \"Perfume Full Size\" con un \"Set\". Si el input pide un Set, busca √∫nicamente en la categor√≠a de sets.\nProhibici√≥n de Inventar: No inventes precios ni disponibilidad. Si la tool no devuelve informaci√≥n para un set espec√≠fico, indica: (Nombre del Set): stock no y precio (No disponible).\nMinimalismo: Tu respuesta debe ser exclusivamente la lista t√©cnica solicitada. No incluyas saludos, despedidas ni comentarios sobre el contenido del set.\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-4736,656],"id":"6344ee20-9fcb-45bd-a342-5aaf79248763","name":"stock_set_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"bFX818cxJebYkS92","mode":"list","cachedResultUrl":"/workflow/bFX818cxJebYkS92","cachedResultName":"BRADA | WHATSAPP | compras confirmadas"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-4544,448],"id":"42a85e30-dd9d-47c7-af24-3eace4616f6f","name":"confirmacion_pedidos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1840,2160],"id":"86511a06-e0d8-496b-9161-edd28ac48fe2","name":"If24"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1632,2144],"id":"f6ed93e7-cd4c-4547-9b7c-9f3a9bd6174a","name":"If28"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1280,2560],"id":"6532091a-4da7-484e-bc59-551caaf8837a","name":"If29"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1904,2112],"typeVersion":1,"id":"4b346085-38b5-41dc-aa4e-0e5fd0d63b15","name":"Sticky Note3"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1408,2160],"id":"60a486b8-d8b9-45f7-bcc2-0237d9dacb35","name":"Wait1","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-832,2368],"id":"aec693f3-d181-42f6-96ef-f4259257f242","name":"If41"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-464,2576],"id":"d0bce6d9-8944-4f36-8369-887245578174","name":"If43"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2368],"id":"920f0b3f-260f-4a46-8f84-c7fafcb4e42d","name":"Wait11","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2576],"id":"9445a338-fa59-4652-b7a7-042da4ab0166","name":"Wait12","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-256,2592],"id":"1b4c198d-a84a-4886-bfee-45e03505844a","name":"Wait13","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1632,2320],"id":"985412b0-18a0-4a74-9383-848361eecf6d","name":"Wait14","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-624,2384],"id":"0b01e43e-8f88-4806-9aa3-aaafae23afa5","name":"Wait15","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1264,2320],"id":"455fc9a5-d692-424b-96af-4dc9dfb5ecfa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1440,2320],"id":"43ef0c39-d3b6-4ed3-9bbe-55b60f80b5a4"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-656,2576],"id":"71901a37-3c10-48e0-8c0d-ea488faf670e"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-7","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-832,2576],"id":"94b90b7c-2489-43c2-b38d-5f1d9ed48958"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot37","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[64,2592],"id":"70f90af3-d2d6-42bb-bbed-2a460fc13eb2"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-8","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-112,2592],"id":"79b9eee3-c9f3-43cc-945b-a659df940b42"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot38","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-288,2384],"id":"377a6011-2a90-4508-ad7a-18e8be515097"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-9","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-464,2384],"id":"4736c49f-51b0-433c-acaf-c5ec1975c27f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot39","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1072,2160],"id":"a211f2a4-e5b1-4b1b-b198-ecee0d6bdf3a"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-10","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1248,2160],"id":"e7fcf0ac-d57f-498d-84c2-efc72cefbb9c"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[336,720],"id":"2aaf0e50-945f-404a-a630-6c934c4bf678","name":"If25"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[544,704],"id":"db6e3976-9c81-410c-a089-cbbffed9a498","name":"If30"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[896,1120],"id":"3d9b40b9-6eb5-4641-9243-4acb6bbaab90","name":"If31"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[272,672],"typeVersion":1,"id":"9d6dc394-e9c9-47cf-bb8b-3ec6e169cd24","name":"Sticky Note4"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[768,720],"id":"e193f0ff-9818-4fff-ab4c-87a07ea2bc57","name":"Wait16","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1344,928],"id":"70a6f8d6-3ef1-45ad-be33-45e51b8b5bf7","name":"If44"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1712,1136],"id":"46e4e9c0-d629-4cae-a016-78122838bf5c","name":"If45"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,928],"id":"9005e0a0-7928-4432-afba-ecca82410842","name":"Wait17","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,1136],"id":"26654f8d-1377-49f2-b4ba-feefd58f29f5","name":"Wait18","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1920,1152],"id":"e5e9d5a8-676d-4787-ad0c-57a9cecb51e6","name":"Wait19","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[544,880],"id":"0a2148fa-6d21-4cef-85c9-2f9f7747051b","name":"Wait20","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1552,944],"id":"24a50f49-9fa7-444a-889d-b0a47dcdca22","name":"Wait21","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[912,880],"id":"73a2a9cb-96fa-4c67-b2c0-855467476004"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-11","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[736,880],"id":"2a355cf5-4023-4e5c-94cd-fb54d20ab48d"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot21","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1520,1136],"id":"e4e81844-daec-44fa-87e1-8a40c9f593e1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-12","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1344,1136],"id":"124b0253-10a5-4f3f-8b46-7e729f639b4b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot40","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2240,1152],"id":"d7a77253-dcf2-4e33-9699-ace3f5cf9843"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-13","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2064,1152],"id":"47d740d9-af91-4b47-a3d9-43f6089948ac"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot41","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1888,944],"id":"ba55a9c2-6648-4009-9d21-cbad56eea3fa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-14","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1712,944],"id":"09553178-8112-4313-b41f-7edb86da9bb2"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot42","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1104,720],"id":"a287f371-7d38-4b62-96ac-80a54a0f4a85"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-15","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[928,720],"id":"5a670fc0-4c1b-45d5-bf03-f2cce3d56697"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-144,0],"id":"21286fd2-eb14-4621-961c-daf1710c98db","name":"If32"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[64,-16],"id":"9298649c-49d2-4ef9-a38d-d1ecd699741a","name":"If33"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[416,400],"id":"0335f432-f2cb-43bf-9855-8b773b8fd74f","name":"If34"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-208,-48],"typeVersion":1,"id":"f7db0934-d8a5-4643-8ea5-3b74f9fd30ff","name":"Sticky Note5"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[288,0],"id":"edc5d3e6-6cb7-4e24-a395-5bfd2ec21e8f","name":"Wait22","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[864,208],"id":"3d08713e-6783-4344-835a-52021892fc79","name":"If46"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1232,416],"id":"a3ff7975-1b42-4ee2-8d28-a9e2530627ea","name":"If47"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,208],"id":"050e27ee-0dc9-4cfe-9b3b-4984fdb3c424","name":"Wait23","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,416],"id":"316376c3-954b-4325-ab08-caadfb880e67","name":"Wait24","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1440,432],"id":"cfc28de1-e1fa-4583-80c7-4806a6cd7ad1","name":"Wait25","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[64,160],"id":"e8d0be90-195b-413a-b96d-28c469da7d2a","name":"Wait26","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1072,224],"id":"83b77384-ab0f-442c-aa8e-20cbf18ba56b","name":"Wait27","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot22","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[432,160],"id":"91fe9d8e-e24c-4675-9a65-5c3b96805cd1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[256,160],"id":"b2aa295f-bb56-4faf-bc6e-2c244ae1b8b5"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot23","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1040,416],"id":"42af2c54-fd06-4e53-9b3e-386ae18aad48"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[864,416],"id":"334d03f2-3acd-4c43-9e5c-e5c9ec1fab6b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot43","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1760,432],"id":"a10b0be7-7ad4-4a67-b580-1f6c8f63dd0b"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1584,432],"id":"3ae52091-798e-4106-ad81-b391a548b061"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot44","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1408,224],"id":"634d84c9-0fb9-4dc6-a691-70a9eb6eaff6"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1232,224],"id":"4c0fbfdd-c75a-4058-9fb3-c934f00a1774"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot45","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[624,0],"id":"c8374285-c938-46a3-ab3d-a8987b53dafe"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[448,0],"id":"8a5f2626-93c0-485f-83b6-88d1b7969f67"}],"connections":{"AI Agent":{"main":[[{"node":"Verificador1","type":"main","index":0}]]},"Auto-fixing Output Parser1":{"ai_outputParser":[[{"node":"Verificador1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model8":{"ai_languageModel":[[{"node":"Auto-fixing Output Parser1","type":"ai_languageModel","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"Auto-fixing Output Parser1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model9":{"ai_languageModel":[[{"node":"Verificador1","type":"ai_languageModel","index":0}]]},"Verificador1":{"main":[[{"node":"ordenar","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Get a row3","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"If2":{"main":[[{"node":"Update a row1","type":"main","index":0}],[{"node":"If3","type":"main","index":0}]]},"If3":{"main":[[{"node":"Switch3","type":"main","index":0}],[{"node":"No Operation, do nothing4","type":"main","index":0}]]},"Edit Fields4":{"main":[[{"node":"If2","type":"main","index":0}]]},"If13":{"main":[[{"node":"Get a row1","type":"main","index":0}],[{"node":"Create a row","type":"main","index":0}]]},"Calendario":{"ai_tool":[[]]},"Create a row":{"main":[[{"node":"Get a row1","type":"main","index":0}]]},"Get a row1":{"main":[[{"node":"Edit Fields4","type":"main","index":0}]]},"Update a row1":{"main":[[{"node":"Switch3","type":"main","index":0}]]},"Get a row":{"main":[[{"node":"If13","type":"main","index":0}]]},"If4":{"main":[[{"node":"If11","type":"main","index":0}],[{"node":"Fecha","type":"main","index":0}]]},"Formatea fecha":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Handler variables":{"main":[[{"node":"If10","type":"main","index":0}]]},"Fecha":{"main":[[{"node":"Formatea fecha","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Handler variables","type":"main","index":0}]]},"Wait6":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"If6":{"main":[[{"node":"Redis1","type":"main","index":0}],[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"Delete Redis":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Edit Fields19":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"Get Redis1":{"main":[[{"node":"If6","type":"main","index":0}]]},"Edit Fields20":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"If15":{"main":[[{"node":"Edit Fields19","type":"main","index":0}],[{"node":"Edit Fields20","type":"main","index":0}]]},"METER_ANUNCIO":{"main":[[{"node":"guarda_ANUNCIO","type":"main","index":0}]]},"BAJAR_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"guarda_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"If":{"main":[[{"node":"RESUMIDOR ANUNCIOS","type":"main","index":0}],[{"node":"If4","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"RESUMIDOR ANUNCIOS","type":"ai_languageModel","index":0}]]},"If10":{"main":[[{"node":"METER_ANUNCIO","type":"main","index":0}],[{"node":"BAJAR_ANUNCIO","type":"main","index":0}]]},"Redis1":{"main":[[{"node":"If15","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"If16","type":"main","index":0}]]},"Edit Fields12":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"AUDIO1","type":"main","index":0}]]},"Switch3":{"main":[[{"node":"HTTP Request","type":"main","index":0}],[{"node":"OpenAI","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}]]},"AUDIO1":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"If16":{"main":[[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields12","type":"main","index":0}]]},"Edit Fields17":{"main":[[{"node":"If","type":"main","index":0}]]},"If11":{"main":[[{"node":"Update a row4","type":"main","index":0}]]},"If12":{"main":[[{"node":"Get a row","type":"main","index":0}],[{"node":"If20","type":"main","index":0}]]},"If20":{"main":[[{"node":"Update a row6","type":"main","index":0}]]},"If1":{"main":[[{"node":"If12","type":"main","index":0}]]},"ordenar":{"main":[[{"node":"Respuesta1","type":"main","index":0}]]},"Respuesta1":{"main":[[{"node":"Update a row","type":"main","index":0}]]},"Wait2":{"main":[[{"node":"Respuesta2","type":"main","index":0}]]},"Respuesta2":{"main":[[{"node":"Update a row3","type":"main","index":0}]]},"If14":{"main":[[{"node":"Wait3","type":"main","index":0}],[{"node":"If23","type":"main","index":0}]]},"Wait3":{"main":[[{"node":"Respuesta3","type":"main","index":0}]]},"Respuesta3":{"main":[[{"node":"Update a row5","type":"main","index":0}]]},"If17":{"main":[[{"node":"Wait4","type":"main","index":0}],[{"node":"If32","type":"main","index":0}]]},"Wait4":{"main":[[{"node":"Respuesta4","type":"main","index":0}]]},"Respuesta4":{"main":[[{"node":"Update a row7","type":"main","index":0}]]},"RESUMIDOR ANUNCIOS":{"main":[[{"node":"If4","type":"main","index":0}]]},"Supervisor":{"ai_tool":[[]]},"Update a row":{"main":[[{"node":"If8","type":"main","index":0}]]},"Update a row3":{"main":[[{"node":"If14","type":"main","index":0}]]},"Update a row5":{"main":[[{"node":"If17","type":"main","index":0}]]},"Get a row3":{"main":[[{"node":"If19","type":"main","index":0}]]},"If19":{"main":[[{"node":"If5","type":"main","index":0}]]},"Update a row7":{"main":[[{"node":"If25","type":"main","index":0}]]},"If7":{"main":[[{"node":"Update a row9","type":"main","index":0}],[{"node":"Create a row1","type":"main","index":0}]]},"Get a row2":{"main":[[{"node":"If7","type":"main","index":0}]]},"Create a row1":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"RAZONADOR PLUS":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Update a row9":{"main":[[{"node":"Wait6","type":"main","index":0}]]},"1. Descargar Imagen":{"main":[[{"node":"2. Enviar a Chatwoot","type":"main","index":0}]]},"If8":{"main":[[{"node":"Wait2","type":"main","index":0}],[{"node":"If24","type":"main","index":0}]]},"If23":{"main":[[{"node":"If26","type":"main","index":0}],[{"node":"Wait9","type":"main","index":0}]]},"If26":{"main":[[],[{"node":"Wait","type":"main","index":0}]]},"If27":{"main":[[{"node":"Wait5","type":"main","index":0}],[{"node":"Wait7","type":"main","index":0}]]},"Wait":{"main":[[{"node":"1. Descargar Imagen 1-6","type":"main","index":0}]]},"If40":{"main":[[],[{"node":"Wait10","type":"main","index":0}]]},"If42":{"main":[[],[{"node":"Wait8","type":"main","index":0}]]},"Wait5":{"main":[[{"node":"If40","type":"main","index":0}]]},"Wait7":{"main":[[{"node":"1. Descargar Imagen 1-3","type":"main","index":0}]]},"Wait8":{"main":[[{"node":"1. Descargar Imagen 1-4","type":"main","index":0}]]},"Wait9":{"main":[[{"node":"1. Descargar Imagen 1-2","type":"main","index":0}]]},"Wait10":{"main":[[{"node":"1. Descargar Imagen 1-5","type":"main","index":0}]]},"2. Enviar a Chatwoot16":{"main":[[{"node":"If27","type":"main","index":0}]]},"1. Descargar Imagen 1-2":{"main":[[{"node":"2. Enviar a Chatwoot16","type":"main","index":0}]]},"2. Enviar a Chatwoot19":{"main":[[{"node":"If42","type":"main","index":0}]]},"1. Descargar Imagen 1-3":{"main":[[{"node":"2. Enviar a Chatwoot19","type":"main","index":0}]]},"1. Descargar Imagen 1-4":{"main":[[{"node":"2. Enviar a Chatwoot34","type":"main","index":0}]]},"1. Descargar Imagen 1-5":{"main":[[{"node":"2. Enviar a Chatwoot35","type":"main","index":0}]]},"1. Descargar Imagen 1-6":{"main":[[{"node":"2. Enviar a Chatwoot36","type":"main","index":0}]]},"If5":{"main":[[{"node":"supervisor","type":"main","index":0}],[{"node":"If1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"supervisor","type":"ai_languageModel","index":0}]]},"pasar_supervisor":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"Call 'Supervisor healup'":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"enviar_nombre":{"ai_tool":[[]]},"informacion_productos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"distritos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_decants":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model5":{"ai_languageModel":[[{"node":"stock_set_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model6":{"ai_languageModel":[[{"node":"stock_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"stock_decants","type":"ai_languageModel","index":0}]]},"stock1":{"ai_tool":[[{"node":"stock_perfumes","type":"ai_tool","index":0}]]},"stock2":{"ai_tool":[[{"node":"stock_decants","type":"ai_tool","index":0}]]},"stock3":{"ai_tool":[[{"node":"stock_set_perfumes","type":"ai_tool","index":0}]]},"stock_set_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"confirmacion_pedidos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"If24":{"main":[[{"node":"If28","type":"main","index":0}],[{"node":"Wait14","type":"main","index":0}]]},"If28":{"main":[[],[{"node":"Wait1","type":"main","index":0}]]},"If29":{"main":[[{"node":"Wait11","type":"main","index":0}],[{"node":"Wait12","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"1. Descargar Imagen 1-10","type":"main","index":0}]]},"If41":{"main":[[],[{"node":"Wait15","type":"main","index":0}]]},"If43":{"main":[[],[{"node":"Wait13","type":"main","index":0}]]},"Wait11":{"main":[[{"node":"If41","type":"main","index":0}]]},"Wait12":{"main":[[{"node":"1. Descargar Imagen 1-7","type":"main","index":0}]]},"Wait13":{"main":[[{"node":"1. Descargar Imagen 1-8","type":"main","index":0}]]},"Wait14":{"main":[[{"node":"1. Descargar Imagen 1-","type":"main","index":0}]]},"Wait15":{"main":[[{"node":"1. Descargar Imagen 1-9","type":"main","index":0}]]},"2. Enviar a Chatwoot17":{"main":[[{"node":"If29","type":"main","index":0}]]},"1. Descargar Imagen 1-":{"main":[[{"node":"2. Enviar a Chatwoot17","type":"main","index":0}]]},"2. Enviar a Chatwoot20":{"main":[[{"node":"If43","type":"main","index":0}]]},"1. Descargar Imagen 1-7":{"main":[[{"node":"2. Enviar a Chatwoot20","type":"main","index":0}]]},"1. Descargar Imagen 1-8":{"main":[[{"node":"2. Enviar a Chatwoot37","type":"main","index":0}]]},"1. Descargar Imagen 1-9":{"main":[[{"node":"2. Enviar a Chatwoot38","type":"main","index":0}]]},"1. Descargar Imagen 1-10":{"main":[[{"node":"2. Enviar a Chatwoot39","type":"main","index":0}]]},"If25":{"main":[[{"node":"If30","type":"main","index":0}],[{"node":"Wait20","type":"main","index":0}]]},"If30":{"main":[[],[{"node":"Wait16","type":"main","index":0}]]},"If31":{"main":[[{"node":"Wait17","type":"main","index":0}],[{"node":"Wait18","type":"main","index":0}]]},"Wait16":{"main":[[{"node":"1. Descargar Imagen 1-15","type":"main","index":0}]]},"If44":{"main":[[],[{"node":"Wait21","type":"main","index":0}]]},"If45":{"main":[[],[{"node":"Wait19","type":"main","index":0}]]},"Wait17":{"main":[[{"node":"If44","type":"main","index":0}]]},"Wait18":{"main":[[{"node":"1. Descargar Imagen 1-12","type":"main","index":0}]]},"Wait19":{"main":[[{"node":"1. Descargar Imagen 1-13","type":"main","index":0}]]},"Wait20":{"main":[[{"node":"1. Descargar Imagen 1-11","type":"main","index":0}]]},"Wait21":{"main":[[{"node":"1. Descargar Imagen 1-14","type":"main","index":0}]]},"2. Enviar a Chatwoot18":{"main":[[{"node":"If31","type":"main","index":0}]]},"1. Descargar Imagen 1-11":{"main":[[{"node":"2. Enviar a Chatwoot18","type":"main","index":0}]]},"2. Enviar a Chatwoot21":{"main":[[{"node":"If45","type":"main","index":0}]]},"1. Descargar Imagen 1-12":{"main":[[{"node":"2. Enviar a Chatwoot21","type":"main","index":0}]]},"1. Descargar Imagen 1-13":{"main":[[{"node":"2. Enviar a Chatwoot40","type":"main","index":0}]]},"1. Descargar Imagen 1-14":{"main":[[{"node":"2. Enviar a Chatwoot41","type":"main","index":0}]]},"1. Descargar Imagen 1-15":{"main":[[{"node":"2. Enviar a Chatwoot42","type":"main","index":0}]]},"If32":{"main":[[{"node":"If33","type":"main","index":0}],[{"node":"Wait26","type":"main","index":0}]]},"If33":{"main":[[],[{"node":"Wait22","type":"main","index":0}]]},"If34":{"main":[[{"node":"Wait23","type":"main","index":0}],[{"node":"Wait24","type":"main","index":0}]]},"Wait22":{"main":[[{"node":"1. Descargar Imagen 1-20","type":"main","index":0}]]},"If46":{"main":[[],[{"node":"Wait27","type":"main","index":0}]]},"If47":{"main":[[],[{"node":"Wait25","type":"main","index":0}]]},"Wait23":{"main":[[{"node":"If46","type":"main","index":0}]]},"Wait24":{"main":[[{"node":"1. Descargar Imagen 1-17","type":"main","index":0}]]},"Wait25":{"main":[[{"node":"1. Descargar Imagen 1-18","type":"main","index":0}]]},"Wait26":{"main":[[{"node":"1. Descargar Imagen 1-16","type":"main","index":0}]]},"Wait27":{"main":[[{"node":"1. Descargar Imagen 1-19","type":"main","index":0}]]},"2. Enviar a Chatwoot22":{"main":[[{"node":"If34","type":"main","index":0}]]},"1. Descargar Imagen 1-16":{"main":[[{"node":"2. Enviar a Chatwoot22","type":"main","index":0}]]},"2. Enviar a Chatwoot23":{"main":[[{"node":"If47","type":"main","index":0}]]},"1. Descargar Imagen 1-17":{"main":[[{"node":"2. Enviar a Chatwoot23","type":"main","index":0}]]},"1. Descargar Imagen 1-18":{"main":[[{"node":"2. Enviar a Chatwoot43","type":"main","index":0}]]},"1. Descargar Imagen 1-19":{"main":[[{"node":"2. Enviar a Chatwoot44","type":"main","index":0}]]},"1. Descargar Imagen 1-20":{"main":[[{"node":"2. Enviar a Chatwoot45","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"acwebhook.alefcompany.online","user-agent":"rest-client/2.1.0 (linux-musl x86_64) ruby/3.4.4p34","content-length":"2304","accept":"application/json","accept-encoding":"gzip;q=1.0,deflate;q=0.6,identity;q=0.3","content-type":"application/json","x-forwarded-for":"173.249.43.27","x-forwarded-host":"acwebhook.alefcompany.online","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"6a57d0c37ad6","x-real-ip":"173.249.43.27"},"params":{},"query":{},"body":{"account":{"id":2,"name":"Healup"},"additional_attributes":{},"content_attributes":{},"content_type":"text","content":"a","conversation":{"additional_attributes":{},"can_reply":true,"channel":"Channel::Whatsapp","contact_inbox":{"id":4,"contact_id":4,"inbox_id":4,"source_id":"51972619000","created_at":"2026-01-02T16:51:45.640Z","updated_at":"2026-01-02T16:51:45.640Z","hmac_verified":false,"pubsub_token":"STv1xcrZw8Aeuyt1SPgxmVQm"},"id":1,"inbox_id":4,"messages":[{"id":18,"content":"a","account_id":2,"inbox_id":4,"conversation_id":1,"message_type":0,"created_at":1767380149,"updated_at":"2026-01-02T18:55:49.212Z","private":false,"status":"sent","source_id":"wamid.HBgLNTE5NzI2MTkwMDAVAgASGBYzRUIwQTY2M0JDMjQwOTg4NTdDQTg3AA==","content_type":"text","content_attributes":{},"sender_type":"Contact","sender_id":4,"external_source_ids":{},"additional_attributes":{},"processed_message_content":"a","sentiment":{},"conversation":{"assignee_id":null,"unread_count":1,"last_activity_at":1767380149,"contact_inbox":{"source_id":"51972619000"}},"sender":{"additional_attributes":{},"custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false,"type":"contact"}}],"labels":[],"meta":{"sender":{"additional_attributes":{},"custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false,"type":"contact"},"assignee":null,"assignee_type":null,"team":null,"hmac_verified":false},"status":"open","custom_attributes":{},"snoozed_until":null,"unread_count":1,"first_reply_created_at":null,"priority":null,"waiting_since":1767372705,"agent_last_seen_at":1767378677,"contact_last_seen_at":0,"last_activity_at":1767380149,"timestamp":1767380149,"created_at":1767372705,"updated_at":1767380149.2243187},"created_at":"2026-01-02T18:55:49.212Z","id":18,"inbox":{"id":4,"name":"Heal Up Lab WhatsApp"},"message_type":"incoming","private":false,"sender":{"account":{"id":2,"name":"Healup"},"additional_attributes":{},"avatar":"","custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false},"source_id":"wamid.HBgLNTE5NzI2MTkwMDAVAgASGBYzRUIwQTY2M0JDMjQwOTg4NTdDQTg3AA==","event":"message_created"},"webhookUrl":"https://acwebhook.alefcompany.online/webhook/healup2","executionMode":"production"}}]},"versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","activeVersionId":"becd5ca5-467d-415a-b311-83050fcb82cb","versionCounter":23,"triggerCount":1,"activeVersion":{"updatedAt":"2026-01-12T22:41:59.446Z","createdAt":"2026-01-12T22:41:59.446Z","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","workflowId":"bIVpE1aXwtICWRcyHjLUv","nodes":[{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $('Delete Redis').first().json.response }}\nCurrent date: {{ $('Formatea fecha').first().json.formattedDate }}\nEl numero del whatsapp del paciente es: {{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n\n## CLASIFICACI√ìN DE TEXTO:\nTe va a llegar los mensajes en parte de esta forma:\nTexto mensaje: [Mensaje]\nAudio transcripto: [audio trascripto]\nImagen analizada: [mensaje analizado]\nesto es para que sepas diferenciar los audios, imagenes, y textos que te manden.\n","options":{"systemMessage":"=#ROL\n1. IDENTIDAD Y VOCABULARIO (EL \"QUI√âN\" Y \"QU√â\" DECIR)\nEsta secci√≥n define su personalidad y el est√°ndar de lenguaje que debe utilizar para conectar con el cliente que desea comprar en Brada Perfumes.\nNombre: Diego.\nCargo: Asesor de ventas de la tienda ‚ÄúBrada Perfumes‚Äù, especializado en alta perfumer√≠a y fragancias √°rabes.\nTrato al Cliente: Uso de un tono simple, cercano y directo. Se evita la informalidad excesiva\nUso de \"Hermano\": El t√©rmino \"hermano\" queda restringido √∫nicamente al saludo inicial. No debe utilizarse en el resto de la conversaci√≥n para evitar un exceso de confianza.\nRestricci√≥n Cr√≠tica: Queda estrictamente prohibido el uso de apelativos exagerados como \"perfum√≥n\" o \"joyita\". Tambi√©n se proh√≠be el lenguaje rob√≥tico, el trato formal de \"Usted\" y el uso de diminutivos (ej. \"perfumito\", \"botellita\").\nEjemplo de Aplicaci√≥n: \nEntrada: \"hola que tal, precio de asad\" \nRespuesta de Diego: \"Hola hermano, que tal? El Lattafa Asad s√≠ lo tenemos disponible, aqu√≠ te paso los detalles...\"\n\n2. PROTOCOLOS DE COMUNICACI√ìN (EL \"C√ìMO\" HABLAR)\nEsta secci√≥n establece la mec√°nica de sus respuestas para garantizar una venta √°gil, persuasiva y aut√©ntica.\nRegla de Interacci√≥n: Responder mensaje por mensaje para mantener un ritmo de chat natural.\nRegla de Extensi√≥n Adaptativa:\nRespuestas Simples: M√°ximo 2 l√≠neas para saludos iniciales o confirmaciones de recepci√≥n.\nRespuestas de Cat√°logo: Entrega de la informaci√≥n clave (precio, disponibiidad y nombre del producto) bas√°ndose en las tres tools seg√∫n las reglas correspondientes a su uso en la secci√≥n: ‚Äú\nRegla de Estructura: Si el cliente pregunta por varias fragancias, responda de forma ordenada destacando lo mejor de cada una.\nRegla de Est√©tica: Uso din√°mico de 1 emoji por mensaje (üî•, üí®, ) para transmitir la energ√≠a y exclusividad de las fragancias.\nRegla de No-Repetici√≥n:\nNo repita el saludo de bienvenida si el cliente contin√∫a la conversaci√≥n m√°s tarde.\nSi el cliente no entiende una nota olfativa, use comparaciones sencillas (ej. \"huele a limpio\", \"es bien dulcecito\") sin perder la base t√©cnica.\n3. L√ìGICA DE OBJETIVOS (EL \"PARA QU√â\" ACTUAR)\nEsta secci√≥n rige sus decisiones estrat√©gicas, priorizando la asesor√≠a efectiva y el cierre de ventas seguro.\nMisi√≥n Principal: Identificar el nombre del perfume que desee el cliente) y resolver dudas sobre stock y env√≠os usando exclusivamente las tools.\nFiltro de Pago y Env√≠o: Prohibido solicitar datos de env√≠o o confirmar pedidos si el cliente no ha pasado por el \"Filtro de Validaci√≥n de Pago\" (An√°lisis de imagen del comprobante).\nFiltro de Asesor√≠a: Ante consultas sobre reclamos, devoluciones o pedidos de asesor√≠a m√©dica/piel muy complejos, debe derivar inmediatamente al supervisor.\nIntegridad de Stock: Prohibido inventar disponibilidad o precios. La √∫nica fuente v√°lida es el output de la tool stock_real.\n#CONOCIMIENTO GENERAL\n### ¬øQu√© es Brada Perfumes?\nEs una tienda especializada en alta perfumer√≠a y fragancias √°rabes exclusivas. Como asesor de ventas, tu objetivo es orientar a los clientes para encontrar su fragancia ideal y cerrar la venta de forma √°gil.\n### Cat√°logo de Productos\nBrada Perfumes ofrece tres categor√≠as de productos. Para conocer la lista actualizada de existencias, siempre debes ejecutar la tool informacion_perfumes al inicio de la consulta:\n**Perfumes Full Size**: Botellas completas en su presentaci√≥n original (ej. 100ml, 120ml).\nEjemplos clave: 9 PM, Hawas Ice, Khamrah, Asad, Creed Aventus.\n**Decants**: Perfumes originales trasvasados a presentaciones peque√±as de 5ml o 10ml. Son ideales para que el cliente pruebe la fragancia antes de comprar el frasco grande.\nEjemplos clave: YSL EDP, Club de Nuit Intense, Scandal.\n**Sets de Perfumes**: Estuches especiales que incluyen la fragancia principal y complementos (lociones, geles o miniaturas).\nEjemplos clave: Set Yara, Set 9pm, Set Art of Universe.\nNota Operativa: La tool informacion_perfumes es tu √∫nica fuente de verdad para nombres de productos. Si un cliente menciona un nombre que no est√° en la tool, verifica si existe un nombre similar por error ortogr√°fico antes de confirmar disponibilidad.\n# REGLAS DE ORO\n## **Regla de uso de la tool ‚Äúinformaci√≥n_perfumes‚Äù**.\nAl recibir el mensaje del cliente, SIEMPRE usa la tool ‚Äúinformacion_perfumes‚Äù antes de redactar la respuesta. Esta tool te devolver√° todos los productos que vende nuestra tienda ‚ÄúBrada Perfumes‚Äù los cuales est√°n divididos en tres categor√≠as: ‚ÄúPerfumes full size‚Äù, ‚ÄúDecants‚Äù y ‚Äúset de perfumes‚Äù\nRestricci√≥n de datos: Cabe aclarar que esta tool NO CONTIENE PRECIOS NI STOCK REAL. Su √∫nica funci√≥n es servir de gu√≠a de nomenclatura formal para identificar los productos que ofrecemos. \n## **Regla de ortograf√≠a**\nEsta regla rige c√≥mo Diego debe interpretar y responder a los mensajes con errores de escritura.\n* Inteligencia Sem√°ntica: Diego debe ignorar errores ortogr√°ficos, de puntuaci√≥n o de tildes del cliente para identificar la intenci√≥n real.\nMapeo Autom√°tico: Si el cliente escribe incorrectamente el nombre de un perfume (ej. \"habas ice\", \"9pm elicsir\", \"latifa asad\"), Diego debe asociarlo mentalmente con el producto correcto de la tool ‚ÄúInformacion_productos‚Äù sin pedir aclaraciones.\nNaturalidad en la Respuesta: Al responder, Diego debe escribir los nombres de los perfumes de forma correcta (seg√∫n la tool ‚ÄúInformacion_productos‚Äù) para mantener el profesionalismo, pero sin resaltar el error del cliente.\nEjemplo de Aplicaci√≥n:\n- Entrada del cliente: \"hola ermano presio del cnit untold\"\n- Acci√≥n de Diego: Identifica \"hermano\", \"precio\" y \"Club de Nuit Untold\".\n- Respuesta de Diego: \"Hola hermano, el Club de Nuit Untold s√≠ lo tenemos disponible. El precio es de S/...\"\n## **Regla de cierre variable**\nEsta regla evita que Diego suene como un robot de ventas insistente.\nFinalizaci√≥n Variable: No es obligatorio terminar cada mensaje con una pregunta. Diego debe evaluar si la conversaci√≥n requiere una pregunta para avanzar o si una afirmaci√≥n directa es m√°s natural seg√∫n el contexto.\nGu√≠a de Ejemplos: El agente debe seguir estrictamente la estructura de la secci√≥n \"EJEMPLOS DE CONVERSACI√ìN\" para identificar en qu√© fases se cierra con una pregunta y en cu√°les se cierra con una instrucci√≥n directa (ej. al pedir el comprobante o solicitar datos).\nCero Presi√≥n: Si el cliente muestra inter√©s general pero no intenci√≥n de compra, Diego debe responder de forma informativa y cerrar de manera amable sin presionar por una respuesta inmediata.\n## Regla de tiempo de entrega:\nEsta regla rige c√≥mo informar sobre la llegada del pedido utilizando la hora actual seg√∫n el input (current_date).\nPara Lima (env√≠o por motorizado): Si el pago se valida antes de las 10:00 am, el pedido llega el mismo d√≠a. De lo contrario, llega el d√≠a de ma√±ana.\nPara Provincia (env√≠o por la agencia Shalom): Si el pago se valida antes de las 4:00 pm, se entrega a la agencia el mismo d√≠a. El tiempo de viaje es de 2 a 5 d√≠as h√°biles.\nAplicaci√≥n: Responde siempre con seguridad seg√∫n la hora actual. No des rangos vagos si el cliente ya pas√≥ el l√≠mite de hora.\n## Regla de env√≠os\nPol√≠tica: Solo realizamos env√≠os a domicilio o agencia; no contamos con la opci√≥n de recojo en tienda f√≠sica.\nAplicaci√≥n: Si el cliente pregunta por una direcci√≥n f√≠sica para recoger su pedido, inf√≥rmele amablemente que operamos exclusivamente mediante env√≠os.\n## Regla de solicitudes presenciales\nAplica cuando el cliente desea visitar el local, ver los perfumes en persona o agendar una cita presencial.\nEjemplos de activaci√≥n: \"Quiero ir a ver los perfumes en persona\", \"Podemos programar una cita para ir de manera presencial con mi amigo\" o \"¬øD√≥nde est√°n ubicados para ir hoy?\".\nAcci√≥n: Utilice la tool pasar_supervisor.\nRespuesta obligatoria: \"Voy a comunicarme con mi compa√±ero para que te confirme el horario\".\n\n\n\n#FASES DE FLUJO DE FUNCIONAMIENTO\n## FASE 1: 1. SALUDO Y PROTOCOLO INICIAL\nEsta fase establece el primer contacto. El saludo se env√≠a una sola vez en toda la conversaci√≥n y no se solicita el nombre del cliente.\nL√≥gica de Inicio seg√∫n el mensaje del cliente:\nESCENARIO A: Mensaje gen√©rico o sin producto identificado Aplica cuando el cliente dice \"Hola\", \"Info\", \"Precios\", o env√≠a un mensaje que no menciona un producto de la Lista Maestra.\nAcci√≥n: Saludar de forma directa.\nRespuesta Obligatoria: \"Hola hermano, en qu√© perfume est√°s interesado?\".\nESCENARIO B: El cliente menciona un perfume o marca desde el inicio Aplica cuando el cliente consulta directamente por un producto (ej: \"precio del hawas\").\nAcci√≥n 1 : Asociar el t√©rmino con el nombre t√©cnico de la lista de ‚Äúperfumes_full_size‚Äù de la tool ‚Äúinformacion_productos‚Äù (ej: \"9pm\" ‚Üí \"9 PM\").\nAcci√≥n 2: Preparar el mensaje de saludo y luego pasa a la ‚ÄúFase 2:  2. IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)‚Äù\nEjemplo de respuesta: \"Hola hermano. (para responder sobre el perfume o sobre la intenci√≥n del cliente pasa a la fase 2)‚Äù.\n## FASE 2: IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)\nEsta fase es el n√∫cleo de la venta. Diego debe mapear el lenguaje del cliente a los productos reales y consultar la disponibilidad exacta.\nCASO A: Perfumes Full Size\nAplica cuando el cliente pide informaci√≥n, precio o disponibilidad de uno o varios perfumes de la lista.\nMapeo Sem√°ntico: Antes de usar la tool, asocia el nombre que diga el cliente con el nombre m√°s cercano de la Lista Maestra.\nUso de Tool: Activa stock_perfumes con el input: disponibilidad del perfume: [Nombre exacto].\nEl nombre del perfume env√≠alo entre comillas.\nEscenario 1: Consulta por un solo perfume\nAcci√≥n: Ejecuta ‚Äústock_perfumes‚Äù.\nLa tool devolver√° el nombre del perfume y con dos datos: \nstock: (si o no). \nStock = si : significa que est√° disponible el perfume\nStock = no : significa que esta agotado el perfume\nSi hay stock: Sigue el Ejemplo 1 de entrega de informaci√≥n.\nSi NO hay stock: La tool sugerir√° perfumes similares. Debes presentarlos de forma atractiva siguiendo el Ejemplo 2.\nEscenario 2: Consulta por m√∫ltiples perfumes\nAcci√≥n: Ejecuta la tool para todos los perfumes mencionados en un solo input: ‚Äúdisponibilidad de los perfumes: 1. [Nombre], 2. [Nombre]...‚Äù\nEnv√≠a cada nombre de los perfumes entre comillas.\nResultados Mixtos:\nSi hay de todos: Sigue el Ejemplo 3.\nSi falta alguno: Sigue el Ejemplo 4 (confirmas lo que hay y ofreces alternativas para lo que no).\nCASO B: Decants (Presentaciones de 5ml o 10ml)\nAplica cuando el cliente busca probar fragancias o indica cantidades peque√±as. Generalmente los clientes piden varios a la vez.\nEjemplos de Entrada del Cliente:\n‚Äúhawas 5ml, harana 10ml, asad 10ml y gos diamond 5ml‚Äù\n\"¬øTienes el 9pm en 5ml?\"\n\"Quiero probar el Hawas y el Asad en 10ml cada uno\".\n\"P√°same precio de decants de 5ml\". En este caso consultar sobre cual desea.\nIdentificaci√≥n: Si el cliente menciona \"5ml\", \"10ml\", \"peque√±o\" o \"para probar\", tr√°talo como Decant.\nUso de Tool: Activa ‚Äústock_decants‚Äù seg√∫n la cantidad de decants que solicita adquirir:\nSi es un solo decant, envia el input: ‚Äúdisponibilidad de decant: [Nombre del perfume] en [Cantidad].‚Äù\nSi es m√°s de un decant, env√≠a el input ‚Äúdisponibilidad de decants: [Nombre del perfume] en [Cantidad]. [Nombre del perfume] en [Cantidad]....‚Äù\nCASO C: Sets de Perfumes\nAplica cuando el cliente busca estuches de regalo o packs que incluyen complementos.\nEjemplo \nAcci√≥n: Revisa la secci√≥n \"Set de perfumes\" del Conocimiento General para validar si el nombre coincide con un set real.\nUso de Tool: Activa ‚Äústock_set_perfumes‚Äù con el input: disponibilidad del SET: [Nombre del Set].\nSi consulta sobre m√°s de un set, env√≠a el input: ‚Äúdisponibilidad del SET: [Nombre del Set]. disponibilidad del SET: [Nombre del Set].‚Äù\nNota: Si el cliente pregunta por un perfume y un set al mismo tiempo, consulta ambos en la misma ejecuci√≥n de la tool.\n## FASE 3: CONFIRMACI√ìN Y LOG√çSTICA DE ENV√çO\nEsta fase se activa cuando el cliente muestra una Intenci√≥n Real de Compra (ej. \"¬øC√≥mo pago?\", \"Lo quiero\", \"P√°same tu cuenta\") o despu√©s de que Diego presente la disponibilidad y precios.\n1. Generaci√≥n del Resumen\nDiego debe presentar un resumen estructurado basado en la secci√≥n #EJEMPLOS DE RESUMEN DE COMPRA.\nRegla de Oro: El total NO incluye el env√≠o todav√≠a. El env√≠o se suma en la Fase 4.\nPregunta de Cierre: Siempre debe terminar con la pregunta: \"¬øPara qu√© distrito o ciudad ser√≠a el env√≠o?\"\n2. Validaci√≥n de Ubicaci√≥n (Uso de Tool)\nUna vez que el cliente responde con un lugar, Diego debe ejecutar la tool distritos.\nL√≥gica de Clasificaci√≥n:\nCASO LIMA: Si el distrito indicado est√° en la lista de la tool distritos (Lima Metropolitana y Callao), se clasifica como Escenario A.\nCASO PROVINCIA: Si el lugar indicado NO est√° en la lista (ej. Piura, Cusco, Trujillo, o distritos de otras regiones), se clasifica autom√°ticamente como Escenario B.\n\n## FASE 4. M√âTODOS DE PAGO Y VALIDACI√ìN\nDiego presentar√° los m√©todos de pago bas√°ndose estrictamente en la ubicaci√≥n identificada. El costo de env√≠o es de S/12 en todos los casos.\nEscenario A: Lima Metropolitana (Distritos indicados)\nRegla: El cliente tiene la opci√≥n de pagar solo el env√≠o (S/12) por adelantado para confirmar, y el saldo del perfume lo cancela al recibirlo.\nMensaje: \"Para Lima puedes confirmar tu pedido pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Si prefieres, tambi√©n puedes pagar el monto total.\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante.‚Äù\nRegla de Flexibilidad: El cliente puede elegir pagar solo el env√≠o o el total.\nEscenario B: Provincia / Env√≠os por Shalom\nRegla: El pago debe realizarse por el monto completo (Perfume + S/12 de env√≠o) antes de despachar.\nMensaje: \"Para enviarte a provincia, el pago es por el monto total: son S/ [Precio del perfume] del perfume + S/ 12 del env√≠o por Shalom. En total ser√≠a S/ [Suma de ambos].\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante..‚Äù\nReglas Cr√≠ticas de Validaci√≥n:\nSolo Imagen: La compra √öNICAMENTE se valida mediante el input Imagen_analizada. No aceptes confirmaci√≥n por texto (\"ya pagu√©\") ni por audio.\nC√°lculo de Montos: * Si el cliente est√° en Lima y env√≠a un comprobante de S/ 12, Diego debe decir: \"Reserva de S/ 12 verificada. El saldo de S/ [Monto del Perfume] lo cancelas al recibir.\" y pasar a pedir datos.\nSi el cliente env√≠a el pago en partes (ej. dos capturas de Yape), Diego debe sumar ambos montos mentalmente. Solo cuando la suma sea igual al total acordado (o al menos a los S/ 12 en Lima), se da por validado.\n\n## FASE 5. SOLICITUD DE DATOS Y FINALIZACI√ìN\nTras validar el pago exitosamente seg√∫n el input ‚Äúimagen_analizada‚Äù, Diego solicita los datos para la confirmaci√≥n del env√≠o, seg√∫n el caso A o el caso B\nCASO A) Si el env√≠o es para los distritos permitidos de Lima Metropolitana.\n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Direcci√≥n exacta.‚Äù\n2) Validaci√≥n: Diego acepta cualquier formato de nombre y direcci√≥n que el cliente proporcione. No debe cuestionar la direcci√≥n, solo recopilarla.\n3) Utilizar tool: Una vez que tengas ambos datos utiliza la tool ‚Äúconfirmacion_pedido‚Äù y env√≠a las siguientes variables:\n‚ÄúNombre‚Äù\n‚ÄúDireccion exacta‚Äù\n‚Äúproductos‚Äù: el producto o los productos env√≠alos de esta forma: \"Producto 1: [Categor√≠a: Full Size/Decant/Set] [Nombre del Perfume] - [Precio] - [Cantidad]. (Repetir si hay m√°s productos)\".\n4) Confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: Tu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada\nCASO B) Si es de Provincia: \n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Apellidos\\n- DNI\\n- Ciudad/provincia\\n- Nombre de la agencia Shalom donde recoger√°‚Äù\n2) Validaci√≥n: Diego acepta los datos tal cual los env√≠e el cliente (no corregir DNI ni nombres). \n3) Utilizar tool: Una vez identificado todo los datos que solicitaste, utiliza la tool ‚Äúconfirmacion_pedido‚Äù con las siguientes variables:\n\n‚ÄúNombre‚Äù\n‚ÄúApellidos‚Äù\n‚ÄúDNI‚Äù\n‚ÄúCiudad/provincia‚Äù\n‚ÄúNombre_agencia_shalom‚Äù\n‚Äúproductos‚Äù: (Misma l√≥gica del CASO A: Categor√≠a, Nombre, Precio y Cantidad)\nNota: en este caso la variable ‚Äúdireccion_exacta‚Äù coloca ‚Äúnull‚Äù.\n4) confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: ‚ÄúTu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada.‚Äù\n\n###SECCI√ìN: EJEMPLO DE ENTREGA DE INFORMACI√ìN DE PERFUME\nEjemplo 1 (Un perfume con stock):\n\"El Hawas Ice s√≠ lo tengo en stock. El precio es de S/ 180. Es un perfume ultra fresco y potente, de los que m√°s piden.\"\nEjemplo 2 (Sin stock + Similares sugeridos):\n‚ÄúEl Valentino est√° agotado. Tengo estos que son de la misma vibra y huelen incre√≠ble:\\nJPG Le Male Elixir a S/ 450\\n\\nScandal Le Parfum a S/ 420 ¬øAlguna de esas opciones te llama la atenci√≥n?\"\nEjemplo 3 (M√∫ltiples perfumes con stock):\n\"Tengo los dos disponibles:\\n\\n9 PM a S/ 140\\nKhamrah Dukhan a S/ 175\"\nEjemplo 4 (Stock mixto):\n\"Hermano, te confirmo: el CDN Intense s√≠ lo tengo listo para enviar a S/ 190. El Azzaro lo tenemos sin stock. ¬øQu√© otro perfume te gustar√≠a?\nEjemplo 5 (Decants m√∫ltiples):\n\"Los tengo disponible:\\n\\n9pm Elixir (5ml): S/ 35\\nYara (10ml): S/ 45\\nKhamrah (5ml): S/ 40\\n\\n¬øTe armo el pack con estos tres o quieres chequear alguno m√°s?\"\n\n#EJEMPLOS DE RESUMEN DE COMPRA\n## EJEMPLOS SOLO PERFUMES FULL SIZE\n### Ejemplo 1: Si es solo un perfume\n\"Resumen de compra:\\n- Hawas Ice\\nüì¶ Cantidad: 1\\nüí∞ Precio unitario: S/ 180\\n\\nüíµ Total: S/ 180\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s perfumes Resumen de compra:\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah Dukhan\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 175\\n\\nüíµ Total: S/ 315\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS SOLO PERFUMES DECANTS\n### Ejemplo 1: Si es solo un decant Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- 9 PM Elixir (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 35\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Si son varios decants Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- Yara (10ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 45\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\nüíµ Total: S/ 125\\n\\n¬øMe indicas el distrito para continuar?\"\n## EJEMPLOS SOLO SET DE PERFUMES\n### Ejemplo 1: Si es solo un set Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 220\\n\\nüíµ Total: S/ 220\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s sets Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\n- GOS Set\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 240\\n\\nüíµ Total: S/ 450\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS DE PEDIDOS COMBINADOS\n### Ejemplo 1: Perfume Full Size + Decants\n\"Resumen de compra:\\n- Lattafa Asad\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 150\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Yara (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 225\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Compra Integral (Full Size + Decant + Set)\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\nüíµ Total: S/ 390\\n\\n¬øMe confirmas el distrito para avanzar con el pago?\" \n\n# EJEMPLOS DE FLUJO DE CONVERSACI√ìN CORRECTO\n## EJEMPLOS SI EL CLIENTE DESEA EL ENV√çO PARA LIMA\n1) Pago completo (Perfume + Env√≠o)\nCliente: Hola, quiero el Hawas Ice para Miraflores.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Hawas Ice s√≠ est√° disponible y cuesta S/180. ¬øDeseas agregar algo m√°s a tu compra?.\nCliente: No, solo eso. ¬øC√≥mo hago el pago?.\nDiego: Para Lima puedes confirmar pagando solo S/12 del env√≠o y el saldo al recibir, o pagar el monto total de S/192. Puedes yapear al 987108094 a nombre de Brandon Quelopana o por transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/192).\nDiego (Tras validar Imagen_analizada): Pago de S/192 verificado. P√°same tu nombre, celular y direcci√≥n exacta para programar el env√≠o. Como pagaste antes de las 10:00 am, llega hoy mismo.\n2) Pago parcial (Solo env√≠o S/12 + Saldo contra entrega)\nCliente: Precio del 9 PM. Estoy en San Borja.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El 9 PM cuesta S/140. ¬øQuieres agregar algo m√°s o solo ese?.\nCliente: Solo ese. Quiero pagar solo el env√≠o ahora.\nDiego: Entendido. Para Lima puedes confirmar pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Yapea al 987108094 (Brandon Quelopana) y me mandas la captura.\nCliente: (Env√≠a captura por S/12).\nDiego (Tras validar Imagen_analizada): Reserva de S/12 verificada. P√°same tu nombre, celular y direcci√≥n exacta. El saldo de S/140 lo pagas al recibir el producto.\n## EJEMPLO SI EL CLIENTE DESEA EL ENV√çO PARA PROVINCIA\n3) Pago total obligatorio para Provincia (V√≠a Shalom)\nCliente: Hola, precio de Asad para Piura.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Lattafa Asad cuesta S/150. ¬øDeseas agregar alg√∫n decant o solo el perfume?.\nCliente: Solo el perfume. ¬øCu√°l es el m√©todo?\nDiego: Para env√≠os a provincia el pago se realiza por el monto total de S/162, que incluye los S/12 de env√≠o por Shalom. Puedes pagar por Yape al 987108094 (Brandon Quelopana) o transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/162).\nDiego (Tras validar Imagen_analizada): Pago de S/162 verificado. P√°same tu nombre, apellidos, DNI, celular, ciudad y el nombre de la agencia Shalom donde lo recoger√°s. \n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-5136,288],"id":"87ad49a4-0b30-4cf2-bd78-475265d05fe3","name":"AI Agent"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","typeVersion":1,"position":[-3472,528],"id":"0af2d781-c62f-4cfa-8636-6576d2801773","name":"Auto-fixing Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3504,704],"id":"0be267ba-446a-4cd1-8c35-ea2e696d7e8b","name":"OpenAI Chat Model8","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"response\": {\n    \"parte_uno\": \"Texto correspondiente a la primera parte de la respuesta.\",\n    \"parte_dos\": \"Texto correspondiente a la segunda parte de la respuesta.\",\n    \"parte_tres\": \"Texto correspondiente a la tercera parte de la respuesta (opcional).\",\n    \"parte_cuatro\": \"Texto correspondiente a la cuarta parte de la respuesta (opcional).\",\n    \"imagen_uno\": \"Imagen correspondiente\",\n    \"imagen_dos\": \"Imagen correspondiente (opcional).\",\n    \"video_mp4\": \"Video .mp4 (opcional)\"\n}\n  }"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-3328,704],"id":"05f11a4e-1bcc-4829-a163-8b4e3e1f1534","name":"Structured Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3744,624],"id":"f2dd9e17-523b-4e58-9b8e-5f00f8fa704f","name":"OpenAI Chat Model9","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"={{ $json.output }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Obtener el texto de entrada:\n\nRecupera el texto de la variable items\n{{ $json.output }}\nLimpieza y normalizaci√≥n del texto:\n\nCrea una funci√≥n que limpie el texto eliminando los siguientes caracteres: ¬ø, ¬°, @, \", *, #.\n\nElimina los espacios en blanco al inicio y al final del texto.\nNo Elimines los emojis, ni los markdown para que los mensajes esten limpios.\nDivisi√≥n del texto en partes:\n\nImplementa una funci√≥n que divida el texto limpio en fragmentos de m√°ximo 800 caracteres sin cortar palabras. Si necesitas cortar uno de los fragementos del mensaje antes de 800 Caracteres para que no se corten mensajes hazlo. Los mensajes deben quedar completo y coherentes\nLa funci√≥n debe asegurarse de que cada fragmento se corte en espacios para no dividir palabras a la mitad.\nSi tienes que aumentar la cantidad de caracteres para que parte del mensaje no quede cortado o quede mal puedes hacerlo sin un limite de caracteres. Esto para que los mensajes sean mas organicos y funcionen bien. Tambien al identificar una imagen necesito que el link lo separes para que se mande separado.\n\n*SIEMPRE* que haiga un Link del video de youtube del tratamiento o presentaci√≥n, mandalo como parte del texto con su contexto, *NUNCA* lo pongas en la parte de imagen uno y dos.\n\n*NUNCA* pongas el link del video.mp4 en las partes de texto e imagen, *SIEMPRE* si es que tienes algun video con .mp4 ponlo en video_mp4.\n\nDeber√°s de enviarlo siempre a la √∫ltima parte pero solo eso.\nConstrucci√≥n de la respuesta:\n\nCrea un objeto JSON con la siguiente estructura:\n\n{\n  \"response\": {\n    \"parte_uno\": \"<primer fragmento>\",\n    \"parte_dos\": \"<segundo fragmento>\",\n    \"parte_tres\": \"<tercer fragmento>\",\n    \"parte_cuatro\": \"<cuarto fragmento>\",\n    \"imagen_uno\": \"<primera imagen>\",\n    \"imagen_dos\": \"<segunda imagen>\",\n    \"video_mp4\": \"<video.mp4>\"\n\n  }\n\n- Si hay un emoji como un check o algo por el estilo que desmuestre un enlistado, opciones o variantes similares, dale salto de linea para que parezca natural, recuerda reemplazar el \"\\n\" por un enter.\n\nSi alguna parte no existe, asigna una cadena vac√≠a (\"\").\n\n\n### Notas \n\n- Nunca debes hacer saltos de linea que no sean naturales evita si en algun momento un mensaje tiene un \":\" que el mensaje que le siga este en la otra parte del mensaje. debe ser lo mas natural posible.\n\n- S√≠ el texto tiene un saludo de bienvenida o algo parecido, *SIEMPRE* separalo en una parte y las siguientes partes separalos de tal forma que se vea ordenada y estructuradas tus respuestas.\n- En caso veas una palabra en asteriscos, ejemplo: **Botox:** deber√°s de quitarle los dos de los extremos y deber√° de quedar as√≠ *Botox:*.\n- *NUNCA* deber√°s de cortar el contexto del mensaje, quiero decir que si ves que el mensaje trata de un tema en espec√≠fico o seccion no deber√°s de cortarlo.\n\nEs Obligatorio reemplazarlo, no eliminarlo. NUNCA DEJAR NINGUNA PARTE VAC√çA OBLIGATORIAMENTE.\n\n- *SIEMPRE* REEMPLAZA \"\\n\" por un salto de linea normal (enter) ejemplo:\n{\n  \"response\": {\n    - opcion 1\n    - opcion 2\n    - opcion 3  \n  }\n}\n\n- *SIEMPRE* y cuando te lleguen dos links de Video.mp4, agarra el primero y no pongas los 2 juntos, si es posible, elimina uno para que solo quede uno.\n\n- *regla adicional* cuando llegue un link que est√© en .jgp .jpeg y .PNG a√±adelo a la parte de imagen, y si est√° en .mp4 a√±adelo al apartado de video "}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-3600,256],"id":"7ca03140-46dd-4d3c-a332-e3ee2072ded6","name":"Verificador1","onError":"continueErrorOutput"},{"parameters":{"httpMethod":"POST","path":"BRADA","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-15296,608],"id":"dbcc07c3-6246-4bdb-878b-af891629f8c8","name":"Webhook","webhookId":"fb43e7b4-c71f-4cad-bebd-32a81374fc49"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n","tableName":"healup","contextWindowLength":12},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-5200,48],"id":"39798e20-26eb-4032-ae59-7f5d5b5f7d8b","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"NzQUFXQpp2MvRekP","name":"CUENTA ALEGRATED"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8fa70db3-09c3-4e87-8fc9-4052751fad3f","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9840,512],"id":"d53b946f-7849-4a0c-91b8-673d822caa58","name":"If2","alwaysOutputData":false,"retryOnFail":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"576350e5-ed67-4ce9-815e-0f0a0ef0b1c7","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9616,688],"id":"3d169320-db83-4f3e-b8ec-cf4189ac8d7a","name":"If3"},{"parameters":{"assignments":{"assignments":[{"id":"1aa91b6d-c441-4496-beee-4af2457332ac","name":"pasar_supervisor","value":"={{ $json.pasar_supervisor }}","type":"string"},{"id":"34e35c66-589c-4146-ab9c-3d08b024a7c1","name":"n√∫mero","value":"={{ $json.numero }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-9984,512],"id":"e5878ba6-1987-4774-811f-c2cee034cb0a","name":"Edit Fields4"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-9184,992],"id":"02219ac8-19fd-463b-b35f-8880e0676c67","name":"No Operation, do nothing4"},{"parameters":{"name":"pasar_supervisor","description":"Llama esta herramienta cuando desees pasar a supervisor.","workflowId":{"__rl":true,"value":"2lPoYs00jPGwaBxq","mode":"list","cachedResultUrl":"/workflow/2lPoYs00jPGwaBxq","cachedResultName":"Supervisor Solari"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('Edit Fields20').item.json.id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-7248,464],"id":"b5e6fa52-fde1-4c70-b3ba-07a042587076","name":"Supervisor2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"98601c0c-949c-4f3d-99f2-40305665d58a","leftValue":"={{ $json.numero }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-10704,576],"id":"40fc0c0b-0829-40fc-81d5-3da1f46a7a9b","name":"If13"},{"parameters":{"name":"=Agendar","description":"=Agendar citas ","source":"=database","workflowId":{"__rl":true,"value":"konppOdwditJvoJQ","mode":"list","cachedResultUrl":"/workflow/konppOdwditJvoJQ","cachedResultName":"agendarSUNAT WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre_completo":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre_completo', ``, 'string') }}","DNI":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('DNI', ``, 'string') }}","numerotelefono":"={{ $json.id }}","inicio_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('inicio_cita', ``, 'string') }}","fin_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fin_cita', ``, 'string') }}","tratamiento(s)":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('tratamiento_s_', `Coloca el tratamiento que se haya mencionado durante la conversaci√≥n, seg√∫n esta lista de tratamientos:\n\n- Lipopapada & Afinamiento Facial Enzim√°tico\n- Natural Lips\n- Bratz Lips\n- Perfilamiento de nariz\n- Rinomodelaci√≥n completa\n- Exosomas + Esperma de Salm√≥n\n- Proyecci√≥n de Ment√≥n con √Åcido Hialur√≥nico\n- Baby Botox\n- Botox Full Face\n- Marcaci√≥n mandibular\n- Masseter Botox\n- Surcos Nasogenianos\n- Sustentaci√≥n pomular\n- √Åcido Hialur√≥nico para ojeras\n- NCTF\n- Hidralips con Dermapen\n- Plasma Rico en Plaquetas (PRP)\n- Armonizaci√≥n Facial \n\n- Glass Skin Babe\n- CalmBabe\n- Pure Babe Skin\n- Heal Up Babe Ritual\n- Prime Skin Clean\n- Eternal Glow Boost\n- Prestige Glow Ritual\n- Heal Up Signature Glow\n\n- Lipo Start Protocol\n- Lipo Sculpt Protocol\n- Lipo Intensive Shape Protocol\n- Heal Up Lipo 360‚Äù.\n\nNota: Si el paciente consult√≥ sobre m√°s de 1 tratamiento, a√±adelo con una coma. por ejemplo: Rinomodelaci√≥n completa, Baby Botox.\n`, 'string') }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","red_social":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('red_social', `Coloca esta palabra: WhatsApp`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"nombre_completo","displayName":"nombre_completo","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"inicio_cita","displayName":"inicio_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"fin_cita","displayName":"fin_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"numerotelefono","displayName":"numerotelefono","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"DNI","displayName":"DNI","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"red_social","displayName":"red_social","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"tratamiento(s)","displayName":"tratamiento(s)","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-5504,784],"id":"5334487f-6a0c-48f2-8833-2cece4f6c66e","name":"Calendario"},{"parameters":{"tableId":"pasar_supervisor_BRADA","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"},{"fieldId":"conversation_id","fieldValue":"={{ $('If12').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10480,832],"id":"6da92ad7-7496-46b2-ad7a-af1302bdca1b","name":"Create a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10192,512],"id":"e01e05d9-2c86-4f10-8067-8d296b347400","name":"Get a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9536,416],"id":"08f4c79d-67de-4997-8b28-3d94436c885c","name":"Update a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10960,592],"id":"0383d00f-4ae0-4f14-850a-4ee2703bbc58","name":"Get a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2acc3e64-d51a-4e98-84a5-e2b17c788fa2","leftValue":"={{ $('Webhook').item.json.body.payload.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7312,592],"id":"645bde3e-f301-4b37-a037-b78f2c234bab","name":"If4"},{"parameters":{"operation":"formatDate","date":"={{ $json.currentDate }}","format":"custom","customFormat":"DDDD tt","options":{"timezone":true}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-6896,576],"id":"c0cfb4f3-987c-429b-9a57-9f8b58dd70a2","name":"Formatea fecha"},{"parameters":{"assignments":{"assignments":[{"id":"d78c89a3-c878-48b7-aa84-4b2674c0667b","name":"data.remoteJid","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation.contact_inbox.source_id }}","type":"string"},{"id":"432a9602-e38b-4880-a64d-b832d120edda","name":"data.id","value":"={{ $('Webhook').item.json.body.id }}","type":"string"},{"id":"d2f45efc-03ac-4c74-b70e-959b06cd2a0b","name":"data.text","value":"={{ $('Edit Fields17').item.json.mensajetexto }}{{ $('Edit Fields17').item.json.mensajeaudio }}{{ $('Edit Fields17').item.json.mensajeimagen }}","type":"string"},{"id":"d77208a8-161b-4ef3-96fa-261a87cf1f39","name":"conversation_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","type":"string"},{"id":"8c279598-20f0-4012-a4ee-8c7898ceaba4","name":"account_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].account_id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6448,576],"id":"e0ece9a2-acd1-450f-9e2f-a45df7d9021e","name":"Handler variables"},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-7072,576],"id":"34435b05-c9a2-4759-b275-a239d12bbcb1","name":"Fecha"},{"parameters":{"jsCode":"// 1. Obtener la fecha de entrada\nconst inputDateString = $input.item.json.formattedDate; \nconst date = new Date(inputDateString);\n\n// 2. Obtener hora actual para la l√≥gica\nconst currentHour = date.getHours();\n\n// Clonamos la fecha para calcular el env√≠o\nlet scheduledDate = new Date(date);\n\n// 3. L√≥gica de Negocio (Reglas de horario)\nif (currentHour >= 19 || currentHour < 5) {\n  // Caso Nocturno (19:00 - 04:59): Programar para las 09:00 AM\n  scheduledDate.setHours(9, 0, 0, 0);\n  \n  // Si es >= 19:00, pasa al d√≠a siguiente.\n  if (currentHour >= 19) {\n    scheduledDate.setDate(scheduledDate.getDate() + 1);\n  }\n} else {\n  // Caso Diurno (05:00 - 18:59): Sumar 4 horas\n  scheduledDate.setHours(scheduledDate.getHours() + 4);\n  // Reiniciamos minutos y segundos a 0 para mantener limpieza (opcional, pero recomendado)\n  scheduledDate.setMinutes(0);\n  scheduledDate.setSeconds(0);\n}\n\n// 4. FORMATEO DE SALIDA \"dd/mm/yyyy HH\"\n// Usamos .padStart(2, '0') para asegurar dos d√≠gitos (09, 05, etc.)\n\nconst day = scheduledDate.getDate().toString().padStart(2, '0');\nconst month = (scheduledDate.getMonth() + 1).toString().padStart(2, '0');\nconst year = scheduledDate.getFullYear();\nconst hourFormatted = scheduledDate.getHours().toString().padStart(2, '0');\n\n// CONSTRUCCI√ìN FINAL: dd/mm/yyyy HH\n// Nota: Eliminamos los minutos (:${minuteFormatted}) de esta l√≠nea\nconst fecha_final = `${day}/${month}/${year} ${hourFormatted}`;\n\nreturn {\n  json: {\n    original_input: inputDateString,\n    // Variable solicitada con el formato exacto\n    fecha_lora_formateada: fecha_final,\n    // Variable extra por si necesitas solo la hora aislada\n    solo_hora: hourFormatted\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6640,576],"id":"7235933b-bf69-4698-9133-cfe47b370ffc","name":"Code2"},{"parameters":{"amount":30},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-7312,1072],"id":"6e3e7abf-d38f-40b1-b0c4-a8e166fc036c","name":"Wait6","webhookId":"5696ca8f-19ae-4cd6-8008-6132ce1cf272"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8a313a41-eadc-4ada-bc2a-feff79845de9","leftValue":"={{ $json.mensajes[0] }}","rightValue":"={{ $('Handler variables').item.json.data.text }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6864,1296],"id":"76729177-6c0d-4ec2-bf0a-0604e5bbf8a9","name":"If6"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-6544,1376],"id":"2c667d72-3de1-4d9e-bff9-88ce886f1c91","name":"No Operation, do nothing1"},{"parameters":{"operation":"delete","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6240,1024],"id":"31c060d8-e6c1-489f-924b-36ee33dce137","name":"Delete Redis","executeOnce":false,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $('Get Redis1').item.json.mensajes.join() }} y el lead viene de un anuncio : {{ $('RESUMIDOR ANUNCIOS').item.json.output }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Wait6').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.payload._data.Info.PushName }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6352,832],"id":"fa0d6541-f1f5-42a3-918d-072dec78f8be","name":"Edit Fields19","alwaysOutputData":true},{"parameters":{"operation":"get","propertyName":"mensajes","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","keyType":"list","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6960,1088],"id":"eb2e5436-c84c-4660-a049-366ff67222ee","name":"Get Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $json.anuncio }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Handler variables').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.conversation.messages[0].sender.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6368,992],"id":"a0199bbc-432c-4d05-a271-0c734eec08cd","name":"Edit Fields20","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3e8a5a20-c60c-48ef-a636-2b5e14a683a8","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6608,944],"id":"61e1b52d-148e-41fd-9b0b-7e4895ad7a0a","name":"If15"},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1136],"id":"edcdff4c-5e82-4bfe-8beb-45b771f8bed2","name":"METER_ANUNCIO","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1296],"id":"666f3eb7-d307-4a99-abd7-1f526c0907fd","name":"BAJAR_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}_ad","messageData":"={{ $('RESUMIDOR ANUNCIOS').item.json.output }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8064,1136],"id":"5a5ab926-f0b0-420f-ad66-6f99a6d9eb9f","name":"guarda_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3deed863-79f3-42e5-a32c-6cb7bb1028df","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7616,512],"id":"46ecb883-24f2-490a-a44c-a9e6dd7a5ab2","name":"If"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-7488,32],"id":"76495bc9-2132-42c6-8f98-7f222fbc58ab","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"8f567177-8b37-4a09-9a53-ac9fe424c843","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6240,576],"id":"49f7d2d6-bf9c-4b3f-bde9-d5b04db1203a","name":"If10"},{"parameters":{"operation":"get","propertyName":"anuncio","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6752,944],"id":"16a19e11-3a97-49d7-b868-7b84b7799dc7","name":"Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-6928,272],"id":"31f4a897-b5fc-4baa-a8ac-c4645d7e6b10","name":"Update a row4","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"Describe esta imagen\n","imageUrls":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].data_url }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8864,560],"id":"655bda6d-6ab1-42a8-85c1-736575210b9b","name":"OpenAI","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"437f223f-80c7-4c47-a50b-9d17a8614251","name":"imagen_caption","value":"={{ $json.content }} .\nEl captions del mensaje de imagen es: {{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8448,688],"id":"fa56722a-8385-4847-b719-f90a132dfbd1","name":"Edit Fields12"},{"parameters":{"url":"={{ $('Webhook').item.json.body.attachments[0].data_url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-8896,368],"id":"f1138959-5c6f-4058-a15b-6e56bdaab777","name":"HTTP Request"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"27bcc104-31e3-4687-b60b-a018c457a3a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"audio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2e8b532f-1f01-45f9-a647-e7a5c9e48aac","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"image","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Imagen"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"59f6b23a-3029-4225-8f9e-3744611a04a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"=text","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"28de146f-c104-4171-924a-29963c4f1970","leftValue":"={{ $('Webhook').item.json.body.content_type }}","rightValue":"text","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-9216,416],"id":"b138e8be-c1d3-4f8a-8423-93fb52834ba7","name":"Switch3"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8624,368],"id":"f26677a7-27a0-43ed-8071-3e3064e25db4","name":"AUDIO1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"276cbb8a-79f2-4f08-b24a-632f474c6013","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-8624,560],"id":"f29adecc-e9d9-4222-9ec3-107cac681c09","name":"If16"},{"parameters":{"assignments":{"assignments":[{"id":"c0a1b2f0-373e-4b86-ae91-25346b20b404","name":"mensajetexto","value":"=Texto mensaje: [{{ $('Webhook').item.json.body.conversation.messages[0].content }}]  ","type":"string"},{"id":"35cd9184-e37e-4d03-9dff-efb319dce478","name":"mensajeaudio","value":"={{ $json.text }}","type":"string"},{"id":"47e9bfe8-2c55-4b5d-b047-024871fc6c21","name":"mensajeimagen","value":"=Imagen analizada: [{{ $json.content }}{{ $json.imagen_caption }}]","type":"string"},{"id":"9926d346-600f-45af-adad-876e9f40ffa4","name":"imagenanalizada","value":"=Imagen de anuncio analizado: {{ $json.content }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8064,480],"id":"8a1f15fa-bf4b-4c01-adbb-7a1a21d7a706","name":"Edit Fields17","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $('Webhook').item.json.body.payload.body }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7120,400],"id":"7ab44ba1-258f-4193-929d-15aa68334a0f","name":"If11"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f05066b5-5a07-41fa-96b7-7a244e7345c8","leftValue":"={{ $json.body.payload.fromMe }}\n","rightValue":"true","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12384,608],"id":"d94743f2-3b7b-460b-bc26-33eae6240210","name":"If12"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $json.body.conversation.messages[0].content }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12224,752],"id":"23a75e86-d3fd-4b05-8d58-aa9da67a47d8","name":"If20"},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-12144,1008],"id":"a93457ed-fd5d-4186-b320-c1a49417136c","name":"Update a row6","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"name":"informacion","description":"utiliza esta tool cuando se necesite informaci√≥n seg√∫n las indicaciones del prompt principal.","workflowId":{"__rl":true,"value":"FB7us6cBaq7jWqB2","mode":"list","cachedResultUrl":"/workflow/FB7us6cBaq7jWqB2","cachedResultName":"informacion HEAL UP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}"},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-6080,784],"id":"e0e915c5-fd08-4168-be41-783aa4ce1390","name":"informacion_tratamientos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"987d5d07-58eb-4927-8e68-a137884b8100","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].message_type }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13248,608],"id":"5e339c78-27b7-41de-8774-f34bd2e49752","name":"If1"},{"parameters":{"jsCode":"// Tomamos todos los items que vienen del nodo anterior (Verificador1)\nconst items = $input.all();\n\nfor (const item of items) {\n  // Aqu√≠ est√° tu objeto con parte_uno, parte_dos, etc.\n  // Verifica la ruta: output.response\n  const resp = item.json.output?.response || {};\n\n  // Orden que quieres respetar\n  const orderedKeys = [\n    'parte_uno',\n    'parte_dos',\n    'parte_tres',\n    'parte_cuatro',\n    'imagen_uno',\n    'imagen_dos',\n    'video_mp4',\n  ];\n\n  // Armamos un nuevo objeto response en el orden deseado\n  const newResponse = {};\n  for (const key of orderedKeys) {\n    if (resp[key]) {\n      newResponse[key] = resp[key];\n    }\n  }\n\n  // Sobrescribimos manteniendo la estructura original\n  if (!item.json.output) item.json.output = {};\n  item.json.output.response = newResponse;\n}\n\n// Devolvemos los items modificados\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2752,352],"id":"24f0ff65-46ee-441c-a6d4-8f9095be5ae0","name":"ordenar"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $json.output.response.parte_uno ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2720,1088],"id":"88a82162-8ee2-4a01-8f95-a7350bae11d1","name":"Respuesta1","executeOnce":false},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1776,832],"id":"cce742aa-91d4-4fd6-971b-02494cc4941d","name":"Wait2","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_dos ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1600,928],"id":"6c953a90-8ee3-40d6-b6fd-f29c2e766496","name":"Respuesta2","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1312,848],"id":"0a8bc622-6c9b-472d-8735-328b027264ff","name":"If14"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1120,832],"id":"568f10ce-4d13-4754-843d-d05277b38f48","name":"Wait3","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_tres ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-912,896],"id":"3cb7de22-5651-4c25-b9eb-6132643c3bbe","name":"Respuesta3","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-496,752],"id":"af5809e5-112a-4632-aeaf-44bd7061fd9e","name":"If17"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-480,976],"id":"d9d3f88f-ef89-458a-8d83-ad4661e1b4e6","name":"Wait4","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=hcy6n6RAJTBAAYguVuewgp2A"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_cuatro ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-256,1008],"id":"319a272b-7a67-4de3-bcc3-381f609226df","name":"Respuesta4","executeOnce":false},{"parameters":{"promptType":"define","text":"=Te va a llegar esta descripcion de un anuncio: {{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","options":{"systemMessage":"ROL:\nTu rol es indicar el mismo input que te llega y enviarlo como output."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-7504,192],"id":"7dd13519-eebb-4cd8-9fbe-870c4eb2ea0b","name":"RESUMIDOR ANUNCIOS"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1a9dd789-5c10-4489-a344-6b7a0fd041ea","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51902215511","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"912d0724-5ef1-4f88-9d43-acbb38f48cee","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51993708540","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"e50ad623-45f5-4af7-bc5a-89708016ddf8","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51972619000","operator":{"type":"string","operation":"equals"}},{"id":"9ffd5afb-ec0c-49fc-a144-b682386c760c","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51960239280","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"50ddfe27-4e13-4e3c-8216-aca1f181f77a","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51936196001","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"7650a20c-4ba9-4e41-bd67-89e8f77278fc","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"14502413970","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"bdfe444d-b4d9-4789-971d-08420999d775","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51945157250","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"5f1e9684-e18d-4a9f-aad7-bef2235f631d","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51971119678","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13888,864],"id":"fc9e995e-943d-4cce-8e72-ee42d86cee6c","name":"If18"},{"parameters":{"description":"usa la tool supervisor seg√∫n el prompt principal","workflowId":{"__rl":true,"value":"xchwhR053ynGsZI4","mode":"list","cachedResultUrl":"/workflow/xchwhR053ynGsZI4","cachedResultName":"SUP SUNAT"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $json.id }}","conversation_id":"={{ $('If7').item.json.conversation_id }}","inbox_id":"={{ $('If12').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5616,832],"id":"5e99594b-abaa-47fe-872d-198f951381e9","name":"Supervisor"},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje1","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_uno }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"},{"fieldId":"account id","fieldValue":"={{ $('Webhook').item.json.body.account.id }}"},{"fieldId":"conversation id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2544,1088],"id":"476c18e7-85f6-493d-b3aa-14cfdf31bcc3","name":"Update a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje2","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1472,944],"id":"d7b09d89-120c-41de-af99-2ac3e43b9c64","name":"Update a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje3","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-720,896],"id":"87f26d37-d4e6-4022-b8e7-d0be58f20d22","name":"Update a row5","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"seguimiento_healup","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-15088,608],"id":"f952306b-6aab-4f21-ba58-cdd5dcebe32c","name":"Get a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}},"disabled":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"60e8198a-90ea-44a7-8f27-6e37021a1a02","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje1 }}","operator":{"type":"string","operation":"equals"}},{"id":"4541b27d-6dfa-47d7-bbff-d1a5c2e6ffd1","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje2 }}","operator":{"type":"string","operation":"equals"}},{"id":"20ce2efd-2509-40d0-b670-2c484246fa28","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje3 }}","operator":{"type":"string","operation":"equals"}},{"id":"b74b14df-879c-4427-8888-d7e1e3212ddc","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje4 }}","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-14880,608],"id":"5c2a2d65-e6b0-4eff-8611-1286cc5f3519","name":"If19","alwaysOutputData":true,"disabled":true},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje4","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[0,1008],"id":"3bfbc342-a045-4fb3-b813-77c25a76e4fd","name":"Update a row7","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"daeff2da-d88d-4aa7-b4d9-8b808c58b7c8","leftValue":"={{ $json.conversation_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7664,1824],"id":"4456591c-6e0e-41e1-8fe3-d6b190cf5b8a","name":"If7"},{"parameters":{"operation":"get","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","keyValue":"={{ $('Get a row3').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7920,1520],"id":"7eb28718-e96b-48aa-aaa6-9595b57209be","name":"Get a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"BRADA_followups","fieldsUi":{"fieldValues":[{"fieldId":"conversation_id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7232,1664],"id":"032dfeeb-7358-4670-bfc8-e64deb12607b","name":"Create a row1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"model":"gpt-5.1","options":{"reasoningEffort":"low"}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5440,496],"id":"ff0bf49f-19d4-4e02-92fc-84ddcb1a06e5","name":"RAZONADOR PLUS","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7536,1424],"id":"456e5e75-da23-4eaf-b219-2d0e6a4c9772","name":"Update a row9","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"pasar_supervisor_healup","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9872,1184],"id":"22e69871-698c-451d-97be-e15985b9f1ca","name":"Create a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"method":"POST","url":"=https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": \"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg\",\n  \"message_type\": \"outgoing\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3152,1440],"id":"1e6becc0-86ad-4636-968f-82b82ce1d008","name":"Respuesta6","executeOnce":false},{"parameters":{"url":"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3648,1424],"id":"c91882f6-4156-4928-83f4-db575130f873"},{"parameters":{"method":"POST","url":"https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content","value":"Aqu√≠ tienes la imagen adjunta üëá"}]},"options":{}},"name":"2. Enviar a Chatwoot","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3440,1408],"id":"bb8131d9-ee4a-4ce7-bfcd-6484ee58e6e9"},{"parameters":{"content":"## EJEMPLO IMAGENES\n","height":320,"width":560},"type":"n8n-nodes-base.stickyNote","position":[-3744,1328],"typeVersion":1,"id":"14ea41f0-1e70-47f8-ad8d-cad36bd5ba28","name":"Sticky Note"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2352,1056],"id":"da693219-5a37-4d6b-b186-6b04eb3a09a2","name":"If8"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1184,1440],"id":"00fb4ecc-2c2b-43c7-a5b0-3bc928404b03","name":"If23"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-976,1424],"id":"b350fa31-345e-420d-9213-4ccd1c603f30","name":"If26"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-624,1840],"id":"4b2323d7-ade6-4594-9192-1b4e2251a93b","name":"If27"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1248,1392],"typeVersion":1,"id":"ffa9ce31-0ae1-4e74-af8a-05d40968ab54","name":"Sticky Note2"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-752,1440],"id":"84b7f3b1-5259-47e9-976f-6a01df9ed583","name":"Wait","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-176,1648],"id":"acf88893-aecd-41e2-8a76-6b13efecaf2c","name":"If40"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[192,1856],"id":"324684bf-472a-4b17-a5fc-3b12d1f0e647","name":"If42"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1648],"id":"9da856cd-4d80-4b0d-84b5-9d412e3a3420","name":"Wait5","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1856],"id":"918310b1-c0da-46c2-80cf-8343bacd20a5","name":"Wait7","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[400,1872],"id":"30392c9c-d8a1-4a3a-8173-0ef149b4dadb","name":"Wait8","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-976,1600],"id":"3270bad6-15d8-4f71-a811-c3359fdab4e3","name":"Wait9","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[32,1664],"id":"e5ada578-5738-42b2-98f2-9c73991a85e8","name":"Wait10","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-608,1600],"id":"f693b423-1013-4d25-a66c-54422bfde206"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-2","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-784,1600],"id":"f2f64f92-df6b-4114-863d-2f5463a5bff7"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[0,1856],"id":"15cd3fea-5316-48c1-87b3-10b8b49c2919"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-3","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-176,1856],"id":"97e4385e-224d-4e1b-814b-55d7358b7f8e"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot34","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[720,1872],"id":"d96e4430-aea9-4374-b39b-75bec4c5b6dc"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-4","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[544,1872],"id":"d9dc6055-97c0-4412-8284-39dd78540a56"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot35","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[368,1664],"id":"e7946bf5-eb93-47a1-8f0a-788003fd3e1d"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-5","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[192,1664],"id":"b835a15f-edb3-45a2-b27b-a2905ade226f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot36","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-416,1440],"id":"97aa4aac-4a3b-4632-a2eb-32fe5486d166"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-6","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-592,1440],"id":"dd6f4397-190c-4511-84ba-a4ddb75136be"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":3},"conditions":[{"id":"b2a6d2d7-c61b-43ef-99fe-cc95d8413e94","leftValue":"={{ $json.body.conversation.messages[0].sender.phone_number }}","rightValue":51971119678,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-14480,592],"id":"65ea26bb-db5c-45f1-a288-c16501032d3c","name":"If5"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-14240,368],"id":"3b9693a6-6e3f-4174-9556-ba7477824248","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', ``, 'string') }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-13856,272],"id":"ff60e952-557a-4961-b575-24caf1329c1f","name":"pasar_supervisor","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $json.body.content }}\n\n","options":{"systemMessage":"=# üéØ ROL\nEres el Agente **Aura**. Tu √∫nica funci√≥n es extraer, **normalizar** y enviar un n√∫mero de tel√©fono a la tool \"pasar_supervisor\" El n√∫mero puede ser nacional (Per√∫) o extranjero, y debes procesarlo seg√∫n las reglas para que la tool reciba solo d√≠gitos.\n\n# üì• INPUT (Solicitud de Recepcionista)\nRecibir√°s una solicitud de la recepcionista para transferir un paciente.\nEl patr√≥n de la solicitud ser√° similar a: **Pasar a supervisor el n√∫mero: [N√∫mero variable]**\nEl n√∫mero puede llegar en formato completo (`519...`), solo el n√∫mero nacional (`9...`), o en formato internacional (`+1...`).\n\n# ‚öôÔ∏è INSTRUCCIONES ESTRICTAS (Funci√≥n sin Estado)\n\n1. Cada input es una solicitud √∫nica. Tu tarea finaliza con la ejecuci√≥n de la tool.\n\n2. **Identificaci√≥n:** Busca y extrae el n√∫mero que sigue inmediatamente al patr√≥n: **Pasar a supervisor el n√∫mero:** o **Manda a supervisor el n√∫mero**.\n\n3. **Normalizaci√≥n:** Antes de usar la tool, debes convertir el n√∫mero extra√≠do a un formato estandarizado de **solo d√≠gitos**, aplicando estas reglas en orden:\n    * **Limpieza:** Elimina todos los caracteres no num√©ricos (espacios, guiones, par√©ntesis, puntos, el signo `+`).\n    * **Normalizaci√≥n Per√∫ (9 d√≠gitos):** Si el n√∫mero tiene **9 d√≠gitos** y **no** comienza con `51`, asume que es un n√∫mero de Per√∫ y **precede** la cadena con `51`.\n    * **Normalizaci√≥n Internacional/Completo:** Si el n√∫mero comienza con `51` (11 d√≠gitos) o es cualquier otra longitud, √∫salo tal cual despu√©s de la limpieza.\n\n4. **Acci√≥n √önica:** Una vez extra√≠do y normalizado el n√∫mero, debes utilizar **exclusivamente** la tool **pasar_supervisor**.\n\n5. **Output:** Nunca respondas, expliques, ni devuelvas texto. Tu √∫nica acci√≥n es ejecutar la tool.\n\n### üìù EJEMPLO DE FLUJO DE TRABAJO\n\n| Input de la Recepcionista | L√≥gica de Normalizaci√≥n | Salida a la Tool |\n| :--- | :--- | :--- |\n| **Input 1 (Per√∫ Completo):** `Pasar a supervisor el n√∫mero: 51998765432` | N√∫mero original: `51998765432` (11 d√≠gitos). No requiere cambios. | `pasar_supervisor(51998765432)` |\n| **Input 2 (Internacional):** `Manda a supervisor el n√∫mero +1 (305) 417-1787` | Limpieza: `13054171787` (11 d√≠gitos). | `pasar_supervisor(13054171787)` |\n| **Input 3 (Per√∫ Corto):** `Manda a supervisor el n√∫mero 977571136` | 9 d√≠gitos. Se asume Per√∫. **Normaliza con 51**. | `pasar_supervisor(51977571136)` |\n\n## HERRAMIENTAS\n**Herramientas disponibles:** **pasar_supervisor**\n\n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-14256,192],"id":"ed307005-1e1d-4800-a494-8f1ee293347f","name":"supervisor"},{"parameters":{"workflowId":{"__rl":true,"value":"86itBT4QcMqbK21F","mode":"list","cachedResultUrl":"/workflow/86itBT4QcMqbK21F","cachedResultName":"[MANTENIMIENTO] Supwhatsapp"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('If19').item.json.body.conversation.messages[0].sender.phone_number }}","conversation_id":"={{ $('If19').item.json.body.conversation.messages[0].conversation_id }}","inbox_id":"={{ $('If19').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":[],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-14016,400],"id":"96b98de4-e095-42e3-83b8-8e9043aac552","name":"Call 'Supervisor healup'"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"Z1S8hBZOFvfBE7I5","mode":"list","cachedResultUrl":"/workflow/Z1S8hBZOFvfBE7I5","cachedResultName":"SUNAT | Enviar datos (General) | WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre', ``, 'string') }}","numero":"={{ $json.id }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},"matchingColumns":[],"schema":[{"id":"nombre","displayName":"nombre","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5664,752],"id":"39552a1a-a1b3-4538-a0c0-eefb20b529b8","name":"enviar_nombre"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    perfumes_full_size: [\n      \"9 pm\",\n      \"9 pm elixir\",\n      \"Aether extrait\",\n      \"Afeef Lattafa\",\n      \"Ajayeb Dubai\",\n      \"Ajwad pink to pink\",\n      \"Al Haramain Dubai Night\",\n      \"Al qiam golf\",\n      \"ALTHAIR PARFUMS de MARLY\",\n      \"Amber rouge\",\n      \"Amethyst\",\n      \"Amore caff√© Mancera\",\n      \"Aqua Dubai 100 ml\",\n      \"Art of nature II\",\n      \"Art of universe\",\n      \"Aruba gold\",\n      \"Atlas LATTAFA\",\n      \"Azzaro PARFUM\",\n      \"Azzaro the most wanted intense\",\n      \"Berry on top\",\n      \"Bharata chocolate\",\n      \"Bharata king EDP\",\n      \"Bharata king gold edition\",\n      \"Bharata Placid\",\n      \"BIANCO latte\",\n      \"CDN Intense man\",\n      \"CDN Sillage\",\n      \"CDN Urban Man Elixir\",\n      \"CDN woman\",\n      \"Champion goat\",\n      \"Champion money\",\n      \"Champion sugar\",\n      \"Chic Sonia\",\n      \"Choco overdose\",\n      \"Cloud Ariana grande\",\n      \"Club de nuit untold\",\n      \"Confidential\",\n      \"Cookie grave\",\n      \"Creed aventus\",\n      \"Creed millesime imperial\",\n      \"Creed silver mountain water\",\n      \"Decant\",\n      \"Diesel spirit\",\n      \"Eclaire\",\n      \"Eclaire banoffi\",\n      \"Eclaire pistache\",\n      \"EMEER\",\n      \"Erba gold\",\n      \"Erba pura\",\n      \"Fahkar Rose\",\n      \"Fakhar black\",\n      \"Fakhar gold\",\n      \"Fire on ice\",\n      \"GOS Blind bid\",\n      \"Gos bonus\",\n      \"GOS Boston\",\n      \"GOS Diamond\",\n      \"Gos Esmerald\",\n      \"GOS Full House\",\n      \"GOS Jackpot\",\n      \"GOS Moon\",\n      \"Gos no limit\",\n      \"GOS platinium\",\n      \"GOS Rouge\",\n      \"GOS Royale\",\n      \"GOS Wildcard\",\n      \"GOS Yellow Saphire\",\n      \"Haramain amber oud gold edition\",\n      \"HAWAS ice\",\n      \"Hawas malibu\",\n      \"Hayaati florence\",\n      \"Hayaati lataffa\",\n      \"Her confession\",\n      \"His Confession\",\n      \"Honor and glory\",\n      \"Invictus Parfum\",\n      \"INVICTUS VICTORY ELIXIR\",\n      \"Ishq al shuyukh silver\",\n      \"Island Khadlaj\",\n      \"Jean lowe azure\",\n      \"Jean lowe inmortel\",\n      \"JPG Le beau le parfum 120ml\",\n      \"JPG Le Male elixir 125ml\",\n      \"JPG LE MALE LE PARFUM\",\n      \"JPG Paradise Garden 125ml\",\n      \"Khamrah\",\n      \"Khamrah Dukhan\",\n      \"Kirk√© Tiziana Terenzi\",\n      \"Lataffa Ameer\",\n      \"Lattafa dynasty\",\n      \"LAYTON PARFUMS de MARLY\",\n      \"Mancera cedrat boise\",\n      \"Mancera coco vanille\",\n      \"Mancera Instant Crush\",\n      \"Mancera Red tobaco\",\n      \"Mandar√≠n elixir\",\n      \"Milestone\",\n      \"Montale Arabians Tonka\",\n      \"M√≥ntale intense caf√©\",\n      \"Nautica voyage\",\n      \"Naxos\",\n      \"Nitro Red\",\n      \"Nitro White\",\n      \"Noble blush\",\n      \"Now white\",\n      \"Now women\",\n      \"Odyssey artisto\",\n      \"Odyssey bahamas\",\n      \"Odyssey black forest\",\n      \"Odyssey Candee\",\n      \"Odyssey Eau de Montagne\",\n      \"Odyssey go mango\",\n      \"Odyssey Homme black EDP\",\n      \"Odyssey Homme white edition\",\n      \"Odyssey Limoni\",\n      \"Odyssey Mandarin sky\",\n      \"Odyssey mega edp\",\n      \"Odyssey revolution\",\n      \"Odyssey Spectra\",\n      \"Odyssey spectra blue\",\n      \"Odyssey toffe coffe\",\n      \"Odyssey Tyrant\",\n      \"Odyssey wild one\",\n      \"Orientica royal amber\",\n      \"Orientica Velvet Gold\",\n      \"OUD FOR GLORY\",\n      \"Qaed unlimited\",\n      \"Rave Now\",\n      \"Rayhaan Elixir\",\n      \"Rome Imagine\",\n      \"Rome paradox\",\n      \"Scandal intense\",\n      \"Scandal le parfum\",\n      \"Sehr\",\n      \"Shaheen\",\n      \"So candid\",\n      \"Spectre Malachite\",\n      \"Spectre wraith\",\n      \"Stronger with you intensly\",\n      \"Summer hammer/Lorenzo Pazzaglia\",\n      \"Sun-gria\",\n      \"Teriaq intense\",\n      \"Tharwah gold\",\n      \"The Kingdom\",\n      \"Turathi\",\n      \"Turathi Electric\",\n      \"Valentino born in Roma intense\",\n      \"Veneno\",\n      \"Versace Eros flame\",\n      \"Versace eros parfum\",\n      \"Vintage Radio\",\n      \"Winners trophy\",\n      \"Yara elixir\",\n      \"Yara lataffa\",\n      \"Yara Moi\",\n      \"Yara tous\",\n      \"Yves Saint Laurent Y EDP\"\n    ],\n\n    decants: [\n      \"BHARARA KING EDP\",\n      \"LATTAFA PRIDE PISA\",\n      \"HARANA\",\n      \"21:00:00\",\n      \"EJAAZI\",\n      \"CDN SILLAGE\",\n      \"GOS MOON\",\n      \"MANDARIN SKY\",\n      \"NAUTICA VOYAGE\",\n      \"ROYAL BLEU\",\n      \"ODYSSEY WHITE\",\n      \"JEAN LOWE MATIERE\",\n      \"SUBLIME\",\n      \"GOS ROUGE\",\n      \"9 PM REBEL\",\n      \"KHAMRAH\",\n      \"GOS YELLOW SAPPHIRE\",\n      \"GOS BOSTON\",\n      \"ASAD\",\n      \"TURATHI BLUE\",\n      \"CND SILLAGE\",\n      \"GOS ROYALE\",\n      \"OUD FOR GLORY\",\n      \"AL HARAMAIN GOLD EXTREME\",\n      \"ODYSSEY AOUD\",\n      \"VLO\",\n      \"EMEER\",\n      \"ISSEY MIYAKE\",\n      \"ODYSSEY TYRANT\",\n      \"ASAD ZANZIBAR\",\n      \"GOS BID\",\n      \"9AM\",\n      \"HAWAS ICE\",\n      \"GOS WILDCARD\",\n      \"YARA MOI\",\n      \"VENTANA ARMAF\",\n      \"CDN IMP√âRIALE\",\n      \"AL NASHAMA CAPRICE\",\n      \"YARA\",\n      \"BHARARA BLEU\",\n      \"GOS BLIND BID\",\n      \"GOS ACE\",\n      \"CDN MILESTONE\",\n      \"DETOUR NOIR\",\n      \"RAED LUXE\",\n      \"QAED UNLIMITED\",\n      \"AI HARAMAIN RUBY EDITION\",\n      \"HAWAS BLACK\",\n      \"HAYAATI\",\n      \"ODYSSEY HOMME BLACK\",\n      \"CDN URBAN MAN ELIXIR\",\n      \"CDN UNTOLD\",\n      \"MAAHIR LEGACY\",\n      \"LEGEND SPIRIT\",\n      \"SHAHEEN GOLD\",\n      \"YARA TOUS\",\n      \"FAKHAR ROSE\",\n      \"HONOR AND GLORY\",\n      \"DUBAI NIGHT\",\n      \"BHARARA KING PARFUM\",\n      \"LATTAFA JASOOR\",\n      \"GOS GOLD\",\n      \"CDN INTENSE MAN\",\n      \"GOS FULL HOUSE\",\n      \"ODYSSEY AQUA\",\n      \"HAYAATI AL MALEKY\",\n      \"GOS WIN\",\n      \"FAKHAR BLACK\",\n      \"GOS DIAMOND\",\n      \"KHAMRAH QAHWA\",\n      \"GOS HIGH ROLLER\",\n      \"THE KINGDOM\",\n      \"ODYSSEY MEGA\",\n      \"HAWAS FOR HIM\",\n      \"LATTAFA NEBRAS\",\n      \"AI HARAMAIN GOLD EDITION\",\n      \"AJWAD\",\n      \"RAVE NOW WHITE\",\n      \"ODYSSEY CANDEE\",\n      \"ODYSSEY SPECTRA\",\n      \"YARA CANDY\",\n      \"ODYSSEY LIMONI\",\n      \"AMBER ROUGE\",\n      \"SCEPTRE MALACHITE\",\n      \"VIKING KASHMIR\",\n      \"AI HARAMAIN PRIVATE EDITION\",\n      \"QAED AI FURSAN\",\n      \"GOS JACKPOT\",\n      \"VIKING DUBAI\",\n      \"ROYAL AMBER\",\n      \"BHARARA KING GOLD EDITION\",\n      \"HIS CONFESSION\",\n      \"VIKING CAIRO\",\n      \"BHARARA ELEGANCE\",\n      \"BHARARA PHARAOH 1\",\n      \"BHARARA PHARAOH 2\",\n      \"MAYAR\",\n      \"CLUB DE NUIT PRECIEUX\",\n      \"HER CONFESSION\",\n      \"AMETHYST LATTAFA\",\n      \"LATTAFA TERIAQ\",\n      \"AI HARAMAIN AQUA DUBAI\",\n      \"ASAD BOURBON\",\n      \"NITRO WHITE\",\n      \"LIQUID BURN\",\n      \"NITRO RED\",\n      \"NOBLE BLUSH\",\n      \"LATTAFA SEHR\",\n      \"ISLAND BLISS\",\n      \"LATTAFA ECLAIRE\",\n      \"AL HARAMAIN ROYAL MUSK\",\n      \"SUQRAAT\",\n      \"ISHQ AL SHUYUKH\",\n      \"LIAM BLUE\",\n      \"DUBAI CHOCOLAT\",\n      \"BHARARA CHOCOLATE\",\n      \"HAYA\",\n      \"ISHQ AL SHUYUKH GOLD\",\n      \"ANSAAM SILVER\",\n      \"VINTAGE RADIO\",\n      \"BHARARA ENCHANTED\",\n      \"GOS OPAL\",\n      \"ART OF UNIVERSE\",\n      \"LATTAFA CHIC\",\n      \"HAWAS ELIXIR\",\n      \"HAYA CRUSH\",\n      \"JEAN LOWE AZURE\",\n      \"ROME POUR HOMME\",\n      \"HAYAATI FLORENCE\",\n      \"VELVET GOLD\",\n      \"AJWAD PINK TO PINK\",\n      \"AL QIAM GOLD\",\n      \"ANGHAM LATTAFA\",\n      \"ARABIAN SKY\",\n      \"TAG UOMO ROSSO\",\n      \"TAG ART OF NATURE II\",\n      \"BHARARA PLACID\",\n      \"BHARARA SOLEIL\",\n      \"CDN WOMAN\",\n      \"CDN ICONIC\",\n      \"CONFIDENTIAL PRIVATE GOLD\",\n      \"DELILAH\",\n      \"GOS PLATINIUM OF SPADES\",\n      \"INTIMATION\",\n      \"ISLAND KHADLAJ\",\n      \"JEAN LOWE INMORTEL\",\n      \"JEAN LOWE VIBE\",\n      \"WINNERS TROPHY\",\n      \"KHANJAR EAU DE PARFUM\",\n      \"KISMET MAGIC\",\n      \"MANDARIN SKY ELIXIR\",\n      \"MAYAR CHERRY INTENSE\",\n      \"NITRO RED INTENSELY\",\n      \"NITRO NOW WOMEN\",\n      \"ODYSSEY ARTISTO\",\n      \"ODYSSEY WILD ONE\",\n      \"RAVE NOW RAYHAAN ELIXIR\",\n      \"NOW\",\n      \"SAKEENA\",\n      \"SO CANDID\",\n      \"TARWAH GOLD\",\n      \"LATTAFA TERIAQ INTENSE\",\n      \"VICTORIA LATTAFA\",\n      \"YUM YUM ARMAF\",\n      \"QISSA DELICIOUS\",\n      \"HAWAS TROPICAL\",\n      \"HAWAS FIRE\",\n      \"FAKHAR PLATIN\",\n      \"KHAMARAH DUKHAN\",\n      \"ODYSSEY EAU DE MONTAGNE\",\n      \"ODYSSEY REVOLUTION\",\n      \"ROME IMAGINE\",\n      \"TURATHI ELECTRIC\",\n      \"VULCAN NUE\",\n      \"SPECTRE WRAITH\",\n      \"GOS EMERALD OF SPADES\",\n      \"AFEEF\",\n      \"BHARARA ONYX\",\n      \"SCEPTRE DESERT\",\n      \"NITRO NEITHE\",\n      \"ODYSSEY BLACK FOREST\",\n      \"ODYSSEY TOFFEE COFFEE\",\n      \"ODYSSEY BAHAMAS\",\n      \"ODYSSEY MANGO\",\n      \"NITRO ELIXIR\",\n      \"ROME PARADOXE\",\n      \"ROME YUM YUM\",\n      \"ECLAIRE PISTACHE\",\n      \"ECLAIRE BANOFFEE\",\n      \"9PM ELIXIR\",\n      \"HAWAS MALIBU\",\n      \"HAWAS KOBRA\",\n      \"GOS BONUS DYNASTY FIRE\",\n      \"ON CIE\",\n      \"LOVELY CHERIE\"\n    ],\n\n    set_perfumes: [\n      \"Gos set\",\n      \"GOS Set 3 piezas jo milano\",\n      \"Set 9pm\",\n      \"Set art of universe\",\n      \"Set mandar√≠n\",\n      \"SET VERSACE NECESER + PERFUME + DECANT\",\n      \"Set YARA\",\n      \"Set Zadig & Voltaire this is her\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4736,416],"id":"8e853398-c1fd-4a9a-9894-11607d7d0832","name":"informacion_productos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"# ROL: \nEres un agente t√©cnico especializado en la verificaci√≥n de existencias y precios del cat√°logo de Brada Perfumes. Tu √∫nico objetivo es recibir nombres de perfumes, identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input y consultar la tool stock1 para obtener datos reales.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Productos: Los nombres de los perfumes en el input siempre vendr√°n entre comillas (ej. \"9 PM\", \"Hawas Ice\") para evitar confusi√≥n con el resto del mensaje.\nUso de la Tool stock1:\nDebes ejecutar la tool enviando el nombre exacto del perfume identificado en la variable perfume.\nSi el input contiene m√∫ltiples perfumes, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes mantener el nombre del perfume exactamente igual a como aparece en el cat√°logo, corrigiendo solo errores ortogr√°ficos evidentes seg√∫n tu conocimiento general.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo perfume\nVariable disponibilidad: Si la tool indica que el producto est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre de perfume): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s perfumes\nDebes listar cada perfume en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n# EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"Hola, revisa la disponibilidad de \"9 PM\" y \"Hawas Ice\".\"\nProceso interno:\nLlamada 1: stock1(perfume=\"9 PM\") -> Resultado: Disponible, S/ 140.\nLlamada 2: stock1(perfume=\"Hawas Ice\") -> Resultado: Agotado, S/ 180.\nOutput que debes enviar si son dos o m√°s perfumes: 9 PM: stock si y precio 140 soles. Hawas Ice: stock no y precio 180 soles.\n#NOTAS ADICIONALES\nNo inventes precios ni estados de stock.\nSi la tool no devuelve informaci√≥n para un nombre espec√≠fico, indica: (Nombre de perfume): stock no y precio (No disponible).\nTu respuesta debe ser exclusivamente la lista de stock solicitada, sin saludos ni despedidas adicionales\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5312,608],"id":"64458501-a4f8-45c4-aae9-17b34719c27a","name":"stock_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    \"distritos_permitidos\": [\n      \"Anc√≥n\", \"Ate\", \"Barranco\", \"Bre√±a\", \"Carabayllo\", \"Chaclacayo\", \n      \"Chorrillos\", \"Cieneguilla\", \"Comas\", \"El Agustino\", \"Independencia\", \n      \"Jes√∫s Mar√≠a\", \"La Molina\", \"La Victoria\", \"Lima\", \"Lince\", \n      \"Los Olivos\", \"Lurigancho\", \"Lur√≠n\", \"Magdalena del Mar\", \"Miraflores\", \n      \"Pachac√°mac\", \"Pucusana\", \"Pueblo Libre\", \"Puente Piedra\", \n      \"Punta Hermosa\", \"Punta Negra\", \"R√≠mac\", \"San Bartolo\", \"San Borja\", \n      \"San Isidro\", \"San Juan de Lurigancho\", \"San Juan de Miraflores\", \n      \"San Luis\", \"San Mart√≠n de Porres\", \"San Miguel\", \"Santa Anita\", \n      \"Santa Mar√≠a del Mar\", \"Santa Rosa\", \"Santiago de Surco\", \"Surquillo\", \n      \"Villa El Salvador\", \"Villa Mar√≠a del Triunfo\", \"Callao\", \"Bellavista\", \n      \"Carmen de la Legua Reynoso\", \"La Perla\", \"La Punta\", \"Ventanilla\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4432,400],"id":"09ca4414-ae98-4efb-aaa7-b0a7d4b68b45","name":"distritos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente especializado exclusivamente en la verificaci√≥n de existencias y precios de Decants (presentaciones de 5ml y 10ml) de Brada Perfumes. Tu objetivo es recibir el input del agente principal, identificar los perfumes y sus medidas, y consultar la tool stock_decants para devolver datos precisos.\n# INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Medidas: Debes prestar especial atenci√≥n a la cantidad solicitada (5ml o 10ml). Si el cliente no especifica la medida pero el contexto indica que es un decant, consulta ambas presentaciones.\nUso de la Tool stock_decants:\nDebes ejecutar la tool enviando el nombre del perfume y la medida identificada.\nSi el input contiene m√∫ltiples decants (ej. \"9 PM de 5ml y Hawas de 10ml\"), debes realizar una ejecuci√≥n de la tool por cada producto/medida individualmente.\nMantenimiento de Nomenclatura: Mant√©n el nombre t√©cnico del perfume (ej. \"Club de Nuit Intense\" en lugar de \"cnit\") seg√∫n la lista maestra.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato basado en los datos de la tool:\nCASO 1: Un solo decant\nVariable disponibilidad: Si la tool indica existencias, utiliza \"si\". Si no hay, utiliza \"no\".\nFormato de salida: (Nombre de perfume) ([Medida]): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s decants\nDebes listar cada decant en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad de decants: \"9 PM\" en 5ml y \"Hawas Ice\" en 10ml.\"\nProceso interno:\nLlamada 1: stock_decants(perfume=\"9 PM\", medida=\"5ml\") -> Resultado: Disponible, S/ 35.\nLlamada 2: stock_decants(perfume=\"Hawas Ice\", medida=\"10ml\") -> Resultado: Agotado, S/ 45.\nOutput (Lo que respondes): 9 PM (5ml): stock si y precio 35 soles. Hawas Ice (10ml): stock no y precio 45 soles.\n#REGLAS DE ORO\nProhibici√≥n de Inventar: No inventes precios. Si la tool no devuelve un precio para una medida espec√≠fica, responde: (Nombre de perfume) ([Medida]): stock no y precio (No disponible).\nExclusividad: Tu respuesta debe contener √∫nicamente la lista t√©cnica. No incluyas saludos, recomendaciones, ni frases de cierre.\nPrecisi√≥n de Medida: Aseg√∫rate de que el precio corresponda exactamente a la medida solicitada (un perfume de 10ml siempre es m√°s caro que uno de 5ml).\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5024,608],"id":"edf1ea9c-753a-4178-8823-ad4b5d276fde","name":"stock_decants"},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-4752,880],"id":"c65b6d98-6ca9-4850-a240-dc15d0e6f244","name":"OpenAI Chat Model5","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5008,880],"id":"f40c83eb-7af9-43d9-9718-23906d503917","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5328,848],"id":"4682821d-4ee5-4aa0-bfa8-6ee52c2d74b9","name":"OpenAI Chat Model6","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfumes","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-5168,816],"id":"db9c5a3b-41f0-489b-95b8-1818ea40b41b","name":"stock1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_decants","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4880,832],"id":"cca318d1-6e33-42b3-9253-f90ae5034239","name":"stock2","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfume_sets","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4592,880],"id":"6150c4ba-6b03-4325-b902-35091b0ac31b","name":"stock3","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente t√©cnico especializado exclusivamente en la verificaci√≥n de existencias y precios de los Sets de Perfumes (estuches de regalo o packs con complementos) de Brada Perfumes. Tu misi√≥n es recibir el nombre del set, validarlo contra la tool stock_set_perfumes y devolver la disponibilidad y precio real.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Sets: Los nombres de los sets suelen incluir la palabra \"Set\" (ej. \"Set Yara\", \"Set 9 PM\"). Debes identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input.\nUso de la Tool stock_set_perfumes:\nDebes ejecutar la tool enviando el nombre exacto del set en la variable nombre_set.\nSi el input contiene m√∫ltiples sets, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes respetar el nombre del set tal como aparece en el cat√°logo oficial de Brada Perfumes, asegur√°ndote de que se trate de la presentaci√≥n en estuche y no de la botella individual.\n#L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo Set\nVariable disponibilidad: Si la tool indica que el set est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre del Set): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s Sets\nDebes listar cada set en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad del SET: \"Set Yara\" y \"Set Art of Universe\".\"\nProceso interno:\nLlamada 1: stock_set_perfumes(nombre_set=\"Set Yara\") -> Resultado: Disponible, S/ 210.\nLlamada 2: stock_set_perfumes(nombre_set=\"Set Art of Universe\") -> Resultado: Disponible, S/ 250.\nOutput (Lo que respondes): Set Yara: stock si y precio 210 soles. Set Art of Universe: stock si y precio 250 soles.\n#REGLAS DE ORO\nPrecisi√≥n: No confundas un \"Perfume Full Size\" con un \"Set\". Si el input pide un Set, busca √∫nicamente en la categor√≠a de sets.\nProhibici√≥n de Inventar: No inventes precios ni disponibilidad. Si la tool no devuelve informaci√≥n para un set espec√≠fico, indica: (Nombre del Set): stock no y precio (No disponible).\nMinimalismo: Tu respuesta debe ser exclusivamente la lista t√©cnica solicitada. No incluyas saludos, despedidas ni comentarios sobre el contenido del set.\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-4736,656],"id":"6344ee20-9fcb-45bd-a342-5aaf79248763","name":"stock_set_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"bFX818cxJebYkS92","mode":"list","cachedResultUrl":"/workflow/bFX818cxJebYkS92","cachedResultName":"BRADA | WHATSAPP | compras confirmadas"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-4544,448],"id":"42a85e30-dd9d-47c7-af24-3eace4616f6f","name":"confirmacion_pedidos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1840,2160],"id":"86511a06-e0d8-496b-9161-edd28ac48fe2","name":"If24"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1632,2144],"id":"f6ed93e7-cd4c-4547-9b7c-9f3a9bd6174a","name":"If28"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1280,2560],"id":"6532091a-4da7-484e-bc59-551caaf8837a","name":"If29"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1904,2112],"typeVersion":1,"id":"4b346085-38b5-41dc-aa4e-0e5fd0d63b15","name":"Sticky Note3"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1408,2160],"id":"60a486b8-d8b9-45f7-bcc2-0237d9dacb35","name":"Wait1","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-832,2368],"id":"aec693f3-d181-42f6-96ef-f4259257f242","name":"If41"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-464,2576],"id":"d0bce6d9-8944-4f36-8369-887245578174","name":"If43"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2368],"id":"920f0b3f-260f-4a46-8f84-c7fafcb4e42d","name":"Wait11","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2576],"id":"9445a338-fa59-4652-b7a7-042da4ab0166","name":"Wait12","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-256,2592],"id":"1b4c198d-a84a-4886-bfee-45e03505844a","name":"Wait13","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1632,2320],"id":"985412b0-18a0-4a74-9383-848361eecf6d","name":"Wait14","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-624,2384],"id":"0b01e43e-8f88-4806-9aa3-aaafae23afa5","name":"Wait15","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1264,2320],"id":"455fc9a5-d692-424b-96af-4dc9dfb5ecfa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1440,2320],"id":"43ef0c39-d3b6-4ed3-9bbe-55b60f80b5a4"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-656,2576],"id":"71901a37-3c10-48e0-8c0d-ea488faf670e"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-7","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-832,2576],"id":"94b90b7c-2489-43c2-b38d-5f1d9ed48958"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot37","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[64,2592],"id":"70f90af3-d2d6-42bb-bbed-2a460fc13eb2"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-8","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-112,2592],"id":"79b9eee3-c9f3-43cc-945b-a659df940b42"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot38","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-288,2384],"id":"377a6011-2a90-4508-ad7a-18e8be515097"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-9","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-464,2384],"id":"4736c49f-51b0-433c-acaf-c5ec1975c27f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot39","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1072,2160],"id":"a211f2a4-e5b1-4b1b-b198-ecee0d6bdf3a"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-10","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1248,2160],"id":"e7fcf0ac-d57f-498d-84c2-efc72cefbb9c"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[336,720],"id":"2aaf0e50-945f-404a-a630-6c934c4bf678","name":"If25"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[544,704],"id":"db6e3976-9c81-410c-a089-cbbffed9a498","name":"If30"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[896,1120],"id":"3d9b40b9-6eb5-4641-9243-4acb6bbaab90","name":"If31"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[272,672],"typeVersion":1,"id":"9d6dc394-e9c9-47cf-bb8b-3ec6e169cd24","name":"Sticky Note4"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[768,720],"id":"e193f0ff-9818-4fff-ab4c-87a07ea2bc57","name":"Wait16","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1344,928],"id":"70a6f8d6-3ef1-45ad-be33-45e51b8b5bf7","name":"If44"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1712,1136],"id":"46e4e9c0-d629-4cae-a016-78122838bf5c","name":"If45"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,928],"id":"9005e0a0-7928-4432-afba-ecca82410842","name":"Wait17","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,1136],"id":"26654f8d-1377-49f2-b4ba-feefd58f29f5","name":"Wait18","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1920,1152],"id":"e5e9d5a8-676d-4787-ad0c-57a9cecb51e6","name":"Wait19","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[544,880],"id":"0a2148fa-6d21-4cef-85c9-2f9f7747051b","name":"Wait20","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1552,944],"id":"24a50f49-9fa7-444a-889d-b0a47dcdca22","name":"Wait21","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[912,880],"id":"73a2a9cb-96fa-4c67-b2c0-855467476004"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-11","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[736,880],"id":"2a355cf5-4023-4e5c-94cd-fb54d20ab48d"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot21","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1520,1136],"id":"e4e81844-daec-44fa-87e1-8a40c9f593e1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-12","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1344,1136],"id":"124b0253-10a5-4f3f-8b46-7e729f639b4b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot40","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2240,1152],"id":"d7a77253-dcf2-4e33-9699-ace3f5cf9843"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-13","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2064,1152],"id":"47d740d9-af91-4b47-a3d9-43f6089948ac"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot41","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1888,944],"id":"ba55a9c2-6648-4009-9d21-cbad56eea3fa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-14","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1712,944],"id":"09553178-8112-4313-b41f-7edb86da9bb2"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot42","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1104,720],"id":"a287f371-7d38-4b62-96ac-80a54a0f4a85"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-15","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[928,720],"id":"5a670fc0-4c1b-45d5-bf03-f2cce3d56697"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-144,0],"id":"21286fd2-eb14-4621-961c-daf1710c98db","name":"If32"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[64,-16],"id":"9298649c-49d2-4ef9-a38d-d1ecd699741a","name":"If33"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[416,400],"id":"0335f432-f2cb-43bf-9855-8b773b8fd74f","name":"If34"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-208,-48],"typeVersion":1,"id":"f7db0934-d8a5-4643-8ea5-3b74f9fd30ff","name":"Sticky Note5"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[288,0],"id":"edc5d3e6-6cb7-4e24-a395-5bfd2ec21e8f","name":"Wait22","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[864,208],"id":"3d08713e-6783-4344-835a-52021892fc79","name":"If46"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1232,416],"id":"a3ff7975-1b42-4ee2-8d28-a9e2530627ea","name":"If47"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,208],"id":"050e27ee-0dc9-4cfe-9b3b-4984fdb3c424","name":"Wait23","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,416],"id":"316376c3-954b-4325-ab08-caadfb880e67","name":"Wait24","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1440,432],"id":"cfc28de1-e1fa-4583-80c7-4806a6cd7ad1","name":"Wait25","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[64,160],"id":"e8d0be90-195b-413a-b96d-28c469da7d2a","name":"Wait26","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1072,224],"id":"83b77384-ab0f-442c-aa8e-20cbf18ba56b","name":"Wait27","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot22","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[432,160],"id":"91fe9d8e-e24c-4675-9a65-5c3b96805cd1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[256,160],"id":"b2aa295f-bb56-4faf-bc6e-2c244ae1b8b5"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot23","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1040,416],"id":"42af2c54-fd06-4e53-9b3e-386ae18aad48"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[864,416],"id":"334d03f2-3acd-4c43-9e5c-e5c9ec1fab6b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot43","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1760,432],"id":"a10b0be7-7ad4-4a67-b580-1f6c8f63dd0b"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1584,432],"id":"3ae52091-798e-4106-ad81-b391a548b061"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot44","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1408,224],"id":"634d84c9-0fb9-4dc6-a691-70a9eb6eaff6"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1232,224],"id":"4c0fbfdd-c75a-4058-9fb3-c934f00a1774"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot45","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[624,0],"id":"c8374285-c938-46a3-ab3d-a8987b53dafe"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[448,0],"id":"8a5f2626-93c0-485f-83b6-88d1b7969f67"}],"connections":{"AI Agent":{"main":[[{"node":"Verificador1","type":"main","index":0}]]},"Auto-fixing Output Parser1":{"ai_outputParser":[[{"node":"Verificador1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model8":{"ai_languageModel":[[{"node":"Auto-fixing Output Parser1","type":"ai_languageModel","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"Auto-fixing Output Parser1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model9":{"ai_languageModel":[[{"node":"Verificador1","type":"ai_languageModel","index":0}]]},"Verificador1":{"main":[[{"node":"ordenar","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Get a row3","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"If2":{"main":[[{"node":"Update a row1","type":"main","index":0}],[{"node":"If3","type":"main","index":0}]]},"If3":{"main":[[{"node":"Switch3","type":"main","index":0}],[{"node":"No Operation, do nothing4","type":"main","index":0}]]},"Edit Fields4":{"main":[[{"node":"If2","type":"main","index":0}]]},"If13":{"main":[[{"node":"Get a row1","type":"main","index":0}],[{"node":"Create a row","type":"main","index":0}]]},"Calendario":{"ai_tool":[[]]},"Create a row":{"main":[[{"node":"Get a row1","type":"main","index":0}]]},"Get a row1":{"main":[[{"node":"Edit Fields4","type":"main","index":0}]]},"Update a row1":{"main":[[{"node":"Switch3","type":"main","index":0}]]},"Get a row":{"main":[[{"node":"If13","type":"main","index":0}]]},"If4":{"main":[[{"node":"If11","type":"main","index":0}],[{"node":"Fecha","type":"main","index":0}]]},"Formatea fecha":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Handler variables":{"main":[[{"node":"If10","type":"main","index":0}]]},"Fecha":{"main":[[{"node":"Formatea fecha","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Handler variables","type":"main","index":0}]]},"Wait6":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"If6":{"main":[[{"node":"Redis1","type":"main","index":0}],[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"Delete Redis":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Edit Fields19":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"Get Redis1":{"main":[[{"node":"If6","type":"main","index":0}]]},"Edit Fields20":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"If15":{"main":[[{"node":"Edit Fields19","type":"main","index":0}],[{"node":"Edit Fields20","type":"main","index":0}]]},"METER_ANUNCIO":{"main":[[{"node":"guarda_ANUNCIO","type":"main","index":0}]]},"BAJAR_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"guarda_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"If":{"main":[[{"node":"RESUMIDOR ANUNCIOS","type":"main","index":0}],[{"node":"If4","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"RESUMIDOR ANUNCIOS","type":"ai_languageModel","index":0}]]},"If10":{"main":[[{"node":"METER_ANUNCIO","type":"main","index":0}],[{"node":"BAJAR_ANUNCIO","type":"main","index":0}]]},"Redis1":{"main":[[{"node":"If15","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"If16","type":"main","index":0}]]},"Edit Fields12":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"AUDIO1","type":"main","index":0}]]},"Switch3":{"main":[[{"node":"HTTP Request","type":"main","index":0}],[{"node":"OpenAI","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}]]},"AUDIO1":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"If16":{"main":[[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields12","type":"main","index":0}]]},"Edit Fields17":{"main":[[{"node":"If","type":"main","index":0}]]},"If11":{"main":[[{"node":"Update a row4","type":"main","index":0}]]},"If12":{"main":[[{"node":"Get a row","type":"main","index":0}],[{"node":"If20","type":"main","index":0}]]},"If20":{"main":[[{"node":"Update a row6","type":"main","index":0}]]},"If1":{"main":[[{"node":"If12","type":"main","index":0}]]},"ordenar":{"main":[[{"node":"Respuesta1","type":"main","index":0}]]},"Respuesta1":{"main":[[{"node":"Update a row","type":"main","index":0}]]},"Wait2":{"main":[[{"node":"Respuesta2","type":"main","index":0}]]},"Respuesta2":{"main":[[{"node":"Update a row3","type":"main","index":0}]]},"If14":{"main":[[{"node":"Wait3","type":"main","index":0}],[{"node":"If23","type":"main","index":0}]]},"Wait3":{"main":[[{"node":"Respuesta3","type":"main","index":0}]]},"Respuesta3":{"main":[[{"node":"Update a row5","type":"main","index":0}]]},"If17":{"main":[[{"node":"Wait4","type":"main","index":0}],[{"node":"If32","type":"main","index":0}]]},"Wait4":{"main":[[{"node":"Respuesta4","type":"main","index":0}]]},"Respuesta4":{"main":[[{"node":"Update a row7","type":"main","index":0}]]},"RESUMIDOR ANUNCIOS":{"main":[[{"node":"If4","type":"main","index":0}]]},"Supervisor":{"ai_tool":[[]]},"Update a row":{"main":[[{"node":"If8","type":"main","index":0}]]},"Update a row3":{"main":[[{"node":"If14","type":"main","index":0}]]},"Update a row5":{"main":[[{"node":"If17","type":"main","index":0}]]},"Get a row3":{"main":[[{"node":"If19","type":"main","index":0}]]},"If19":{"main":[[{"node":"If5","type":"main","index":0}]]},"Update a row7":{"main":[[{"node":"If25","type":"main","index":0}]]},"If7":{"main":[[{"node":"Update a row9","type":"main","index":0}],[{"node":"Create a row1","type":"main","index":0}]]},"Get a row2":{"main":[[{"node":"If7","type":"main","index":0}]]},"Create a row1":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"RAZONADOR PLUS":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Update a row9":{"main":[[{"node":"Wait6","type":"main","index":0}]]},"1. Descargar Imagen":{"main":[[{"node":"2. Enviar a Chatwoot","type":"main","index":0}]]},"If8":{"main":[[{"node":"Wait2","type":"main","index":0}],[{"node":"If24","type":"main","index":0}]]},"If23":{"main":[[{"node":"If26","type":"main","index":0}],[{"node":"Wait9","type":"main","index":0}]]},"If26":{"main":[[],[{"node":"Wait","type":"main","index":0}]]},"If27":{"main":[[{"node":"Wait5","type":"main","index":0}],[{"node":"Wait7","type":"main","index":0}]]},"Wait":{"main":[[{"node":"1. Descargar Imagen 1-6","type":"main","index":0}]]},"If40":{"main":[[],[{"node":"Wait10","type":"main","index":0}]]},"If42":{"main":[[],[{"node":"Wait8","type":"main","index":0}]]},"Wait5":{"main":[[{"node":"If40","type":"main","index":0}]]},"Wait7":{"main":[[{"node":"1. Descargar Imagen 1-3","type":"main","index":0}]]},"Wait8":{"main":[[{"node":"1. Descargar Imagen 1-4","type":"main","index":0}]]},"Wait9":{"main":[[{"node":"1. Descargar Imagen 1-2","type":"main","index":0}]]},"Wait10":{"main":[[{"node":"1. Descargar Imagen 1-5","type":"main","index":0}]]},"2. Enviar a Chatwoot16":{"main":[[{"node":"If27","type":"main","index":0}]]},"1. Descargar Imagen 1-2":{"main":[[{"node":"2. Enviar a Chatwoot16","type":"main","index":0}]]},"2. Enviar a Chatwoot19":{"main":[[{"node":"If42","type":"main","index":0}]]},"1. Descargar Imagen 1-3":{"main":[[{"node":"2. Enviar a Chatwoot19","type":"main","index":0}]]},"1. Descargar Imagen 1-4":{"main":[[{"node":"2. Enviar a Chatwoot34","type":"main","index":0}]]},"1. Descargar Imagen 1-5":{"main":[[{"node":"2. Enviar a Chatwoot35","type":"main","index":0}]]},"1. Descargar Imagen 1-6":{"main":[[{"node":"2. Enviar a Chatwoot36","type":"main","index":0}]]},"If5":{"main":[[{"node":"supervisor","type":"main","index":0}],[{"node":"If1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"supervisor","type":"ai_languageModel","index":0}]]},"pasar_supervisor":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"Call 'Supervisor healup'":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"enviar_nombre":{"ai_tool":[[]]},"informacion_productos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"distritos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_decants":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model5":{"ai_languageModel":[[{"node":"stock_set_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model6":{"ai_languageModel":[[{"node":"stock_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"stock_decants","type":"ai_languageModel","index":0}]]},"stock1":{"ai_tool":[[{"node":"stock_perfumes","type":"ai_tool","index":0}]]},"stock2":{"ai_tool":[[{"node":"stock_decants","type":"ai_tool","index":0}]]},"stock3":{"ai_tool":[[{"node":"stock_set_perfumes","type":"ai_tool","index":0}]]},"stock_set_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"confirmacion_pedidos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"If24":{"main":[[{"node":"If28","type":"main","index":0}],[{"node":"Wait14","type":"main","index":0}]]},"If28":{"main":[[],[{"node":"Wait1","type":"main","index":0}]]},"If29":{"main":[[{"node":"Wait11","type":"main","index":0}],[{"node":"Wait12","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"1. Descargar Imagen 1-10","type":"main","index":0}]]},"If41":{"main":[[],[{"node":"Wait15","type":"main","index":0}]]},"If43":{"main":[[],[{"node":"Wait13","type":"main","index":0}]]},"Wait11":{"main":[[{"node":"If41","type":"main","index":0}]]},"Wait12":{"main":[[{"node":"1. Descargar Imagen 1-7","type":"main","index":0}]]},"Wait13":{"main":[[{"node":"1. Descargar Imagen 1-8","type":"main","index":0}]]},"Wait14":{"main":[[{"node":"1. Descargar Imagen 1-","type":"main","index":0}]]},"Wait15":{"main":[[{"node":"1. Descargar Imagen 1-9","type":"main","index":0}]]},"2. Enviar a Chatwoot17":{"main":[[{"node":"If29","type":"main","index":0}]]},"1. Descargar Imagen 1-":{"main":[[{"node":"2. Enviar a Chatwoot17","type":"main","index":0}]]},"2. Enviar a Chatwoot20":{"main":[[{"node":"If43","type":"main","index":0}]]},"1. Descargar Imagen 1-7":{"main":[[{"node":"2. Enviar a Chatwoot20","type":"main","index":0}]]},"1. Descargar Imagen 1-8":{"main":[[{"node":"2. Enviar a Chatwoot37","type":"main","index":0}]]},"1. Descargar Imagen 1-9":{"main":[[{"node":"2. Enviar a Chatwoot38","type":"main","index":0}]]},"1. Descargar Imagen 1-10":{"main":[[{"node":"2. Enviar a Chatwoot39","type":"main","index":0}]]},"If25":{"main":[[{"node":"If30","type":"main","index":0}],[{"node":"Wait20","type":"main","index":0}]]},"If30":{"main":[[],[{"node":"Wait16","type":"main","index":0}]]},"If31":{"main":[[{"node":"Wait17","type":"main","index":0}],[{"node":"Wait18","type":"main","index":0}]]},"Wait16":{"main":[[{"node":"1. Descargar Imagen 1-15","type":"main","index":0}]]},"If44":{"main":[[],[{"node":"Wait21","type":"main","index":0}]]},"If45":{"main":[[],[{"node":"Wait19","type":"main","index":0}]]},"Wait17":{"main":[[{"node":"If44","type":"main","index":0}]]},"Wait18":{"main":[[{"node":"1. Descargar Imagen 1-12","type":"main","index":0}]]},"Wait19":{"main":[[{"node":"1. Descargar Imagen 1-13","type":"main","index":0}]]},"Wait20":{"main":[[{"node":"1. Descargar Imagen 1-11","type":"main","index":0}]]},"Wait21":{"main":[[{"node":"1. Descargar Imagen 1-14","type":"main","index":0}]]},"2. Enviar a Chatwoot18":{"main":[[{"node":"If31","type":"main","index":0}]]},"1. Descargar Imagen 1-11":{"main":[[{"node":"2. Enviar a Chatwoot18","type":"main","index":0}]]},"2. Enviar a Chatwoot21":{"main":[[{"node":"If45","type":"main","index":0}]]},"1. Descargar Imagen 1-12":{"main":[[{"node":"2. Enviar a Chatwoot21","type":"main","index":0}]]},"1. Descargar Imagen 1-13":{"main":[[{"node":"2. Enviar a Chatwoot40","type":"main","index":0}]]},"1. Descargar Imagen 1-14":{"main":[[{"node":"2. Enviar a Chatwoot41","type":"main","index":0}]]},"1. Descargar Imagen 1-15":{"main":[[{"node":"2. Enviar a Chatwoot42","type":"main","index":0}]]},"If32":{"main":[[{"node":"If33","type":"main","index":0}],[{"node":"Wait26","type":"main","index":0}]]},"If33":{"main":[[],[{"node":"Wait22","type":"main","index":0}]]},"If34":{"main":[[{"node":"Wait23","type":"main","index":0}],[{"node":"Wait24","type":"main","index":0}]]},"Wait22":{"main":[[{"node":"1. Descargar Imagen 1-20","type":"main","index":0}]]},"If46":{"main":[[],[{"node":"Wait27","type":"main","index":0}]]},"If47":{"main":[[],[{"node":"Wait25","type":"main","index":0}]]},"Wait23":{"main":[[{"node":"If46","type":"main","index":0}]]},"Wait24":{"main":[[{"node":"1. Descargar Imagen 1-17","type":"main","index":0}]]},"Wait25":{"main":[[{"node":"1. Descargar Imagen 1-18","type":"main","index":0}]]},"Wait26":{"main":[[{"node":"1. Descargar Imagen 1-16","type":"main","index":0}]]},"Wait27":{"main":[[{"node":"1. Descargar Imagen 1-19","type":"main","index":0}]]},"2. Enviar a Chatwoot22":{"main":[[{"node":"If34","type":"main","index":0}]]},"1. Descargar Imagen 1-16":{"main":[[{"node":"2. Enviar a Chatwoot22","type":"main","index":0}]]},"2. Enviar a Chatwoot23":{"main":[[{"node":"If47","type":"main","index":0}]]},"1. Descargar Imagen 1-17":{"main":[[{"node":"2. Enviar a Chatwoot23","type":"main","index":0}]]},"1. Descargar Imagen 1-18":{"main":[[{"node":"2. Enviar a Chatwoot43","type":"main","index":0}]]},"1. Descargar Imagen 1-19":{"main":[[{"node":"2. Enviar a Chatwoot44","type":"main","index":0}]]},"1. Descargar Imagen 1-20":{"main":[[{"node":"2. Enviar a Chatwoot45","type":"main","index":0}]]}},"authors":"Juan Pablo Jesus Bazan Ramos","name":null,"description":null,"autosaved":false,"workflowPublishHistory":[{"createdAt":"2026-01-21T02:18:44.974Z","id":708,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"activated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"},{"createdAt":"2026-01-21T02:48:48.349Z","id":711,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"deactivated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"},{"createdAt":"2026-01-21T04:06:49.280Z","id":721,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"deactivated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"},{"createdAt":"2026-01-21T02:21:39.965Z","id":709,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"deactivated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"},{"createdAt":"2026-01-21T04:13:41.322Z","id":722,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"activated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"},{"createdAt":"2026-01-21T02:40:10.134Z","id":710,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"activated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"},{"createdAt":"2026-01-21T04:04:45.436Z","id":720,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"activated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"}]}}
[2026-01-21T04:39:47.438Z] Request received: {"active":false,"clientKey":"brada"}
[2026-01-21T04:39:47.439Z] Resolved Client: brada -> TargetID: MS7xFmf_BBVmAGXBcL
[2026-01-21T04:39:47.439Z] API Config - BaseURL: https://acn8n.alefcompany.online/api/v1, KeyLength: 207
[2026-01-21T04:39:47.440Z] Executing n8n action: deactivate on MS7xFmf_BBVmAGXBcL
[ERROR] CRITICAL FAILURE: [POST] "https://acn8n.alefcompany.online/api/v1/workflows/MS7xFmf_BBVmAGXBcL/deactivate": 404 Not Found
[2026-01-21T04:49:20.128Z] Request received: {"active":false,"clientKey":"brada"}
[2026-01-21T04:49:20.129Z] Resolved Client: brada -> TargetID: bIVpE1aXwtICWRcyHjLUv
[2026-01-21T04:49:20.130Z] API Config - BaseURL: https://acn8n.alefcompany.online/api/v1, KeyLength: 207
[2026-01-21T04:49:20.132Z] Executing n8n action: deactivate on bIVpE1aXwtICWRcyHjLUv
[2026-01-21T04:49:21.262Z] n8n Response: {"updatedAt":"2026-01-12T22:41:59.443Z","createdAt":"2026-01-08T17:51:46.711Z","id":"bIVpE1aXwtICWRcyHjLUv","name":"BRADAWHATSAPP","description":null,"active":false,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $('Delete Redis').first().json.response }}\nCurrent date: {{ $('Formatea fecha').first().json.formattedDate }}\nEl numero del whatsapp del paciente es: {{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n\n## CLASIFICACI√ìN DE TEXTO:\nTe va a llegar los mensajes en parte de esta forma:\nTexto mensaje: [Mensaje]\nAudio transcripto: [audio trascripto]\nImagen analizada: [mensaje analizado]\nesto es para que sepas diferenciar los audios, imagenes, y textos que te manden.\n","options":{"systemMessage":"=#ROL\n1. IDENTIDAD Y VOCABULARIO (EL \"QUI√âN\" Y \"QU√â\" DECIR)\nEsta secci√≥n define su personalidad y el est√°ndar de lenguaje que debe utilizar para conectar con el cliente que desea comprar en Brada Perfumes.\nNombre: Diego.\nCargo: Asesor de ventas de la tienda ‚ÄúBrada Perfumes‚Äù, especializado en alta perfumer√≠a y fragancias √°rabes.\nTrato al Cliente: Uso de un tono simple, cercano y directo. Se evita la informalidad excesiva\nUso de \"Hermano\": El t√©rmino \"hermano\" queda restringido √∫nicamente al saludo inicial. No debe utilizarse en el resto de la conversaci√≥n para evitar un exceso de confianza.\nRestricci√≥n Cr√≠tica: Queda estrictamente prohibido el uso de apelativos exagerados como \"perfum√≥n\" o \"joyita\". Tambi√©n se proh√≠be el lenguaje rob√≥tico, el trato formal de \"Usted\" y el uso de diminutivos (ej. \"perfumito\", \"botellita\").\nEjemplo de Aplicaci√≥n: \nEntrada: \"hola que tal, precio de asad\" \nRespuesta de Diego: \"Hola hermano, que tal? El Lattafa Asad s√≠ lo tenemos disponible, aqu√≠ te paso los detalles...\"\n\n2. PROTOCOLOS DE COMUNICACI√ìN (EL \"C√ìMO\" HABLAR)\nEsta secci√≥n establece la mec√°nica de sus respuestas para garantizar una venta √°gil, persuasiva y aut√©ntica.\nRegla de Interacci√≥n: Responder mensaje por mensaje para mantener un ritmo de chat natural.\nRegla de Extensi√≥n Adaptativa:\nRespuestas Simples: M√°ximo 2 l√≠neas para saludos iniciales o confirmaciones de recepci√≥n.\nRespuestas de Cat√°logo: Entrega de la informaci√≥n clave (precio, disponibiidad y nombre del producto) bas√°ndose en las tres tools seg√∫n las reglas correspondientes a su uso en la secci√≥n: ‚Äú\nRegla de Estructura: Si el cliente pregunta por varias fragancias, responda de forma ordenada destacando lo mejor de cada una.\nRegla de Est√©tica: Uso din√°mico de 1 emoji por mensaje (üî•, üí®, ) para transmitir la energ√≠a y exclusividad de las fragancias.\nRegla de No-Repetici√≥n:\nNo repita el saludo de bienvenida si el cliente contin√∫a la conversaci√≥n m√°s tarde.\nSi el cliente no entiende una nota olfativa, use comparaciones sencillas (ej. \"huele a limpio\", \"es bien dulcecito\") sin perder la base t√©cnica.\n3. L√ìGICA DE OBJETIVOS (EL \"PARA QU√â\" ACTUAR)\nEsta secci√≥n rige sus decisiones estrat√©gicas, priorizando la asesor√≠a efectiva y el cierre de ventas seguro.\nMisi√≥n Principal: Identificar el nombre del perfume que desee el cliente) y resolver dudas sobre stock y env√≠os usando exclusivamente las tools.\nFiltro de Pago y Env√≠o: Prohibido solicitar datos de env√≠o o confirmar pedidos si el cliente no ha pasado por el \"Filtro de Validaci√≥n de Pago\" (An√°lisis de imagen del comprobante).\nFiltro de Asesor√≠a: Ante consultas sobre reclamos, devoluciones o pedidos de asesor√≠a m√©dica/piel muy complejos, debe derivar inmediatamente al supervisor.\nIntegridad de Stock: Prohibido inventar disponibilidad o precios. La √∫nica fuente v√°lida es el output de la tool stock_real.\n#CONOCIMIENTO GENERAL\n### ¬øQu√© es Brada Perfumes?\nEs una tienda especializada en alta perfumer√≠a y fragancias √°rabes exclusivas. Como asesor de ventas, tu objetivo es orientar a los clientes para encontrar su fragancia ideal y cerrar la venta de forma √°gil.\n### Cat√°logo de Productos\nBrada Perfumes ofrece tres categor√≠as de productos. Para conocer la lista actualizada de existencias, siempre debes ejecutar la tool informacion_perfumes al inicio de la consulta:\n**Perfumes Full Size**: Botellas completas en su presentaci√≥n original (ej. 100ml, 120ml).\nEjemplos clave: 9 PM, Hawas Ice, Khamrah, Asad, Creed Aventus.\n**Decants**: Perfumes originales trasvasados a presentaciones peque√±as de 5ml o 10ml. Son ideales para que el cliente pruebe la fragancia antes de comprar el frasco grande.\nEjemplos clave: YSL EDP, Club de Nuit Intense, Scandal.\n**Sets de Perfumes**: Estuches especiales que incluyen la fragancia principal y complementos (lociones, geles o miniaturas).\nEjemplos clave: Set Yara, Set 9pm, Set Art of Universe.\nNota Operativa: La tool informacion_perfumes es tu √∫nica fuente de verdad para nombres de productos. Si un cliente menciona un nombre que no est√° en la tool, verifica si existe un nombre similar por error ortogr√°fico antes de confirmar disponibilidad.\n# REGLAS DE ORO\n## **Regla de uso de la tool ‚Äúinformaci√≥n_perfumes‚Äù**.\nAl recibir el mensaje del cliente, SIEMPRE usa la tool ‚Äúinformacion_perfumes‚Äù antes de redactar la respuesta. Esta tool te devolver√° todos los productos que vende nuestra tienda ‚ÄúBrada Perfumes‚Äù los cuales est√°n divididos en tres categor√≠as: ‚ÄúPerfumes full size‚Äù, ‚ÄúDecants‚Äù y ‚Äúset de perfumes‚Äù\nRestricci√≥n de datos: Cabe aclarar que esta tool NO CONTIENE PRECIOS NI STOCK REAL. Su √∫nica funci√≥n es servir de gu√≠a de nomenclatura formal para identificar los productos que ofrecemos. \n## **Regla de ortograf√≠a**\nEsta regla rige c√≥mo Diego debe interpretar y responder a los mensajes con errores de escritura.\n* Inteligencia Sem√°ntica: Diego debe ignorar errores ortogr√°ficos, de puntuaci√≥n o de tildes del cliente para identificar la intenci√≥n real.\nMapeo Autom√°tico: Si el cliente escribe incorrectamente el nombre de un perfume (ej. \"habas ice\", \"9pm elicsir\", \"latifa asad\"), Diego debe asociarlo mentalmente con el producto correcto de la tool ‚ÄúInformacion_productos‚Äù sin pedir aclaraciones.\nNaturalidad en la Respuesta: Al responder, Diego debe escribir los nombres de los perfumes de forma correcta (seg√∫n la tool ‚ÄúInformacion_productos‚Äù) para mantener el profesionalismo, pero sin resaltar el error del cliente.\nEjemplo de Aplicaci√≥n:\n- Entrada del cliente: \"hola ermano presio del cnit untold\"\n- Acci√≥n de Diego: Identifica \"hermano\", \"precio\" y \"Club de Nuit Untold\".\n- Respuesta de Diego: \"Hola hermano, el Club de Nuit Untold s√≠ lo tenemos disponible. El precio es de S/...\"\n## **Regla de cierre variable**\nEsta regla evita que Diego suene como un robot de ventas insistente.\nFinalizaci√≥n Variable: No es obligatorio terminar cada mensaje con una pregunta. Diego debe evaluar si la conversaci√≥n requiere una pregunta para avanzar o si una afirmaci√≥n directa es m√°s natural seg√∫n el contexto.\nGu√≠a de Ejemplos: El agente debe seguir estrictamente la estructura de la secci√≥n \"EJEMPLOS DE CONVERSACI√ìN\" para identificar en qu√© fases se cierra con una pregunta y en cu√°les se cierra con una instrucci√≥n directa (ej. al pedir el comprobante o solicitar datos).\nCero Presi√≥n: Si el cliente muestra inter√©s general pero no intenci√≥n de compra, Diego debe responder de forma informativa y cerrar de manera amable sin presionar por una respuesta inmediata.\n## Regla de tiempo de entrega:\nEsta regla rige c√≥mo informar sobre la llegada del pedido utilizando la hora actual seg√∫n el input (current_date).\nPara Lima (env√≠o por motorizado): Si el pago se valida antes de las 10:00 am, el pedido llega el mismo d√≠a. De lo contrario, llega el d√≠a de ma√±ana.\nPara Provincia (env√≠o por la agencia Shalom): Si el pago se valida antes de las 4:00 pm, se entrega a la agencia el mismo d√≠a. El tiempo de viaje es de 2 a 5 d√≠as h√°biles.\nAplicaci√≥n: Responde siempre con seguridad seg√∫n la hora actual. No des rangos vagos si el cliente ya pas√≥ el l√≠mite de hora.\n## Regla de env√≠os\nPol√≠tica: Solo realizamos env√≠os a domicilio o agencia; no contamos con la opci√≥n de recojo en tienda f√≠sica.\nAplicaci√≥n: Si el cliente pregunta por una direcci√≥n f√≠sica para recoger su pedido, inf√≥rmele amablemente que operamos exclusivamente mediante env√≠os.\n## Regla de solicitudes presenciales\nAplica cuando el cliente desea visitar el local, ver los perfumes en persona o agendar una cita presencial.\nEjemplos de activaci√≥n: \"Quiero ir a ver los perfumes en persona\", \"Podemos programar una cita para ir de manera presencial con mi amigo\" o \"¬øD√≥nde est√°n ubicados para ir hoy?\".\nAcci√≥n: Utilice la tool pasar_supervisor.\nRespuesta obligatoria: \"Voy a comunicarme con mi compa√±ero para que te confirme el horario\".\n\n\n\n#FASES DE FLUJO DE FUNCIONAMIENTO\n## FASE 1: 1. SALUDO Y PROTOCOLO INICIAL\nEsta fase establece el primer contacto. El saludo se env√≠a una sola vez en toda la conversaci√≥n y no se solicita el nombre del cliente.\nL√≥gica de Inicio seg√∫n el mensaje del cliente:\nESCENARIO A: Mensaje gen√©rico o sin producto identificado Aplica cuando el cliente dice \"Hola\", \"Info\", \"Precios\", o env√≠a un mensaje que no menciona un producto de la Lista Maestra.\nAcci√≥n: Saludar de forma directa.\nRespuesta Obligatoria: \"Hola hermano, en qu√© perfume est√°s interesado?\".\nESCENARIO B: El cliente menciona un perfume o marca desde el inicio Aplica cuando el cliente consulta directamente por un producto (ej: \"precio del hawas\").\nAcci√≥n 1 : Asociar el t√©rmino con el nombre t√©cnico de la lista de ‚Äúperfumes_full_size‚Äù de la tool ‚Äúinformacion_productos‚Äù (ej: \"9pm\" ‚Üí \"9 PM\").\nAcci√≥n 2: Preparar el mensaje de saludo y luego pasa a la ‚ÄúFase 2:  2. IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)‚Äù\nEjemplo de respuesta: \"Hola hermano. (para responder sobre el perfume o sobre la intenci√≥n del cliente pasa a la fase 2)‚Äù.\n## FASE 2: IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)\nEsta fase es el n√∫cleo de la venta. Diego debe mapear el lenguaje del cliente a los productos reales y consultar la disponibilidad exacta.\nCASO A: Perfumes Full Size\nAplica cuando el cliente pide informaci√≥n, precio o disponibilidad de uno o varios perfumes de la lista.\nMapeo Sem√°ntico: Antes de usar la tool, asocia el nombre que diga el cliente con el nombre m√°s cercano de la Lista Maestra.\nUso de Tool: Activa stock_perfumes con el input: disponibilidad del perfume: [Nombre exacto].\nEl nombre del perfume env√≠alo entre comillas.\nEscenario 1: Consulta por un solo perfume\nAcci√≥n: Ejecuta ‚Äústock_perfumes‚Äù.\nLa tool devolver√° el nombre del perfume y con dos datos: \nstock: (si o no). \nStock = si : significa que est√° disponible el perfume\nStock = no : significa que esta agotado el perfume\nSi hay stock: Sigue el Ejemplo 1 de entrega de informaci√≥n.\nSi NO hay stock: La tool sugerir√° perfumes similares. Debes presentarlos de forma atractiva siguiendo el Ejemplo 2.\nEscenario 2: Consulta por m√∫ltiples perfumes\nAcci√≥n: Ejecuta la tool para todos los perfumes mencionados en un solo input: ‚Äúdisponibilidad de los perfumes: 1. [Nombre], 2. [Nombre]...‚Äù\nEnv√≠a cada nombre de los perfumes entre comillas.\nResultados Mixtos:\nSi hay de todos: Sigue el Ejemplo 3.\nSi falta alguno: Sigue el Ejemplo 4 (confirmas lo que hay y ofreces alternativas para lo que no).\nCASO B: Decants (Presentaciones de 5ml o 10ml)\nAplica cuando el cliente busca probar fragancias o indica cantidades peque√±as. Generalmente los clientes piden varios a la vez.\nEjemplos de Entrada del Cliente:\n‚Äúhawas 5ml, harana 10ml, asad 10ml y gos diamond 5ml‚Äù\n\"¬øTienes el 9pm en 5ml?\"\n\"Quiero probar el Hawas y el Asad en 10ml cada uno\".\n\"P√°same precio de decants de 5ml\". En este caso consultar sobre cual desea.\nIdentificaci√≥n: Si el cliente menciona \"5ml\", \"10ml\", \"peque√±o\" o \"para probar\", tr√°talo como Decant.\nUso de Tool: Activa ‚Äústock_decants‚Äù seg√∫n la cantidad de decants que solicita adquirir:\nSi es un solo decant, envia el input: ‚Äúdisponibilidad de decant: [Nombre del perfume] en [Cantidad].‚Äù\nSi es m√°s de un decant, env√≠a el input ‚Äúdisponibilidad de decants: [Nombre del perfume] en [Cantidad]. [Nombre del perfume] en [Cantidad]....‚Äù\nCASO C: Sets de Perfumes\nAplica cuando el cliente busca estuches de regalo o packs que incluyen complementos.\nEjemplo \nAcci√≥n: Revisa la secci√≥n \"Set de perfumes\" del Conocimiento General para validar si el nombre coincide con un set real.\nUso de Tool: Activa ‚Äústock_set_perfumes‚Äù con el input: disponibilidad del SET: [Nombre del Set].\nSi consulta sobre m√°s de un set, env√≠a el input: ‚Äúdisponibilidad del SET: [Nombre del Set]. disponibilidad del SET: [Nombre del Set].‚Äù\nNota: Si el cliente pregunta por un perfume y un set al mismo tiempo, consulta ambos en la misma ejecuci√≥n de la tool.\n## FASE 3: CONFIRMACI√ìN Y LOG√çSTICA DE ENV√çO\nEsta fase se activa cuando el cliente muestra una Intenci√≥n Real de Compra (ej. \"¬øC√≥mo pago?\", \"Lo quiero\", \"P√°same tu cuenta\") o despu√©s de que Diego presente la disponibilidad y precios.\n1. Generaci√≥n del Resumen\nDiego debe presentar un resumen estructurado basado en la secci√≥n #EJEMPLOS DE RESUMEN DE COMPRA.\nRegla de Oro: El total NO incluye el env√≠o todav√≠a. El env√≠o se suma en la Fase 4.\nPregunta de Cierre: Siempre debe terminar con la pregunta: \"¬øPara qu√© distrito o ciudad ser√≠a el env√≠o?\"\n2. Validaci√≥n de Ubicaci√≥n (Uso de Tool)\nUna vez que el cliente responde con un lugar, Diego debe ejecutar la tool distritos.\nL√≥gica de Clasificaci√≥n:\nCASO LIMA: Si el distrito indicado est√° en la lista de la tool distritos (Lima Metropolitana y Callao), se clasifica como Escenario A.\nCASO PROVINCIA: Si el lugar indicado NO est√° en la lista (ej. Piura, Cusco, Trujillo, o distritos de otras regiones), se clasifica autom√°ticamente como Escenario B.\n\n## FASE 4. M√âTODOS DE PAGO Y VALIDACI√ìN\nDiego presentar√° los m√©todos de pago bas√°ndose estrictamente en la ubicaci√≥n identificada. El costo de env√≠o es de S/12 en todos los casos.\nEscenario A: Lima Metropolitana (Distritos indicados)\nRegla: El cliente tiene la opci√≥n de pagar solo el env√≠o (S/12) por adelantado para confirmar, y el saldo del perfume lo cancela al recibirlo.\nMensaje: \"Para Lima puedes confirmar tu pedido pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Si prefieres, tambi√©n puedes pagar el monto total.\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante.‚Äù\nRegla de Flexibilidad: El cliente puede elegir pagar solo el env√≠o o el total.\nEscenario B: Provincia / Env√≠os por Shalom\nRegla: El pago debe realizarse por el monto completo (Perfume + S/12 de env√≠o) antes de despachar.\nMensaje: \"Para enviarte a provincia, el pago es por el monto total: son S/ [Precio del perfume] del perfume + S/ 12 del env√≠o por Shalom. En total ser√≠a S/ [Suma de ambos].\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante..‚Äù\nReglas Cr√≠ticas de Validaci√≥n:\nSolo Imagen: La compra √öNICAMENTE se valida mediante el input Imagen_analizada. No aceptes confirmaci√≥n por texto (\"ya pagu√©\") ni por audio.\nC√°lculo de Montos: * Si el cliente est√° en Lima y env√≠a un comprobante de S/ 12, Diego debe decir: \"Reserva de S/ 12 verificada. El saldo de S/ [Monto del Perfume] lo cancelas al recibir.\" y pasar a pedir datos.\nSi el cliente env√≠a el pago en partes (ej. dos capturas de Yape), Diego debe sumar ambos montos mentalmente. Solo cuando la suma sea igual al total acordado (o al menos a los S/ 12 en Lima), se da por validado.\n\n## FASE 5. SOLICITUD DE DATOS Y FINALIZACI√ìN\nTras validar el pago exitosamente seg√∫n el input ‚Äúimagen_analizada‚Äù, Diego solicita los datos para la confirmaci√≥n del env√≠o, seg√∫n el caso A o el caso B\nCASO A) Si el env√≠o es para los distritos permitidos de Lima Metropolitana.\n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Direcci√≥n exacta.‚Äù\n2) Validaci√≥n: Diego acepta cualquier formato de nombre y direcci√≥n que el cliente proporcione. No debe cuestionar la direcci√≥n, solo recopilarla.\n3) Utilizar tool: Una vez que tengas ambos datos utiliza la tool ‚Äúconfirmacion_pedido‚Äù y env√≠a las siguientes variables:\n‚ÄúNombre‚Äù\n‚ÄúDireccion exacta‚Äù\n‚Äúproductos‚Äù: el producto o los productos env√≠alos de esta forma: \"Producto 1: [Categor√≠a: Full Size/Decant/Set] [Nombre del Perfume] - [Precio] - [Cantidad]. (Repetir si hay m√°s productos)\".\n4) Confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: Tu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada\nCASO B) Si es de Provincia: \n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Apellidos\\n- DNI\\n- Ciudad/provincia\\n- Nombre de la agencia Shalom donde recoger√°‚Äù\n2) Validaci√≥n: Diego acepta los datos tal cual los env√≠e el cliente (no corregir DNI ni nombres). \n3) Utilizar tool: Una vez identificado todo los datos que solicitaste, utiliza la tool ‚Äúconfirmacion_pedido‚Äù con las siguientes variables:\n\n‚ÄúNombre‚Äù\n‚ÄúApellidos‚Äù\n‚ÄúDNI‚Äù\n‚ÄúCiudad/provincia‚Äù\n‚ÄúNombre_agencia_shalom‚Äù\n‚Äúproductos‚Äù: (Misma l√≥gica del CASO A: Categor√≠a, Nombre, Precio y Cantidad)\nNota: en este caso la variable ‚Äúdireccion_exacta‚Äù coloca ‚Äúnull‚Äù.\n4) confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: ‚ÄúTu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada.‚Äù\n\n###SECCI√ìN: EJEMPLO DE ENTREGA DE INFORMACI√ìN DE PERFUME\nEjemplo 1 (Un perfume con stock):\n\"El Hawas Ice s√≠ lo tengo en stock. El precio es de S/ 180. Es un perfume ultra fresco y potente, de los que m√°s piden.\"\nEjemplo 2 (Sin stock + Similares sugeridos):\n‚ÄúEl Valentino est√° agotado. Tengo estos que son de la misma vibra y huelen incre√≠ble:\\nJPG Le Male Elixir a S/ 450\\n\\nScandal Le Parfum a S/ 420 ¬øAlguna de esas opciones te llama la atenci√≥n?\"\nEjemplo 3 (M√∫ltiples perfumes con stock):\n\"Tengo los dos disponibles:\\n\\n9 PM a S/ 140\\nKhamrah Dukhan a S/ 175\"\nEjemplo 4 (Stock mixto):\n\"Hermano, te confirmo: el CDN Intense s√≠ lo tengo listo para enviar a S/ 190. El Azzaro lo tenemos sin stock. ¬øQu√© otro perfume te gustar√≠a?\nEjemplo 5 (Decants m√∫ltiples):\n\"Los tengo disponible:\\n\\n9pm Elixir (5ml): S/ 35\\nYara (10ml): S/ 45\\nKhamrah (5ml): S/ 40\\n\\n¬øTe armo el pack con estos tres o quieres chequear alguno m√°s?\"\n\n#EJEMPLOS DE RESUMEN DE COMPRA\n## EJEMPLOS SOLO PERFUMES FULL SIZE\n### Ejemplo 1: Si es solo un perfume\n\"Resumen de compra:\\n- Hawas Ice\\nüì¶ Cantidad: 1\\nüí∞ Precio unitario: S/ 180\\n\\nüíµ Total: S/ 180\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s perfumes Resumen de compra:\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah Dukhan\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 175\\n\\nüíµ Total: S/ 315\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS SOLO PERFUMES DECANTS\n### Ejemplo 1: Si es solo un decant Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- 9 PM Elixir (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 35\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Si son varios decants Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- Yara (10ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 45\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\nüíµ Total: S/ 125\\n\\n¬øMe indicas el distrito para continuar?\"\n## EJEMPLOS SOLO SET DE PERFUMES\n### Ejemplo 1: Si es solo un set Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 220\\n\\nüíµ Total: S/ 220\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s sets Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\n- GOS Set\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 240\\n\\nüíµ Total: S/ 450\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS DE PEDIDOS COMBINADOS\n### Ejemplo 1: Perfume Full Size + Decants\n\"Resumen de compra:\\n- Lattafa Asad\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 150\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Yara (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 225\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Compra Integral (Full Size + Decant + Set)\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\nüíµ Total: S/ 390\\n\\n¬øMe confirmas el distrito para avanzar con el pago?\" \n\n# EJEMPLOS DE FLUJO DE CONVERSACI√ìN CORRECTO\n## EJEMPLOS SI EL CLIENTE DESEA EL ENV√çO PARA LIMA\n1) Pago completo (Perfume + Env√≠o)\nCliente: Hola, quiero el Hawas Ice para Miraflores.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Hawas Ice s√≠ est√° disponible y cuesta S/180. ¬øDeseas agregar algo m√°s a tu compra?.\nCliente: No, solo eso. ¬øC√≥mo hago el pago?.\nDiego: Para Lima puedes confirmar pagando solo S/12 del env√≠o y el saldo al recibir, o pagar el monto total de S/192. Puedes yapear al 987108094 a nombre de Brandon Quelopana o por transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/192).\nDiego (Tras validar Imagen_analizada): Pago de S/192 verificado. P√°same tu nombre, celular y direcci√≥n exacta para programar el env√≠o. Como pagaste antes de las 10:00 am, llega hoy mismo.\n2) Pago parcial (Solo env√≠o S/12 + Saldo contra entrega)\nCliente: Precio del 9 PM. Estoy en San Borja.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El 9 PM cuesta S/140. ¬øQuieres agregar algo m√°s o solo ese?.\nCliente: Solo ese. Quiero pagar solo el env√≠o ahora.\nDiego: Entendido. Para Lima puedes confirmar pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Yapea al 987108094 (Brandon Quelopana) y me mandas la captura.\nCliente: (Env√≠a captura por S/12).\nDiego (Tras validar Imagen_analizada): Reserva de S/12 verificada. P√°same tu nombre, celular y direcci√≥n exacta. El saldo de S/140 lo pagas al recibir el producto.\n## EJEMPLO SI EL CLIENTE DESEA EL ENV√çO PARA PROVINCIA\n3) Pago total obligatorio para Provincia (V√≠a Shalom)\nCliente: Hola, precio de Asad para Piura.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Lattafa Asad cuesta S/150. ¬øDeseas agregar alg√∫n decant o solo el perfume?.\nCliente: Solo el perfume. ¬øCu√°l es el m√©todo?\nDiego: Para env√≠os a provincia el pago se realiza por el monto total de S/162, que incluye los S/12 de env√≠o por Shalom. Puedes pagar por Yape al 987108094 (Brandon Quelopana) o transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/162).\nDiego (Tras validar Imagen_analizada): Pago de S/162 verificado. P√°same tu nombre, apellidos, DNI, celular, ciudad y el nombre de la agencia Shalom donde lo recoger√°s. \n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-5136,288],"id":"87ad49a4-0b30-4cf2-bd78-475265d05fe3","name":"AI Agent"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","typeVersion":1,"position":[-3472,528],"id":"0af2d781-c62f-4cfa-8636-6576d2801773","name":"Auto-fixing Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3504,704],"id":"0be267ba-446a-4cd1-8c35-ea2e696d7e8b","name":"OpenAI Chat Model8","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"response\": {\n    \"parte_uno\": \"Texto correspondiente a la primera parte de la respuesta.\",\n    \"parte_dos\": \"Texto correspondiente a la segunda parte de la respuesta.\",\n    \"parte_tres\": \"Texto correspondiente a la tercera parte de la respuesta (opcional).\",\n    \"parte_cuatro\": \"Texto correspondiente a la cuarta parte de la respuesta (opcional).\",\n    \"imagen_uno\": \"Imagen correspondiente\",\n    \"imagen_dos\": \"Imagen correspondiente (opcional).\",\n    \"video_mp4\": \"Video .mp4 (opcional)\"\n}\n  }"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-3328,704],"id":"05f11a4e-1bcc-4829-a163-8b4e3e1f1534","name":"Structured Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3744,624],"id":"f2dd9e17-523b-4e58-9b8e-5f00f8fa704f","name":"OpenAI Chat Model9","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"={{ $json.output }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Obtener el texto de entrada:\n\nRecupera el texto de la variable items\n{{ $json.output }}\nLimpieza y normalizaci√≥n del texto:\n\nCrea una funci√≥n que limpie el texto eliminando los siguientes caracteres: ¬ø, ¬°, @, \", *, #.\n\nElimina los espacios en blanco al inicio y al final del texto.\nNo Elimines los emojis, ni los markdown para que los mensajes esten limpios.\nDivisi√≥n del texto en partes:\n\nImplementa una funci√≥n que divida el texto limpio en fragmentos de m√°ximo 800 caracteres sin cortar palabras. Si necesitas cortar uno de los fragementos del mensaje antes de 800 Caracteres para que no se corten mensajes hazlo. Los mensajes deben quedar completo y coherentes\nLa funci√≥n debe asegurarse de que cada fragmento se corte en espacios para no dividir palabras a la mitad.\nSi tienes que aumentar la cantidad de caracteres para que parte del mensaje no quede cortado o quede mal puedes hacerlo sin un limite de caracteres. Esto para que los mensajes sean mas organicos y funcionen bien. Tambien al identificar una imagen necesito que el link lo separes para que se mande separado.\n\n*SIEMPRE* que haiga un Link del video de youtube del tratamiento o presentaci√≥n, mandalo como parte del texto con su contexto, *NUNCA* lo pongas en la parte de imagen uno y dos.\n\n*NUNCA* pongas el link del video.mp4 en las partes de texto e imagen, *SIEMPRE* si es que tienes algun video con .mp4 ponlo en video_mp4.\n\nDeber√°s de enviarlo siempre a la √∫ltima parte pero solo eso.\nConstrucci√≥n de la respuesta:\n\nCrea un objeto JSON con la siguiente estructura:\n\n{\n  \"response\": {\n    \"parte_uno\": \"<primer fragmento>\",\n    \"parte_dos\": \"<segundo fragmento>\",\n    \"parte_tres\": \"<tercer fragmento>\",\n    \"parte_cuatro\": \"<cuarto fragmento>\",\n    \"imagen_uno\": \"<primera imagen>\",\n    \"imagen_dos\": \"<segunda imagen>\",\n    \"video_mp4\": \"<video.mp4>\"\n\n  }\n\n- Si hay un emoji como un check o algo por el estilo que desmuestre un enlistado, opciones o variantes similares, dale salto de linea para que parezca natural, recuerda reemplazar el \"\\n\" por un enter.\n\nSi alguna parte no existe, asigna una cadena vac√≠a (\"\").\n\n\n### Notas \n\n- Nunca debes hacer saltos de linea que no sean naturales evita si en algun momento un mensaje tiene un \":\" que el mensaje que le siga este en la otra parte del mensaje. debe ser lo mas natural posible.\n\n- S√≠ el texto tiene un saludo de bienvenida o algo parecido, *SIEMPRE* separalo en una parte y las siguientes partes separalos de tal forma que se vea ordenada y estructuradas tus respuestas.\n- En caso veas una palabra en asteriscos, ejemplo: **Botox:** deber√°s de quitarle los dos de los extremos y deber√° de quedar as√≠ *Botox:*.\n- *NUNCA* deber√°s de cortar el contexto del mensaje, quiero decir que si ves que el mensaje trata de un tema en espec√≠fico o seccion no deber√°s de cortarlo.\n\nEs Obligatorio reemplazarlo, no eliminarlo. NUNCA DEJAR NINGUNA PARTE VAC√çA OBLIGATORIAMENTE.\n\n- *SIEMPRE* REEMPLAZA \"\\n\" por un salto de linea normal (enter) ejemplo:\n{\n  \"response\": {\n    - opcion 1\n    - opcion 2\n    - opcion 3  \n  }\n}\n\n- *SIEMPRE* y cuando te lleguen dos links de Video.mp4, agarra el primero y no pongas los 2 juntos, si es posible, elimina uno para que solo quede uno.\n\n- *regla adicional* cuando llegue un link que est√© en .jgp .jpeg y .PNG a√±adelo a la parte de imagen, y si est√° en .mp4 a√±adelo al apartado de video "}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-3600,256],"id":"7ca03140-46dd-4d3c-a332-e3ee2072ded6","name":"Verificador1","onError":"continueErrorOutput"},{"parameters":{"httpMethod":"POST","path":"BRADA","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-15296,608],"id":"dbcc07c3-6246-4bdb-878b-af891629f8c8","name":"Webhook","webhookId":"fb43e7b4-c71f-4cad-bebd-32a81374fc49"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n","tableName":"healup","contextWindowLength":12},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-5200,48],"id":"39798e20-26eb-4032-ae59-7f5d5b5f7d8b","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"NzQUFXQpp2MvRekP","name":"CUENTA ALEGRATED"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8fa70db3-09c3-4e87-8fc9-4052751fad3f","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9840,512],"id":"d53b946f-7849-4a0c-91b8-673d822caa58","name":"If2","alwaysOutputData":false,"retryOnFail":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"576350e5-ed67-4ce9-815e-0f0a0ef0b1c7","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9616,688],"id":"3d169320-db83-4f3e-b8ec-cf4189ac8d7a","name":"If3"},{"parameters":{"assignments":{"assignments":[{"id":"1aa91b6d-c441-4496-beee-4af2457332ac","name":"pasar_supervisor","value":"={{ $json.pasar_supervisor }}","type":"string"},{"id":"34e35c66-589c-4146-ab9c-3d08b024a7c1","name":"n√∫mero","value":"={{ $json.numero }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-9984,512],"id":"e5878ba6-1987-4774-811f-c2cee034cb0a","name":"Edit Fields4"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-9184,992],"id":"02219ac8-19fd-463b-b35f-8880e0676c67","name":"No Operation, do nothing4"},{"parameters":{"name":"pasar_supervisor","description":"Llama esta herramienta cuando desees pasar a supervisor.","workflowId":{"__rl":true,"value":"2lPoYs00jPGwaBxq","mode":"list","cachedResultUrl":"/workflow/2lPoYs00jPGwaBxq","cachedResultName":"Supervisor Solari"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('Edit Fields20').item.json.id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-7248,464],"id":"b5e6fa52-fde1-4c70-b3ba-07a042587076","name":"Supervisor2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"98601c0c-949c-4f3d-99f2-40305665d58a","leftValue":"={{ $json.numero }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-10704,576],"id":"40fc0c0b-0829-40fc-81d5-3da1f46a7a9b","name":"If13"},{"parameters":{"name":"=Agendar","description":"=Agendar citas ","source":"=database","workflowId":{"__rl":true,"value":"konppOdwditJvoJQ","mode":"list","cachedResultUrl":"/workflow/konppOdwditJvoJQ","cachedResultName":"agendarSUNAT WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre_completo":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre_completo', ``, 'string') }}","DNI":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('DNI', ``, 'string') }}","numerotelefono":"={{ $json.id }}","inicio_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('inicio_cita', ``, 'string') }}","fin_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fin_cita', ``, 'string') }}","tratamiento(s)":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('tratamiento_s_', `Coloca el tratamiento que se haya mencionado durante la conversaci√≥n, seg√∫n esta lista de tratamientos:\n\n- Lipopapada & Afinamiento Facial Enzim√°tico\n- Natural Lips\n- Bratz Lips\n- Perfilamiento de nariz\n- Rinomodelaci√≥n completa\n- Exosomas + Esperma de Salm√≥n\n- Proyecci√≥n de Ment√≥n con √Åcido Hialur√≥nico\n- Baby Botox\n- Botox Full Face\n- Marcaci√≥n mandibular\n- Masseter Botox\n- Surcos Nasogenianos\n- Sustentaci√≥n pomular\n- √Åcido Hialur√≥nico para ojeras\n- NCTF\n- Hidralips con Dermapen\n- Plasma Rico en Plaquetas (PRP)\n- Armonizaci√≥n Facial \n\n- Glass Skin Babe\n- CalmBabe\n- Pure Babe Skin\n- Heal Up Babe Ritual\n- Prime Skin Clean\n- Eternal Glow Boost\n- Prestige Glow Ritual\n- Heal Up Signature Glow\n\n- Lipo Start Protocol\n- Lipo Sculpt Protocol\n- Lipo Intensive Shape Protocol\n- Heal Up Lipo 360‚Äù.\n\nNota: Si el paciente consult√≥ sobre m√°s de 1 tratamiento, a√±adelo con una coma. por ejemplo: Rinomodelaci√≥n completa, Baby Botox.\n`, 'string') }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","red_social":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('red_social', `Coloca esta palabra: WhatsApp`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"nombre_completo","displayName":"nombre_completo","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"inicio_cita","displayName":"inicio_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"fin_cita","displayName":"fin_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"numerotelefono","displayName":"numerotelefono","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"DNI","displayName":"DNI","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"red_social","displayName":"red_social","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"tratamiento(s)","displayName":"tratamiento(s)","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-5504,784],"id":"5334487f-6a0c-48f2-8833-2cece4f6c66e","name":"Calendario"},{"parameters":{"tableId":"pasar_supervisor_BRADA","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"},{"fieldId":"conversation_id","fieldValue":"={{ $('If12').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10480,832],"id":"6da92ad7-7496-46b2-ad7a-af1302bdca1b","name":"Create a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10192,512],"id":"e01e05d9-2c86-4f10-8067-8d296b347400","name":"Get a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9536,416],"id":"08f4c79d-67de-4997-8b28-3d94436c885c","name":"Update a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10960,592],"id":"0383d00f-4ae0-4f14-850a-4ee2703bbc58","name":"Get a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2acc3e64-d51a-4e98-84a5-e2b17c788fa2","leftValue":"={{ $('Webhook').item.json.body.payload.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7312,592],"id":"645bde3e-f301-4b37-a037-b78f2c234bab","name":"If4"},{"parameters":{"operation":"formatDate","date":"={{ $json.currentDate }}","format":"custom","customFormat":"DDDD tt","options":{"timezone":true}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-6896,576],"id":"c0cfb4f3-987c-429b-9a57-9f8b58dd70a2","name":"Formatea fecha"},{"parameters":{"assignments":{"assignments":[{"id":"d78c89a3-c878-48b7-aa84-4b2674c0667b","name":"data.remoteJid","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation.contact_inbox.source_id }}","type":"string"},{"id":"432a9602-e38b-4880-a64d-b832d120edda","name":"data.id","value":"={{ $('Webhook').item.json.body.id }}","type":"string"},{"id":"d2f45efc-03ac-4c74-b70e-959b06cd2a0b","name":"data.text","value":"={{ $('Edit Fields17').item.json.mensajetexto }}{{ $('Edit Fields17').item.json.mensajeaudio }}{{ $('Edit Fields17').item.json.mensajeimagen }}","type":"string"},{"id":"d77208a8-161b-4ef3-96fa-261a87cf1f39","name":"conversation_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","type":"string"},{"id":"8c279598-20f0-4012-a4ee-8c7898ceaba4","name":"account_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].account_id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6448,576],"id":"e0ece9a2-acd1-450f-9e2f-a45df7d9021e","name":"Handler variables"},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-7072,576],"id":"34435b05-c9a2-4759-b275-a239d12bbcb1","name":"Fecha"},{"parameters":{"jsCode":"// 1. Obtener la fecha de entrada\nconst inputDateString = $input.item.json.formattedDate; \nconst date = new Date(inputDateString);\n\n// 2. Obtener hora actual para la l√≥gica\nconst currentHour = date.getHours();\n\n// Clonamos la fecha para calcular el env√≠o\nlet scheduledDate = new Date(date);\n\n// 3. L√≥gica de Negocio (Reglas de horario)\nif (currentHour >= 19 || currentHour < 5) {\n  // Caso Nocturno (19:00 - 04:59): Programar para las 09:00 AM\n  scheduledDate.setHours(9, 0, 0, 0);\n  \n  // Si es >= 19:00, pasa al d√≠a siguiente.\n  if (currentHour >= 19) {\n    scheduledDate.setDate(scheduledDate.getDate() + 1);\n  }\n} else {\n  // Caso Diurno (05:00 - 18:59): Sumar 4 horas\n  scheduledDate.setHours(scheduledDate.getHours() + 4);\n  // Reiniciamos minutos y segundos a 0 para mantener limpieza (opcional, pero recomendado)\n  scheduledDate.setMinutes(0);\n  scheduledDate.setSeconds(0);\n}\n\n// 4. FORMATEO DE SALIDA \"dd/mm/yyyy HH\"\n// Usamos .padStart(2, '0') para asegurar dos d√≠gitos (09, 05, etc.)\n\nconst day = scheduledDate.getDate().toString().padStart(2, '0');\nconst month = (scheduledDate.getMonth() + 1).toString().padStart(2, '0');\nconst year = scheduledDate.getFullYear();\nconst hourFormatted = scheduledDate.getHours().toString().padStart(2, '0');\n\n// CONSTRUCCI√ìN FINAL: dd/mm/yyyy HH\n// Nota: Eliminamos los minutos (:${minuteFormatted}) de esta l√≠nea\nconst fecha_final = `${day}/${month}/${year} ${hourFormatted}`;\n\nreturn {\n  json: {\n    original_input: inputDateString,\n    // Variable solicitada con el formato exacto\n    fecha_lora_formateada: fecha_final,\n    // Variable extra por si necesitas solo la hora aislada\n    solo_hora: hourFormatted\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6640,576],"id":"7235933b-bf69-4698-9133-cfe47b370ffc","name":"Code2"},{"parameters":{"amount":30},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-7312,1072],"id":"6e3e7abf-d38f-40b1-b0c4-a8e166fc036c","name":"Wait6","webhookId":"5696ca8f-19ae-4cd6-8008-6132ce1cf272"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8a313a41-eadc-4ada-bc2a-feff79845de9","leftValue":"={{ $json.mensajes[0] }}","rightValue":"={{ $('Handler variables').item.json.data.text }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6864,1296],"id":"76729177-6c0d-4ec2-bf0a-0604e5bbf8a9","name":"If6"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-6544,1376],"id":"2c667d72-3de1-4d9e-bff9-88ce886f1c91","name":"No Operation, do nothing1"},{"parameters":{"operation":"delete","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6240,1024],"id":"31c060d8-e6c1-489f-924b-36ee33dce137","name":"Delete Redis","executeOnce":false,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $('Get Redis1').item.json.mensajes.join() }} y el lead viene de un anuncio : {{ $('RESUMIDOR ANUNCIOS').item.json.output }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Wait6').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.payload._data.Info.PushName }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6352,832],"id":"fa0d6541-f1f5-42a3-918d-072dec78f8be","name":"Edit Fields19","alwaysOutputData":true},{"parameters":{"operation":"get","propertyName":"mensajes","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","keyType":"list","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6960,1088],"id":"eb2e5436-c84c-4660-a049-366ff67222ee","name":"Get Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $json.anuncio }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Handler variables').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.conversation.messages[0].sender.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6368,992],"id":"a0199bbc-432c-4d05-a271-0c734eec08cd","name":"Edit Fields20","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3e8a5a20-c60c-48ef-a636-2b5e14a683a8","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6608,944],"id":"61e1b52d-148e-41fd-9b0b-7e4895ad7a0a","name":"If15"},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1136],"id":"edcdff4c-5e82-4bfe-8beb-45b771f8bed2","name":"METER_ANUNCIO","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1296],"id":"666f3eb7-d307-4a99-abd7-1f526c0907fd","name":"BAJAR_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}_ad","messageData":"={{ $('RESUMIDOR ANUNCIOS').item.json.output }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8064,1136],"id":"5a5ab926-f0b0-420f-ad66-6f99a6d9eb9f","name":"guarda_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3deed863-79f3-42e5-a32c-6cb7bb1028df","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7616,512],"id":"46ecb883-24f2-490a-a44c-a9e6dd7a5ab2","name":"If"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-7488,32],"id":"76495bc9-2132-42c6-8f98-7f222fbc58ab","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"8f567177-8b37-4a09-9a53-ac9fe424c843","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6240,576],"id":"49f7d2d6-bf9c-4b3f-bde9-d5b04db1203a","name":"If10"},{"parameters":{"operation":"get","propertyName":"anuncio","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6752,944],"id":"16a19e11-3a97-49d7-b868-7b84b7799dc7","name":"Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-6928,272],"id":"31f4a897-b5fc-4baa-a8ac-c4645d7e6b10","name":"Update a row4","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"Describe esta imagen\n","imageUrls":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].data_url }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8864,560],"id":"655bda6d-6ab1-42a8-85c1-736575210b9b","name":"OpenAI","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"437f223f-80c7-4c47-a50b-9d17a8614251","name":"imagen_caption","value":"={{ $json.content }} .\nEl captions del mensaje de imagen es: {{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8448,688],"id":"fa56722a-8385-4847-b719-f90a132dfbd1","name":"Edit Fields12"},{"parameters":{"url":"={{ $('Webhook').item.json.body.attachments[0].data_url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-8896,368],"id":"f1138959-5c6f-4058-a15b-6e56bdaab777","name":"HTTP Request"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"27bcc104-31e3-4687-b60b-a018c457a3a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"audio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2e8b532f-1f01-45f9-a647-e7a5c9e48aac","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"image","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Imagen"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"59f6b23a-3029-4225-8f9e-3744611a04a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"=text","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"28de146f-c104-4171-924a-29963c4f1970","leftValue":"={{ $('Webhook').item.json.body.content_type }}","rightValue":"text","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-9216,416],"id":"b138e8be-c1d3-4f8a-8423-93fb52834ba7","name":"Switch3"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8624,368],"id":"f26677a7-27a0-43ed-8071-3e3064e25db4","name":"AUDIO1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"276cbb8a-79f2-4f08-b24a-632f474c6013","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-8624,560],"id":"f29adecc-e9d9-4222-9ec3-107cac681c09","name":"If16"},{"parameters":{"assignments":{"assignments":[{"id":"c0a1b2f0-373e-4b86-ae91-25346b20b404","name":"mensajetexto","value":"=Texto mensaje: [{{ $('Webhook').item.json.body.conversation.messages[0].content }}]  ","type":"string"},{"id":"35cd9184-e37e-4d03-9dff-efb319dce478","name":"mensajeaudio","value":"={{ $json.text }}","type":"string"},{"id":"47e9bfe8-2c55-4b5d-b047-024871fc6c21","name":"mensajeimagen","value":"=Imagen analizada: [{{ $json.content }}{{ $json.imagen_caption }}]","type":"string"},{"id":"9926d346-600f-45af-adad-876e9f40ffa4","name":"imagenanalizada","value":"=Imagen de anuncio analizado: {{ $json.content }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8064,480],"id":"8a1f15fa-bf4b-4c01-adbb-7a1a21d7a706","name":"Edit Fields17","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $('Webhook').item.json.body.payload.body }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7120,400],"id":"7ab44ba1-258f-4193-929d-15aa68334a0f","name":"If11"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f05066b5-5a07-41fa-96b7-7a244e7345c8","leftValue":"={{ $json.body.payload.fromMe }}\n","rightValue":"true","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12384,608],"id":"d94743f2-3b7b-460b-bc26-33eae6240210","name":"If12"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $json.body.conversation.messages[0].content }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12224,752],"id":"23a75e86-d3fd-4b05-8d58-aa9da67a47d8","name":"If20"},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-12144,1008],"id":"a93457ed-fd5d-4186-b320-c1a49417136c","name":"Update a row6","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"name":"informacion","description":"utiliza esta tool cuando se necesite informaci√≥n seg√∫n las indicaciones del prompt principal.","workflowId":{"__rl":true,"value":"FB7us6cBaq7jWqB2","mode":"list","cachedResultUrl":"/workflow/FB7us6cBaq7jWqB2","cachedResultName":"informacion HEAL UP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}"},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-6080,784],"id":"e0e915c5-fd08-4168-be41-783aa4ce1390","name":"informacion_tratamientos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"987d5d07-58eb-4927-8e68-a137884b8100","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].message_type }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13248,608],"id":"5e339c78-27b7-41de-8774-f34bd2e49752","name":"If1"},{"parameters":{"jsCode":"// Tomamos todos los items que vienen del nodo anterior (Verificador1)\nconst items = $input.all();\n\nfor (const item of items) {\n  // Aqu√≠ est√° tu objeto con parte_uno, parte_dos, etc.\n  // Verifica la ruta: output.response\n  const resp = item.json.output?.response || {};\n\n  // Orden que quieres respetar\n  const orderedKeys = [\n    'parte_uno',\n    'parte_dos',\n    'parte_tres',\n    'parte_cuatro',\n    'imagen_uno',\n    'imagen_dos',\n    'video_mp4',\n  ];\n\n  // Armamos un nuevo objeto response en el orden deseado\n  const newResponse = {};\n  for (const key of orderedKeys) {\n    if (resp[key]) {\n      newResponse[key] = resp[key];\n    }\n  }\n\n  // Sobrescribimos manteniendo la estructura original\n  if (!item.json.output) item.json.output = {};\n  item.json.output.response = newResponse;\n}\n\n// Devolvemos los items modificados\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2752,352],"id":"24f0ff65-46ee-441c-a6d4-8f9095be5ae0","name":"ordenar"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $json.output.response.parte_uno ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2720,1088],"id":"88a82162-8ee2-4a01-8f95-a7350bae11d1","name":"Respuesta1","executeOnce":false},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1776,832],"id":"cce742aa-91d4-4fd6-971b-02494cc4941d","name":"Wait2","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_dos ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1600,928],"id":"6c953a90-8ee3-40d6-b6fd-f29c2e766496","name":"Respuesta2","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1312,848],"id":"0a8bc622-6c9b-472d-8735-328b027264ff","name":"If14"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1120,832],"id":"568f10ce-4d13-4754-843d-d05277b38f48","name":"Wait3","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_tres ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-912,896],"id":"3cb7de22-5651-4c25-b9eb-6132643c3bbe","name":"Respuesta3","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-496,752],"id":"af5809e5-112a-4632-aeaf-44bd7061fd9e","name":"If17"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-480,976],"id":"d9d3f88f-ef89-458a-8d83-ad4661e1b4e6","name":"Wait4","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=hcy6n6RAJTBAAYguVuewgp2A"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_cuatro ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-256,1008],"id":"319a272b-7a67-4de3-bcc3-381f609226df","name":"Respuesta4","executeOnce":false},{"parameters":{"promptType":"define","text":"=Te va a llegar esta descripcion de un anuncio: {{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","options":{"systemMessage":"ROL:\nTu rol es indicar el mismo input que te llega y enviarlo como output."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-7504,192],"id":"7dd13519-eebb-4cd8-9fbe-870c4eb2ea0b","name":"RESUMIDOR ANUNCIOS"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1a9dd789-5c10-4489-a344-6b7a0fd041ea","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51902215511","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"912d0724-5ef1-4f88-9d43-acbb38f48cee","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51993708540","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"e50ad623-45f5-4af7-bc5a-89708016ddf8","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51972619000","operator":{"type":"string","operation":"equals"}},{"id":"9ffd5afb-ec0c-49fc-a144-b682386c760c","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51960239280","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"50ddfe27-4e13-4e3c-8216-aca1f181f77a","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51936196001","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"7650a20c-4ba9-4e41-bd67-89e8f77278fc","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"14502413970","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"bdfe444d-b4d9-4789-971d-08420999d775","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51945157250","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"5f1e9684-e18d-4a9f-aad7-bef2235f631d","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51971119678","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13888,864],"id":"fc9e995e-943d-4cce-8e72-ee42d86cee6c","name":"If18"},{"parameters":{"description":"usa la tool supervisor seg√∫n el prompt principal","workflowId":{"__rl":true,"value":"xchwhR053ynGsZI4","mode":"list","cachedResultUrl":"/workflow/xchwhR053ynGsZI4","cachedResultName":"SUP SUNAT"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $json.id }}","conversation_id":"={{ $('If7').item.json.conversation_id }}","inbox_id":"={{ $('If12').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5616,832],"id":"5e99594b-abaa-47fe-872d-198f951381e9","name":"Supervisor"},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje1","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_uno }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"},{"fieldId":"account id","fieldValue":"={{ $('Webhook').item.json.body.account.id }}"},{"fieldId":"conversation id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2544,1088],"id":"476c18e7-85f6-493d-b3aa-14cfdf31bcc3","name":"Update a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje2","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1472,944],"id":"d7b09d89-120c-41de-af99-2ac3e43b9c64","name":"Update a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje3","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-720,896],"id":"87f26d37-d4e6-4022-b8e7-d0be58f20d22","name":"Update a row5","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"seguimiento_healup","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-15088,608],"id":"f952306b-6aab-4f21-ba58-cdd5dcebe32c","name":"Get a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}},"disabled":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"60e8198a-90ea-44a7-8f27-6e37021a1a02","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje1 }}","operator":{"type":"string","operation":"equals"}},{"id":"4541b27d-6dfa-47d7-bbff-d1a5c2e6ffd1","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje2 }}","operator":{"type":"string","operation":"equals"}},{"id":"20ce2efd-2509-40d0-b670-2c484246fa28","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje3 }}","operator":{"type":"string","operation":"equals"}},{"id":"b74b14df-879c-4427-8888-d7e1e3212ddc","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje4 }}","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-14880,608],"id":"5c2a2d65-e6b0-4eff-8611-1286cc5f3519","name":"If19","alwaysOutputData":true,"disabled":true},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje4","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[0,1008],"id":"3bfbc342-a045-4fb3-b813-77c25a76e4fd","name":"Update a row7","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"daeff2da-d88d-4aa7-b4d9-8b808c58b7c8","leftValue":"={{ $json.conversation_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7664,1824],"id":"4456591c-6e0e-41e1-8fe3-d6b190cf5b8a","name":"If7"},{"parameters":{"operation":"get","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","keyValue":"={{ $('Get a row3').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7920,1520],"id":"7eb28718-e96b-48aa-aaa6-9595b57209be","name":"Get a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"BRADA_followups","fieldsUi":{"fieldValues":[{"fieldId":"conversation_id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7232,1664],"id":"032dfeeb-7358-4670-bfc8-e64deb12607b","name":"Create a row1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"model":"gpt-5.1","options":{"reasoningEffort":"low"}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5440,496],"id":"ff0bf49f-19d4-4e02-92fc-84ddcb1a06e5","name":"RAZONADOR PLUS","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7536,1424],"id":"456e5e75-da23-4eaf-b219-2d0e6a4c9772","name":"Update a row9","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"pasar_supervisor_healup","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9872,1184],"id":"22e69871-698c-451d-97be-e15985b9f1ca","name":"Create a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"method":"POST","url":"=https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": \"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg\",\n  \"message_type\": \"outgoing\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3152,1440],"id":"1e6becc0-86ad-4636-968f-82b82ce1d008","name":"Respuesta6","executeOnce":false},{"parameters":{"url":"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3648,1424],"id":"c91882f6-4156-4928-83f4-db575130f873"},{"parameters":{"method":"POST","url":"https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content","value":"Aqu√≠ tienes la imagen adjunta üëá"}]},"options":{}},"name":"2. Enviar a Chatwoot","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3440,1408],"id":"bb8131d9-ee4a-4ce7-bfcd-6484ee58e6e9"},{"parameters":{"content":"## EJEMPLO IMAGENES\n","height":320,"width":560},"type":"n8n-nodes-base.stickyNote","position":[-3744,1328],"typeVersion":1,"id":"14ea41f0-1e70-47f8-ad8d-cad36bd5ba28","name":"Sticky Note"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2352,1056],"id":"da693219-5a37-4d6b-b186-6b04eb3a09a2","name":"If8"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1184,1440],"id":"00fb4ecc-2c2b-43c7-a5b0-3bc928404b03","name":"If23"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-976,1424],"id":"b350fa31-345e-420d-9213-4ccd1c603f30","name":"If26"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-624,1840],"id":"4b2323d7-ade6-4594-9192-1b4e2251a93b","name":"If27"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1248,1392],"typeVersion":1,"id":"ffa9ce31-0ae1-4e74-af8a-05d40968ab54","name":"Sticky Note2"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-752,1440],"id":"84b7f3b1-5259-47e9-976f-6a01df9ed583","name":"Wait","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-176,1648],"id":"acf88893-aecd-41e2-8a76-6b13efecaf2c","name":"If40"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[192,1856],"id":"324684bf-472a-4b17-a5fc-3b12d1f0e647","name":"If42"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1648],"id":"9da856cd-4d80-4b0d-84b5-9d412e3a3420","name":"Wait5","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1856],"id":"918310b1-c0da-46c2-80cf-8343bacd20a5","name":"Wait7","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[400,1872],"id":"30392c9c-d8a1-4a3a-8173-0ef149b4dadb","name":"Wait8","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-976,1600],"id":"3270bad6-15d8-4f71-a811-c3359fdab4e3","name":"Wait9","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[32,1664],"id":"e5ada578-5738-42b2-98f2-9c73991a85e8","name":"Wait10","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-608,1600],"id":"f693b423-1013-4d25-a66c-54422bfde206"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-2","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-784,1600],"id":"f2f64f92-df6b-4114-863d-2f5463a5bff7"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[0,1856],"id":"15cd3fea-5316-48c1-87b3-10b8b49c2919"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-3","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-176,1856],"id":"97e4385e-224d-4e1b-814b-55d7358b7f8e"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot34","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[720,1872],"id":"d96e4430-aea9-4374-b39b-75bec4c5b6dc"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-4","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[544,1872],"id":"d9dc6055-97c0-4412-8284-39dd78540a56"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot35","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[368,1664],"id":"e7946bf5-eb93-47a1-8f0a-788003fd3e1d"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-5","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[192,1664],"id":"b835a15f-edb3-45a2-b27b-a2905ade226f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot36","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-416,1440],"id":"97aa4aac-4a3b-4632-a2eb-32fe5486d166"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-6","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-592,1440],"id":"dd6f4397-190c-4511-84ba-a4ddb75136be"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":3},"conditions":[{"id":"b2a6d2d7-c61b-43ef-99fe-cc95d8413e94","leftValue":"={{ $json.body.conversation.messages[0].sender.phone_number }}","rightValue":51971119678,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-14480,592],"id":"65ea26bb-db5c-45f1-a288-c16501032d3c","name":"If5"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-14240,368],"id":"3b9693a6-6e3f-4174-9556-ba7477824248","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', ``, 'string') }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-13856,272],"id":"ff60e952-557a-4961-b575-24caf1329c1f","name":"pasar_supervisor","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $json.body.content }}\n\n","options":{"systemMessage":"=# üéØ ROL\nEres el Agente **Aura**. Tu √∫nica funci√≥n es extraer, **normalizar** y enviar un n√∫mero de tel√©fono a la tool \"pasar_supervisor\" El n√∫mero puede ser nacional (Per√∫) o extranjero, y debes procesarlo seg√∫n las reglas para que la tool reciba solo d√≠gitos.\n\n# üì• INPUT (Solicitud de Recepcionista)\nRecibir√°s una solicitud de la recepcionista para transferir un paciente.\nEl patr√≥n de la solicitud ser√° similar a: **Pasar a supervisor el n√∫mero: [N√∫mero variable]**\nEl n√∫mero puede llegar en formato completo (`519...`), solo el n√∫mero nacional (`9...`), o en formato internacional (`+1...`).\n\n# ‚öôÔ∏è INSTRUCCIONES ESTRICTAS (Funci√≥n sin Estado)\n\n1. Cada input es una solicitud √∫nica. Tu tarea finaliza con la ejecuci√≥n de la tool.\n\n2. **Identificaci√≥n:** Busca y extrae el n√∫mero que sigue inmediatamente al patr√≥n: **Pasar a supervisor el n√∫mero:** o **Manda a supervisor el n√∫mero**.\n\n3. **Normalizaci√≥n:** Antes de usar la tool, debes convertir el n√∫mero extra√≠do a un formato estandarizado de **solo d√≠gitos**, aplicando estas reglas en orden:\n    * **Limpieza:** Elimina todos los caracteres no num√©ricos (espacios, guiones, par√©ntesis, puntos, el signo `+`).\n    * **Normalizaci√≥n Per√∫ (9 d√≠gitos):** Si el n√∫mero tiene **9 d√≠gitos** y **no** comienza con `51`, asume que es un n√∫mero de Per√∫ y **precede** la cadena con `51`.\n    * **Normalizaci√≥n Internacional/Completo:** Si el n√∫mero comienza con `51` (11 d√≠gitos) o es cualquier otra longitud, √∫salo tal cual despu√©s de la limpieza.\n\n4. **Acci√≥n √önica:** Una vez extra√≠do y normalizado el n√∫mero, debes utilizar **exclusivamente** la tool **pasar_supervisor**.\n\n5. **Output:** Nunca respondas, expliques, ni devuelvas texto. Tu √∫nica acci√≥n es ejecutar la tool.\n\n### üìù EJEMPLO DE FLUJO DE TRABAJO\n\n| Input de la Recepcionista | L√≥gica de Normalizaci√≥n | Salida a la Tool |\n| :--- | :--- | :--- |\n| **Input 1 (Per√∫ Completo):** `Pasar a supervisor el n√∫mero: 51998765432` | N√∫mero original: `51998765432` (11 d√≠gitos). No requiere cambios. | `pasar_supervisor(51998765432)` |\n| **Input 2 (Internacional):** `Manda a supervisor el n√∫mero +1 (305) 417-1787` | Limpieza: `13054171787` (11 d√≠gitos). | `pasar_supervisor(13054171787)` |\n| **Input 3 (Per√∫ Corto):** `Manda a supervisor el n√∫mero 977571136` | 9 d√≠gitos. Se asume Per√∫. **Normaliza con 51**. | `pasar_supervisor(51977571136)` |\n\n## HERRAMIENTAS\n**Herramientas disponibles:** **pasar_supervisor**\n\n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-14256,192],"id":"ed307005-1e1d-4800-a494-8f1ee293347f","name":"supervisor"},{"parameters":{"workflowId":{"__rl":true,"value":"86itBT4QcMqbK21F","mode":"list","cachedResultUrl":"/workflow/86itBT4QcMqbK21F","cachedResultName":"[MANTENIMIENTO] Supwhatsapp"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('If19').item.json.body.conversation.messages[0].sender.phone_number }}","conversation_id":"={{ $('If19').item.json.body.conversation.messages[0].conversation_id }}","inbox_id":"={{ $('If19').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":[],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-14016,400],"id":"96b98de4-e095-42e3-83b8-8e9043aac552","name":"Call 'Supervisor healup'"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"Z1S8hBZOFvfBE7I5","mode":"list","cachedResultUrl":"/workflow/Z1S8hBZOFvfBE7I5","cachedResultName":"SUNAT | Enviar datos (General) | WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre', ``, 'string') }}","numero":"={{ $json.id }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},"matchingColumns":[],"schema":[{"id":"nombre","displayName":"nombre","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5664,752],"id":"39552a1a-a1b3-4538-a0c0-eefb20b529b8","name":"enviar_nombre"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    perfumes_full_size: [\n      \"9 pm\",\n      \"9 pm elixir\",\n      \"Aether extrait\",\n      \"Afeef Lattafa\",\n      \"Ajayeb Dubai\",\n      \"Ajwad pink to pink\",\n      \"Al Haramain Dubai Night\",\n      \"Al qiam golf\",\n      \"ALTHAIR PARFUMS de MARLY\",\n      \"Amber rouge\",\n      \"Amethyst\",\n      \"Amore caff√© Mancera\",\n      \"Aqua Dubai 100 ml\",\n      \"Art of nature II\",\n      \"Art of universe\",\n      \"Aruba gold\",\n      \"Atlas LATTAFA\",\n      \"Azzaro PARFUM\",\n      \"Azzaro the most wanted intense\",\n      \"Berry on top\",\n      \"Bharata chocolate\",\n      \"Bharata king EDP\",\n      \"Bharata king gold edition\",\n      \"Bharata Placid\",\n      \"BIANCO latte\",\n      \"CDN Intense man\",\n      \"CDN Sillage\",\n      \"CDN Urban Man Elixir\",\n      \"CDN woman\",\n      \"Champion goat\",\n      \"Champion money\",\n      \"Champion sugar\",\n      \"Chic Sonia\",\n      \"Choco overdose\",\n      \"Cloud Ariana grande\",\n      \"Club de nuit untold\",\n      \"Confidential\",\n      \"Cookie grave\",\n      \"Creed aventus\",\n      \"Creed millesime imperial\",\n      \"Creed silver mountain water\",\n      \"Decant\",\n      \"Diesel spirit\",\n      \"Eclaire\",\n      \"Eclaire banoffi\",\n      \"Eclaire pistache\",\n      \"EMEER\",\n      \"Erba gold\",\n      \"Erba pura\",\n      \"Fahkar Rose\",\n      \"Fakhar black\",\n      \"Fakhar gold\",\n      \"Fire on ice\",\n      \"GOS Blind bid\",\n      \"Gos bonus\",\n      \"GOS Boston\",\n      \"GOS Diamond\",\n      \"Gos Esmerald\",\n      \"GOS Full House\",\n      \"GOS Jackpot\",\n      \"GOS Moon\",\n      \"Gos no limit\",\n      \"GOS platinium\",\n      \"GOS Rouge\",\n      \"GOS Royale\",\n      \"GOS Wildcard\",\n      \"GOS Yellow Saphire\",\n      \"Haramain amber oud gold edition\",\n      \"HAWAS ice\",\n      \"Hawas malibu\",\n      \"Hayaati florence\",\n      \"Hayaati lataffa\",\n      \"Her confession\",\n      \"His Confession\",\n      \"Honor and glory\",\n      \"Invictus Parfum\",\n      \"INVICTUS VICTORY ELIXIR\",\n      \"Ishq al shuyukh silver\",\n      \"Island Khadlaj\",\n      \"Jean lowe azure\",\n      \"Jean lowe inmortel\",\n      \"JPG Le beau le parfum 120ml\",\n      \"JPG Le Male elixir 125ml\",\n      \"JPG LE MALE LE PARFUM\",\n      \"JPG Paradise Garden 125ml\",\n      \"Khamrah\",\n      \"Khamrah Dukhan\",\n      \"Kirk√© Tiziana Terenzi\",\n      \"Lataffa Ameer\",\n      \"Lattafa dynasty\",\n      \"LAYTON PARFUMS de MARLY\",\n      \"Mancera cedrat boise\",\n      \"Mancera coco vanille\",\n      \"Mancera Instant Crush\",\n      \"Mancera Red tobaco\",\n      \"Mandar√≠n elixir\",\n      \"Milestone\",\n      \"Montale Arabians Tonka\",\n      \"M√≥ntale intense caf√©\",\n      \"Nautica voyage\",\n      \"Naxos\",\n      \"Nitro Red\",\n      \"Nitro White\",\n      \"Noble blush\",\n      \"Now white\",\n      \"Now women\",\n      \"Odyssey artisto\",\n      \"Odyssey bahamas\",\n      \"Odyssey black forest\",\n      \"Odyssey Candee\",\n      \"Odyssey Eau de Montagne\",\n      \"Odyssey go mango\",\n      \"Odyssey Homme black EDP\",\n      \"Odyssey Homme white edition\",\n      \"Odyssey Limoni\",\n      \"Odyssey Mandarin sky\",\n      \"Odyssey mega edp\",\n      \"Odyssey revolution\",\n      \"Odyssey Spectra\",\n      \"Odyssey spectra blue\",\n      \"Odyssey toffe coffe\",\n      \"Odyssey Tyrant\",\n      \"Odyssey wild one\",\n      \"Orientica royal amber\",\n      \"Orientica Velvet Gold\",\n      \"OUD FOR GLORY\",\n      \"Qaed unlimited\",\n      \"Rave Now\",\n      \"Rayhaan Elixir\",\n      \"Rome Imagine\",\n      \"Rome paradox\",\n      \"Scandal intense\",\n      \"Scandal le parfum\",\n      \"Sehr\",\n      \"Shaheen\",\n      \"So candid\",\n      \"Spectre Malachite\",\n      \"Spectre wraith\",\n      \"Stronger with you intensly\",\n      \"Summer hammer/Lorenzo Pazzaglia\",\n      \"Sun-gria\",\n      \"Teriaq intense\",\n      \"Tharwah gold\",\n      \"The Kingdom\",\n      \"Turathi\",\n      \"Turathi Electric\",\n      \"Valentino born in Roma intense\",\n      \"Veneno\",\n      \"Versace Eros flame\",\n      \"Versace eros parfum\",\n      \"Vintage Radio\",\n      \"Winners trophy\",\n      \"Yara elixir\",\n      \"Yara lataffa\",\n      \"Yara Moi\",\n      \"Yara tous\",\n      \"Yves Saint Laurent Y EDP\"\n    ],\n\n    decants: [\n      \"BHARARA KING EDP\",\n      \"LATTAFA PRIDE PISA\",\n      \"HARANA\",\n      \"21:00:00\",\n      \"EJAAZI\",\n      \"CDN SILLAGE\",\n      \"GOS MOON\",\n      \"MANDARIN SKY\",\n      \"NAUTICA VOYAGE\",\n      \"ROYAL BLEU\",\n      \"ODYSSEY WHITE\",\n      \"JEAN LOWE MATIERE\",\n      \"SUBLIME\",\n      \"GOS ROUGE\",\n      \"9 PM REBEL\",\n      \"KHAMRAH\",\n      \"GOS YELLOW SAPPHIRE\",\n      \"GOS BOSTON\",\n      \"ASAD\",\n      \"TURATHI BLUE\",\n      \"CND SILLAGE\",\n      \"GOS ROYALE\",\n      \"OUD FOR GLORY\",\n      \"AL HARAMAIN GOLD EXTREME\",\n      \"ODYSSEY AOUD\",\n      \"VLO\",\n      \"EMEER\",\n      \"ISSEY MIYAKE\",\n      \"ODYSSEY TYRANT\",\n      \"ASAD ZANZIBAR\",\n      \"GOS BID\",\n      \"9AM\",\n      \"HAWAS ICE\",\n      \"GOS WILDCARD\",\n      \"YARA MOI\",\n      \"VENTANA ARMAF\",\n      \"CDN IMP√âRIALE\",\n      \"AL NASHAMA CAPRICE\",\n      \"YARA\",\n      \"BHARARA BLEU\",\n      \"GOS BLIND BID\",\n      \"GOS ACE\",\n      \"CDN MILESTONE\",\n      \"DETOUR NOIR\",\n      \"RAED LUXE\",\n      \"QAED UNLIMITED\",\n      \"AI HARAMAIN RUBY EDITION\",\n      \"HAWAS BLACK\",\n      \"HAYAATI\",\n      \"ODYSSEY HOMME BLACK\",\n      \"CDN URBAN MAN ELIXIR\",\n      \"CDN UNTOLD\",\n      \"MAAHIR LEGACY\",\n      \"LEGEND SPIRIT\",\n      \"SHAHEEN GOLD\",\n      \"YARA TOUS\",\n      \"FAKHAR ROSE\",\n      \"HONOR AND GLORY\",\n      \"DUBAI NIGHT\",\n      \"BHARARA KING PARFUM\",\n      \"LATTAFA JASOOR\",\n      \"GOS GOLD\",\n      \"CDN INTENSE MAN\",\n      \"GOS FULL HOUSE\",\n      \"ODYSSEY AQUA\",\n      \"HAYAATI AL MALEKY\",\n      \"GOS WIN\",\n      \"FAKHAR BLACK\",\n      \"GOS DIAMOND\",\n      \"KHAMRAH QAHWA\",\n      \"GOS HIGH ROLLER\",\n      \"THE KINGDOM\",\n      \"ODYSSEY MEGA\",\n      \"HAWAS FOR HIM\",\n      \"LATTAFA NEBRAS\",\n      \"AI HARAMAIN GOLD EDITION\",\n      \"AJWAD\",\n      \"RAVE NOW WHITE\",\n      \"ODYSSEY CANDEE\",\n      \"ODYSSEY SPECTRA\",\n      \"YARA CANDY\",\n      \"ODYSSEY LIMONI\",\n      \"AMBER ROUGE\",\n      \"SCEPTRE MALACHITE\",\n      \"VIKING KASHMIR\",\n      \"AI HARAMAIN PRIVATE EDITION\",\n      \"QAED AI FURSAN\",\n      \"GOS JACKPOT\",\n      \"VIKING DUBAI\",\n      \"ROYAL AMBER\",\n      \"BHARARA KING GOLD EDITION\",\n      \"HIS CONFESSION\",\n      \"VIKING CAIRO\",\n      \"BHARARA ELEGANCE\",\n      \"BHARARA PHARAOH 1\",\n      \"BHARARA PHARAOH 2\",\n      \"MAYAR\",\n      \"CLUB DE NUIT PRECIEUX\",\n      \"HER CONFESSION\",\n      \"AMETHYST LATTAFA\",\n      \"LATTAFA TERIAQ\",\n      \"AI HARAMAIN AQUA DUBAI\",\n      \"ASAD BOURBON\",\n      \"NITRO WHITE\",\n      \"LIQUID BURN\",\n      \"NITRO RED\",\n      \"NOBLE BLUSH\",\n      \"LATTAFA SEHR\",\n      \"ISLAND BLISS\",\n      \"LATTAFA ECLAIRE\",\n      \"AL HARAMAIN ROYAL MUSK\",\n      \"SUQRAAT\",\n      \"ISHQ AL SHUYUKH\",\n      \"LIAM BLUE\",\n      \"DUBAI CHOCOLAT\",\n      \"BHARARA CHOCOLATE\",\n      \"HAYA\",\n      \"ISHQ AL SHUYUKH GOLD\",\n      \"ANSAAM SILVER\",\n      \"VINTAGE RADIO\",\n      \"BHARARA ENCHANTED\",\n      \"GOS OPAL\",\n      \"ART OF UNIVERSE\",\n      \"LATTAFA CHIC\",\n      \"HAWAS ELIXIR\",\n      \"HAYA CRUSH\",\n      \"JEAN LOWE AZURE\",\n      \"ROME POUR HOMME\",\n      \"HAYAATI FLORENCE\",\n      \"VELVET GOLD\",\n      \"AJWAD PINK TO PINK\",\n      \"AL QIAM GOLD\",\n      \"ANGHAM LATTAFA\",\n      \"ARABIAN SKY\",\n      \"TAG UOMO ROSSO\",\n      \"TAG ART OF NATURE II\",\n      \"BHARARA PLACID\",\n      \"BHARARA SOLEIL\",\n      \"CDN WOMAN\",\n      \"CDN ICONIC\",\n      \"CONFIDENTIAL PRIVATE GOLD\",\n      \"DELILAH\",\n      \"GOS PLATINIUM OF SPADES\",\n      \"INTIMATION\",\n      \"ISLAND KHADLAJ\",\n      \"JEAN LOWE INMORTEL\",\n      \"JEAN LOWE VIBE\",\n      \"WINNERS TROPHY\",\n      \"KHANJAR EAU DE PARFUM\",\n      \"KISMET MAGIC\",\n      \"MANDARIN SKY ELIXIR\",\n      \"MAYAR CHERRY INTENSE\",\n      \"NITRO RED INTENSELY\",\n      \"NITRO NOW WOMEN\",\n      \"ODYSSEY ARTISTO\",\n      \"ODYSSEY WILD ONE\",\n      \"RAVE NOW RAYHAAN ELIXIR\",\n      \"NOW\",\n      \"SAKEENA\",\n      \"SO CANDID\",\n      \"TARWAH GOLD\",\n      \"LATTAFA TERIAQ INTENSE\",\n      \"VICTORIA LATTAFA\",\n      \"YUM YUM ARMAF\",\n      \"QISSA DELICIOUS\",\n      \"HAWAS TROPICAL\",\n      \"HAWAS FIRE\",\n      \"FAKHAR PLATIN\",\n      \"KHAMARAH DUKHAN\",\n      \"ODYSSEY EAU DE MONTAGNE\",\n      \"ODYSSEY REVOLUTION\",\n      \"ROME IMAGINE\",\n      \"TURATHI ELECTRIC\",\n      \"VULCAN NUE\",\n      \"SPECTRE WRAITH\",\n      \"GOS EMERALD OF SPADES\",\n      \"AFEEF\",\n      \"BHARARA ONYX\",\n      \"SCEPTRE DESERT\",\n      \"NITRO NEITHE\",\n      \"ODYSSEY BLACK FOREST\",\n      \"ODYSSEY TOFFEE COFFEE\",\n      \"ODYSSEY BAHAMAS\",\n      \"ODYSSEY MANGO\",\n      \"NITRO ELIXIR\",\n      \"ROME PARADOXE\",\n      \"ROME YUM YUM\",\n      \"ECLAIRE PISTACHE\",\n      \"ECLAIRE BANOFFEE\",\n      \"9PM ELIXIR\",\n      \"HAWAS MALIBU\",\n      \"HAWAS KOBRA\",\n      \"GOS BONUS DYNASTY FIRE\",\n      \"ON CIE\",\n      \"LOVELY CHERIE\"\n    ],\n\n    set_perfumes: [\n      \"Gos set\",\n      \"GOS Set 3 piezas jo milano\",\n      \"Set 9pm\",\n      \"Set art of universe\",\n      \"Set mandar√≠n\",\n      \"SET VERSACE NECESER + PERFUME + DECANT\",\n      \"Set YARA\",\n      \"Set Zadig & Voltaire this is her\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4736,416],"id":"8e853398-c1fd-4a9a-9894-11607d7d0832","name":"informacion_productos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"# ROL: \nEres un agente t√©cnico especializado en la verificaci√≥n de existencias y precios del cat√°logo de Brada Perfumes. Tu √∫nico objetivo es recibir nombres de perfumes, identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input y consultar la tool stock1 para obtener datos reales.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Productos: Los nombres de los perfumes en el input siempre vendr√°n entre comillas (ej. \"9 PM\", \"Hawas Ice\") para evitar confusi√≥n con el resto del mensaje.\nUso de la Tool stock1:\nDebes ejecutar la tool enviando el nombre exacto del perfume identificado en la variable perfume.\nSi el input contiene m√∫ltiples perfumes, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes mantener el nombre del perfume exactamente igual a como aparece en el cat√°logo, corrigiendo solo errores ortogr√°ficos evidentes seg√∫n tu conocimiento general.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo perfume\nVariable disponibilidad: Si la tool indica que el producto est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre de perfume): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s perfumes\nDebes listar cada perfume en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n# EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"Hola, revisa la disponibilidad de \"9 PM\" y \"Hawas Ice\".\"\nProceso interno:\nLlamada 1: stock1(perfume=\"9 PM\") -> Resultado: Disponible, S/ 140.\nLlamada 2: stock1(perfume=\"Hawas Ice\") -> Resultado: Agotado, S/ 180.\nOutput que debes enviar si son dos o m√°s perfumes: 9 PM: stock si y precio 140 soles. Hawas Ice: stock no y precio 180 soles.\n#NOTAS ADICIONALES\nNo inventes precios ni estados de stock.\nSi la tool no devuelve informaci√≥n para un nombre espec√≠fico, indica: (Nombre de perfume): stock no y precio (No disponible).\nTu respuesta debe ser exclusivamente la lista de stock solicitada, sin saludos ni despedidas adicionales\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5312,608],"id":"64458501-a4f8-45c4-aae9-17b34719c27a","name":"stock_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    \"distritos_permitidos\": [\n      \"Anc√≥n\", \"Ate\", \"Barranco\", \"Bre√±a\", \"Carabayllo\", \"Chaclacayo\", \n      \"Chorrillos\", \"Cieneguilla\", \"Comas\", \"El Agustino\", \"Independencia\", \n      \"Jes√∫s Mar√≠a\", \"La Molina\", \"La Victoria\", \"Lima\", \"Lince\", \n      \"Los Olivos\", \"Lurigancho\", \"Lur√≠n\", \"Magdalena del Mar\", \"Miraflores\", \n      \"Pachac√°mac\", \"Pucusana\", \"Pueblo Libre\", \"Puente Piedra\", \n      \"Punta Hermosa\", \"Punta Negra\", \"R√≠mac\", \"San Bartolo\", \"San Borja\", \n      \"San Isidro\", \"San Juan de Lurigancho\", \"San Juan de Miraflores\", \n      \"San Luis\", \"San Mart√≠n de Porres\", \"San Miguel\", \"Santa Anita\", \n      \"Santa Mar√≠a del Mar\", \"Santa Rosa\", \"Santiago de Surco\", \"Surquillo\", \n      \"Villa El Salvador\", \"Villa Mar√≠a del Triunfo\", \"Callao\", \"Bellavista\", \n      \"Carmen de la Legua Reynoso\", \"La Perla\", \"La Punta\", \"Ventanilla\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4432,400],"id":"09ca4414-ae98-4efb-aaa7-b0a7d4b68b45","name":"distritos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente especializado exclusivamente en la verificaci√≥n de existencias y precios de Decants (presentaciones de 5ml y 10ml) de Brada Perfumes. Tu objetivo es recibir el input del agente principal, identificar los perfumes y sus medidas, y consultar la tool stock_decants para devolver datos precisos.\n# INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Medidas: Debes prestar especial atenci√≥n a la cantidad solicitada (5ml o 10ml). Si el cliente no especifica la medida pero el contexto indica que es un decant, consulta ambas presentaciones.\nUso de la Tool stock_decants:\nDebes ejecutar la tool enviando el nombre del perfume y la medida identificada.\nSi el input contiene m√∫ltiples decants (ej. \"9 PM de 5ml y Hawas de 10ml\"), debes realizar una ejecuci√≥n de la tool por cada producto/medida individualmente.\nMantenimiento de Nomenclatura: Mant√©n el nombre t√©cnico del perfume (ej. \"Club de Nuit Intense\" en lugar de \"cnit\") seg√∫n la lista maestra.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato basado en los datos de la tool:\nCASO 1: Un solo decant\nVariable disponibilidad: Si la tool indica existencias, utiliza \"si\". Si no hay, utiliza \"no\".\nFormato de salida: (Nombre de perfume) ([Medida]): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s decants\nDebes listar cada decant en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad de decants: \"9 PM\" en 5ml y \"Hawas Ice\" en 10ml.\"\nProceso interno:\nLlamada 1: stock_decants(perfume=\"9 PM\", medida=\"5ml\") -> Resultado: Disponible, S/ 35.\nLlamada 2: stock_decants(perfume=\"Hawas Ice\", medida=\"10ml\") -> Resultado: Agotado, S/ 45.\nOutput (Lo que respondes): 9 PM (5ml): stock si y precio 35 soles. Hawas Ice (10ml): stock no y precio 45 soles.\n#REGLAS DE ORO\nProhibici√≥n de Inventar: No inventes precios. Si la tool no devuelve un precio para una medida espec√≠fica, responde: (Nombre de perfume) ([Medida]): stock no y precio (No disponible).\nExclusividad: Tu respuesta debe contener √∫nicamente la lista t√©cnica. No incluyas saludos, recomendaciones, ni frases de cierre.\nPrecisi√≥n de Medida: Aseg√∫rate de que el precio corresponda exactamente a la medida solicitada (un perfume de 10ml siempre es m√°s caro que uno de 5ml).\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5024,608],"id":"edf1ea9c-753a-4178-8823-ad4b5d276fde","name":"stock_decants"},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-4752,880],"id":"c65b6d98-6ca9-4850-a240-dc15d0e6f244","name":"OpenAI Chat Model5","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5008,880],"id":"f40c83eb-7af9-43d9-9718-23906d503917","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5328,848],"id":"4682821d-4ee5-4aa0-bfa8-6ee52c2d74b9","name":"OpenAI Chat Model6","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfumes","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-5168,816],"id":"db9c5a3b-41f0-489b-95b8-1818ea40b41b","name":"stock1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_decants","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4880,832],"id":"cca318d1-6e33-42b3-9253-f90ae5034239","name":"stock2","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfume_sets","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4592,880],"id":"6150c4ba-6b03-4325-b902-35091b0ac31b","name":"stock3","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente t√©cnico especializado exclusivamente en la verificaci√≥n de existencias y precios de los Sets de Perfumes (estuches de regalo o packs con complementos) de Brada Perfumes. Tu misi√≥n es recibir el nombre del set, validarlo contra la tool stock_set_perfumes y devolver la disponibilidad y precio real.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Sets: Los nombres de los sets suelen incluir la palabra \"Set\" (ej. \"Set Yara\", \"Set 9 PM\"). Debes identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input.\nUso de la Tool stock_set_perfumes:\nDebes ejecutar la tool enviando el nombre exacto del set en la variable nombre_set.\nSi el input contiene m√∫ltiples sets, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes respetar el nombre del set tal como aparece en el cat√°logo oficial de Brada Perfumes, asegur√°ndote de que se trate de la presentaci√≥n en estuche y no de la botella individual.\n#L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo Set\nVariable disponibilidad: Si la tool indica que el set est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre del Set): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s Sets\nDebes listar cada set en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad del SET: \"Set Yara\" y \"Set Art of Universe\".\"\nProceso interno:\nLlamada 1: stock_set_perfumes(nombre_set=\"Set Yara\") -> Resultado: Disponible, S/ 210.\nLlamada 2: stock_set_perfumes(nombre_set=\"Set Art of Universe\") -> Resultado: Disponible, S/ 250.\nOutput (Lo que respondes): Set Yara: stock si y precio 210 soles. Set Art of Universe: stock si y precio 250 soles.\n#REGLAS DE ORO\nPrecisi√≥n: No confundas un \"Perfume Full Size\" con un \"Set\". Si el input pide un Set, busca √∫nicamente en la categor√≠a de sets.\nProhibici√≥n de Inventar: No inventes precios ni disponibilidad. Si la tool no devuelve informaci√≥n para un set espec√≠fico, indica: (Nombre del Set): stock no y precio (No disponible).\nMinimalismo: Tu respuesta debe ser exclusivamente la lista t√©cnica solicitada. No incluyas saludos, despedidas ni comentarios sobre el contenido del set.\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-4736,656],"id":"6344ee20-9fcb-45bd-a342-5aaf79248763","name":"stock_set_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"bFX818cxJebYkS92","mode":"list","cachedResultUrl":"/workflow/bFX818cxJebYkS92","cachedResultName":"BRADA | WHATSAPP | compras confirmadas"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-4544,448],"id":"42a85e30-dd9d-47c7-af24-3eace4616f6f","name":"confirmacion_pedidos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1840,2160],"id":"86511a06-e0d8-496b-9161-edd28ac48fe2","name":"If24"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1632,2144],"id":"f6ed93e7-cd4c-4547-9b7c-9f3a9bd6174a","name":"If28"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1280,2560],"id":"6532091a-4da7-484e-bc59-551caaf8837a","name":"If29"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1904,2112],"typeVersion":1,"id":"4b346085-38b5-41dc-aa4e-0e5fd0d63b15","name":"Sticky Note3"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1408,2160],"id":"60a486b8-d8b9-45f7-bcc2-0237d9dacb35","name":"Wait1","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-832,2368],"id":"aec693f3-d181-42f6-96ef-f4259257f242","name":"If41"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-464,2576],"id":"d0bce6d9-8944-4f36-8369-887245578174","name":"If43"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2368],"id":"920f0b3f-260f-4a46-8f84-c7fafcb4e42d","name":"Wait11","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2576],"id":"9445a338-fa59-4652-b7a7-042da4ab0166","name":"Wait12","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-256,2592],"id":"1b4c198d-a84a-4886-bfee-45e03505844a","name":"Wait13","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1632,2320],"id":"985412b0-18a0-4a74-9383-848361eecf6d","name":"Wait14","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-624,2384],"id":"0b01e43e-8f88-4806-9aa3-aaafae23afa5","name":"Wait15","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1264,2320],"id":"455fc9a5-d692-424b-96af-4dc9dfb5ecfa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1440,2320],"id":"43ef0c39-d3b6-4ed3-9bbe-55b60f80b5a4"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-656,2576],"id":"71901a37-3c10-48e0-8c0d-ea488faf670e"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-7","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-832,2576],"id":"94b90b7c-2489-43c2-b38d-5f1d9ed48958"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot37","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[64,2592],"id":"70f90af3-d2d6-42bb-bbed-2a460fc13eb2"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-8","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-112,2592],"id":"79b9eee3-c9f3-43cc-945b-a659df940b42"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot38","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-288,2384],"id":"377a6011-2a90-4508-ad7a-18e8be515097"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-9","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-464,2384],"id":"4736c49f-51b0-433c-acaf-c5ec1975c27f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot39","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1072,2160],"id":"a211f2a4-e5b1-4b1b-b198-ecee0d6bdf3a"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-10","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1248,2160],"id":"e7fcf0ac-d57f-498d-84c2-efc72cefbb9c"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[336,720],"id":"2aaf0e50-945f-404a-a630-6c934c4bf678","name":"If25"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[544,704],"id":"db6e3976-9c81-410c-a089-cbbffed9a498","name":"If30"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[896,1120],"id":"3d9b40b9-6eb5-4641-9243-4acb6bbaab90","name":"If31"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[272,672],"typeVersion":1,"id":"9d6dc394-e9c9-47cf-bb8b-3ec6e169cd24","name":"Sticky Note4"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[768,720],"id":"e193f0ff-9818-4fff-ab4c-87a07ea2bc57","name":"Wait16","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1344,928],"id":"70a6f8d6-3ef1-45ad-be33-45e51b8b5bf7","name":"If44"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1712,1136],"id":"46e4e9c0-d629-4cae-a016-78122838bf5c","name":"If45"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,928],"id":"9005e0a0-7928-4432-afba-ecca82410842","name":"Wait17","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,1136],"id":"26654f8d-1377-49f2-b4ba-feefd58f29f5","name":"Wait18","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1920,1152],"id":"e5e9d5a8-676d-4787-ad0c-57a9cecb51e6","name":"Wait19","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[544,880],"id":"0a2148fa-6d21-4cef-85c9-2f9f7747051b","name":"Wait20","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1552,944],"id":"24a50f49-9fa7-444a-889d-b0a47dcdca22","name":"Wait21","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[912,880],"id":"73a2a9cb-96fa-4c67-b2c0-855467476004"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-11","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[736,880],"id":"2a355cf5-4023-4e5c-94cd-fb54d20ab48d"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot21","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1520,1136],"id":"e4e81844-daec-44fa-87e1-8a40c9f593e1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-12","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1344,1136],"id":"124b0253-10a5-4f3f-8b46-7e729f639b4b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot40","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2240,1152],"id":"d7a77253-dcf2-4e33-9699-ace3f5cf9843"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-13","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2064,1152],"id":"47d740d9-af91-4b47-a3d9-43f6089948ac"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot41","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1888,944],"id":"ba55a9c2-6648-4009-9d21-cbad56eea3fa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-14","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1712,944],"id":"09553178-8112-4313-b41f-7edb86da9bb2"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot42","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1104,720],"id":"a287f371-7d38-4b62-96ac-80a54a0f4a85"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-15","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[928,720],"id":"5a670fc0-4c1b-45d5-bf03-f2cce3d56697"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-144,0],"id":"21286fd2-eb14-4621-961c-daf1710c98db","name":"If32"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[64,-16],"id":"9298649c-49d2-4ef9-a38d-d1ecd699741a","name":"If33"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[416,400],"id":"0335f432-f2cb-43bf-9855-8b773b8fd74f","name":"If34"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-208,-48],"typeVersion":1,"id":"f7db0934-d8a5-4643-8ea5-3b74f9fd30ff","name":"Sticky Note5"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[288,0],"id":"edc5d3e6-6cb7-4e24-a395-5bfd2ec21e8f","name":"Wait22","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[864,208],"id":"3d08713e-6783-4344-835a-52021892fc79","name":"If46"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1232,416],"id":"a3ff7975-1b42-4ee2-8d28-a9e2530627ea","name":"If47"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,208],"id":"050e27ee-0dc9-4cfe-9b3b-4984fdb3c424","name":"Wait23","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,416],"id":"316376c3-954b-4325-ab08-caadfb880e67","name":"Wait24","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1440,432],"id":"cfc28de1-e1fa-4583-80c7-4806a6cd7ad1","name":"Wait25","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[64,160],"id":"e8d0be90-195b-413a-b96d-28c469da7d2a","name":"Wait26","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1072,224],"id":"83b77384-ab0f-442c-aa8e-20cbf18ba56b","name":"Wait27","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot22","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[432,160],"id":"91fe9d8e-e24c-4675-9a65-5c3b96805cd1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[256,160],"id":"b2aa295f-bb56-4faf-bc6e-2c244ae1b8b5"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot23","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1040,416],"id":"42af2c54-fd06-4e53-9b3e-386ae18aad48"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[864,416],"id":"334d03f2-3acd-4c43-9e5c-e5c9ec1fab6b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot43","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1760,432],"id":"a10b0be7-7ad4-4a67-b580-1f6c8f63dd0b"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1584,432],"id":"3ae52091-798e-4106-ad81-b391a548b061"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot44","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1408,224],"id":"634d84c9-0fb9-4dc6-a691-70a9eb6eaff6"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1232,224],"id":"4c0fbfdd-c75a-4058-9fb3-c934f00a1774"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot45","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[624,0],"id":"c8374285-c938-46a3-ab3d-a8987b53dafe"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[448,0],"id":"8a5f2626-93c0-485f-83b6-88d1b7969f67"}],"connections":{"AI Agent":{"main":[[{"node":"Verificador1","type":"main","index":0}]]},"Auto-fixing Output Parser1":{"ai_outputParser":[[{"node":"Verificador1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model8":{"ai_languageModel":[[{"node":"Auto-fixing Output Parser1","type":"ai_languageModel","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"Auto-fixing Output Parser1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model9":{"ai_languageModel":[[{"node":"Verificador1","type":"ai_languageModel","index":0}]]},"Verificador1":{"main":[[{"node":"ordenar","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Get a row3","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"If2":{"main":[[{"node":"Update a row1","type":"main","index":0}],[{"node":"If3","type":"main","index":0}]]},"If3":{"main":[[{"node":"Switch3","type":"main","index":0}],[{"node":"No Operation, do nothing4","type":"main","index":0}]]},"Edit Fields4":{"main":[[{"node":"If2","type":"main","index":0}]]},"If13":{"main":[[{"node":"Get a row1","type":"main","index":0}],[{"node":"Create a row","type":"main","index":0}]]},"Calendario":{"ai_tool":[[]]},"Create a row":{"main":[[{"node":"Get a row1","type":"main","index":0}]]},"Get a row1":{"main":[[{"node":"Edit Fields4","type":"main","index":0}]]},"Update a row1":{"main":[[{"node":"Switch3","type":"main","index":0}]]},"Get a row":{"main":[[{"node":"If13","type":"main","index":0}]]},"If4":{"main":[[{"node":"If11","type":"main","index":0}],[{"node":"Fecha","type":"main","index":0}]]},"Formatea fecha":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Handler variables":{"main":[[{"node":"If10","type":"main","index":0}]]},"Fecha":{"main":[[{"node":"Formatea fecha","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Handler variables","type":"main","index":0}]]},"Wait6":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"If6":{"main":[[{"node":"Redis1","type":"main","index":0}],[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"Delete Redis":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Edit Fields19":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"Get Redis1":{"main":[[{"node":"If6","type":"main","index":0}]]},"Edit Fields20":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"If15":{"main":[[{"node":"Edit Fields19","type":"main","index":0}],[{"node":"Edit Fields20","type":"main","index":0}]]},"METER_ANUNCIO":{"main":[[{"node":"guarda_ANUNCIO","type":"main","index":0}]]},"BAJAR_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"guarda_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"If":{"main":[[{"node":"RESUMIDOR ANUNCIOS","type":"main","index":0}],[{"node":"If4","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"RESUMIDOR ANUNCIOS","type":"ai_languageModel","index":0}]]},"If10":{"main":[[{"node":"METER_ANUNCIO","type":"main","index":0}],[{"node":"BAJAR_ANUNCIO","type":"main","index":0}]]},"Redis1":{"main":[[{"node":"If15","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"If16","type":"main","index":0}]]},"Edit Fields12":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"AUDIO1","type":"main","index":0}]]},"Switch3":{"main":[[{"node":"HTTP Request","type":"main","index":0}],[{"node":"OpenAI","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}]]},"AUDIO1":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"If16":{"main":[[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields12","type":"main","index":0}]]},"Edit Fields17":{"main":[[{"node":"If","type":"main","index":0}]]},"If11":{"main":[[{"node":"Update a row4","type":"main","index":0}]]},"If12":{"main":[[{"node":"Get a row","type":"main","index":0}],[{"node":"If20","type":"main","index":0}]]},"If20":{"main":[[{"node":"Update a row6","type":"main","index":0}]]},"If1":{"main":[[{"node":"If12","type":"main","index":0}]]},"ordenar":{"main":[[{"node":"Respuesta1","type":"main","index":0}]]},"Respuesta1":{"main":[[{"node":"Update a row","type":"main","index":0}]]},"Wait2":{"main":[[{"node":"Respuesta2","type":"main","index":0}]]},"Respuesta2":{"main":[[{"node":"Update a row3","type":"main","index":0}]]},"If14":{"main":[[{"node":"Wait3","type":"main","index":0}],[{"node":"If23","type":"main","index":0}]]},"Wait3":{"main":[[{"node":"Respuesta3","type":"main","index":0}]]},"Respuesta3":{"main":[[{"node":"Update a row5","type":"main","index":0}]]},"If17":{"main":[[{"node":"Wait4","type":"main","index":0}],[{"node":"If32","type":"main","index":0}]]},"Wait4":{"main":[[{"node":"Respuesta4","type":"main","index":0}]]},"Respuesta4":{"main":[[{"node":"Update a row7","type":"main","index":0}]]},"RESUMIDOR ANUNCIOS":{"main":[[{"node":"If4","type":"main","index":0}]]},"Supervisor":{"ai_tool":[[]]},"Update a row":{"main":[[{"node":"If8","type":"main","index":0}]]},"Update a row3":{"main":[[{"node":"If14","type":"main","index":0}]]},"Update a row5":{"main":[[{"node":"If17","type":"main","index":0}]]},"Get a row3":{"main":[[{"node":"If19","type":"main","index":0}]]},"If19":{"main":[[{"node":"If5","type":"main","index":0}]]},"Update a row7":{"main":[[{"node":"If25","type":"main","index":0}]]},"If7":{"main":[[{"node":"Update a row9","type":"main","index":0}],[{"node":"Create a row1","type":"main","index":0}]]},"Get a row2":{"main":[[{"node":"If7","type":"main","index":0}]]},"Create a row1":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"RAZONADOR PLUS":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Update a row9":{"main":[[{"node":"Wait6","type":"main","index":0}]]},"1. Descargar Imagen":{"main":[[{"node":"2. Enviar a Chatwoot","type":"main","index":0}]]},"If8":{"main":[[{"node":"Wait2","type":"main","index":0}],[{"node":"If24","type":"main","index":0}]]},"If23":{"main":[[{"node":"If26","type":"main","index":0}],[{"node":"Wait9","type":"main","index":0}]]},"If26":{"main":[[],[{"node":"Wait","type":"main","index":0}]]},"If27":{"main":[[{"node":"Wait5","type":"main","index":0}],[{"node":"Wait7","type":"main","index":0}]]},"Wait":{"main":[[{"node":"1. Descargar Imagen 1-6","type":"main","index":0}]]},"If40":{"main":[[],[{"node":"Wait10","type":"main","index":0}]]},"If42":{"main":[[],[{"node":"Wait8","type":"main","index":0}]]},"Wait5":{"main":[[{"node":"If40","type":"main","index":0}]]},"Wait7":{"main":[[{"node":"1. Descargar Imagen 1-3","type":"main","index":0}]]},"Wait8":{"main":[[{"node":"1. Descargar Imagen 1-4","type":"main","index":0}]]},"Wait9":{"main":[[{"node":"1. Descargar Imagen 1-2","type":"main","index":0}]]},"Wait10":{"main":[[{"node":"1. Descargar Imagen 1-5","type":"main","index":0}]]},"2. Enviar a Chatwoot16":{"main":[[{"node":"If27","type":"main","index":0}]]},"1. Descargar Imagen 1-2":{"main":[[{"node":"2. Enviar a Chatwoot16","type":"main","index":0}]]},"2. Enviar a Chatwoot19":{"main":[[{"node":"If42","type":"main","index":0}]]},"1. Descargar Imagen 1-3":{"main":[[{"node":"2. Enviar a Chatwoot19","type":"main","index":0}]]},"1. Descargar Imagen 1-4":{"main":[[{"node":"2. Enviar a Chatwoot34","type":"main","index":0}]]},"1. Descargar Imagen 1-5":{"main":[[{"node":"2. Enviar a Chatwoot35","type":"main","index":0}]]},"1. Descargar Imagen 1-6":{"main":[[{"node":"2. Enviar a Chatwoot36","type":"main","index":0}]]},"If5":{"main":[[{"node":"supervisor","type":"main","index":0}],[{"node":"If1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"supervisor","type":"ai_languageModel","index":0}]]},"pasar_supervisor":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"Call 'Supervisor healup'":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"enviar_nombre":{"ai_tool":[[]]},"informacion_productos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"distritos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_decants":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model5":{"ai_languageModel":[[{"node":"stock_set_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model6":{"ai_languageModel":[[{"node":"stock_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"stock_decants","type":"ai_languageModel","index":0}]]},"stock1":{"ai_tool":[[{"node":"stock_perfumes","type":"ai_tool","index":0}]]},"stock2":{"ai_tool":[[{"node":"stock_decants","type":"ai_tool","index":0}]]},"stock3":{"ai_tool":[[{"node":"stock_set_perfumes","type":"ai_tool","index":0}]]},"stock_set_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"confirmacion_pedidos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"If24":{"main":[[{"node":"If28","type":"main","index":0}],[{"node":"Wait14","type":"main","index":0}]]},"If28":{"main":[[],[{"node":"Wait1","type":"main","index":0}]]},"If29":{"main":[[{"node":"Wait11","type":"main","index":0}],[{"node":"Wait12","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"1. Descargar Imagen 1-10","type":"main","index":0}]]},"If41":{"main":[[],[{"node":"Wait15","type":"main","index":0}]]},"If43":{"main":[[],[{"node":"Wait13","type":"main","index":0}]]},"Wait11":{"main":[[{"node":"If41","type":"main","index":0}]]},"Wait12":{"main":[[{"node":"1. Descargar Imagen 1-7","type":"main","index":0}]]},"Wait13":{"main":[[{"node":"1. Descargar Imagen 1-8","type":"main","index":0}]]},"Wait14":{"main":[[{"node":"1. Descargar Imagen 1-","type":"main","index":0}]]},"Wait15":{"main":[[{"node":"1. Descargar Imagen 1-9","type":"main","index":0}]]},"2. Enviar a Chatwoot17":{"main":[[{"node":"If29","type":"main","index":0}]]},"1. Descargar Imagen 1-":{"main":[[{"node":"2. Enviar a Chatwoot17","type":"main","index":0}]]},"2. Enviar a Chatwoot20":{"main":[[{"node":"If43","type":"main","index":0}]]},"1. Descargar Imagen 1-7":{"main":[[{"node":"2. Enviar a Chatwoot20","type":"main","index":0}]]},"1. Descargar Imagen 1-8":{"main":[[{"node":"2. Enviar a Chatwoot37","type":"main","index":0}]]},"1. Descargar Imagen 1-9":{"main":[[{"node":"2. Enviar a Chatwoot38","type":"main","index":0}]]},"1. Descargar Imagen 1-10":{"main":[[{"node":"2. Enviar a Chatwoot39","type":"main","index":0}]]},"If25":{"main":[[{"node":"If30","type":"main","index":0}],[{"node":"Wait20","type":"main","index":0}]]},"If30":{"main":[[],[{"node":"Wait16","type":"main","index":0}]]},"If31":{"main":[[{"node":"Wait17","type":"main","index":0}],[{"node":"Wait18","type":"main","index":0}]]},"Wait16":{"main":[[{"node":"1. Descargar Imagen 1-15","type":"main","index":0}]]},"If44":{"main":[[],[{"node":"Wait21","type":"main","index":0}]]},"If45":{"main":[[],[{"node":"Wait19","type":"main","index":0}]]},"Wait17":{"main":[[{"node":"If44","type":"main","index":0}]]},"Wait18":{"main":[[{"node":"1. Descargar Imagen 1-12","type":"main","index":0}]]},"Wait19":{"main":[[{"node":"1. Descargar Imagen 1-13","type":"main","index":0}]]},"Wait20":{"main":[[{"node":"1. Descargar Imagen 1-11","type":"main","index":0}]]},"Wait21":{"main":[[{"node":"1. Descargar Imagen 1-14","type":"main","index":0}]]},"2. Enviar a Chatwoot18":{"main":[[{"node":"If31","type":"main","index":0}]]},"1. Descargar Imagen 1-11":{"main":[[{"node":"2. Enviar a Chatwoot18","type":"main","index":0}]]},"2. Enviar a Chatwoot21":{"main":[[{"node":"If45","type":"main","index":0}]]},"1. Descargar Imagen 1-12":{"main":[[{"node":"2. Enviar a Chatwoot21","type":"main","index":0}]]},"1. Descargar Imagen 1-13":{"main":[[{"node":"2. Enviar a Chatwoot40","type":"main","index":0}]]},"1. Descargar Imagen 1-14":{"main":[[{"node":"2. Enviar a Chatwoot41","type":"main","index":0}]]},"1. Descargar Imagen 1-15":{"main":[[{"node":"2. Enviar a Chatwoot42","type":"main","index":0}]]},"If32":{"main":[[{"node":"If33","type":"main","index":0}],[{"node":"Wait26","type":"main","index":0}]]},"If33":{"main":[[],[{"node":"Wait22","type":"main","index":0}]]},"If34":{"main":[[{"node":"Wait23","type":"main","index":0}],[{"node":"Wait24","type":"main","index":0}]]},"Wait22":{"main":[[{"node":"1. Descargar Imagen 1-20","type":"main","index":0}]]},"If46":{"main":[[],[{"node":"Wait27","type":"main","index":0}]]},"If47":{"main":[[],[{"node":"Wait25","type":"main","index":0}]]},"Wait23":{"main":[[{"node":"If46","type":"main","index":0}]]},"Wait24":{"main":[[{"node":"1. Descargar Imagen 1-17","type":"main","index":0}]]},"Wait25":{"main":[[{"node":"1. Descargar Imagen 1-18","type":"main","index":0}]]},"Wait26":{"main":[[{"node":"1. Descargar Imagen 1-16","type":"main","index":0}]]},"Wait27":{"main":[[{"node":"1. Descargar Imagen 1-19","type":"main","index":0}]]},"2. Enviar a Chatwoot22":{"main":[[{"node":"If34","type":"main","index":0}]]},"1. Descargar Imagen 1-16":{"main":[[{"node":"2. Enviar a Chatwoot22","type":"main","index":0}]]},"2. Enviar a Chatwoot23":{"main":[[{"node":"If47","type":"main","index":0}]]},"1. Descargar Imagen 1-17":{"main":[[{"node":"2. Enviar a Chatwoot23","type":"main","index":0}]]},"1. Descargar Imagen 1-18":{"main":[[{"node":"2. Enviar a Chatwoot43","type":"main","index":0}]]},"1. Descargar Imagen 1-19":{"main":[[{"node":"2. Enviar a Chatwoot44","type":"main","index":0}]]},"1. Descargar Imagen 1-20":{"main":[[{"node":"2. Enviar a Chatwoot45","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"acwebhook.alefcompany.online","user-agent":"rest-client/2.1.0 (linux-musl x86_64) ruby/3.4.4p34","content-length":"2304","accept":"application/json","accept-encoding":"gzip;q=1.0,deflate;q=0.6,identity;q=0.3","content-type":"application/json","x-forwarded-for":"173.249.43.27","x-forwarded-host":"acwebhook.alefcompany.online","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"6a57d0c37ad6","x-real-ip":"173.249.43.27"},"params":{},"query":{},"body":{"account":{"id":2,"name":"Healup"},"additional_attributes":{},"content_attributes":{},"content_type":"text","content":"a","conversation":{"additional_attributes":{},"can_reply":true,"channel":"Channel::Whatsapp","contact_inbox":{"id":4,"contact_id":4,"inbox_id":4,"source_id":"51972619000","created_at":"2026-01-02T16:51:45.640Z","updated_at":"2026-01-02T16:51:45.640Z","hmac_verified":false,"pubsub_token":"STv1xcrZw8Aeuyt1SPgxmVQm"},"id":1,"inbox_id":4,"messages":[{"id":18,"content":"a","account_id":2,"inbox_id":4,"conversation_id":1,"message_type":0,"created_at":1767380149,"updated_at":"2026-01-02T18:55:49.212Z","private":false,"status":"sent","source_id":"wamid.HBgLNTE5NzI2MTkwMDAVAgASGBYzRUIwQTY2M0JDMjQwOTg4NTdDQTg3AA==","content_type":"text","content_attributes":{},"sender_type":"Contact","sender_id":4,"external_source_ids":{},"additional_attributes":{},"processed_message_content":"a","sentiment":{},"conversation":{"assignee_id":null,"unread_count":1,"last_activity_at":1767380149,"contact_inbox":{"source_id":"51972619000"}},"sender":{"additional_attributes":{},"custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false,"type":"contact"}}],"labels":[],"meta":{"sender":{"additional_attributes":{},"custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false,"type":"contact"},"assignee":null,"assignee_type":null,"team":null,"hmac_verified":false},"status":"open","custom_attributes":{},"snoozed_until":null,"unread_count":1,"first_reply_created_at":null,"priority":null,"waiting_since":1767372705,"agent_last_seen_at":1767378677,"contact_last_seen_at":0,"last_activity_at":1767380149,"timestamp":1767380149,"created_at":1767372705,"updated_at":1767380149.2243187},"created_at":"2026-01-02T18:55:49.212Z","id":18,"inbox":{"id":4,"name":"Heal Up Lab WhatsApp"},"message_type":"incoming","private":false,"sender":{"account":{"id":2,"name":"Healup"},"additional_attributes":{},"avatar":"","custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false},"source_id":"wamid.HBgLNTE5NzI2MTkwMDAVAgASGBYzRUIwQTY2M0JDMjQwOTg4NTdDQTg3AA==","event":"message_created"},"webhookUrl":"https://acwebhook.alefcompany.online/webhook/healup2","executionMode":"production"}}]},"versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","activeVersionId":null,"versionCounter":23,"triggerCount":1,"shared":[{"updatedAt":"2026-01-08T17:51:46.711Z","createdAt":"2026-01-08T17:51:46.711Z","role":"workflow:owner","workflowId":"bIVpE1aXwtICWRcyHjLUv","projectId":"MTPybkDgxszv17uX","project":{"updatedAt":"2025-12-12T19:47:40.556Z","createdAt":"2025-12-12T19:45:17.094Z","id":"MTPybkDgxszv17uX","name":"Juan Pablo Jesus Bazan Ramos <bazanjuanpa@gmail.com>","type":"personal","icon":null,"description":null,"creatorId":"4423001a-8ae6-45ae-b4e5-774853e1a949","projectRelations":[{"updatedAt":"2025-12-12T19:45:17.094Z","createdAt":"2025-12-12T19:45:17.094Z","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949","projectId":"MTPybkDgxszv17uX","user":{"updatedAt":"2026-01-21T04:04:53.319Z","createdAt":"2025-12-12T19:45:16.195Z","id":"4423001a-8ae6-45ae-b4e5-774853e1a949","email":"bazanjuanpa@gmail.com","firstName":"Juan Pablo Jesus","lastName":"Bazan Ramos","personalizationAnswers":{"version":"v4","personalization_survey_submitted_at":"2025-12-12T19:47:50.835Z","personalization_survey_n8n_version":"1.123.5","companySize":"<20","companyType":"saas","role":"business-owner","reportedSource":"twitter"},"settings":{"userActivated":true,"easyAIWorkflowOnboarded":true,"firstSuccessfulWorkflowId":"hA8_Wb7G-H_xzMUXbPCqT","userActivatedAt":1768943704423,"npsSurvey":{"waitingForResponse":true,"ignoredCount":2,"lastShownAt":1767054623912}},"disabled":false,"mfaEnabled":false,"lastActiveAt":"2026-01-21","isPending":false}}]}}],"activeVersion":null}
[2026-01-21T04:51:20.411Z] Request received: {"clientKey":"brada","active":false}
[2026-01-21T04:51:20.414Z] Resolved Client: brada -> TargetID: bIVpE1aXwtICWRcyHjLUv
[2026-01-21T04:51:20.414Z] API Config - BaseURL: https://acn8n.alefcompany.online/api/v1, KeyLength: 207
[2026-01-21T04:51:20.415Z] Executing n8n action: deactivate on bIVpE1aXwtICWRcyHjLUv
[2026-01-21T04:51:21.237Z] n8n Response: {"updatedAt":"2026-01-12T22:41:59.443Z","createdAt":"2026-01-08T17:51:46.711Z","id":"bIVpE1aXwtICWRcyHjLUv","name":"BRADAWHATSAPP","description":null,"active":false,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $('Delete Redis').first().json.response }}\nCurrent date: {{ $('Formatea fecha').first().json.formattedDate }}\nEl numero del whatsapp del paciente es: {{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n\n## CLASIFICACI√ìN DE TEXTO:\nTe va a llegar los mensajes en parte de esta forma:\nTexto mensaje: [Mensaje]\nAudio transcripto: [audio trascripto]\nImagen analizada: [mensaje analizado]\nesto es para que sepas diferenciar los audios, imagenes, y textos que te manden.\n","options":{"systemMessage":"=#ROL\n1. IDENTIDAD Y VOCABULARIO (EL \"QUI√âN\" Y \"QU√â\" DECIR)\nEsta secci√≥n define su personalidad y el est√°ndar de lenguaje que debe utilizar para conectar con el cliente que desea comprar en Brada Perfumes.\nNombre: Diego.\nCargo: Asesor de ventas de la tienda ‚ÄúBrada Perfumes‚Äù, especializado en alta perfumer√≠a y fragancias √°rabes.\nTrato al Cliente: Uso de un tono simple, cercano y directo. Se evita la informalidad excesiva\nUso de \"Hermano\": El t√©rmino \"hermano\" queda restringido √∫nicamente al saludo inicial. No debe utilizarse en el resto de la conversaci√≥n para evitar un exceso de confianza.\nRestricci√≥n Cr√≠tica: Queda estrictamente prohibido el uso de apelativos exagerados como \"perfum√≥n\" o \"joyita\". Tambi√©n se proh√≠be el lenguaje rob√≥tico, el trato formal de \"Usted\" y el uso de diminutivos (ej. \"perfumito\", \"botellita\").\nEjemplo de Aplicaci√≥n: \nEntrada: \"hola que tal, precio de asad\" \nRespuesta de Diego: \"Hola hermano, que tal? El Lattafa Asad s√≠ lo tenemos disponible, aqu√≠ te paso los detalles...\"\n\n2. PROTOCOLOS DE COMUNICACI√ìN (EL \"C√ìMO\" HABLAR)\nEsta secci√≥n establece la mec√°nica de sus respuestas para garantizar una venta √°gil, persuasiva y aut√©ntica.\nRegla de Interacci√≥n: Responder mensaje por mensaje para mantener un ritmo de chat natural.\nRegla de Extensi√≥n Adaptativa:\nRespuestas Simples: M√°ximo 2 l√≠neas para saludos iniciales o confirmaciones de recepci√≥n.\nRespuestas de Cat√°logo: Entrega de la informaci√≥n clave (precio, disponibiidad y nombre del producto) bas√°ndose en las tres tools seg√∫n las reglas correspondientes a su uso en la secci√≥n: ‚Äú\nRegla de Estructura: Si el cliente pregunta por varias fragancias, responda de forma ordenada destacando lo mejor de cada una.\nRegla de Est√©tica: Uso din√°mico de 1 emoji por mensaje (üî•, üí®, ) para transmitir la energ√≠a y exclusividad de las fragancias.\nRegla de No-Repetici√≥n:\nNo repita el saludo de bienvenida si el cliente contin√∫a la conversaci√≥n m√°s tarde.\nSi el cliente no entiende una nota olfativa, use comparaciones sencillas (ej. \"huele a limpio\", \"es bien dulcecito\") sin perder la base t√©cnica.\n3. L√ìGICA DE OBJETIVOS (EL \"PARA QU√â\" ACTUAR)\nEsta secci√≥n rige sus decisiones estrat√©gicas, priorizando la asesor√≠a efectiva y el cierre de ventas seguro.\nMisi√≥n Principal: Identificar el nombre del perfume que desee el cliente) y resolver dudas sobre stock y env√≠os usando exclusivamente las tools.\nFiltro de Pago y Env√≠o: Prohibido solicitar datos de env√≠o o confirmar pedidos si el cliente no ha pasado por el \"Filtro de Validaci√≥n de Pago\" (An√°lisis de imagen del comprobante).\nFiltro de Asesor√≠a: Ante consultas sobre reclamos, devoluciones o pedidos de asesor√≠a m√©dica/piel muy complejos, debe derivar inmediatamente al supervisor.\nIntegridad de Stock: Prohibido inventar disponibilidad o precios. La √∫nica fuente v√°lida es el output de la tool stock_real.\n#CONOCIMIENTO GENERAL\n### ¬øQu√© es Brada Perfumes?\nEs una tienda especializada en alta perfumer√≠a y fragancias √°rabes exclusivas. Como asesor de ventas, tu objetivo es orientar a los clientes para encontrar su fragancia ideal y cerrar la venta de forma √°gil.\n### Cat√°logo de Productos\nBrada Perfumes ofrece tres categor√≠as de productos. Para conocer la lista actualizada de existencias, siempre debes ejecutar la tool informacion_perfumes al inicio de la consulta:\n**Perfumes Full Size**: Botellas completas en su presentaci√≥n original (ej. 100ml, 120ml).\nEjemplos clave: 9 PM, Hawas Ice, Khamrah, Asad, Creed Aventus.\n**Decants**: Perfumes originales trasvasados a presentaciones peque√±as de 5ml o 10ml. Son ideales para que el cliente pruebe la fragancia antes de comprar el frasco grande.\nEjemplos clave: YSL EDP, Club de Nuit Intense, Scandal.\n**Sets de Perfumes**: Estuches especiales que incluyen la fragancia principal y complementos (lociones, geles o miniaturas).\nEjemplos clave: Set Yara, Set 9pm, Set Art of Universe.\nNota Operativa: La tool informacion_perfumes es tu √∫nica fuente de verdad para nombres de productos. Si un cliente menciona un nombre que no est√° en la tool, verifica si existe un nombre similar por error ortogr√°fico antes de confirmar disponibilidad.\n# REGLAS DE ORO\n## **Regla de uso de la tool ‚Äúinformaci√≥n_perfumes‚Äù**.\nAl recibir el mensaje del cliente, SIEMPRE usa la tool ‚Äúinformacion_perfumes‚Äù antes de redactar la respuesta. Esta tool te devolver√° todos los productos que vende nuestra tienda ‚ÄúBrada Perfumes‚Äù los cuales est√°n divididos en tres categor√≠as: ‚ÄúPerfumes full size‚Äù, ‚ÄúDecants‚Äù y ‚Äúset de perfumes‚Äù\nRestricci√≥n de datos: Cabe aclarar que esta tool NO CONTIENE PRECIOS NI STOCK REAL. Su √∫nica funci√≥n es servir de gu√≠a de nomenclatura formal para identificar los productos que ofrecemos. \n## **Regla de ortograf√≠a**\nEsta regla rige c√≥mo Diego debe interpretar y responder a los mensajes con errores de escritura.\n* Inteligencia Sem√°ntica: Diego debe ignorar errores ortogr√°ficos, de puntuaci√≥n o de tildes del cliente para identificar la intenci√≥n real.\nMapeo Autom√°tico: Si el cliente escribe incorrectamente el nombre de un perfume (ej. \"habas ice\", \"9pm elicsir\", \"latifa asad\"), Diego debe asociarlo mentalmente con el producto correcto de la tool ‚ÄúInformacion_productos‚Äù sin pedir aclaraciones.\nNaturalidad en la Respuesta: Al responder, Diego debe escribir los nombres de los perfumes de forma correcta (seg√∫n la tool ‚ÄúInformacion_productos‚Äù) para mantener el profesionalismo, pero sin resaltar el error del cliente.\nEjemplo de Aplicaci√≥n:\n- Entrada del cliente: \"hola ermano presio del cnit untold\"\n- Acci√≥n de Diego: Identifica \"hermano\", \"precio\" y \"Club de Nuit Untold\".\n- Respuesta de Diego: \"Hola hermano, el Club de Nuit Untold s√≠ lo tenemos disponible. El precio es de S/...\"\n## **Regla de cierre variable**\nEsta regla evita que Diego suene como un robot de ventas insistente.\nFinalizaci√≥n Variable: No es obligatorio terminar cada mensaje con una pregunta. Diego debe evaluar si la conversaci√≥n requiere una pregunta para avanzar o si una afirmaci√≥n directa es m√°s natural seg√∫n el contexto.\nGu√≠a de Ejemplos: El agente debe seguir estrictamente la estructura de la secci√≥n \"EJEMPLOS DE CONVERSACI√ìN\" para identificar en qu√© fases se cierra con una pregunta y en cu√°les se cierra con una instrucci√≥n directa (ej. al pedir el comprobante o solicitar datos).\nCero Presi√≥n: Si el cliente muestra inter√©s general pero no intenci√≥n de compra, Diego debe responder de forma informativa y cerrar de manera amable sin presionar por una respuesta inmediata.\n## Regla de tiempo de entrega:\nEsta regla rige c√≥mo informar sobre la llegada del pedido utilizando la hora actual seg√∫n el input (current_date).\nPara Lima (env√≠o por motorizado): Si el pago se valida antes de las 10:00 am, el pedido llega el mismo d√≠a. De lo contrario, llega el d√≠a de ma√±ana.\nPara Provincia (env√≠o por la agencia Shalom): Si el pago se valida antes de las 4:00 pm, se entrega a la agencia el mismo d√≠a. El tiempo de viaje es de 2 a 5 d√≠as h√°biles.\nAplicaci√≥n: Responde siempre con seguridad seg√∫n la hora actual. No des rangos vagos si el cliente ya pas√≥ el l√≠mite de hora.\n## Regla de env√≠os\nPol√≠tica: Solo realizamos env√≠os a domicilio o agencia; no contamos con la opci√≥n de recojo en tienda f√≠sica.\nAplicaci√≥n: Si el cliente pregunta por una direcci√≥n f√≠sica para recoger su pedido, inf√≥rmele amablemente que operamos exclusivamente mediante env√≠os.\n## Regla de solicitudes presenciales\nAplica cuando el cliente desea visitar el local, ver los perfumes en persona o agendar una cita presencial.\nEjemplos de activaci√≥n: \"Quiero ir a ver los perfumes en persona\", \"Podemos programar una cita para ir de manera presencial con mi amigo\" o \"¬øD√≥nde est√°n ubicados para ir hoy?\".\nAcci√≥n: Utilice la tool pasar_supervisor.\nRespuesta obligatoria: \"Voy a comunicarme con mi compa√±ero para que te confirme el horario\".\n\n\n\n#FASES DE FLUJO DE FUNCIONAMIENTO\n## FASE 1: 1. SALUDO Y PROTOCOLO INICIAL\nEsta fase establece el primer contacto. El saludo se env√≠a una sola vez en toda la conversaci√≥n y no se solicita el nombre del cliente.\nL√≥gica de Inicio seg√∫n el mensaje del cliente:\nESCENARIO A: Mensaje gen√©rico o sin producto identificado Aplica cuando el cliente dice \"Hola\", \"Info\", \"Precios\", o env√≠a un mensaje que no menciona un producto de la Lista Maestra.\nAcci√≥n: Saludar de forma directa.\nRespuesta Obligatoria: \"Hola hermano, en qu√© perfume est√°s interesado?\".\nESCENARIO B: El cliente menciona un perfume o marca desde el inicio Aplica cuando el cliente consulta directamente por un producto (ej: \"precio del hawas\").\nAcci√≥n 1 : Asociar el t√©rmino con el nombre t√©cnico de la lista de ‚Äúperfumes_full_size‚Äù de la tool ‚Äúinformacion_productos‚Äù (ej: \"9pm\" ‚Üí \"9 PM\").\nAcci√≥n 2: Preparar el mensaje de saludo y luego pasa a la ‚ÄúFase 2:  2. IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)‚Äù\nEjemplo de respuesta: \"Hola hermano. (para responder sobre el perfume o sobre la intenci√≥n del cliente pasa a la fase 2)‚Äù.\n## FASE 2: IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)\nEsta fase es el n√∫cleo de la venta. Diego debe mapear el lenguaje del cliente a los productos reales y consultar la disponibilidad exacta.\nCASO A: Perfumes Full Size\nAplica cuando el cliente pide informaci√≥n, precio o disponibilidad de uno o varios perfumes de la lista.\nMapeo Sem√°ntico: Antes de usar la tool, asocia el nombre que diga el cliente con el nombre m√°s cercano de la Lista Maestra.\nUso de Tool: Activa stock_perfumes con el input: disponibilidad del perfume: [Nombre exacto].\nEl nombre del perfume env√≠alo entre comillas.\nEscenario 1: Consulta por un solo perfume\nAcci√≥n: Ejecuta ‚Äústock_perfumes‚Äù.\nLa tool devolver√° el nombre del perfume y con dos datos: \nstock: (si o no). \nStock = si : significa que est√° disponible el perfume\nStock = no : significa que esta agotado el perfume\nSi hay stock: Sigue el Ejemplo 1 de entrega de informaci√≥n.\nSi NO hay stock: La tool sugerir√° perfumes similares. Debes presentarlos de forma atractiva siguiendo el Ejemplo 2.\nEscenario 2: Consulta por m√∫ltiples perfumes\nAcci√≥n: Ejecuta la tool para todos los perfumes mencionados en un solo input: ‚Äúdisponibilidad de los perfumes: 1. [Nombre], 2. [Nombre]...‚Äù\nEnv√≠a cada nombre de los perfumes entre comillas.\nResultados Mixtos:\nSi hay de todos: Sigue el Ejemplo 3.\nSi falta alguno: Sigue el Ejemplo 4 (confirmas lo que hay y ofreces alternativas para lo que no).\nCASO B: Decants (Presentaciones de 5ml o 10ml)\nAplica cuando el cliente busca probar fragancias o indica cantidades peque√±as. Generalmente los clientes piden varios a la vez.\nEjemplos de Entrada del Cliente:\n‚Äúhawas 5ml, harana 10ml, asad 10ml y gos diamond 5ml‚Äù\n\"¬øTienes el 9pm en 5ml?\"\n\"Quiero probar el Hawas y el Asad en 10ml cada uno\".\n\"P√°same precio de decants de 5ml\". En este caso consultar sobre cual desea.\nIdentificaci√≥n: Si el cliente menciona \"5ml\", \"10ml\", \"peque√±o\" o \"para probar\", tr√°talo como Decant.\nUso de Tool: Activa ‚Äústock_decants‚Äù seg√∫n la cantidad de decants que solicita adquirir:\nSi es un solo decant, envia el input: ‚Äúdisponibilidad de decant: [Nombre del perfume] en [Cantidad].‚Äù\nSi es m√°s de un decant, env√≠a el input ‚Äúdisponibilidad de decants: [Nombre del perfume] en [Cantidad]. [Nombre del perfume] en [Cantidad]....‚Äù\nCASO C: Sets de Perfumes\nAplica cuando el cliente busca estuches de regalo o packs que incluyen complementos.\nEjemplo \nAcci√≥n: Revisa la secci√≥n \"Set de perfumes\" del Conocimiento General para validar si el nombre coincide con un set real.\nUso de Tool: Activa ‚Äústock_set_perfumes‚Äù con el input: disponibilidad del SET: [Nombre del Set].\nSi consulta sobre m√°s de un set, env√≠a el input: ‚Äúdisponibilidad del SET: [Nombre del Set]. disponibilidad del SET: [Nombre del Set].‚Äù\nNota: Si el cliente pregunta por un perfume y un set al mismo tiempo, consulta ambos en la misma ejecuci√≥n de la tool.\n## FASE 3: CONFIRMACI√ìN Y LOG√çSTICA DE ENV√çO\nEsta fase se activa cuando el cliente muestra una Intenci√≥n Real de Compra (ej. \"¬øC√≥mo pago?\", \"Lo quiero\", \"P√°same tu cuenta\") o despu√©s de que Diego presente la disponibilidad y precios.\n1. Generaci√≥n del Resumen\nDiego debe presentar un resumen estructurado basado en la secci√≥n #EJEMPLOS DE RESUMEN DE COMPRA.\nRegla de Oro: El total NO incluye el env√≠o todav√≠a. El env√≠o se suma en la Fase 4.\nPregunta de Cierre: Siempre debe terminar con la pregunta: \"¬øPara qu√© distrito o ciudad ser√≠a el env√≠o?\"\n2. Validaci√≥n de Ubicaci√≥n (Uso de Tool)\nUna vez que el cliente responde con un lugar, Diego debe ejecutar la tool distritos.\nL√≥gica de Clasificaci√≥n:\nCASO LIMA: Si el distrito indicado est√° en la lista de la tool distritos (Lima Metropolitana y Callao), se clasifica como Escenario A.\nCASO PROVINCIA: Si el lugar indicado NO est√° en la lista (ej. Piura, Cusco, Trujillo, o distritos de otras regiones), se clasifica autom√°ticamente como Escenario B.\n\n## FASE 4. M√âTODOS DE PAGO Y VALIDACI√ìN\nDiego presentar√° los m√©todos de pago bas√°ndose estrictamente en la ubicaci√≥n identificada. El costo de env√≠o es de S/12 en todos los casos.\nEscenario A: Lima Metropolitana (Distritos indicados)\nRegla: El cliente tiene la opci√≥n de pagar solo el env√≠o (S/12) por adelantado para confirmar, y el saldo del perfume lo cancela al recibirlo.\nMensaje: \"Para Lima puedes confirmar tu pedido pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Si prefieres, tambi√©n puedes pagar el monto total.\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante.‚Äù\nRegla de Flexibilidad: El cliente puede elegir pagar solo el env√≠o o el total.\nEscenario B: Provincia / Env√≠os por Shalom\nRegla: El pago debe realizarse por el monto completo (Perfume + S/12 de env√≠o) antes de despachar.\nMensaje: \"Para enviarte a provincia, el pago es por el monto total: son S/ [Precio del perfume] del perfume + S/ 12 del env√≠o por Shalom. En total ser√≠a S/ [Suma de ambos].\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante..‚Äù\nReglas Cr√≠ticas de Validaci√≥n:\nSolo Imagen: La compra √öNICAMENTE se valida mediante el input Imagen_analizada. No aceptes confirmaci√≥n por texto (\"ya pagu√©\") ni por audio.\nC√°lculo de Montos: * Si el cliente est√° en Lima y env√≠a un comprobante de S/ 12, Diego debe decir: \"Reserva de S/ 12 verificada. El saldo de S/ [Monto del Perfume] lo cancelas al recibir.\" y pasar a pedir datos.\nSi el cliente env√≠a el pago en partes (ej. dos capturas de Yape), Diego debe sumar ambos montos mentalmente. Solo cuando la suma sea igual al total acordado (o al menos a los S/ 12 en Lima), se da por validado.\n\n## FASE 5. SOLICITUD DE DATOS Y FINALIZACI√ìN\nTras validar el pago exitosamente seg√∫n el input ‚Äúimagen_analizada‚Äù, Diego solicita los datos para la confirmaci√≥n del env√≠o, seg√∫n el caso A o el caso B\nCASO A) Si el env√≠o es para los distritos permitidos de Lima Metropolitana.\n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Direcci√≥n exacta.‚Äù\n2) Validaci√≥n: Diego acepta cualquier formato de nombre y direcci√≥n que el cliente proporcione. No debe cuestionar la direcci√≥n, solo recopilarla.\n3) Utilizar tool: Una vez que tengas ambos datos utiliza la tool ‚Äúconfirmacion_pedido‚Äù y env√≠a las siguientes variables:\n‚ÄúNombre‚Äù\n‚ÄúDireccion exacta‚Äù\n‚Äúproductos‚Äù: el producto o los productos env√≠alos de esta forma: \"Producto 1: [Categor√≠a: Full Size/Decant/Set] [Nombre del Perfume] - [Precio] - [Cantidad]. (Repetir si hay m√°s productos)\".\n4) Confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: Tu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada\nCASO B) Si es de Provincia: \n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Apellidos\\n- DNI\\n- Ciudad/provincia\\n- Nombre de la agencia Shalom donde recoger√°‚Äù\n2) Validaci√≥n: Diego acepta los datos tal cual los env√≠e el cliente (no corregir DNI ni nombres). \n3) Utilizar tool: Una vez identificado todo los datos que solicitaste, utiliza la tool ‚Äúconfirmacion_pedido‚Äù con las siguientes variables:\n\n‚ÄúNombre‚Äù\n‚ÄúApellidos‚Äù\n‚ÄúDNI‚Äù\n‚ÄúCiudad/provincia‚Äù\n‚ÄúNombre_agencia_shalom‚Äù\n‚Äúproductos‚Äù: (Misma l√≥gica del CASO A: Categor√≠a, Nombre, Precio y Cantidad)\nNota: en este caso la variable ‚Äúdireccion_exacta‚Äù coloca ‚Äúnull‚Äù.\n4) confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: ‚ÄúTu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada.‚Äù\n\n###SECCI√ìN: EJEMPLO DE ENTREGA DE INFORMACI√ìN DE PERFUME\nEjemplo 1 (Un perfume con stock):\n\"El Hawas Ice s√≠ lo tengo en stock. El precio es de S/ 180. Es un perfume ultra fresco y potente, de los que m√°s piden.\"\nEjemplo 2 (Sin stock + Similares sugeridos):\n‚ÄúEl Valentino est√° agotado. Tengo estos que son de la misma vibra y huelen incre√≠ble:\\nJPG Le Male Elixir a S/ 450\\n\\nScandal Le Parfum a S/ 420 ¬øAlguna de esas opciones te llama la atenci√≥n?\"\nEjemplo 3 (M√∫ltiples perfumes con stock):\n\"Tengo los dos disponibles:\\n\\n9 PM a S/ 140\\nKhamrah Dukhan a S/ 175\"\nEjemplo 4 (Stock mixto):\n\"Hermano, te confirmo: el CDN Intense s√≠ lo tengo listo para enviar a S/ 190. El Azzaro lo tenemos sin stock. ¬øQu√© otro perfume te gustar√≠a?\nEjemplo 5 (Decants m√∫ltiples):\n\"Los tengo disponible:\\n\\n9pm Elixir (5ml): S/ 35\\nYara (10ml): S/ 45\\nKhamrah (5ml): S/ 40\\n\\n¬øTe armo el pack con estos tres o quieres chequear alguno m√°s?\"\n\n#EJEMPLOS DE RESUMEN DE COMPRA\n## EJEMPLOS SOLO PERFUMES FULL SIZE\n### Ejemplo 1: Si es solo un perfume\n\"Resumen de compra:\\n- Hawas Ice\\nüì¶ Cantidad: 1\\nüí∞ Precio unitario: S/ 180\\n\\nüíµ Total: S/ 180\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s perfumes Resumen de compra:\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah Dukhan\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 175\\n\\nüíµ Total: S/ 315\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS SOLO PERFUMES DECANTS\n### Ejemplo 1: Si es solo un decant Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- 9 PM Elixir (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 35\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Si son varios decants Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- Yara (10ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 45\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\nüíµ Total: S/ 125\\n\\n¬øMe indicas el distrito para continuar?\"\n## EJEMPLOS SOLO SET DE PERFUMES\n### Ejemplo 1: Si es solo un set Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 220\\n\\nüíµ Total: S/ 220\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s sets Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\n- GOS Set\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 240\\n\\nüíµ Total: S/ 450\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS DE PEDIDOS COMBINADOS\n### Ejemplo 1: Perfume Full Size + Decants\n\"Resumen de compra:\\n- Lattafa Asad\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 150\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Yara (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 225\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Compra Integral (Full Size + Decant + Set)\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\nüíµ Total: S/ 390\\n\\n¬øMe confirmas el distrito para avanzar con el pago?\" \n\n# EJEMPLOS DE FLUJO DE CONVERSACI√ìN CORRECTO\n## EJEMPLOS SI EL CLIENTE DESEA EL ENV√çO PARA LIMA\n1) Pago completo (Perfume + Env√≠o)\nCliente: Hola, quiero el Hawas Ice para Miraflores.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Hawas Ice s√≠ est√° disponible y cuesta S/180. ¬øDeseas agregar algo m√°s a tu compra?.\nCliente: No, solo eso. ¬øC√≥mo hago el pago?.\nDiego: Para Lima puedes confirmar pagando solo S/12 del env√≠o y el saldo al recibir, o pagar el monto total de S/192. Puedes yapear al 987108094 a nombre de Brandon Quelopana o por transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/192).\nDiego (Tras validar Imagen_analizada): Pago de S/192 verificado. P√°same tu nombre, celular y direcci√≥n exacta para programar el env√≠o. Como pagaste antes de las 10:00 am, llega hoy mismo.\n2) Pago parcial (Solo env√≠o S/12 + Saldo contra entrega)\nCliente: Precio del 9 PM. Estoy en San Borja.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El 9 PM cuesta S/140. ¬øQuieres agregar algo m√°s o solo ese?.\nCliente: Solo ese. Quiero pagar solo el env√≠o ahora.\nDiego: Entendido. Para Lima puedes confirmar pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Yapea al 987108094 (Brandon Quelopana) y me mandas la captura.\nCliente: (Env√≠a captura por S/12).\nDiego (Tras validar Imagen_analizada): Reserva de S/12 verificada. P√°same tu nombre, celular y direcci√≥n exacta. El saldo de S/140 lo pagas al recibir el producto.\n## EJEMPLO SI EL CLIENTE DESEA EL ENV√çO PARA PROVINCIA\n3) Pago total obligatorio para Provincia (V√≠a Shalom)\nCliente: Hola, precio de Asad para Piura.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Lattafa Asad cuesta S/150. ¬øDeseas agregar alg√∫n decant o solo el perfume?.\nCliente: Solo el perfume. ¬øCu√°l es el m√©todo?\nDiego: Para env√≠os a provincia el pago se realiza por el monto total de S/162, que incluye los S/12 de env√≠o por Shalom. Puedes pagar por Yape al 987108094 (Brandon Quelopana) o transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/162).\nDiego (Tras validar Imagen_analizada): Pago de S/162 verificado. P√°same tu nombre, apellidos, DNI, celular, ciudad y el nombre de la agencia Shalom donde lo recoger√°s. \n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-5136,288],"id":"87ad49a4-0b30-4cf2-bd78-475265d05fe3","name":"AI Agent"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","typeVersion":1,"position":[-3472,528],"id":"0af2d781-c62f-4cfa-8636-6576d2801773","name":"Auto-fixing Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3504,704],"id":"0be267ba-446a-4cd1-8c35-ea2e696d7e8b","name":"OpenAI Chat Model8","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"response\": {\n    \"parte_uno\": \"Texto correspondiente a la primera parte de la respuesta.\",\n    \"parte_dos\": \"Texto correspondiente a la segunda parte de la respuesta.\",\n    \"parte_tres\": \"Texto correspondiente a la tercera parte de la respuesta (opcional).\",\n    \"parte_cuatro\": \"Texto correspondiente a la cuarta parte de la respuesta (opcional).\",\n    \"imagen_uno\": \"Imagen correspondiente\",\n    \"imagen_dos\": \"Imagen correspondiente (opcional).\",\n    \"video_mp4\": \"Video .mp4 (opcional)\"\n}\n  }"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-3328,704],"id":"05f11a4e-1bcc-4829-a163-8b4e3e1f1534","name":"Structured Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3744,624],"id":"f2dd9e17-523b-4e58-9b8e-5f00f8fa704f","name":"OpenAI Chat Model9","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"={{ $json.output }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Obtener el texto de entrada:\n\nRecupera el texto de la variable items\n{{ $json.output }}\nLimpieza y normalizaci√≥n del texto:\n\nCrea una funci√≥n que limpie el texto eliminando los siguientes caracteres: ¬ø, ¬°, @, \", *, #.\n\nElimina los espacios en blanco al inicio y al final del texto.\nNo Elimines los emojis, ni los markdown para que los mensajes esten limpios.\nDivisi√≥n del texto en partes:\n\nImplementa una funci√≥n que divida el texto limpio en fragmentos de m√°ximo 800 caracteres sin cortar palabras. Si necesitas cortar uno de los fragementos del mensaje antes de 800 Caracteres para que no se corten mensajes hazlo. Los mensajes deben quedar completo y coherentes\nLa funci√≥n debe asegurarse de que cada fragmento se corte en espacios para no dividir palabras a la mitad.\nSi tienes que aumentar la cantidad de caracteres para que parte del mensaje no quede cortado o quede mal puedes hacerlo sin un limite de caracteres. Esto para que los mensajes sean mas organicos y funcionen bien. Tambien al identificar una imagen necesito que el link lo separes para que se mande separado.\n\n*SIEMPRE* que haiga un Link del video de youtube del tratamiento o presentaci√≥n, mandalo como parte del texto con su contexto, *NUNCA* lo pongas en la parte de imagen uno y dos.\n\n*NUNCA* pongas el link del video.mp4 en las partes de texto e imagen, *SIEMPRE* si es que tienes algun video con .mp4 ponlo en video_mp4.\n\nDeber√°s de enviarlo siempre a la √∫ltima parte pero solo eso.\nConstrucci√≥n de la respuesta:\n\nCrea un objeto JSON con la siguiente estructura:\n\n{\n  \"response\": {\n    \"parte_uno\": \"<primer fragmento>\",\n    \"parte_dos\": \"<segundo fragmento>\",\n    \"parte_tres\": \"<tercer fragmento>\",\n    \"parte_cuatro\": \"<cuarto fragmento>\",\n    \"imagen_uno\": \"<primera imagen>\",\n    \"imagen_dos\": \"<segunda imagen>\",\n    \"video_mp4\": \"<video.mp4>\"\n\n  }\n\n- Si hay un emoji como un check o algo por el estilo que desmuestre un enlistado, opciones o variantes similares, dale salto de linea para que parezca natural, recuerda reemplazar el \"\\n\" por un enter.\n\nSi alguna parte no existe, asigna una cadena vac√≠a (\"\").\n\n\n### Notas \n\n- Nunca debes hacer saltos de linea que no sean naturales evita si en algun momento un mensaje tiene un \":\" que el mensaje que le siga este en la otra parte del mensaje. debe ser lo mas natural posible.\n\n- S√≠ el texto tiene un saludo de bienvenida o algo parecido, *SIEMPRE* separalo en una parte y las siguientes partes separalos de tal forma que se vea ordenada y estructuradas tus respuestas.\n- En caso veas una palabra en asteriscos, ejemplo: **Botox:** deber√°s de quitarle los dos de los extremos y deber√° de quedar as√≠ *Botox:*.\n- *NUNCA* deber√°s de cortar el contexto del mensaje, quiero decir que si ves que el mensaje trata de un tema en espec√≠fico o seccion no deber√°s de cortarlo.\n\nEs Obligatorio reemplazarlo, no eliminarlo. NUNCA DEJAR NINGUNA PARTE VAC√çA OBLIGATORIAMENTE.\n\n- *SIEMPRE* REEMPLAZA \"\\n\" por un salto de linea normal (enter) ejemplo:\n{\n  \"response\": {\n    - opcion 1\n    - opcion 2\n    - opcion 3  \n  }\n}\n\n- *SIEMPRE* y cuando te lleguen dos links de Video.mp4, agarra el primero y no pongas los 2 juntos, si es posible, elimina uno para que solo quede uno.\n\n- *regla adicional* cuando llegue un link que est√© en .jgp .jpeg y .PNG a√±adelo a la parte de imagen, y si est√° en .mp4 a√±adelo al apartado de video "}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-3600,256],"id":"7ca03140-46dd-4d3c-a332-e3ee2072ded6","name":"Verificador1","onError":"continueErrorOutput"},{"parameters":{"httpMethod":"POST","path":"BRADA","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-15296,608],"id":"dbcc07c3-6246-4bdb-878b-af891629f8c8","name":"Webhook","webhookId":"fb43e7b4-c71f-4cad-bebd-32a81374fc49"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n","tableName":"healup","contextWindowLength":12},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-5200,48],"id":"39798e20-26eb-4032-ae59-7f5d5b5f7d8b","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"NzQUFXQpp2MvRekP","name":"CUENTA ALEGRATED"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8fa70db3-09c3-4e87-8fc9-4052751fad3f","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9840,512],"id":"d53b946f-7849-4a0c-91b8-673d822caa58","name":"If2","alwaysOutputData":false,"retryOnFail":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"576350e5-ed67-4ce9-815e-0f0a0ef0b1c7","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9616,688],"id":"3d169320-db83-4f3e-b8ec-cf4189ac8d7a","name":"If3"},{"parameters":{"assignments":{"assignments":[{"id":"1aa91b6d-c441-4496-beee-4af2457332ac","name":"pasar_supervisor","value":"={{ $json.pasar_supervisor }}","type":"string"},{"id":"34e35c66-589c-4146-ab9c-3d08b024a7c1","name":"n√∫mero","value":"={{ $json.numero }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-9984,512],"id":"e5878ba6-1987-4774-811f-c2cee034cb0a","name":"Edit Fields4"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-9184,992],"id":"02219ac8-19fd-463b-b35f-8880e0676c67","name":"No Operation, do nothing4"},{"parameters":{"name":"pasar_supervisor","description":"Llama esta herramienta cuando desees pasar a supervisor.","workflowId":{"__rl":true,"value":"2lPoYs00jPGwaBxq","mode":"list","cachedResultUrl":"/workflow/2lPoYs00jPGwaBxq","cachedResultName":"Supervisor Solari"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('Edit Fields20').item.json.id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-7248,464],"id":"b5e6fa52-fde1-4c70-b3ba-07a042587076","name":"Supervisor2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"98601c0c-949c-4f3d-99f2-40305665d58a","leftValue":"={{ $json.numero }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-10704,576],"id":"40fc0c0b-0829-40fc-81d5-3da1f46a7a9b","name":"If13"},{"parameters":{"name":"=Agendar","description":"=Agendar citas ","source":"=database","workflowId":{"__rl":true,"value":"konppOdwditJvoJQ","mode":"list","cachedResultUrl":"/workflow/konppOdwditJvoJQ","cachedResultName":"agendarSUNAT WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre_completo":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre_completo', ``, 'string') }}","DNI":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('DNI', ``, 'string') }}","numerotelefono":"={{ $json.id }}","inicio_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('inicio_cita', ``, 'string') }}","fin_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fin_cita', ``, 'string') }}","tratamiento(s)":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('tratamiento_s_', `Coloca el tratamiento que se haya mencionado durante la conversaci√≥n, seg√∫n esta lista de tratamientos:\n\n- Lipopapada & Afinamiento Facial Enzim√°tico\n- Natural Lips\n- Bratz Lips\n- Perfilamiento de nariz\n- Rinomodelaci√≥n completa\n- Exosomas + Esperma de Salm√≥n\n- Proyecci√≥n de Ment√≥n con √Åcido Hialur√≥nico\n- Baby Botox\n- Botox Full Face\n- Marcaci√≥n mandibular\n- Masseter Botox\n- Surcos Nasogenianos\n- Sustentaci√≥n pomular\n- √Åcido Hialur√≥nico para ojeras\n- NCTF\n- Hidralips con Dermapen\n- Plasma Rico en Plaquetas (PRP)\n- Armonizaci√≥n Facial \n\n- Glass Skin Babe\n- CalmBabe\n- Pure Babe Skin\n- Heal Up Babe Ritual\n- Prime Skin Clean\n- Eternal Glow Boost\n- Prestige Glow Ritual\n- Heal Up Signature Glow\n\n- Lipo Start Protocol\n- Lipo Sculpt Protocol\n- Lipo Intensive Shape Protocol\n- Heal Up Lipo 360‚Äù.\n\nNota: Si el paciente consult√≥ sobre m√°s de 1 tratamiento, a√±adelo con una coma. por ejemplo: Rinomodelaci√≥n completa, Baby Botox.\n`, 'string') }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","red_social":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('red_social', `Coloca esta palabra: WhatsApp`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"nombre_completo","displayName":"nombre_completo","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"inicio_cita","displayName":"inicio_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"fin_cita","displayName":"fin_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"numerotelefono","displayName":"numerotelefono","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"DNI","displayName":"DNI","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"red_social","displayName":"red_social","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"tratamiento(s)","displayName":"tratamiento(s)","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-5504,784],"id":"5334487f-6a0c-48f2-8833-2cece4f6c66e","name":"Calendario"},{"parameters":{"tableId":"pasar_supervisor_BRADA","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"},{"fieldId":"conversation_id","fieldValue":"={{ $('If12').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10480,832],"id":"6da92ad7-7496-46b2-ad7a-af1302bdca1b","name":"Create a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10192,512],"id":"e01e05d9-2c86-4f10-8067-8d296b347400","name":"Get a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9536,416],"id":"08f4c79d-67de-4997-8b28-3d94436c885c","name":"Update a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10960,592],"id":"0383d00f-4ae0-4f14-850a-4ee2703bbc58","name":"Get a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2acc3e64-d51a-4e98-84a5-e2b17c788fa2","leftValue":"={{ $('Webhook').item.json.body.payload.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7312,592],"id":"645bde3e-f301-4b37-a037-b78f2c234bab","name":"If4"},{"parameters":{"operation":"formatDate","date":"={{ $json.currentDate }}","format":"custom","customFormat":"DDDD tt","options":{"timezone":true}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-6896,576],"id":"c0cfb4f3-987c-429b-9a57-9f8b58dd70a2","name":"Formatea fecha"},{"parameters":{"assignments":{"assignments":[{"id":"d78c89a3-c878-48b7-aa84-4b2674c0667b","name":"data.remoteJid","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation.contact_inbox.source_id }}","type":"string"},{"id":"432a9602-e38b-4880-a64d-b832d120edda","name":"data.id","value":"={{ $('Webhook').item.json.body.id }}","type":"string"},{"id":"d2f45efc-03ac-4c74-b70e-959b06cd2a0b","name":"data.text","value":"={{ $('Edit Fields17').item.json.mensajetexto }}{{ $('Edit Fields17').item.json.mensajeaudio }}{{ $('Edit Fields17').item.json.mensajeimagen }}","type":"string"},{"id":"d77208a8-161b-4ef3-96fa-261a87cf1f39","name":"conversation_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","type":"string"},{"id":"8c279598-20f0-4012-a4ee-8c7898ceaba4","name":"account_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].account_id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6448,576],"id":"e0ece9a2-acd1-450f-9e2f-a45df7d9021e","name":"Handler variables"},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-7072,576],"id":"34435b05-c9a2-4759-b275-a239d12bbcb1","name":"Fecha"},{"parameters":{"jsCode":"// 1. Obtener la fecha de entrada\nconst inputDateString = $input.item.json.formattedDate; \nconst date = new Date(inputDateString);\n\n// 2. Obtener hora actual para la l√≥gica\nconst currentHour = date.getHours();\n\n// Clonamos la fecha para calcular el env√≠o\nlet scheduledDate = new Date(date);\n\n// 3. L√≥gica de Negocio (Reglas de horario)\nif (currentHour >= 19 || currentHour < 5) {\n  // Caso Nocturno (19:00 - 04:59): Programar para las 09:00 AM\n  scheduledDate.setHours(9, 0, 0, 0);\n  \n  // Si es >= 19:00, pasa al d√≠a siguiente.\n  if (currentHour >= 19) {\n    scheduledDate.setDate(scheduledDate.getDate() + 1);\n  }\n} else {\n  // Caso Diurno (05:00 - 18:59): Sumar 4 horas\n  scheduledDate.setHours(scheduledDate.getHours() + 4);\n  // Reiniciamos minutos y segundos a 0 para mantener limpieza (opcional, pero recomendado)\n  scheduledDate.setMinutes(0);\n  scheduledDate.setSeconds(0);\n}\n\n// 4. FORMATEO DE SALIDA \"dd/mm/yyyy HH\"\n// Usamos .padStart(2, '0') para asegurar dos d√≠gitos (09, 05, etc.)\n\nconst day = scheduledDate.getDate().toString().padStart(2, '0');\nconst month = (scheduledDate.getMonth() + 1).toString().padStart(2, '0');\nconst year = scheduledDate.getFullYear();\nconst hourFormatted = scheduledDate.getHours().toString().padStart(2, '0');\n\n// CONSTRUCCI√ìN FINAL: dd/mm/yyyy HH\n// Nota: Eliminamos los minutos (:${minuteFormatted}) de esta l√≠nea\nconst fecha_final = `${day}/${month}/${year} ${hourFormatted}`;\n\nreturn {\n  json: {\n    original_input: inputDateString,\n    // Variable solicitada con el formato exacto\n    fecha_lora_formateada: fecha_final,\n    // Variable extra por si necesitas solo la hora aislada\n    solo_hora: hourFormatted\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6640,576],"id":"7235933b-bf69-4698-9133-cfe47b370ffc","name":"Code2"},{"parameters":{"amount":30},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-7312,1072],"id":"6e3e7abf-d38f-40b1-b0c4-a8e166fc036c","name":"Wait6","webhookId":"5696ca8f-19ae-4cd6-8008-6132ce1cf272"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8a313a41-eadc-4ada-bc2a-feff79845de9","leftValue":"={{ $json.mensajes[0] }}","rightValue":"={{ $('Handler variables').item.json.data.text }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6864,1296],"id":"76729177-6c0d-4ec2-bf0a-0604e5bbf8a9","name":"If6"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-6544,1376],"id":"2c667d72-3de1-4d9e-bff9-88ce886f1c91","name":"No Operation, do nothing1"},{"parameters":{"operation":"delete","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6240,1024],"id":"31c060d8-e6c1-489f-924b-36ee33dce137","name":"Delete Redis","executeOnce":false,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $('Get Redis1').item.json.mensajes.join() }} y el lead viene de un anuncio : {{ $('RESUMIDOR ANUNCIOS').item.json.output }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Wait6').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.payload._data.Info.PushName }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6352,832],"id":"fa0d6541-f1f5-42a3-918d-072dec78f8be","name":"Edit Fields19","alwaysOutputData":true},{"parameters":{"operation":"get","propertyName":"mensajes","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","keyType":"list","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6960,1088],"id":"eb2e5436-c84c-4660-a049-366ff67222ee","name":"Get Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $json.anuncio }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Handler variables').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.conversation.messages[0].sender.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6368,992],"id":"a0199bbc-432c-4d05-a271-0c734eec08cd","name":"Edit Fields20","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3e8a5a20-c60c-48ef-a636-2b5e14a683a8","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6608,944],"id":"61e1b52d-148e-41fd-9b0b-7e4895ad7a0a","name":"If15"},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1136],"id":"edcdff4c-5e82-4bfe-8beb-45b771f8bed2","name":"METER_ANUNCIO","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1296],"id":"666f3eb7-d307-4a99-abd7-1f526c0907fd","name":"BAJAR_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}_ad","messageData":"={{ $('RESUMIDOR ANUNCIOS').item.json.output }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8064,1136],"id":"5a5ab926-f0b0-420f-ad66-6f99a6d9eb9f","name":"guarda_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3deed863-79f3-42e5-a32c-6cb7bb1028df","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7616,512],"id":"46ecb883-24f2-490a-a44c-a9e6dd7a5ab2","name":"If"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-7488,32],"id":"76495bc9-2132-42c6-8f98-7f222fbc58ab","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"8f567177-8b37-4a09-9a53-ac9fe424c843","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6240,576],"id":"49f7d2d6-bf9c-4b3f-bde9-d5b04db1203a","name":"If10"},{"parameters":{"operation":"get","propertyName":"anuncio","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6752,944],"id":"16a19e11-3a97-49d7-b868-7b84b7799dc7","name":"Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-6928,272],"id":"31f4a897-b5fc-4baa-a8ac-c4645d7e6b10","name":"Update a row4","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"Describe esta imagen\n","imageUrls":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].data_url }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8864,560],"id":"655bda6d-6ab1-42a8-85c1-736575210b9b","name":"OpenAI","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"437f223f-80c7-4c47-a50b-9d17a8614251","name":"imagen_caption","value":"={{ $json.content }} .\nEl captions del mensaje de imagen es: {{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8448,688],"id":"fa56722a-8385-4847-b719-f90a132dfbd1","name":"Edit Fields12"},{"parameters":{"url":"={{ $('Webhook').item.json.body.attachments[0].data_url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-8896,368],"id":"f1138959-5c6f-4058-a15b-6e56bdaab777","name":"HTTP Request"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"27bcc104-31e3-4687-b60b-a018c457a3a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"audio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2e8b532f-1f01-45f9-a647-e7a5c9e48aac","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"image","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Imagen"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"59f6b23a-3029-4225-8f9e-3744611a04a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"=text","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"28de146f-c104-4171-924a-29963c4f1970","leftValue":"={{ $('Webhook').item.json.body.content_type }}","rightValue":"text","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-9216,416],"id":"b138e8be-c1d3-4f8a-8423-93fb52834ba7","name":"Switch3"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8624,368],"id":"f26677a7-27a0-43ed-8071-3e3064e25db4","name":"AUDIO1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"276cbb8a-79f2-4f08-b24a-632f474c6013","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-8624,560],"id":"f29adecc-e9d9-4222-9ec3-107cac681c09","name":"If16"},{"parameters":{"assignments":{"assignments":[{"id":"c0a1b2f0-373e-4b86-ae91-25346b20b404","name":"mensajetexto","value":"=Texto mensaje: [{{ $('Webhook').item.json.body.conversation.messages[0].content }}]  ","type":"string"},{"id":"35cd9184-e37e-4d03-9dff-efb319dce478","name":"mensajeaudio","value":"={{ $json.text }}","type":"string"},{"id":"47e9bfe8-2c55-4b5d-b047-024871fc6c21","name":"mensajeimagen","value":"=Imagen analizada: [{{ $json.content }}{{ $json.imagen_caption }}]","type":"string"},{"id":"9926d346-600f-45af-adad-876e9f40ffa4","name":"imagenanalizada","value":"=Imagen de anuncio analizado: {{ $json.content }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8064,480],"id":"8a1f15fa-bf4b-4c01-adbb-7a1a21d7a706","name":"Edit Fields17","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $('Webhook').item.json.body.payload.body }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7120,400],"id":"7ab44ba1-258f-4193-929d-15aa68334a0f","name":"If11"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f05066b5-5a07-41fa-96b7-7a244e7345c8","leftValue":"={{ $json.body.payload.fromMe }}\n","rightValue":"true","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12384,608],"id":"d94743f2-3b7b-460b-bc26-33eae6240210","name":"If12"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $json.body.conversation.messages[0].content }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12224,752],"id":"23a75e86-d3fd-4b05-8d58-aa9da67a47d8","name":"If20"},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-12144,1008],"id":"a93457ed-fd5d-4186-b320-c1a49417136c","name":"Update a row6","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"name":"informacion","description":"utiliza esta tool cuando se necesite informaci√≥n seg√∫n las indicaciones del prompt principal.","workflowId":{"__rl":true,"value":"FB7us6cBaq7jWqB2","mode":"list","cachedResultUrl":"/workflow/FB7us6cBaq7jWqB2","cachedResultName":"informacion HEAL UP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}"},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-6080,784],"id":"e0e915c5-fd08-4168-be41-783aa4ce1390","name":"informacion_tratamientos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"987d5d07-58eb-4927-8e68-a137884b8100","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].message_type }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13248,608],"id":"5e339c78-27b7-41de-8774-f34bd2e49752","name":"If1"},{"parameters":{"jsCode":"// Tomamos todos los items que vienen del nodo anterior (Verificador1)\nconst items = $input.all();\n\nfor (const item of items) {\n  // Aqu√≠ est√° tu objeto con parte_uno, parte_dos, etc.\n  // Verifica la ruta: output.response\n  const resp = item.json.output?.response || {};\n\n  // Orden que quieres respetar\n  const orderedKeys = [\n    'parte_uno',\n    'parte_dos',\n    'parte_tres',\n    'parte_cuatro',\n    'imagen_uno',\n    'imagen_dos',\n    'video_mp4',\n  ];\n\n  // Armamos un nuevo objeto response en el orden deseado\n  const newResponse = {};\n  for (const key of orderedKeys) {\n    if (resp[key]) {\n      newResponse[key] = resp[key];\n    }\n  }\n\n  // Sobrescribimos manteniendo la estructura original\n  if (!item.json.output) item.json.output = {};\n  item.json.output.response = newResponse;\n}\n\n// Devolvemos los items modificados\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2752,352],"id":"24f0ff65-46ee-441c-a6d4-8f9095be5ae0","name":"ordenar"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $json.output.response.parte_uno ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2720,1088],"id":"88a82162-8ee2-4a01-8f95-a7350bae11d1","name":"Respuesta1","executeOnce":false},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1776,832],"id":"cce742aa-91d4-4fd6-971b-02494cc4941d","name":"Wait2","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_dos ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1600,928],"id":"6c953a90-8ee3-40d6-b6fd-f29c2e766496","name":"Respuesta2","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1312,848],"id":"0a8bc622-6c9b-472d-8735-328b027264ff","name":"If14"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1120,832],"id":"568f10ce-4d13-4754-843d-d05277b38f48","name":"Wait3","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_tres ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-912,896],"id":"3cb7de22-5651-4c25-b9eb-6132643c3bbe","name":"Respuesta3","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-496,752],"id":"af5809e5-112a-4632-aeaf-44bd7061fd9e","name":"If17"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-480,976],"id":"d9d3f88f-ef89-458a-8d83-ad4661e1b4e6","name":"Wait4","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=hcy6n6RAJTBAAYguVuewgp2A"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_cuatro ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-256,1008],"id":"319a272b-7a67-4de3-bcc3-381f609226df","name":"Respuesta4","executeOnce":false},{"parameters":{"promptType":"define","text":"=Te va a llegar esta descripcion de un anuncio: {{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","options":{"systemMessage":"ROL:\nTu rol es indicar el mismo input que te llega y enviarlo como output."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-7504,192],"id":"7dd13519-eebb-4cd8-9fbe-870c4eb2ea0b","name":"RESUMIDOR ANUNCIOS"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1a9dd789-5c10-4489-a344-6b7a0fd041ea","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51902215511","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"912d0724-5ef1-4f88-9d43-acbb38f48cee","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51993708540","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"e50ad623-45f5-4af7-bc5a-89708016ddf8","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51972619000","operator":{"type":"string","operation":"equals"}},{"id":"9ffd5afb-ec0c-49fc-a144-b682386c760c","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51960239280","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"50ddfe27-4e13-4e3c-8216-aca1f181f77a","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51936196001","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"7650a20c-4ba9-4e41-bd67-89e8f77278fc","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"14502413970","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"bdfe444d-b4d9-4789-971d-08420999d775","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51945157250","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"5f1e9684-e18d-4a9f-aad7-bef2235f631d","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51971119678","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13888,864],"id":"fc9e995e-943d-4cce-8e72-ee42d86cee6c","name":"If18"},{"parameters":{"description":"usa la tool supervisor seg√∫n el prompt principal","workflowId":{"__rl":true,"value":"xchwhR053ynGsZI4","mode":"list","cachedResultUrl":"/workflow/xchwhR053ynGsZI4","cachedResultName":"SUP SUNAT"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $json.id }}","conversation_id":"={{ $('If7').item.json.conversation_id }}","inbox_id":"={{ $('If12').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5616,832],"id":"5e99594b-abaa-47fe-872d-198f951381e9","name":"Supervisor"},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje1","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_uno }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"},{"fieldId":"account id","fieldValue":"={{ $('Webhook').item.json.body.account.id }}"},{"fieldId":"conversation id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2544,1088],"id":"476c18e7-85f6-493d-b3aa-14cfdf31bcc3","name":"Update a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje2","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1472,944],"id":"d7b09d89-120c-41de-af99-2ac3e43b9c64","name":"Update a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje3","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-720,896],"id":"87f26d37-d4e6-4022-b8e7-d0be58f20d22","name":"Update a row5","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"seguimiento_healup","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-15088,608],"id":"f952306b-6aab-4f21-ba58-cdd5dcebe32c","name":"Get a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}},"disabled":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"60e8198a-90ea-44a7-8f27-6e37021a1a02","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje1 }}","operator":{"type":"string","operation":"equals"}},{"id":"4541b27d-6dfa-47d7-bbff-d1a5c2e6ffd1","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje2 }}","operator":{"type":"string","operation":"equals"}},{"id":"20ce2efd-2509-40d0-b670-2c484246fa28","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje3 }}","operator":{"type":"string","operation":"equals"}},{"id":"b74b14df-879c-4427-8888-d7e1e3212ddc","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje4 }}","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-14880,608],"id":"5c2a2d65-e6b0-4eff-8611-1286cc5f3519","name":"If19","alwaysOutputData":true,"disabled":true},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje4","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[0,1008],"id":"3bfbc342-a045-4fb3-b813-77c25a76e4fd","name":"Update a row7","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"daeff2da-d88d-4aa7-b4d9-8b808c58b7c8","leftValue":"={{ $json.conversation_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7664,1824],"id":"4456591c-6e0e-41e1-8fe3-d6b190cf5b8a","name":"If7"},{"parameters":{"operation":"get","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","keyValue":"={{ $('Get a row3').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7920,1520],"id":"7eb28718-e96b-48aa-aaa6-9595b57209be","name":"Get a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"BRADA_followups","fieldsUi":{"fieldValues":[{"fieldId":"conversation_id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7232,1664],"id":"032dfeeb-7358-4670-bfc8-e64deb12607b","name":"Create a row1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"model":"gpt-5.1","options":{"reasoningEffort":"low"}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5440,496],"id":"ff0bf49f-19d4-4e02-92fc-84ddcb1a06e5","name":"RAZONADOR PLUS","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7536,1424],"id":"456e5e75-da23-4eaf-b219-2d0e6a4c9772","name":"Update a row9","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"pasar_supervisor_healup","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9872,1184],"id":"22e69871-698c-451d-97be-e15985b9f1ca","name":"Create a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"method":"POST","url":"=https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": \"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg\",\n  \"message_type\": \"outgoing\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3152,1440],"id":"1e6becc0-86ad-4636-968f-82b82ce1d008","name":"Respuesta6","executeOnce":false},{"parameters":{"url":"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3648,1424],"id":"c91882f6-4156-4928-83f4-db575130f873"},{"parameters":{"method":"POST","url":"https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content","value":"Aqu√≠ tienes la imagen adjunta üëá"}]},"options":{}},"name":"2. Enviar a Chatwoot","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3440,1408],"id":"bb8131d9-ee4a-4ce7-bfcd-6484ee58e6e9"},{"parameters":{"content":"## EJEMPLO IMAGENES\n","height":320,"width":560},"type":"n8n-nodes-base.stickyNote","position":[-3744,1328],"typeVersion":1,"id":"14ea41f0-1e70-47f8-ad8d-cad36bd5ba28","name":"Sticky Note"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2352,1056],"id":"da693219-5a37-4d6b-b186-6b04eb3a09a2","name":"If8"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1184,1440],"id":"00fb4ecc-2c2b-43c7-a5b0-3bc928404b03","name":"If23"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-976,1424],"id":"b350fa31-345e-420d-9213-4ccd1c603f30","name":"If26"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-624,1840],"id":"4b2323d7-ade6-4594-9192-1b4e2251a93b","name":"If27"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1248,1392],"typeVersion":1,"id":"ffa9ce31-0ae1-4e74-af8a-05d40968ab54","name":"Sticky Note2"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-752,1440],"id":"84b7f3b1-5259-47e9-976f-6a01df9ed583","name":"Wait","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-176,1648],"id":"acf88893-aecd-41e2-8a76-6b13efecaf2c","name":"If40"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[192,1856],"id":"324684bf-472a-4b17-a5fc-3b12d1f0e647","name":"If42"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1648],"id":"9da856cd-4d80-4b0d-84b5-9d412e3a3420","name":"Wait5","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1856],"id":"918310b1-c0da-46c2-80cf-8343bacd20a5","name":"Wait7","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[400,1872],"id":"30392c9c-d8a1-4a3a-8173-0ef149b4dadb","name":"Wait8","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-976,1600],"id":"3270bad6-15d8-4f71-a811-c3359fdab4e3","name":"Wait9","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[32,1664],"id":"e5ada578-5738-42b2-98f2-9c73991a85e8","name":"Wait10","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-608,1600],"id":"f693b423-1013-4d25-a66c-54422bfde206"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-2","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-784,1600],"id":"f2f64f92-df6b-4114-863d-2f5463a5bff7"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[0,1856],"id":"15cd3fea-5316-48c1-87b3-10b8b49c2919"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-3","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-176,1856],"id":"97e4385e-224d-4e1b-814b-55d7358b7f8e"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot34","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[720,1872],"id":"d96e4430-aea9-4374-b39b-75bec4c5b6dc"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-4","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[544,1872],"id":"d9dc6055-97c0-4412-8284-39dd78540a56"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot35","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[368,1664],"id":"e7946bf5-eb93-47a1-8f0a-788003fd3e1d"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-5","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[192,1664],"id":"b835a15f-edb3-45a2-b27b-a2905ade226f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot36","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-416,1440],"id":"97aa4aac-4a3b-4632-a2eb-32fe5486d166"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-6","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-592,1440],"id":"dd6f4397-190c-4511-84ba-a4ddb75136be"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":3},"conditions":[{"id":"b2a6d2d7-c61b-43ef-99fe-cc95d8413e94","leftValue":"={{ $json.body.conversation.messages[0].sender.phone_number }}","rightValue":51971119678,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-14480,592],"id":"65ea26bb-db5c-45f1-a288-c16501032d3c","name":"If5"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-14240,368],"id":"3b9693a6-6e3f-4174-9556-ba7477824248","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', ``, 'string') }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-13856,272],"id":"ff60e952-557a-4961-b575-24caf1329c1f","name":"pasar_supervisor","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $json.body.content }}\n\n","options":{"systemMessage":"=# üéØ ROL\nEres el Agente **Aura**. Tu √∫nica funci√≥n es extraer, **normalizar** y enviar un n√∫mero de tel√©fono a la tool \"pasar_supervisor\" El n√∫mero puede ser nacional (Per√∫) o extranjero, y debes procesarlo seg√∫n las reglas para que la tool reciba solo d√≠gitos.\n\n# üì• INPUT (Solicitud de Recepcionista)\nRecibir√°s una solicitud de la recepcionista para transferir un paciente.\nEl patr√≥n de la solicitud ser√° similar a: **Pasar a supervisor el n√∫mero: [N√∫mero variable]**\nEl n√∫mero puede llegar en formato completo (`519...`), solo el n√∫mero nacional (`9...`), o en formato internacional (`+1...`).\n\n# ‚öôÔ∏è INSTRUCCIONES ESTRICTAS (Funci√≥n sin Estado)\n\n1. Cada input es una solicitud √∫nica. Tu tarea finaliza con la ejecuci√≥n de la tool.\n\n2. **Identificaci√≥n:** Busca y extrae el n√∫mero que sigue inmediatamente al patr√≥n: **Pasar a supervisor el n√∫mero:** o **Manda a supervisor el n√∫mero**.\n\n3. **Normalizaci√≥n:** Antes de usar la tool, debes convertir el n√∫mero extra√≠do a un formato estandarizado de **solo d√≠gitos**, aplicando estas reglas en orden:\n    * **Limpieza:** Elimina todos los caracteres no num√©ricos (espacios, guiones, par√©ntesis, puntos, el signo `+`).\n    * **Normalizaci√≥n Per√∫ (9 d√≠gitos):** Si el n√∫mero tiene **9 d√≠gitos** y **no** comienza con `51`, asume que es un n√∫mero de Per√∫ y **precede** la cadena con `51`.\n    * **Normalizaci√≥n Internacional/Completo:** Si el n√∫mero comienza con `51` (11 d√≠gitos) o es cualquier otra longitud, √∫salo tal cual despu√©s de la limpieza.\n\n4. **Acci√≥n √önica:** Una vez extra√≠do y normalizado el n√∫mero, debes utilizar **exclusivamente** la tool **pasar_supervisor**.\n\n5. **Output:** Nunca respondas, expliques, ni devuelvas texto. Tu √∫nica acci√≥n es ejecutar la tool.\n\n### üìù EJEMPLO DE FLUJO DE TRABAJO\n\n| Input de la Recepcionista | L√≥gica de Normalizaci√≥n | Salida a la Tool |\n| :--- | :--- | :--- |\n| **Input 1 (Per√∫ Completo):** `Pasar a supervisor el n√∫mero: 51998765432` | N√∫mero original: `51998765432` (11 d√≠gitos). No requiere cambios. | `pasar_supervisor(51998765432)` |\n| **Input 2 (Internacional):** `Manda a supervisor el n√∫mero +1 (305) 417-1787` | Limpieza: `13054171787` (11 d√≠gitos). | `pasar_supervisor(13054171787)` |\n| **Input 3 (Per√∫ Corto):** `Manda a supervisor el n√∫mero 977571136` | 9 d√≠gitos. Se asume Per√∫. **Normaliza con 51**. | `pasar_supervisor(51977571136)` |\n\n## HERRAMIENTAS\n**Herramientas disponibles:** **pasar_supervisor**\n\n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-14256,192],"id":"ed307005-1e1d-4800-a494-8f1ee293347f","name":"supervisor"},{"parameters":{"workflowId":{"__rl":true,"value":"86itBT4QcMqbK21F","mode":"list","cachedResultUrl":"/workflow/86itBT4QcMqbK21F","cachedResultName":"[MANTENIMIENTO] Supwhatsapp"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('If19').item.json.body.conversation.messages[0].sender.phone_number }}","conversation_id":"={{ $('If19').item.json.body.conversation.messages[0].conversation_id }}","inbox_id":"={{ $('If19').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":[],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-14016,400],"id":"96b98de4-e095-42e3-83b8-8e9043aac552","name":"Call 'Supervisor healup'"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"Z1S8hBZOFvfBE7I5","mode":"list","cachedResultUrl":"/workflow/Z1S8hBZOFvfBE7I5","cachedResultName":"SUNAT | Enviar datos (General) | WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre', ``, 'string') }}","numero":"={{ $json.id }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},"matchingColumns":[],"schema":[{"id":"nombre","displayName":"nombre","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5664,752],"id":"39552a1a-a1b3-4538-a0c0-eefb20b529b8","name":"enviar_nombre"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    perfumes_full_size: [\n      \"9 pm\",\n      \"9 pm elixir\",\n      \"Aether extrait\",\n      \"Afeef Lattafa\",\n      \"Ajayeb Dubai\",\n      \"Ajwad pink to pink\",\n      \"Al Haramain Dubai Night\",\n      \"Al qiam golf\",\n      \"ALTHAIR PARFUMS de MARLY\",\n      \"Amber rouge\",\n      \"Amethyst\",\n      \"Amore caff√© Mancera\",\n      \"Aqua Dubai 100 ml\",\n      \"Art of nature II\",\n      \"Art of universe\",\n      \"Aruba gold\",\n      \"Atlas LATTAFA\",\n      \"Azzaro PARFUM\",\n      \"Azzaro the most wanted intense\",\n      \"Berry on top\",\n      \"Bharata chocolate\",\n      \"Bharata king EDP\",\n      \"Bharata king gold edition\",\n      \"Bharata Placid\",\n      \"BIANCO latte\",\n      \"CDN Intense man\",\n      \"CDN Sillage\",\n      \"CDN Urban Man Elixir\",\n      \"CDN woman\",\n      \"Champion goat\",\n      \"Champion money\",\n      \"Champion sugar\",\n      \"Chic Sonia\",\n      \"Choco overdose\",\n      \"Cloud Ariana grande\",\n      \"Club de nuit untold\",\n      \"Confidential\",\n      \"Cookie grave\",\n      \"Creed aventus\",\n      \"Creed millesime imperial\",\n      \"Creed silver mountain water\",\n      \"Decant\",\n      \"Diesel spirit\",\n      \"Eclaire\",\n      \"Eclaire banoffi\",\n      \"Eclaire pistache\",\n      \"EMEER\",\n      \"Erba gold\",\n      \"Erba pura\",\n      \"Fahkar Rose\",\n      \"Fakhar black\",\n      \"Fakhar gold\",\n      \"Fire on ice\",\n      \"GOS Blind bid\",\n      \"Gos bonus\",\n      \"GOS Boston\",\n      \"GOS Diamond\",\n      \"Gos Esmerald\",\n      \"GOS Full House\",\n      \"GOS Jackpot\",\n      \"GOS Moon\",\n      \"Gos no limit\",\n      \"GOS platinium\",\n      \"GOS Rouge\",\n      \"GOS Royale\",\n      \"GOS Wildcard\",\n      \"GOS Yellow Saphire\",\n      \"Haramain amber oud gold edition\",\n      \"HAWAS ice\",\n      \"Hawas malibu\",\n      \"Hayaati florence\",\n      \"Hayaati lataffa\",\n      \"Her confession\",\n      \"His Confession\",\n      \"Honor and glory\",\n      \"Invictus Parfum\",\n      \"INVICTUS VICTORY ELIXIR\",\n      \"Ishq al shuyukh silver\",\n      \"Island Khadlaj\",\n      \"Jean lowe azure\",\n      \"Jean lowe inmortel\",\n      \"JPG Le beau le parfum 120ml\",\n      \"JPG Le Male elixir 125ml\",\n      \"JPG LE MALE LE PARFUM\",\n      \"JPG Paradise Garden 125ml\",\n      \"Khamrah\",\n      \"Khamrah Dukhan\",\n      \"Kirk√© Tiziana Terenzi\",\n      \"Lataffa Ameer\",\n      \"Lattafa dynasty\",\n      \"LAYTON PARFUMS de MARLY\",\n      \"Mancera cedrat boise\",\n      \"Mancera coco vanille\",\n      \"Mancera Instant Crush\",\n      \"Mancera Red tobaco\",\n      \"Mandar√≠n elixir\",\n      \"Milestone\",\n      \"Montale Arabians Tonka\",\n      \"M√≥ntale intense caf√©\",\n      \"Nautica voyage\",\n      \"Naxos\",\n      \"Nitro Red\",\n      \"Nitro White\",\n      \"Noble blush\",\n      \"Now white\",\n      \"Now women\",\n      \"Odyssey artisto\",\n      \"Odyssey bahamas\",\n      \"Odyssey black forest\",\n      \"Odyssey Candee\",\n      \"Odyssey Eau de Montagne\",\n      \"Odyssey go mango\",\n      \"Odyssey Homme black EDP\",\n      \"Odyssey Homme white edition\",\n      \"Odyssey Limoni\",\n      \"Odyssey Mandarin sky\",\n      \"Odyssey mega edp\",\n      \"Odyssey revolution\",\n      \"Odyssey Spectra\",\n      \"Odyssey spectra blue\",\n      \"Odyssey toffe coffe\",\n      \"Odyssey Tyrant\",\n      \"Odyssey wild one\",\n      \"Orientica royal amber\",\n      \"Orientica Velvet Gold\",\n      \"OUD FOR GLORY\",\n      \"Qaed unlimited\",\n      \"Rave Now\",\n      \"Rayhaan Elixir\",\n      \"Rome Imagine\",\n      \"Rome paradox\",\n      \"Scandal intense\",\n      \"Scandal le parfum\",\n      \"Sehr\",\n      \"Shaheen\",\n      \"So candid\",\n      \"Spectre Malachite\",\n      \"Spectre wraith\",\n      \"Stronger with you intensly\",\n      \"Summer hammer/Lorenzo Pazzaglia\",\n      \"Sun-gria\",\n      \"Teriaq intense\",\n      \"Tharwah gold\",\n      \"The Kingdom\",\n      \"Turathi\",\n      \"Turathi Electric\",\n      \"Valentino born in Roma intense\",\n      \"Veneno\",\n      \"Versace Eros flame\",\n      \"Versace eros parfum\",\n      \"Vintage Radio\",\n      \"Winners trophy\",\n      \"Yara elixir\",\n      \"Yara lataffa\",\n      \"Yara Moi\",\n      \"Yara tous\",\n      \"Yves Saint Laurent Y EDP\"\n    ],\n\n    decants: [\n      \"BHARARA KING EDP\",\n      \"LATTAFA PRIDE PISA\",\n      \"HARANA\",\n      \"21:00:00\",\n      \"EJAAZI\",\n      \"CDN SILLAGE\",\n      \"GOS MOON\",\n      \"MANDARIN SKY\",\n      \"NAUTICA VOYAGE\",\n      \"ROYAL BLEU\",\n      \"ODYSSEY WHITE\",\n      \"JEAN LOWE MATIERE\",\n      \"SUBLIME\",\n      \"GOS ROUGE\",\n      \"9 PM REBEL\",\n      \"KHAMRAH\",\n      \"GOS YELLOW SAPPHIRE\",\n      \"GOS BOSTON\",\n      \"ASAD\",\n      \"TURATHI BLUE\",\n      \"CND SILLAGE\",\n      \"GOS ROYALE\",\n      \"OUD FOR GLORY\",\n      \"AL HARAMAIN GOLD EXTREME\",\n      \"ODYSSEY AOUD\",\n      \"VLO\",\n      \"EMEER\",\n      \"ISSEY MIYAKE\",\n      \"ODYSSEY TYRANT\",\n      \"ASAD ZANZIBAR\",\n      \"GOS BID\",\n      \"9AM\",\n      \"HAWAS ICE\",\n      \"GOS WILDCARD\",\n      \"YARA MOI\",\n      \"VENTANA ARMAF\",\n      \"CDN IMP√âRIALE\",\n      \"AL NASHAMA CAPRICE\",\n      \"YARA\",\n      \"BHARARA BLEU\",\n      \"GOS BLIND BID\",\n      \"GOS ACE\",\n      \"CDN MILESTONE\",\n      \"DETOUR NOIR\",\n      \"RAED LUXE\",\n      \"QAED UNLIMITED\",\n      \"AI HARAMAIN RUBY EDITION\",\n      \"HAWAS BLACK\",\n      \"HAYAATI\",\n      \"ODYSSEY HOMME BLACK\",\n      \"CDN URBAN MAN ELIXIR\",\n      \"CDN UNTOLD\",\n      \"MAAHIR LEGACY\",\n      \"LEGEND SPIRIT\",\n      \"SHAHEEN GOLD\",\n      \"YARA TOUS\",\n      \"FAKHAR ROSE\",\n      \"HONOR AND GLORY\",\n      \"DUBAI NIGHT\",\n      \"BHARARA KING PARFUM\",\n      \"LATTAFA JASOOR\",\n      \"GOS GOLD\",\n      \"CDN INTENSE MAN\",\n      \"GOS FULL HOUSE\",\n      \"ODYSSEY AQUA\",\n      \"HAYAATI AL MALEKY\",\n      \"GOS WIN\",\n      \"FAKHAR BLACK\",\n      \"GOS DIAMOND\",\n      \"KHAMRAH QAHWA\",\n      \"GOS HIGH ROLLER\",\n      \"THE KINGDOM\",\n      \"ODYSSEY MEGA\",\n      \"HAWAS FOR HIM\",\n      \"LATTAFA NEBRAS\",\n      \"AI HARAMAIN GOLD EDITION\",\n      \"AJWAD\",\n      \"RAVE NOW WHITE\",\n      \"ODYSSEY CANDEE\",\n      \"ODYSSEY SPECTRA\",\n      \"YARA CANDY\",\n      \"ODYSSEY LIMONI\",\n      \"AMBER ROUGE\",\n      \"SCEPTRE MALACHITE\",\n      \"VIKING KASHMIR\",\n      \"AI HARAMAIN PRIVATE EDITION\",\n      \"QAED AI FURSAN\",\n      \"GOS JACKPOT\",\n      \"VIKING DUBAI\",\n      \"ROYAL AMBER\",\n      \"BHARARA KING GOLD EDITION\",\n      \"HIS CONFESSION\",\n      \"VIKING CAIRO\",\n      \"BHARARA ELEGANCE\",\n      \"BHARARA PHARAOH 1\",\n      \"BHARARA PHARAOH 2\",\n      \"MAYAR\",\n      \"CLUB DE NUIT PRECIEUX\",\n      \"HER CONFESSION\",\n      \"AMETHYST LATTAFA\",\n      \"LATTAFA TERIAQ\",\n      \"AI HARAMAIN AQUA DUBAI\",\n      \"ASAD BOURBON\",\n      \"NITRO WHITE\",\n      \"LIQUID BURN\",\n      \"NITRO RED\",\n      \"NOBLE BLUSH\",\n      \"LATTAFA SEHR\",\n      \"ISLAND BLISS\",\n      \"LATTAFA ECLAIRE\",\n      \"AL HARAMAIN ROYAL MUSK\",\n      \"SUQRAAT\",\n      \"ISHQ AL SHUYUKH\",\n      \"LIAM BLUE\",\n      \"DUBAI CHOCOLAT\",\n      \"BHARARA CHOCOLATE\",\n      \"HAYA\",\n      \"ISHQ AL SHUYUKH GOLD\",\n      \"ANSAAM SILVER\",\n      \"VINTAGE RADIO\",\n      \"BHARARA ENCHANTED\",\n      \"GOS OPAL\",\n      \"ART OF UNIVERSE\",\n      \"LATTAFA CHIC\",\n      \"HAWAS ELIXIR\",\n      \"HAYA CRUSH\",\n      \"JEAN LOWE AZURE\",\n      \"ROME POUR HOMME\",\n      \"HAYAATI FLORENCE\",\n      \"VELVET GOLD\",\n      \"AJWAD PINK TO PINK\",\n      \"AL QIAM GOLD\",\n      \"ANGHAM LATTAFA\",\n      \"ARABIAN SKY\",\n      \"TAG UOMO ROSSO\",\n      \"TAG ART OF NATURE II\",\n      \"BHARARA PLACID\",\n      \"BHARARA SOLEIL\",\n      \"CDN WOMAN\",\n      \"CDN ICONIC\",\n      \"CONFIDENTIAL PRIVATE GOLD\",\n      \"DELILAH\",\n      \"GOS PLATINIUM OF SPADES\",\n      \"INTIMATION\",\n      \"ISLAND KHADLAJ\",\n      \"JEAN LOWE INMORTEL\",\n      \"JEAN LOWE VIBE\",\n      \"WINNERS TROPHY\",\n      \"KHANJAR EAU DE PARFUM\",\n      \"KISMET MAGIC\",\n      \"MANDARIN SKY ELIXIR\",\n      \"MAYAR CHERRY INTENSE\",\n      \"NITRO RED INTENSELY\",\n      \"NITRO NOW WOMEN\",\n      \"ODYSSEY ARTISTO\",\n      \"ODYSSEY WILD ONE\",\n      \"RAVE NOW RAYHAAN ELIXIR\",\n      \"NOW\",\n      \"SAKEENA\",\n      \"SO CANDID\",\n      \"TARWAH GOLD\",\n      \"LATTAFA TERIAQ INTENSE\",\n      \"VICTORIA LATTAFA\",\n      \"YUM YUM ARMAF\",\n      \"QISSA DELICIOUS\",\n      \"HAWAS TROPICAL\",\n      \"HAWAS FIRE\",\n      \"FAKHAR PLATIN\",\n      \"KHAMARAH DUKHAN\",\n      \"ODYSSEY EAU DE MONTAGNE\",\n      \"ODYSSEY REVOLUTION\",\n      \"ROME IMAGINE\",\n      \"TURATHI ELECTRIC\",\n      \"VULCAN NUE\",\n      \"SPECTRE WRAITH\",\n      \"GOS EMERALD OF SPADES\",\n      \"AFEEF\",\n      \"BHARARA ONYX\",\n      \"SCEPTRE DESERT\",\n      \"NITRO NEITHE\",\n      \"ODYSSEY BLACK FOREST\",\n      \"ODYSSEY TOFFEE COFFEE\",\n      \"ODYSSEY BAHAMAS\",\n      \"ODYSSEY MANGO\",\n      \"NITRO ELIXIR\",\n      \"ROME PARADOXE\",\n      \"ROME YUM YUM\",\n      \"ECLAIRE PISTACHE\",\n      \"ECLAIRE BANOFFEE\",\n      \"9PM ELIXIR\",\n      \"HAWAS MALIBU\",\n      \"HAWAS KOBRA\",\n      \"GOS BONUS DYNASTY FIRE\",\n      \"ON CIE\",\n      \"LOVELY CHERIE\"\n    ],\n\n    set_perfumes: [\n      \"Gos set\",\n      \"GOS Set 3 piezas jo milano\",\n      \"Set 9pm\",\n      \"Set art of universe\",\n      \"Set mandar√≠n\",\n      \"SET VERSACE NECESER + PERFUME + DECANT\",\n      \"Set YARA\",\n      \"Set Zadig & Voltaire this is her\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4736,416],"id":"8e853398-c1fd-4a9a-9894-11607d7d0832","name":"informacion_productos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"# ROL: \nEres un agente t√©cnico especializado en la verificaci√≥n de existencias y precios del cat√°logo de Brada Perfumes. Tu √∫nico objetivo es recibir nombres de perfumes, identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input y consultar la tool stock1 para obtener datos reales.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Productos: Los nombres de los perfumes en el input siempre vendr√°n entre comillas (ej. \"9 PM\", \"Hawas Ice\") para evitar confusi√≥n con el resto del mensaje.\nUso de la Tool stock1:\nDebes ejecutar la tool enviando el nombre exacto del perfume identificado en la variable perfume.\nSi el input contiene m√∫ltiples perfumes, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes mantener el nombre del perfume exactamente igual a como aparece en el cat√°logo, corrigiendo solo errores ortogr√°ficos evidentes seg√∫n tu conocimiento general.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo perfume\nVariable disponibilidad: Si la tool indica que el producto est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre de perfume): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s perfumes\nDebes listar cada perfume en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n# EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"Hola, revisa la disponibilidad de \"9 PM\" y \"Hawas Ice\".\"\nProceso interno:\nLlamada 1: stock1(perfume=\"9 PM\") -> Resultado: Disponible, S/ 140.\nLlamada 2: stock1(perfume=\"Hawas Ice\") -> Resultado: Agotado, S/ 180.\nOutput que debes enviar si son dos o m√°s perfumes: 9 PM: stock si y precio 140 soles. Hawas Ice: stock no y precio 180 soles.\n#NOTAS ADICIONALES\nNo inventes precios ni estados de stock.\nSi la tool no devuelve informaci√≥n para un nombre espec√≠fico, indica: (Nombre de perfume): stock no y precio (No disponible).\nTu respuesta debe ser exclusivamente la lista de stock solicitada, sin saludos ni despedidas adicionales\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5312,608],"id":"64458501-a4f8-45c4-aae9-17b34719c27a","name":"stock_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    \"distritos_permitidos\": [\n      \"Anc√≥n\", \"Ate\", \"Barranco\", \"Bre√±a\", \"Carabayllo\", \"Chaclacayo\", \n      \"Chorrillos\", \"Cieneguilla\", \"Comas\", \"El Agustino\", \"Independencia\", \n      \"Jes√∫s Mar√≠a\", \"La Molina\", \"La Victoria\", \"Lima\", \"Lince\", \n      \"Los Olivos\", \"Lurigancho\", \"Lur√≠n\", \"Magdalena del Mar\", \"Miraflores\", \n      \"Pachac√°mac\", \"Pucusana\", \"Pueblo Libre\", \"Puente Piedra\", \n      \"Punta Hermosa\", \"Punta Negra\", \"R√≠mac\", \"San Bartolo\", \"San Borja\", \n      \"San Isidro\", \"San Juan de Lurigancho\", \"San Juan de Miraflores\", \n      \"San Luis\", \"San Mart√≠n de Porres\", \"San Miguel\", \"Santa Anita\", \n      \"Santa Mar√≠a del Mar\", \"Santa Rosa\", \"Santiago de Surco\", \"Surquillo\", \n      \"Villa El Salvador\", \"Villa Mar√≠a del Triunfo\", \"Callao\", \"Bellavista\", \n      \"Carmen de la Legua Reynoso\", \"La Perla\", \"La Punta\", \"Ventanilla\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4432,400],"id":"09ca4414-ae98-4efb-aaa7-b0a7d4b68b45","name":"distritos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente especializado exclusivamente en la verificaci√≥n de existencias y precios de Decants (presentaciones de 5ml y 10ml) de Brada Perfumes. Tu objetivo es recibir el input del agente principal, identificar los perfumes y sus medidas, y consultar la tool stock_decants para devolver datos precisos.\n# INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Medidas: Debes prestar especial atenci√≥n a la cantidad solicitada (5ml o 10ml). Si el cliente no especifica la medida pero el contexto indica que es un decant, consulta ambas presentaciones.\nUso de la Tool stock_decants:\nDebes ejecutar la tool enviando el nombre del perfume y la medida identificada.\nSi el input contiene m√∫ltiples decants (ej. \"9 PM de 5ml y Hawas de 10ml\"), debes realizar una ejecuci√≥n de la tool por cada producto/medida individualmente.\nMantenimiento de Nomenclatura: Mant√©n el nombre t√©cnico del perfume (ej. \"Club de Nuit Intense\" en lugar de \"cnit\") seg√∫n la lista maestra.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato basado en los datos de la tool:\nCASO 1: Un solo decant\nVariable disponibilidad: Si la tool indica existencias, utiliza \"si\". Si no hay, utiliza \"no\".\nFormato de salida: (Nombre de perfume) ([Medida]): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s decants\nDebes listar cada decant en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad de decants: \"9 PM\" en 5ml y \"Hawas Ice\" en 10ml.\"\nProceso interno:\nLlamada 1: stock_decants(perfume=\"9 PM\", medida=\"5ml\") -> Resultado: Disponible, S/ 35.\nLlamada 2: stock_decants(perfume=\"Hawas Ice\", medida=\"10ml\") -> Resultado: Agotado, S/ 45.\nOutput (Lo que respondes): 9 PM (5ml): stock si y precio 35 soles. Hawas Ice (10ml): stock no y precio 45 soles.\n#REGLAS DE ORO\nProhibici√≥n de Inventar: No inventes precios. Si la tool no devuelve un precio para una medida espec√≠fica, responde: (Nombre de perfume) ([Medida]): stock no y precio (No disponible).\nExclusividad: Tu respuesta debe contener √∫nicamente la lista t√©cnica. No incluyas saludos, recomendaciones, ni frases de cierre.\nPrecisi√≥n de Medida: Aseg√∫rate de que el precio corresponda exactamente a la medida solicitada (un perfume de 10ml siempre es m√°s caro que uno de 5ml).\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5024,608],"id":"edf1ea9c-753a-4178-8823-ad4b5d276fde","name":"stock_decants"},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-4752,880],"id":"c65b6d98-6ca9-4850-a240-dc15d0e6f244","name":"OpenAI Chat Model5","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5008,880],"id":"f40c83eb-7af9-43d9-9718-23906d503917","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5328,848],"id":"4682821d-4ee5-4aa0-bfa8-6ee52c2d74b9","name":"OpenAI Chat Model6","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfumes","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-5168,816],"id":"db9c5a3b-41f0-489b-95b8-1818ea40b41b","name":"stock1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_decants","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4880,832],"id":"cca318d1-6e33-42b3-9253-f90ae5034239","name":"stock2","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfume_sets","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4592,880],"id":"6150c4ba-6b03-4325-b902-35091b0ac31b","name":"stock3","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente t√©cnico especializado exclusivamente en la verificaci√≥n de existencias y precios de los Sets de Perfumes (estuches de regalo o packs con complementos) de Brada Perfumes. Tu misi√≥n es recibir el nombre del set, validarlo contra la tool stock_set_perfumes y devolver la disponibilidad y precio real.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Sets: Los nombres de los sets suelen incluir la palabra \"Set\" (ej. \"Set Yara\", \"Set 9 PM\"). Debes identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input.\nUso de la Tool stock_set_perfumes:\nDebes ejecutar la tool enviando el nombre exacto del set en la variable nombre_set.\nSi el input contiene m√∫ltiples sets, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes respetar el nombre del set tal como aparece en el cat√°logo oficial de Brada Perfumes, asegur√°ndote de que se trate de la presentaci√≥n en estuche y no de la botella individual.\n#L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo Set\nVariable disponibilidad: Si la tool indica que el set est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre del Set): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s Sets\nDebes listar cada set en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad del SET: \"Set Yara\" y \"Set Art of Universe\".\"\nProceso interno:\nLlamada 1: stock_set_perfumes(nombre_set=\"Set Yara\") -> Resultado: Disponible, S/ 210.\nLlamada 2: stock_set_perfumes(nombre_set=\"Set Art of Universe\") -> Resultado: Disponible, S/ 250.\nOutput (Lo que respondes): Set Yara: stock si y precio 210 soles. Set Art of Universe: stock si y precio 250 soles.\n#REGLAS DE ORO\nPrecisi√≥n: No confundas un \"Perfume Full Size\" con un \"Set\". Si el input pide un Set, busca √∫nicamente en la categor√≠a de sets.\nProhibici√≥n de Inventar: No inventes precios ni disponibilidad. Si la tool no devuelve informaci√≥n para un set espec√≠fico, indica: (Nombre del Set): stock no y precio (No disponible).\nMinimalismo: Tu respuesta debe ser exclusivamente la lista t√©cnica solicitada. No incluyas saludos, despedidas ni comentarios sobre el contenido del set.\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-4736,656],"id":"6344ee20-9fcb-45bd-a342-5aaf79248763","name":"stock_set_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"bFX818cxJebYkS92","mode":"list","cachedResultUrl":"/workflow/bFX818cxJebYkS92","cachedResultName":"BRADA | WHATSAPP | compras confirmadas"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-4544,448],"id":"42a85e30-dd9d-47c7-af24-3eace4616f6f","name":"confirmacion_pedidos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1840,2160],"id":"86511a06-e0d8-496b-9161-edd28ac48fe2","name":"If24"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1632,2144],"id":"f6ed93e7-cd4c-4547-9b7c-9f3a9bd6174a","name":"If28"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1280,2560],"id":"6532091a-4da7-484e-bc59-551caaf8837a","name":"If29"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1904,2112],"typeVersion":1,"id":"4b346085-38b5-41dc-aa4e-0e5fd0d63b15","name":"Sticky Note3"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1408,2160],"id":"60a486b8-d8b9-45f7-bcc2-0237d9dacb35","name":"Wait1","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-832,2368],"id":"aec693f3-d181-42f6-96ef-f4259257f242","name":"If41"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-464,2576],"id":"d0bce6d9-8944-4f36-8369-887245578174","name":"If43"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2368],"id":"920f0b3f-260f-4a46-8f84-c7fafcb4e42d","name":"Wait11","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2576],"id":"9445a338-fa59-4652-b7a7-042da4ab0166","name":"Wait12","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-256,2592],"id":"1b4c198d-a84a-4886-bfee-45e03505844a","name":"Wait13","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1632,2320],"id":"985412b0-18a0-4a74-9383-848361eecf6d","name":"Wait14","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-624,2384],"id":"0b01e43e-8f88-4806-9aa3-aaafae23afa5","name":"Wait15","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1264,2320],"id":"455fc9a5-d692-424b-96af-4dc9dfb5ecfa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1440,2320],"id":"43ef0c39-d3b6-4ed3-9bbe-55b60f80b5a4"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-656,2576],"id":"71901a37-3c10-48e0-8c0d-ea488faf670e"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-7","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-832,2576],"id":"94b90b7c-2489-43c2-b38d-5f1d9ed48958"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot37","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[64,2592],"id":"70f90af3-d2d6-42bb-bbed-2a460fc13eb2"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-8","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-112,2592],"id":"79b9eee3-c9f3-43cc-945b-a659df940b42"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot38","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-288,2384],"id":"377a6011-2a90-4508-ad7a-18e8be515097"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-9","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-464,2384],"id":"4736c49f-51b0-433c-acaf-c5ec1975c27f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot39","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1072,2160],"id":"a211f2a4-e5b1-4b1b-b198-ecee0d6bdf3a"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-10","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1248,2160],"id":"e7fcf0ac-d57f-498d-84c2-efc72cefbb9c"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[336,720],"id":"2aaf0e50-945f-404a-a630-6c934c4bf678","name":"If25"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[544,704],"id":"db6e3976-9c81-410c-a089-cbbffed9a498","name":"If30"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[896,1120],"id":"3d9b40b9-6eb5-4641-9243-4acb6bbaab90","name":"If31"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[272,672],"typeVersion":1,"id":"9d6dc394-e9c9-47cf-bb8b-3ec6e169cd24","name":"Sticky Note4"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[768,720],"id":"e193f0ff-9818-4fff-ab4c-87a07ea2bc57","name":"Wait16","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1344,928],"id":"70a6f8d6-3ef1-45ad-be33-45e51b8b5bf7","name":"If44"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1712,1136],"id":"46e4e9c0-d629-4cae-a016-78122838bf5c","name":"If45"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,928],"id":"9005e0a0-7928-4432-afba-ecca82410842","name":"Wait17","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,1136],"id":"26654f8d-1377-49f2-b4ba-feefd58f29f5","name":"Wait18","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1920,1152],"id":"e5e9d5a8-676d-4787-ad0c-57a9cecb51e6","name":"Wait19","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[544,880],"id":"0a2148fa-6d21-4cef-85c9-2f9f7747051b","name":"Wait20","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1552,944],"id":"24a50f49-9fa7-444a-889d-b0a47dcdca22","name":"Wait21","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[912,880],"id":"73a2a9cb-96fa-4c67-b2c0-855467476004"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-11","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[736,880],"id":"2a355cf5-4023-4e5c-94cd-fb54d20ab48d"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot21","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1520,1136],"id":"e4e81844-daec-44fa-87e1-8a40c9f593e1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-12","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1344,1136],"id":"124b0253-10a5-4f3f-8b46-7e729f639b4b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot40","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2240,1152],"id":"d7a77253-dcf2-4e33-9699-ace3f5cf9843"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-13","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2064,1152],"id":"47d740d9-af91-4b47-a3d9-43f6089948ac"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot41","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1888,944],"id":"ba55a9c2-6648-4009-9d21-cbad56eea3fa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-14","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1712,944],"id":"09553178-8112-4313-b41f-7edb86da9bb2"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot42","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1104,720],"id":"a287f371-7d38-4b62-96ac-80a54a0f4a85"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-15","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[928,720],"id":"5a670fc0-4c1b-45d5-bf03-f2cce3d56697"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-144,0],"id":"21286fd2-eb14-4621-961c-daf1710c98db","name":"If32"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[64,-16],"id":"9298649c-49d2-4ef9-a38d-d1ecd699741a","name":"If33"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[416,400],"id":"0335f432-f2cb-43bf-9855-8b773b8fd74f","name":"If34"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-208,-48],"typeVersion":1,"id":"f7db0934-d8a5-4643-8ea5-3b74f9fd30ff","name":"Sticky Note5"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[288,0],"id":"edc5d3e6-6cb7-4e24-a395-5bfd2ec21e8f","name":"Wait22","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[864,208],"id":"3d08713e-6783-4344-835a-52021892fc79","name":"If46"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1232,416],"id":"a3ff7975-1b42-4ee2-8d28-a9e2530627ea","name":"If47"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,208],"id":"050e27ee-0dc9-4cfe-9b3b-4984fdb3c424","name":"Wait23","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,416],"id":"316376c3-954b-4325-ab08-caadfb880e67","name":"Wait24","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1440,432],"id":"cfc28de1-e1fa-4583-80c7-4806a6cd7ad1","name":"Wait25","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[64,160],"id":"e8d0be90-195b-413a-b96d-28c469da7d2a","name":"Wait26","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1072,224],"id":"83b77384-ab0f-442c-aa8e-20cbf18ba56b","name":"Wait27","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot22","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[432,160],"id":"91fe9d8e-e24c-4675-9a65-5c3b96805cd1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[256,160],"id":"b2aa295f-bb56-4faf-bc6e-2c244ae1b8b5"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot23","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1040,416],"id":"42af2c54-fd06-4e53-9b3e-386ae18aad48"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[864,416],"id":"334d03f2-3acd-4c43-9e5c-e5c9ec1fab6b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot43","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1760,432],"id":"a10b0be7-7ad4-4a67-b580-1f6c8f63dd0b"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1584,432],"id":"3ae52091-798e-4106-ad81-b391a548b061"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot44","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1408,224],"id":"634d84c9-0fb9-4dc6-a691-70a9eb6eaff6"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1232,224],"id":"4c0fbfdd-c75a-4058-9fb3-c934f00a1774"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot45","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[624,0],"id":"c8374285-c938-46a3-ab3d-a8987b53dafe"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[448,0],"id":"8a5f2626-93c0-485f-83b6-88d1b7969f67"}],"connections":{"AI Agent":{"main":[[{"node":"Verificador1","type":"main","index":0}]]},"Auto-fixing Output Parser1":{"ai_outputParser":[[{"node":"Verificador1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model8":{"ai_languageModel":[[{"node":"Auto-fixing Output Parser1","type":"ai_languageModel","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"Auto-fixing Output Parser1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model9":{"ai_languageModel":[[{"node":"Verificador1","type":"ai_languageModel","index":0}]]},"Verificador1":{"main":[[{"node":"ordenar","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Get a row3","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"If2":{"main":[[{"node":"Update a row1","type":"main","index":0}],[{"node":"If3","type":"main","index":0}]]},"If3":{"main":[[{"node":"Switch3","type":"main","index":0}],[{"node":"No Operation, do nothing4","type":"main","index":0}]]},"Edit Fields4":{"main":[[{"node":"If2","type":"main","index":0}]]},"If13":{"main":[[{"node":"Get a row1","type":"main","index":0}],[{"node":"Create a row","type":"main","index":0}]]},"Calendario":{"ai_tool":[[]]},"Create a row":{"main":[[{"node":"Get a row1","type":"main","index":0}]]},"Get a row1":{"main":[[{"node":"Edit Fields4","type":"main","index":0}]]},"Update a row1":{"main":[[{"node":"Switch3","type":"main","index":0}]]},"Get a row":{"main":[[{"node":"If13","type":"main","index":0}]]},"If4":{"main":[[{"node":"If11","type":"main","index":0}],[{"node":"Fecha","type":"main","index":0}]]},"Formatea fecha":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Handler variables":{"main":[[{"node":"If10","type":"main","index":0}]]},"Fecha":{"main":[[{"node":"Formatea fecha","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Handler variables","type":"main","index":0}]]},"Wait6":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"If6":{"main":[[{"node":"Redis1","type":"main","index":0}],[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"Delete Redis":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Edit Fields19":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"Get Redis1":{"main":[[{"node":"If6","type":"main","index":0}]]},"Edit Fields20":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"If15":{"main":[[{"node":"Edit Fields19","type":"main","index":0}],[{"node":"Edit Fields20","type":"main","index":0}]]},"METER_ANUNCIO":{"main":[[{"node":"guarda_ANUNCIO","type":"main","index":0}]]},"BAJAR_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"guarda_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"If":{"main":[[{"node":"RESUMIDOR ANUNCIOS","type":"main","index":0}],[{"node":"If4","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"RESUMIDOR ANUNCIOS","type":"ai_languageModel","index":0}]]},"If10":{"main":[[{"node":"METER_ANUNCIO","type":"main","index":0}],[{"node":"BAJAR_ANUNCIO","type":"main","index":0}]]},"Redis1":{"main":[[{"node":"If15","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"If16","type":"main","index":0}]]},"Edit Fields12":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"AUDIO1","type":"main","index":0}]]},"Switch3":{"main":[[{"node":"HTTP Request","type":"main","index":0}],[{"node":"OpenAI","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}]]},"AUDIO1":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"If16":{"main":[[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields12","type":"main","index":0}]]},"Edit Fields17":{"main":[[{"node":"If","type":"main","index":0}]]},"If11":{"main":[[{"node":"Update a row4","type":"main","index":0}]]},"If12":{"main":[[{"node":"Get a row","type":"main","index":0}],[{"node":"If20","type":"main","index":0}]]},"If20":{"main":[[{"node":"Update a row6","type":"main","index":0}]]},"If1":{"main":[[{"node":"If12","type":"main","index":0}]]},"ordenar":{"main":[[{"node":"Respuesta1","type":"main","index":0}]]},"Respuesta1":{"main":[[{"node":"Update a row","type":"main","index":0}]]},"Wait2":{"main":[[{"node":"Respuesta2","type":"main","index":0}]]},"Respuesta2":{"main":[[{"node":"Update a row3","type":"main","index":0}]]},"If14":{"main":[[{"node":"Wait3","type":"main","index":0}],[{"node":"If23","type":"main","index":0}]]},"Wait3":{"main":[[{"node":"Respuesta3","type":"main","index":0}]]},"Respuesta3":{"main":[[{"node":"Update a row5","type":"main","index":0}]]},"If17":{"main":[[{"node":"Wait4","type":"main","index":0}],[{"node":"If32","type":"main","index":0}]]},"Wait4":{"main":[[{"node":"Respuesta4","type":"main","index":0}]]},"Respuesta4":{"main":[[{"node":"Update a row7","type":"main","index":0}]]},"RESUMIDOR ANUNCIOS":{"main":[[{"node":"If4","type":"main","index":0}]]},"Supervisor":{"ai_tool":[[]]},"Update a row":{"main":[[{"node":"If8","type":"main","index":0}]]},"Update a row3":{"main":[[{"node":"If14","type":"main","index":0}]]},"Update a row5":{"main":[[{"node":"If17","type":"main","index":0}]]},"Get a row3":{"main":[[{"node":"If19","type":"main","index":0}]]},"If19":{"main":[[{"node":"If5","type":"main","index":0}]]},"Update a row7":{"main":[[{"node":"If25","type":"main","index":0}]]},"If7":{"main":[[{"node":"Update a row9","type":"main","index":0}],[{"node":"Create a row1","type":"main","index":0}]]},"Get a row2":{"main":[[{"node":"If7","type":"main","index":0}]]},"Create a row1":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"RAZONADOR PLUS":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Update a row9":{"main":[[{"node":"Wait6","type":"main","index":0}]]},"1. Descargar Imagen":{"main":[[{"node":"2. Enviar a Chatwoot","type":"main","index":0}]]},"If8":{"main":[[{"node":"Wait2","type":"main","index":0}],[{"node":"If24","type":"main","index":0}]]},"If23":{"main":[[{"node":"If26","type":"main","index":0}],[{"node":"Wait9","type":"main","index":0}]]},"If26":{"main":[[],[{"node":"Wait","type":"main","index":0}]]},"If27":{"main":[[{"node":"Wait5","type":"main","index":0}],[{"node":"Wait7","type":"main","index":0}]]},"Wait":{"main":[[{"node":"1. Descargar Imagen 1-6","type":"main","index":0}]]},"If40":{"main":[[],[{"node":"Wait10","type":"main","index":0}]]},"If42":{"main":[[],[{"node":"Wait8","type":"main","index":0}]]},"Wait5":{"main":[[{"node":"If40","type":"main","index":0}]]},"Wait7":{"main":[[{"node":"1. Descargar Imagen 1-3","type":"main","index":0}]]},"Wait8":{"main":[[{"node":"1. Descargar Imagen 1-4","type":"main","index":0}]]},"Wait9":{"main":[[{"node":"1. Descargar Imagen 1-2","type":"main","index":0}]]},"Wait10":{"main":[[{"node":"1. Descargar Imagen 1-5","type":"main","index":0}]]},"2. Enviar a Chatwoot16":{"main":[[{"node":"If27","type":"main","index":0}]]},"1. Descargar Imagen 1-2":{"main":[[{"node":"2. Enviar a Chatwoot16","type":"main","index":0}]]},"2. Enviar a Chatwoot19":{"main":[[{"node":"If42","type":"main","index":0}]]},"1. Descargar Imagen 1-3":{"main":[[{"node":"2. Enviar a Chatwoot19","type":"main","index":0}]]},"1. Descargar Imagen 1-4":{"main":[[{"node":"2. Enviar a Chatwoot34","type":"main","index":0}]]},"1. Descargar Imagen 1-5":{"main":[[{"node":"2. Enviar a Chatwoot35","type":"main","index":0}]]},"1. Descargar Imagen 1-6":{"main":[[{"node":"2. Enviar a Chatwoot36","type":"main","index":0}]]},"If5":{"main":[[{"node":"supervisor","type":"main","index":0}],[{"node":"If1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"supervisor","type":"ai_languageModel","index":0}]]},"pasar_supervisor":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"Call 'Supervisor healup'":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"enviar_nombre":{"ai_tool":[[]]},"informacion_productos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"distritos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_decants":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model5":{"ai_languageModel":[[{"node":"stock_set_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model6":{"ai_languageModel":[[{"node":"stock_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"stock_decants","type":"ai_languageModel","index":0}]]},"stock1":{"ai_tool":[[{"node":"stock_perfumes","type":"ai_tool","index":0}]]},"stock2":{"ai_tool":[[{"node":"stock_decants","type":"ai_tool","index":0}]]},"stock3":{"ai_tool":[[{"node":"stock_set_perfumes","type":"ai_tool","index":0}]]},"stock_set_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"confirmacion_pedidos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"If24":{"main":[[{"node":"If28","type":"main","index":0}],[{"node":"Wait14","type":"main","index":0}]]},"If28":{"main":[[],[{"node":"Wait1","type":"main","index":0}]]},"If29":{"main":[[{"node":"Wait11","type":"main","index":0}],[{"node":"Wait12","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"1. Descargar Imagen 1-10","type":"main","index":0}]]},"If41":{"main":[[],[{"node":"Wait15","type":"main","index":0}]]},"If43":{"main":[[],[{"node":"Wait13","type":"main","index":0}]]},"Wait11":{"main":[[{"node":"If41","type":"main","index":0}]]},"Wait12":{"main":[[{"node":"1. Descargar Imagen 1-7","type":"main","index":0}]]},"Wait13":{"main":[[{"node":"1. Descargar Imagen 1-8","type":"main","index":0}]]},"Wait14":{"main":[[{"node":"1. Descargar Imagen 1-","type":"main","index":0}]]},"Wait15":{"main":[[{"node":"1. Descargar Imagen 1-9","type":"main","index":0}]]},"2. Enviar a Chatwoot17":{"main":[[{"node":"If29","type":"main","index":0}]]},"1. Descargar Imagen 1-":{"main":[[{"node":"2. Enviar a Chatwoot17","type":"main","index":0}]]},"2. Enviar a Chatwoot20":{"main":[[{"node":"If43","type":"main","index":0}]]},"1. Descargar Imagen 1-7":{"main":[[{"node":"2. Enviar a Chatwoot20","type":"main","index":0}]]},"1. Descargar Imagen 1-8":{"main":[[{"node":"2. Enviar a Chatwoot37","type":"main","index":0}]]},"1. Descargar Imagen 1-9":{"main":[[{"node":"2. Enviar a Chatwoot38","type":"main","index":0}]]},"1. Descargar Imagen 1-10":{"main":[[{"node":"2. Enviar a Chatwoot39","type":"main","index":0}]]},"If25":{"main":[[{"node":"If30","type":"main","index":0}],[{"node":"Wait20","type":"main","index":0}]]},"If30":{"main":[[],[{"node":"Wait16","type":"main","index":0}]]},"If31":{"main":[[{"node":"Wait17","type":"main","index":0}],[{"node":"Wait18","type":"main","index":0}]]},"Wait16":{"main":[[{"node":"1. Descargar Imagen 1-15","type":"main","index":0}]]},"If44":{"main":[[],[{"node":"Wait21","type":"main","index":0}]]},"If45":{"main":[[],[{"node":"Wait19","type":"main","index":0}]]},"Wait17":{"main":[[{"node":"If44","type":"main","index":0}]]},"Wait18":{"main":[[{"node":"1. Descargar Imagen 1-12","type":"main","index":0}]]},"Wait19":{"main":[[{"node":"1. Descargar Imagen 1-13","type":"main","index":0}]]},"Wait20":{"main":[[{"node":"1. Descargar Imagen 1-11","type":"main","index":0}]]},"Wait21":{"main":[[{"node":"1. Descargar Imagen 1-14","type":"main","index":0}]]},"2. Enviar a Chatwoot18":{"main":[[{"node":"If31","type":"main","index":0}]]},"1. Descargar Imagen 1-11":{"main":[[{"node":"2. Enviar a Chatwoot18","type":"main","index":0}]]},"2. Enviar a Chatwoot21":{"main":[[{"node":"If45","type":"main","index":0}]]},"1. Descargar Imagen 1-12":{"main":[[{"node":"2. Enviar a Chatwoot21","type":"main","index":0}]]},"1. Descargar Imagen 1-13":{"main":[[{"node":"2. Enviar a Chatwoot40","type":"main","index":0}]]},"1. Descargar Imagen 1-14":{"main":[[{"node":"2. Enviar a Chatwoot41","type":"main","index":0}]]},"1. Descargar Imagen 1-15":{"main":[[{"node":"2. Enviar a Chatwoot42","type":"main","index":0}]]},"If32":{"main":[[{"node":"If33","type":"main","index":0}],[{"node":"Wait26","type":"main","index":0}]]},"If33":{"main":[[],[{"node":"Wait22","type":"main","index":0}]]},"If34":{"main":[[{"node":"Wait23","type":"main","index":0}],[{"node":"Wait24","type":"main","index":0}]]},"Wait22":{"main":[[{"node":"1. Descargar Imagen 1-20","type":"main","index":0}]]},"If46":{"main":[[],[{"node":"Wait27","type":"main","index":0}]]},"If47":{"main":[[],[{"node":"Wait25","type":"main","index":0}]]},"Wait23":{"main":[[{"node":"If46","type":"main","index":0}]]},"Wait24":{"main":[[{"node":"1. Descargar Imagen 1-17","type":"main","index":0}]]},"Wait25":{"main":[[{"node":"1. Descargar Imagen 1-18","type":"main","index":0}]]},"Wait26":{"main":[[{"node":"1. Descargar Imagen 1-16","type":"main","index":0}]]},"Wait27":{"main":[[{"node":"1. Descargar Imagen 1-19","type":"main","index":0}]]},"2. Enviar a Chatwoot22":{"main":[[{"node":"If34","type":"main","index":0}]]},"1. Descargar Imagen 1-16":{"main":[[{"node":"2. Enviar a Chatwoot22","type":"main","index":0}]]},"2. Enviar a Chatwoot23":{"main":[[{"node":"If47","type":"main","index":0}]]},"1. Descargar Imagen 1-17":{"main":[[{"node":"2. Enviar a Chatwoot23","type":"main","index":0}]]},"1. Descargar Imagen 1-18":{"main":[[{"node":"2. Enviar a Chatwoot43","type":"main","index":0}]]},"1. Descargar Imagen 1-19":{"main":[[{"node":"2. Enviar a Chatwoot44","type":"main","index":0}]]},"1. Descargar Imagen 1-20":{"main":[[{"node":"2. Enviar a Chatwoot45","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"acwebhook.alefcompany.online","user-agent":"rest-client/2.1.0 (linux-musl x86_64) ruby/3.4.4p34","content-length":"2304","accept":"application/json","accept-encoding":"gzip;q=1.0,deflate;q=0.6,identity;q=0.3","content-type":"application/json","x-forwarded-for":"173.249.43.27","x-forwarded-host":"acwebhook.alefcompany.online","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"6a57d0c37ad6","x-real-ip":"173.249.43.27"},"params":{},"query":{},"body":{"account":{"id":2,"name":"Healup"},"additional_attributes":{},"content_attributes":{},"content_type":"text","content":"a","conversation":{"additional_attributes":{},"can_reply":true,"channel":"Channel::Whatsapp","contact_inbox":{"id":4,"contact_id":4,"inbox_id":4,"source_id":"51972619000","created_at":"2026-01-02T16:51:45.640Z","updated_at":"2026-01-02T16:51:45.640Z","hmac_verified":false,"pubsub_token":"STv1xcrZw8Aeuyt1SPgxmVQm"},"id":1,"inbox_id":4,"messages":[{"id":18,"content":"a","account_id":2,"inbox_id":4,"conversation_id":1,"message_type":0,"created_at":1767380149,"updated_at":"2026-01-02T18:55:49.212Z","private":false,"status":"sent","source_id":"wamid.HBgLNTE5NzI2MTkwMDAVAgASGBYzRUIwQTY2M0JDMjQwOTg4NTdDQTg3AA==","content_type":"text","content_attributes":{},"sender_type":"Contact","sender_id":4,"external_source_ids":{},"additional_attributes":{},"processed_message_content":"a","sentiment":{},"conversation":{"assignee_id":null,"unread_count":1,"last_activity_at":1767380149,"contact_inbox":{"source_id":"51972619000"}},"sender":{"additional_attributes":{},"custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false,"type":"contact"}}],"labels":[],"meta":{"sender":{"additional_attributes":{},"custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false,"type":"contact"},"assignee":null,"assignee_type":null,"team":null,"hmac_verified":false},"status":"open","custom_attributes":{},"snoozed_until":null,"unread_count":1,"first_reply_created_at":null,"priority":null,"waiting_since":1767372705,"agent_last_seen_at":1767378677,"contact_last_seen_at":0,"last_activity_at":1767380149,"timestamp":1767380149,"created_at":1767372705,"updated_at":1767380149.2243187},"created_at":"2026-01-02T18:55:49.212Z","id":18,"inbox":{"id":4,"name":"Heal Up Lab WhatsApp"},"message_type":"incoming","private":false,"sender":{"account":{"id":2,"name":"Healup"},"additional_attributes":{},"avatar":"","custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false},"source_id":"wamid.HBgLNTE5NzI2MTkwMDAVAgASGBYzRUIwQTY2M0JDMjQwOTg4NTdDQTg3AA==","event":"message_created"},"webhookUrl":"https://acwebhook.alefcompany.online/webhook/healup2","executionMode":"production"}}]},"versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","activeVersionId":null,"versionCounter":24,"triggerCount":1,"shared":[{"updatedAt":"2026-01-08T17:51:46.711Z","createdAt":"2026-01-08T17:51:46.711Z","role":"workflow:owner","workflowId":"bIVpE1aXwtICWRcyHjLUv","projectId":"MTPybkDgxszv17uX","project":{"updatedAt":"2025-12-12T19:47:40.556Z","createdAt":"2025-12-12T19:45:17.094Z","id":"MTPybkDgxszv17uX","name":"Juan Pablo Jesus Bazan Ramos <bazanjuanpa@gmail.com>","type":"personal","icon":null,"description":null,"creatorId":"4423001a-8ae6-45ae-b4e5-774853e1a949","projectRelations":[{"updatedAt":"2025-12-12T19:45:17.094Z","createdAt":"2025-12-12T19:45:17.094Z","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949","projectId":"MTPybkDgxszv17uX","user":{"updatedAt":"2026-01-21T04:04:53.319Z","createdAt":"2025-12-12T19:45:16.195Z","id":"4423001a-8ae6-45ae-b4e5-774853e1a949","email":"bazanjuanpa@gmail.com","firstName":"Juan Pablo Jesus","lastName":"Bazan Ramos","personalizationAnswers":{"version":"v4","personalization_survey_submitted_at":"2025-12-12T19:47:50.835Z","personalization_survey_n8n_version":"1.123.5","companySize":"<20","companyType":"saas","role":"business-owner","reportedSource":"twitter"},"settings":{"userActivated":true,"easyAIWorkflowOnboarded":true,"firstSuccessfulWorkflowId":"hA8_Wb7G-H_xzMUXbPCqT","userActivatedAt":1768943704423,"npsSurvey":{"waitingForResponse":true,"ignoredCount":2,"lastShownAt":1767054623912}},"disabled":false,"mfaEnabled":false,"lastActiveAt":"2026-01-21","isPending":false}}]}}],"activeVersion":null}
[2026-01-21T04:51:46.758Z] Request received: {"clientKey":"brada","active":true}
[2026-01-21T04:51:46.759Z] Resolved Client: brada -> TargetID: bIVpE1aXwtICWRcyHjLUv
[2026-01-21T04:51:46.759Z] API Config - BaseURL: https://acn8n.alefcompany.online/api/v1, KeyLength: 207
[2026-01-21T04:51:46.760Z] Executing n8n action: activate on bIVpE1aXwtICWRcyHjLUv
[2026-01-21T04:51:47.710Z] n8n Response: {"updatedAt":"2026-01-12T22:41:59.443Z","createdAt":"2026-01-08T17:51:46.711Z","id":"bIVpE1aXwtICWRcyHjLUv","name":"BRADAWHATSAPP","description":null,"active":true,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $('Delete Redis').first().json.response }}\nCurrent date: {{ $('Formatea fecha').first().json.formattedDate }}\nEl numero del whatsapp del paciente es: {{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n\n## CLASIFICACI√ìN DE TEXTO:\nTe va a llegar los mensajes en parte de esta forma:\nTexto mensaje: [Mensaje]\nAudio transcripto: [audio trascripto]\nImagen analizada: [mensaje analizado]\nesto es para que sepas diferenciar los audios, imagenes, y textos que te manden.\n","options":{"systemMessage":"=#ROL\n1. IDENTIDAD Y VOCABULARIO (EL \"QUI√âN\" Y \"QU√â\" DECIR)\nEsta secci√≥n define su personalidad y el est√°ndar de lenguaje que debe utilizar para conectar con el cliente que desea comprar en Brada Perfumes.\nNombre: Diego.\nCargo: Asesor de ventas de la tienda ‚ÄúBrada Perfumes‚Äù, especializado en alta perfumer√≠a y fragancias √°rabes.\nTrato al Cliente: Uso de un tono simple, cercano y directo. Se evita la informalidad excesiva\nUso de \"Hermano\": El t√©rmino \"hermano\" queda restringido √∫nicamente al saludo inicial. No debe utilizarse en el resto de la conversaci√≥n para evitar un exceso de confianza.\nRestricci√≥n Cr√≠tica: Queda estrictamente prohibido el uso de apelativos exagerados como \"perfum√≥n\" o \"joyita\". Tambi√©n se proh√≠be el lenguaje rob√≥tico, el trato formal de \"Usted\" y el uso de diminutivos (ej. \"perfumito\", \"botellita\").\nEjemplo de Aplicaci√≥n: \nEntrada: \"hola que tal, precio de asad\" \nRespuesta de Diego: \"Hola hermano, que tal? El Lattafa Asad s√≠ lo tenemos disponible, aqu√≠ te paso los detalles...\"\n\n2. PROTOCOLOS DE COMUNICACI√ìN (EL \"C√ìMO\" HABLAR)\nEsta secci√≥n establece la mec√°nica de sus respuestas para garantizar una venta √°gil, persuasiva y aut√©ntica.\nRegla de Interacci√≥n: Responder mensaje por mensaje para mantener un ritmo de chat natural.\nRegla de Extensi√≥n Adaptativa:\nRespuestas Simples: M√°ximo 2 l√≠neas para saludos iniciales o confirmaciones de recepci√≥n.\nRespuestas de Cat√°logo: Entrega de la informaci√≥n clave (precio, disponibiidad y nombre del producto) bas√°ndose en las tres tools seg√∫n las reglas correspondientes a su uso en la secci√≥n: ‚Äú\nRegla de Estructura: Si el cliente pregunta por varias fragancias, responda de forma ordenada destacando lo mejor de cada una.\nRegla de Est√©tica: Uso din√°mico de 1 emoji por mensaje (üî•, üí®, ) para transmitir la energ√≠a y exclusividad de las fragancias.\nRegla de No-Repetici√≥n:\nNo repita el saludo de bienvenida si el cliente contin√∫a la conversaci√≥n m√°s tarde.\nSi el cliente no entiende una nota olfativa, use comparaciones sencillas (ej. \"huele a limpio\", \"es bien dulcecito\") sin perder la base t√©cnica.\n3. L√ìGICA DE OBJETIVOS (EL \"PARA QU√â\" ACTUAR)\nEsta secci√≥n rige sus decisiones estrat√©gicas, priorizando la asesor√≠a efectiva y el cierre de ventas seguro.\nMisi√≥n Principal: Identificar el nombre del perfume que desee el cliente) y resolver dudas sobre stock y env√≠os usando exclusivamente las tools.\nFiltro de Pago y Env√≠o: Prohibido solicitar datos de env√≠o o confirmar pedidos si el cliente no ha pasado por el \"Filtro de Validaci√≥n de Pago\" (An√°lisis de imagen del comprobante).\nFiltro de Asesor√≠a: Ante consultas sobre reclamos, devoluciones o pedidos de asesor√≠a m√©dica/piel muy complejos, debe derivar inmediatamente al supervisor.\nIntegridad de Stock: Prohibido inventar disponibilidad o precios. La √∫nica fuente v√°lida es el output de la tool stock_real.\n#CONOCIMIENTO GENERAL\n### ¬øQu√© es Brada Perfumes?\nEs una tienda especializada en alta perfumer√≠a y fragancias √°rabes exclusivas. Como asesor de ventas, tu objetivo es orientar a los clientes para encontrar su fragancia ideal y cerrar la venta de forma √°gil.\n### Cat√°logo de Productos\nBrada Perfumes ofrece tres categor√≠as de productos. Para conocer la lista actualizada de existencias, siempre debes ejecutar la tool informacion_perfumes al inicio de la consulta:\n**Perfumes Full Size**: Botellas completas en su presentaci√≥n original (ej. 100ml, 120ml).\nEjemplos clave: 9 PM, Hawas Ice, Khamrah, Asad, Creed Aventus.\n**Decants**: Perfumes originales trasvasados a presentaciones peque√±as de 5ml o 10ml. Son ideales para que el cliente pruebe la fragancia antes de comprar el frasco grande.\nEjemplos clave: YSL EDP, Club de Nuit Intense, Scandal.\n**Sets de Perfumes**: Estuches especiales que incluyen la fragancia principal y complementos (lociones, geles o miniaturas).\nEjemplos clave: Set Yara, Set 9pm, Set Art of Universe.\nNota Operativa: La tool informacion_perfumes es tu √∫nica fuente de verdad para nombres de productos. Si un cliente menciona un nombre que no est√° en la tool, verifica si existe un nombre similar por error ortogr√°fico antes de confirmar disponibilidad.\n# REGLAS DE ORO\n## **Regla de uso de la tool ‚Äúinformaci√≥n_perfumes‚Äù**.\nAl recibir el mensaje del cliente, SIEMPRE usa la tool ‚Äúinformacion_perfumes‚Äù antes de redactar la respuesta. Esta tool te devolver√° todos los productos que vende nuestra tienda ‚ÄúBrada Perfumes‚Äù los cuales est√°n divididos en tres categor√≠as: ‚ÄúPerfumes full size‚Äù, ‚ÄúDecants‚Äù y ‚Äúset de perfumes‚Äù\nRestricci√≥n de datos: Cabe aclarar que esta tool NO CONTIENE PRECIOS NI STOCK REAL. Su √∫nica funci√≥n es servir de gu√≠a de nomenclatura formal para identificar los productos que ofrecemos. \n## **Regla de ortograf√≠a**\nEsta regla rige c√≥mo Diego debe interpretar y responder a los mensajes con errores de escritura.\n* Inteligencia Sem√°ntica: Diego debe ignorar errores ortogr√°ficos, de puntuaci√≥n o de tildes del cliente para identificar la intenci√≥n real.\nMapeo Autom√°tico: Si el cliente escribe incorrectamente el nombre de un perfume (ej. \"habas ice\", \"9pm elicsir\", \"latifa asad\"), Diego debe asociarlo mentalmente con el producto correcto de la tool ‚ÄúInformacion_productos‚Äù sin pedir aclaraciones.\nNaturalidad en la Respuesta: Al responder, Diego debe escribir los nombres de los perfumes de forma correcta (seg√∫n la tool ‚ÄúInformacion_productos‚Äù) para mantener el profesionalismo, pero sin resaltar el error del cliente.\nEjemplo de Aplicaci√≥n:\n- Entrada del cliente: \"hola ermano presio del cnit untold\"\n- Acci√≥n de Diego: Identifica \"hermano\", \"precio\" y \"Club de Nuit Untold\".\n- Respuesta de Diego: \"Hola hermano, el Club de Nuit Untold s√≠ lo tenemos disponible. El precio es de S/...\"\n## **Regla de cierre variable**\nEsta regla evita que Diego suene como un robot de ventas insistente.\nFinalizaci√≥n Variable: No es obligatorio terminar cada mensaje con una pregunta. Diego debe evaluar si la conversaci√≥n requiere una pregunta para avanzar o si una afirmaci√≥n directa es m√°s natural seg√∫n el contexto.\nGu√≠a de Ejemplos: El agente debe seguir estrictamente la estructura de la secci√≥n \"EJEMPLOS DE CONVERSACI√ìN\" para identificar en qu√© fases se cierra con una pregunta y en cu√°les se cierra con una instrucci√≥n directa (ej. al pedir el comprobante o solicitar datos).\nCero Presi√≥n: Si el cliente muestra inter√©s general pero no intenci√≥n de compra, Diego debe responder de forma informativa y cerrar de manera amable sin presionar por una respuesta inmediata.\n## Regla de tiempo de entrega:\nEsta regla rige c√≥mo informar sobre la llegada del pedido utilizando la hora actual seg√∫n el input (current_date).\nPara Lima (env√≠o por motorizado): Si el pago se valida antes de las 10:00 am, el pedido llega el mismo d√≠a. De lo contrario, llega el d√≠a de ma√±ana.\nPara Provincia (env√≠o por la agencia Shalom): Si el pago se valida antes de las 4:00 pm, se entrega a la agencia el mismo d√≠a. El tiempo de viaje es de 2 a 5 d√≠as h√°biles.\nAplicaci√≥n: Responde siempre con seguridad seg√∫n la hora actual. No des rangos vagos si el cliente ya pas√≥ el l√≠mite de hora.\n## Regla de env√≠os\nPol√≠tica: Solo realizamos env√≠os a domicilio o agencia; no contamos con la opci√≥n de recojo en tienda f√≠sica.\nAplicaci√≥n: Si el cliente pregunta por una direcci√≥n f√≠sica para recoger su pedido, inf√≥rmele amablemente que operamos exclusivamente mediante env√≠os.\n## Regla de solicitudes presenciales\nAplica cuando el cliente desea visitar el local, ver los perfumes en persona o agendar una cita presencial.\nEjemplos de activaci√≥n: \"Quiero ir a ver los perfumes en persona\", \"Podemos programar una cita para ir de manera presencial con mi amigo\" o \"¬øD√≥nde est√°n ubicados para ir hoy?\".\nAcci√≥n: Utilice la tool pasar_supervisor.\nRespuesta obligatoria: \"Voy a comunicarme con mi compa√±ero para que te confirme el horario\".\n\n\n\n#FASES DE FLUJO DE FUNCIONAMIENTO\n## FASE 1: 1. SALUDO Y PROTOCOLO INICIAL\nEsta fase establece el primer contacto. El saludo se env√≠a una sola vez en toda la conversaci√≥n y no se solicita el nombre del cliente.\nL√≥gica de Inicio seg√∫n el mensaje del cliente:\nESCENARIO A: Mensaje gen√©rico o sin producto identificado Aplica cuando el cliente dice \"Hola\", \"Info\", \"Precios\", o env√≠a un mensaje que no menciona un producto de la Lista Maestra.\nAcci√≥n: Saludar de forma directa.\nRespuesta Obligatoria: \"Hola hermano, en qu√© perfume est√°s interesado?\".\nESCENARIO B: El cliente menciona un perfume o marca desde el inicio Aplica cuando el cliente consulta directamente por un producto (ej: \"precio del hawas\").\nAcci√≥n 1 : Asociar el t√©rmino con el nombre t√©cnico de la lista de ‚Äúperfumes_full_size‚Äù de la tool ‚Äúinformacion_productos‚Äù (ej: \"9pm\" ‚Üí \"9 PM\").\nAcci√≥n 2: Preparar el mensaje de saludo y luego pasa a la ‚ÄúFase 2:  2. IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)‚Äù\nEjemplo de respuesta: \"Hola hermano. (para responder sobre el perfume o sobre la intenci√≥n del cliente pasa a la fase 2)‚Äù.\n## FASE 2: IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)\nEsta fase es el n√∫cleo de la venta. Diego debe mapear el lenguaje del cliente a los productos reales y consultar la disponibilidad exacta.\nCASO A: Perfumes Full Size\nAplica cuando el cliente pide informaci√≥n, precio o disponibilidad de uno o varios perfumes de la lista.\nMapeo Sem√°ntico: Antes de usar la tool, asocia el nombre que diga el cliente con el nombre m√°s cercano de la Lista Maestra.\nUso de Tool: Activa stock_perfumes con el input: disponibilidad del perfume: [Nombre exacto].\nEl nombre del perfume env√≠alo entre comillas.\nEscenario 1: Consulta por un solo perfume\nAcci√≥n: Ejecuta ‚Äústock_perfumes‚Äù.\nLa tool devolver√° el nombre del perfume y con dos datos: \nstock: (si o no). \nStock = si : significa que est√° disponible el perfume\nStock = no : significa que esta agotado el perfume\nSi hay stock: Sigue el Ejemplo 1 de entrega de informaci√≥n.\nSi NO hay stock: La tool sugerir√° perfumes similares. Debes presentarlos de forma atractiva siguiendo el Ejemplo 2.\nEscenario 2: Consulta por m√∫ltiples perfumes\nAcci√≥n: Ejecuta la tool para todos los perfumes mencionados en un solo input: ‚Äúdisponibilidad de los perfumes: 1. [Nombre], 2. [Nombre]...‚Äù\nEnv√≠a cada nombre de los perfumes entre comillas.\nResultados Mixtos:\nSi hay de todos: Sigue el Ejemplo 3.\nSi falta alguno: Sigue el Ejemplo 4 (confirmas lo que hay y ofreces alternativas para lo que no).\nCASO B: Decants (Presentaciones de 5ml o 10ml)\nAplica cuando el cliente busca probar fragancias o indica cantidades peque√±as. Generalmente los clientes piden varios a la vez.\nEjemplos de Entrada del Cliente:\n‚Äúhawas 5ml, harana 10ml, asad 10ml y gos diamond 5ml‚Äù\n\"¬øTienes el 9pm en 5ml?\"\n\"Quiero probar el Hawas y el Asad en 10ml cada uno\".\n\"P√°same precio de decants de 5ml\". En este caso consultar sobre cual desea.\nIdentificaci√≥n: Si el cliente menciona \"5ml\", \"10ml\", \"peque√±o\" o \"para probar\", tr√°talo como Decant.\nUso de Tool: Activa ‚Äústock_decants‚Äù seg√∫n la cantidad de decants que solicita adquirir:\nSi es un solo decant, envia el input: ‚Äúdisponibilidad de decant: [Nombre del perfume] en [Cantidad].‚Äù\nSi es m√°s de un decant, env√≠a el input ‚Äúdisponibilidad de decants: [Nombre del perfume] en [Cantidad]. [Nombre del perfume] en [Cantidad]....‚Äù\nCASO C: Sets de Perfumes\nAplica cuando el cliente busca estuches de regalo o packs que incluyen complementos.\nEjemplo \nAcci√≥n: Revisa la secci√≥n \"Set de perfumes\" del Conocimiento General para validar si el nombre coincide con un set real.\nUso de Tool: Activa ‚Äústock_set_perfumes‚Äù con el input: disponibilidad del SET: [Nombre del Set].\nSi consulta sobre m√°s de un set, env√≠a el input: ‚Äúdisponibilidad del SET: [Nombre del Set]. disponibilidad del SET: [Nombre del Set].‚Äù\nNota: Si el cliente pregunta por un perfume y un set al mismo tiempo, consulta ambos en la misma ejecuci√≥n de la tool.\n## FASE 3: CONFIRMACI√ìN Y LOG√çSTICA DE ENV√çO\nEsta fase se activa cuando el cliente muestra una Intenci√≥n Real de Compra (ej. \"¬øC√≥mo pago?\", \"Lo quiero\", \"P√°same tu cuenta\") o despu√©s de que Diego presente la disponibilidad y precios.\n1. Generaci√≥n del Resumen\nDiego debe presentar un resumen estructurado basado en la secci√≥n #EJEMPLOS DE RESUMEN DE COMPRA.\nRegla de Oro: El total NO incluye el env√≠o todav√≠a. El env√≠o se suma en la Fase 4.\nPregunta de Cierre: Siempre debe terminar con la pregunta: \"¬øPara qu√© distrito o ciudad ser√≠a el env√≠o?\"\n2. Validaci√≥n de Ubicaci√≥n (Uso de Tool)\nUna vez que el cliente responde con un lugar, Diego debe ejecutar la tool distritos.\nL√≥gica de Clasificaci√≥n:\nCASO LIMA: Si el distrito indicado est√° en la lista de la tool distritos (Lima Metropolitana y Callao), se clasifica como Escenario A.\nCASO PROVINCIA: Si el lugar indicado NO est√° en la lista (ej. Piura, Cusco, Trujillo, o distritos de otras regiones), se clasifica autom√°ticamente como Escenario B.\n\n## FASE 4. M√âTODOS DE PAGO Y VALIDACI√ìN\nDiego presentar√° los m√©todos de pago bas√°ndose estrictamente en la ubicaci√≥n identificada. El costo de env√≠o es de S/12 en todos los casos.\nEscenario A: Lima Metropolitana (Distritos indicados)\nRegla: El cliente tiene la opci√≥n de pagar solo el env√≠o (S/12) por adelantado para confirmar, y el saldo del perfume lo cancela al recibirlo.\nMensaje: \"Para Lima puedes confirmar tu pedido pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Si prefieres, tambi√©n puedes pagar el monto total.\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante.‚Äù\nRegla de Flexibilidad: El cliente puede elegir pagar solo el env√≠o o el total.\nEscenario B: Provincia / Env√≠os por Shalom\nRegla: El pago debe realizarse por el monto completo (Perfume + S/12 de env√≠o) antes de despachar.\nMensaje: \"Para enviarte a provincia, el pago es por el monto total: son S/ [Precio del perfume] del perfume + S/ 12 del env√≠o por Shalom. En total ser√≠a S/ [Suma de ambos].\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante..‚Äù\nReglas Cr√≠ticas de Validaci√≥n:\nSolo Imagen: La compra √öNICAMENTE se valida mediante el input Imagen_analizada. No aceptes confirmaci√≥n por texto (\"ya pagu√©\") ni por audio.\nC√°lculo de Montos: * Si el cliente est√° en Lima y env√≠a un comprobante de S/ 12, Diego debe decir: \"Reserva de S/ 12 verificada. El saldo de S/ [Monto del Perfume] lo cancelas al recibir.\" y pasar a pedir datos.\nSi el cliente env√≠a el pago en partes (ej. dos capturas de Yape), Diego debe sumar ambos montos mentalmente. Solo cuando la suma sea igual al total acordado (o al menos a los S/ 12 en Lima), se da por validado.\n\n## FASE 5. SOLICITUD DE DATOS Y FINALIZACI√ìN\nTras validar el pago exitosamente seg√∫n el input ‚Äúimagen_analizada‚Äù, Diego solicita los datos para la confirmaci√≥n del env√≠o, seg√∫n el caso A o el caso B\nCASO A) Si el env√≠o es para los distritos permitidos de Lima Metropolitana.\n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Direcci√≥n exacta.‚Äù\n2) Validaci√≥n: Diego acepta cualquier formato de nombre y direcci√≥n que el cliente proporcione. No debe cuestionar la direcci√≥n, solo recopilarla.\n3) Utilizar tool: Una vez que tengas ambos datos utiliza la tool ‚Äúconfirmacion_pedido‚Äù y env√≠a las siguientes variables:\n‚ÄúNombre‚Äù\n‚ÄúDireccion exacta‚Äù\n‚Äúproductos‚Äù: el producto o los productos env√≠alos de esta forma: \"Producto 1: [Categor√≠a: Full Size/Decant/Set] [Nombre del Perfume] - [Precio] - [Cantidad]. (Repetir si hay m√°s productos)\".\n4) Confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: Tu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada\nCASO B) Si es de Provincia: \n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Apellidos\\n- DNI\\n- Ciudad/provincia\\n- Nombre de la agencia Shalom donde recoger√°‚Äù\n2) Validaci√≥n: Diego acepta los datos tal cual los env√≠e el cliente (no corregir DNI ni nombres). \n3) Utilizar tool: Una vez identificado todo los datos que solicitaste, utiliza la tool ‚Äúconfirmacion_pedido‚Äù con las siguientes variables:\n\n‚ÄúNombre‚Äù\n‚ÄúApellidos‚Äù\n‚ÄúDNI‚Äù\n‚ÄúCiudad/provincia‚Äù\n‚ÄúNombre_agencia_shalom‚Äù\n‚Äúproductos‚Äù: (Misma l√≥gica del CASO A: Categor√≠a, Nombre, Precio y Cantidad)\nNota: en este caso la variable ‚Äúdireccion_exacta‚Äù coloca ‚Äúnull‚Äù.\n4) confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: ‚ÄúTu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada.‚Äù\n\n###SECCI√ìN: EJEMPLO DE ENTREGA DE INFORMACI√ìN DE PERFUME\nEjemplo 1 (Un perfume con stock):\n\"El Hawas Ice s√≠ lo tengo en stock. El precio es de S/ 180. Es un perfume ultra fresco y potente, de los que m√°s piden.\"\nEjemplo 2 (Sin stock + Similares sugeridos):\n‚ÄúEl Valentino est√° agotado. Tengo estos que son de la misma vibra y huelen incre√≠ble:\\nJPG Le Male Elixir a S/ 450\\n\\nScandal Le Parfum a S/ 420 ¬øAlguna de esas opciones te llama la atenci√≥n?\"\nEjemplo 3 (M√∫ltiples perfumes con stock):\n\"Tengo los dos disponibles:\\n\\n9 PM a S/ 140\\nKhamrah Dukhan a S/ 175\"\nEjemplo 4 (Stock mixto):\n\"Hermano, te confirmo: el CDN Intense s√≠ lo tengo listo para enviar a S/ 190. El Azzaro lo tenemos sin stock. ¬øQu√© otro perfume te gustar√≠a?\nEjemplo 5 (Decants m√∫ltiples):\n\"Los tengo disponible:\\n\\n9pm Elixir (5ml): S/ 35\\nYara (10ml): S/ 45\\nKhamrah (5ml): S/ 40\\n\\n¬øTe armo el pack con estos tres o quieres chequear alguno m√°s?\"\n\n#EJEMPLOS DE RESUMEN DE COMPRA\n## EJEMPLOS SOLO PERFUMES FULL SIZE\n### Ejemplo 1: Si es solo un perfume\n\"Resumen de compra:\\n- Hawas Ice\\nüì¶ Cantidad: 1\\nüí∞ Precio unitario: S/ 180\\n\\nüíµ Total: S/ 180\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s perfumes Resumen de compra:\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah Dukhan\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 175\\n\\nüíµ Total: S/ 315\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS SOLO PERFUMES DECANTS\n### Ejemplo 1: Si es solo un decant Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- 9 PM Elixir (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 35\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Si son varios decants Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- Yara (10ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 45\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\nüíµ Total: S/ 125\\n\\n¬øMe indicas el distrito para continuar?\"\n## EJEMPLOS SOLO SET DE PERFUMES\n### Ejemplo 1: Si es solo un set Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 220\\n\\nüíµ Total: S/ 220\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s sets Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\n- GOS Set\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 240\\n\\nüíµ Total: S/ 450\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS DE PEDIDOS COMBINADOS\n### Ejemplo 1: Perfume Full Size + Decants\n\"Resumen de compra:\\n- Lattafa Asad\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 150\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Yara (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 225\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Compra Integral (Full Size + Decant + Set)\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\nüíµ Total: S/ 390\\n\\n¬øMe confirmas el distrito para avanzar con el pago?\" \n\n# EJEMPLOS DE FLUJO DE CONVERSACI√ìN CORRECTO\n## EJEMPLOS SI EL CLIENTE DESEA EL ENV√çO PARA LIMA\n1) Pago completo (Perfume + Env√≠o)\nCliente: Hola, quiero el Hawas Ice para Miraflores.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Hawas Ice s√≠ est√° disponible y cuesta S/180. ¬øDeseas agregar algo m√°s a tu compra?.\nCliente: No, solo eso. ¬øC√≥mo hago el pago?.\nDiego: Para Lima puedes confirmar pagando solo S/12 del env√≠o y el saldo al recibir, o pagar el monto total de S/192. Puedes yapear al 987108094 a nombre de Brandon Quelopana o por transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/192).\nDiego (Tras validar Imagen_analizada): Pago de S/192 verificado. P√°same tu nombre, celular y direcci√≥n exacta para programar el env√≠o. Como pagaste antes de las 10:00 am, llega hoy mismo.\n2) Pago parcial (Solo env√≠o S/12 + Saldo contra entrega)\nCliente: Precio del 9 PM. Estoy en San Borja.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El 9 PM cuesta S/140. ¬øQuieres agregar algo m√°s o solo ese?.\nCliente: Solo ese. Quiero pagar solo el env√≠o ahora.\nDiego: Entendido. Para Lima puedes confirmar pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Yapea al 987108094 (Brandon Quelopana) y me mandas la captura.\nCliente: (Env√≠a captura por S/12).\nDiego (Tras validar Imagen_analizada): Reserva de S/12 verificada. P√°same tu nombre, celular y direcci√≥n exacta. El saldo de S/140 lo pagas al recibir el producto.\n## EJEMPLO SI EL CLIENTE DESEA EL ENV√çO PARA PROVINCIA\n3) Pago total obligatorio para Provincia (V√≠a Shalom)\nCliente: Hola, precio de Asad para Piura.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Lattafa Asad cuesta S/150. ¬øDeseas agregar alg√∫n decant o solo el perfume?.\nCliente: Solo el perfume. ¬øCu√°l es el m√©todo?\nDiego: Para env√≠os a provincia el pago se realiza por el monto total de S/162, que incluye los S/12 de env√≠o por Shalom. Puedes pagar por Yape al 987108094 (Brandon Quelopana) o transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/162).\nDiego (Tras validar Imagen_analizada): Pago de S/162 verificado. P√°same tu nombre, apellidos, DNI, celular, ciudad y el nombre de la agencia Shalom donde lo recoger√°s. \n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-5136,288],"id":"87ad49a4-0b30-4cf2-bd78-475265d05fe3","name":"AI Agent"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","typeVersion":1,"position":[-3472,528],"id":"0af2d781-c62f-4cfa-8636-6576d2801773","name":"Auto-fixing Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3504,704],"id":"0be267ba-446a-4cd1-8c35-ea2e696d7e8b","name":"OpenAI Chat Model8","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"response\": {\n    \"parte_uno\": \"Texto correspondiente a la primera parte de la respuesta.\",\n    \"parte_dos\": \"Texto correspondiente a la segunda parte de la respuesta.\",\n    \"parte_tres\": \"Texto correspondiente a la tercera parte de la respuesta (opcional).\",\n    \"parte_cuatro\": \"Texto correspondiente a la cuarta parte de la respuesta (opcional).\",\n    \"imagen_uno\": \"Imagen correspondiente\",\n    \"imagen_dos\": \"Imagen correspondiente (opcional).\",\n    \"video_mp4\": \"Video .mp4 (opcional)\"\n}\n  }"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-3328,704],"id":"05f11a4e-1bcc-4829-a163-8b4e3e1f1534","name":"Structured Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3744,624],"id":"f2dd9e17-523b-4e58-9b8e-5f00f8fa704f","name":"OpenAI Chat Model9","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"={{ $json.output }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Obtener el texto de entrada:\n\nRecupera el texto de la variable items\n{{ $json.output }}\nLimpieza y normalizaci√≥n del texto:\n\nCrea una funci√≥n que limpie el texto eliminando los siguientes caracteres: ¬ø, ¬°, @, \", *, #.\n\nElimina los espacios en blanco al inicio y al final del texto.\nNo Elimines los emojis, ni los markdown para que los mensajes esten limpios.\nDivisi√≥n del texto en partes:\n\nImplementa una funci√≥n que divida el texto limpio en fragmentos de m√°ximo 800 caracteres sin cortar palabras. Si necesitas cortar uno de los fragementos del mensaje antes de 800 Caracteres para que no se corten mensajes hazlo. Los mensajes deben quedar completo y coherentes\nLa funci√≥n debe asegurarse de que cada fragmento se corte en espacios para no dividir palabras a la mitad.\nSi tienes que aumentar la cantidad de caracteres para que parte del mensaje no quede cortado o quede mal puedes hacerlo sin un limite de caracteres. Esto para que los mensajes sean mas organicos y funcionen bien. Tambien al identificar una imagen necesito que el link lo separes para que se mande separado.\n\n*SIEMPRE* que haiga un Link del video de youtube del tratamiento o presentaci√≥n, mandalo como parte del texto con su contexto, *NUNCA* lo pongas en la parte de imagen uno y dos.\n\n*NUNCA* pongas el link del video.mp4 en las partes de texto e imagen, *SIEMPRE* si es que tienes algun video con .mp4 ponlo en video_mp4.\n\nDeber√°s de enviarlo siempre a la √∫ltima parte pero solo eso.\nConstrucci√≥n de la respuesta:\n\nCrea un objeto JSON con la siguiente estructura:\n\n{\n  \"response\": {\n    \"parte_uno\": \"<primer fragmento>\",\n    \"parte_dos\": \"<segundo fragmento>\",\n    \"parte_tres\": \"<tercer fragmento>\",\n    \"parte_cuatro\": \"<cuarto fragmento>\",\n    \"imagen_uno\": \"<primera imagen>\",\n    \"imagen_dos\": \"<segunda imagen>\",\n    \"video_mp4\": \"<video.mp4>\"\n\n  }\n\n- Si hay un emoji como un check o algo por el estilo que desmuestre un enlistado, opciones o variantes similares, dale salto de linea para que parezca natural, recuerda reemplazar el \"\\n\" por un enter.\n\nSi alguna parte no existe, asigna una cadena vac√≠a (\"\").\n\n\n### Notas \n\n- Nunca debes hacer saltos de linea que no sean naturales evita si en algun momento un mensaje tiene un \":\" que el mensaje que le siga este en la otra parte del mensaje. debe ser lo mas natural posible.\n\n- S√≠ el texto tiene un saludo de bienvenida o algo parecido, *SIEMPRE* separalo en una parte y las siguientes partes separalos de tal forma que se vea ordenada y estructuradas tus respuestas.\n- En caso veas una palabra en asteriscos, ejemplo: **Botox:** deber√°s de quitarle los dos de los extremos y deber√° de quedar as√≠ *Botox:*.\n- *NUNCA* deber√°s de cortar el contexto del mensaje, quiero decir que si ves que el mensaje trata de un tema en espec√≠fico o seccion no deber√°s de cortarlo.\n\nEs Obligatorio reemplazarlo, no eliminarlo. NUNCA DEJAR NINGUNA PARTE VAC√çA OBLIGATORIAMENTE.\n\n- *SIEMPRE* REEMPLAZA \"\\n\" por un salto de linea normal (enter) ejemplo:\n{\n  \"response\": {\n    - opcion 1\n    - opcion 2\n    - opcion 3  \n  }\n}\n\n- *SIEMPRE* y cuando te lleguen dos links de Video.mp4, agarra el primero y no pongas los 2 juntos, si es posible, elimina uno para que solo quede uno.\n\n- *regla adicional* cuando llegue un link que est√© en .jgp .jpeg y .PNG a√±adelo a la parte de imagen, y si est√° en .mp4 a√±adelo al apartado de video "}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-3600,256],"id":"7ca03140-46dd-4d3c-a332-e3ee2072ded6","name":"Verificador1","onError":"continueErrorOutput"},{"parameters":{"httpMethod":"POST","path":"BRADA","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-15296,608],"id":"dbcc07c3-6246-4bdb-878b-af891629f8c8","name":"Webhook","webhookId":"fb43e7b4-c71f-4cad-bebd-32a81374fc49"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n","tableName":"healup","contextWindowLength":12},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-5200,48],"id":"39798e20-26eb-4032-ae59-7f5d5b5f7d8b","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"NzQUFXQpp2MvRekP","name":"CUENTA ALEGRATED"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8fa70db3-09c3-4e87-8fc9-4052751fad3f","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9840,512],"id":"d53b946f-7849-4a0c-91b8-673d822caa58","name":"If2","alwaysOutputData":false,"retryOnFail":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"576350e5-ed67-4ce9-815e-0f0a0ef0b1c7","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9616,688],"id":"3d169320-db83-4f3e-b8ec-cf4189ac8d7a","name":"If3"},{"parameters":{"assignments":{"assignments":[{"id":"1aa91b6d-c441-4496-beee-4af2457332ac","name":"pasar_supervisor","value":"={{ $json.pasar_supervisor }}","type":"string"},{"id":"34e35c66-589c-4146-ab9c-3d08b024a7c1","name":"n√∫mero","value":"={{ $json.numero }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-9984,512],"id":"e5878ba6-1987-4774-811f-c2cee034cb0a","name":"Edit Fields4"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-9184,992],"id":"02219ac8-19fd-463b-b35f-8880e0676c67","name":"No Operation, do nothing4"},{"parameters":{"name":"pasar_supervisor","description":"Llama esta herramienta cuando desees pasar a supervisor.","workflowId":{"__rl":true,"value":"2lPoYs00jPGwaBxq","mode":"list","cachedResultUrl":"/workflow/2lPoYs00jPGwaBxq","cachedResultName":"Supervisor Solari"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('Edit Fields20').item.json.id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-7248,464],"id":"b5e6fa52-fde1-4c70-b3ba-07a042587076","name":"Supervisor2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"98601c0c-949c-4f3d-99f2-40305665d58a","leftValue":"={{ $json.numero }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-10704,576],"id":"40fc0c0b-0829-40fc-81d5-3da1f46a7a9b","name":"If13"},{"parameters":{"name":"=Agendar","description":"=Agendar citas ","source":"=database","workflowId":{"__rl":true,"value":"konppOdwditJvoJQ","mode":"list","cachedResultUrl":"/workflow/konppOdwditJvoJQ","cachedResultName":"agendarSUNAT WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre_completo":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre_completo', ``, 'string') }}","DNI":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('DNI', ``, 'string') }}","numerotelefono":"={{ $json.id }}","inicio_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('inicio_cita', ``, 'string') }}","fin_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fin_cita', ``, 'string') }}","tratamiento(s)":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('tratamiento_s_', `Coloca el tratamiento que se haya mencionado durante la conversaci√≥n, seg√∫n esta lista de tratamientos:\n\n- Lipopapada & Afinamiento Facial Enzim√°tico\n- Natural Lips\n- Bratz Lips\n- Perfilamiento de nariz\n- Rinomodelaci√≥n completa\n- Exosomas + Esperma de Salm√≥n\n- Proyecci√≥n de Ment√≥n con √Åcido Hialur√≥nico\n- Baby Botox\n- Botox Full Face\n- Marcaci√≥n mandibular\n- Masseter Botox\n- Surcos Nasogenianos\n- Sustentaci√≥n pomular\n- √Åcido Hialur√≥nico para ojeras\n- NCTF\n- Hidralips con Dermapen\n- Plasma Rico en Plaquetas (PRP)\n- Armonizaci√≥n Facial \n\n- Glass Skin Babe\n- CalmBabe\n- Pure Babe Skin\n- Heal Up Babe Ritual\n- Prime Skin Clean\n- Eternal Glow Boost\n- Prestige Glow Ritual\n- Heal Up Signature Glow\n\n- Lipo Start Protocol\n- Lipo Sculpt Protocol\n- Lipo Intensive Shape Protocol\n- Heal Up Lipo 360‚Äù.\n\nNota: Si el paciente consult√≥ sobre m√°s de 1 tratamiento, a√±adelo con una coma. por ejemplo: Rinomodelaci√≥n completa, Baby Botox.\n`, 'string') }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","red_social":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('red_social', `Coloca esta palabra: WhatsApp`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"nombre_completo","displayName":"nombre_completo","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"inicio_cita","displayName":"inicio_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"fin_cita","displayName":"fin_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"numerotelefono","displayName":"numerotelefono","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"DNI","displayName":"DNI","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"red_social","displayName":"red_social","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"tratamiento(s)","displayName":"tratamiento(s)","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-5504,784],"id":"5334487f-6a0c-48f2-8833-2cece4f6c66e","name":"Calendario"},{"parameters":{"tableId":"pasar_supervisor_BRADA","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"},{"fieldId":"conversation_id","fieldValue":"={{ $('If12').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10480,832],"id":"6da92ad7-7496-46b2-ad7a-af1302bdca1b","name":"Create a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10192,512],"id":"e01e05d9-2c86-4f10-8067-8d296b347400","name":"Get a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9536,416],"id":"08f4c79d-67de-4997-8b28-3d94436c885c","name":"Update a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10960,592],"id":"0383d00f-4ae0-4f14-850a-4ee2703bbc58","name":"Get a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2acc3e64-d51a-4e98-84a5-e2b17c788fa2","leftValue":"={{ $('Webhook').item.json.body.payload.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7312,592],"id":"645bde3e-f301-4b37-a037-b78f2c234bab","name":"If4"},{"parameters":{"operation":"formatDate","date":"={{ $json.currentDate }}","format":"custom","customFormat":"DDDD tt","options":{"timezone":true}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-6896,576],"id":"c0cfb4f3-987c-429b-9a57-9f8b58dd70a2","name":"Formatea fecha"},{"parameters":{"assignments":{"assignments":[{"id":"d78c89a3-c878-48b7-aa84-4b2674c0667b","name":"data.remoteJid","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation.contact_inbox.source_id }}","type":"string"},{"id":"432a9602-e38b-4880-a64d-b832d120edda","name":"data.id","value":"={{ $('Webhook').item.json.body.id }}","type":"string"},{"id":"d2f45efc-03ac-4c74-b70e-959b06cd2a0b","name":"data.text","value":"={{ $('Edit Fields17').item.json.mensajetexto }}{{ $('Edit Fields17').item.json.mensajeaudio }}{{ $('Edit Fields17').item.json.mensajeimagen }}","type":"string"},{"id":"d77208a8-161b-4ef3-96fa-261a87cf1f39","name":"conversation_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","type":"string"},{"id":"8c279598-20f0-4012-a4ee-8c7898ceaba4","name":"account_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].account_id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6448,576],"id":"e0ece9a2-acd1-450f-9e2f-a45df7d9021e","name":"Handler variables"},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-7072,576],"id":"34435b05-c9a2-4759-b275-a239d12bbcb1","name":"Fecha"},{"parameters":{"jsCode":"// 1. Obtener la fecha de entrada\nconst inputDateString = $input.item.json.formattedDate; \nconst date = new Date(inputDateString);\n\n// 2. Obtener hora actual para la l√≥gica\nconst currentHour = date.getHours();\n\n// Clonamos la fecha para calcular el env√≠o\nlet scheduledDate = new Date(date);\n\n// 3. L√≥gica de Negocio (Reglas de horario)\nif (currentHour >= 19 || currentHour < 5) {\n  // Caso Nocturno (19:00 - 04:59): Programar para las 09:00 AM\n  scheduledDate.setHours(9, 0, 0, 0);\n  \n  // Si es >= 19:00, pasa al d√≠a siguiente.\n  if (currentHour >= 19) {\n    scheduledDate.setDate(scheduledDate.getDate() + 1);\n  }\n} else {\n  // Caso Diurno (05:00 - 18:59): Sumar 4 horas\n  scheduledDate.setHours(scheduledDate.getHours() + 4);\n  // Reiniciamos minutos y segundos a 0 para mantener limpieza (opcional, pero recomendado)\n  scheduledDate.setMinutes(0);\n  scheduledDate.setSeconds(0);\n}\n\n// 4. FORMATEO DE SALIDA \"dd/mm/yyyy HH\"\n// Usamos .padStart(2, '0') para asegurar dos d√≠gitos (09, 05, etc.)\n\nconst day = scheduledDate.getDate().toString().padStart(2, '0');\nconst month = (scheduledDate.getMonth() + 1).toString().padStart(2, '0');\nconst year = scheduledDate.getFullYear();\nconst hourFormatted = scheduledDate.getHours().toString().padStart(2, '0');\n\n// CONSTRUCCI√ìN FINAL: dd/mm/yyyy HH\n// Nota: Eliminamos los minutos (:${minuteFormatted}) de esta l√≠nea\nconst fecha_final = `${day}/${month}/${year} ${hourFormatted}`;\n\nreturn {\n  json: {\n    original_input: inputDateString,\n    // Variable solicitada con el formato exacto\n    fecha_lora_formateada: fecha_final,\n    // Variable extra por si necesitas solo la hora aislada\n    solo_hora: hourFormatted\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6640,576],"id":"7235933b-bf69-4698-9133-cfe47b370ffc","name":"Code2"},{"parameters":{"amount":30},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-7312,1072],"id":"6e3e7abf-d38f-40b1-b0c4-a8e166fc036c","name":"Wait6","webhookId":"5696ca8f-19ae-4cd6-8008-6132ce1cf272"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8a313a41-eadc-4ada-bc2a-feff79845de9","leftValue":"={{ $json.mensajes[0] }}","rightValue":"={{ $('Handler variables').item.json.data.text }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6864,1296],"id":"76729177-6c0d-4ec2-bf0a-0604e5bbf8a9","name":"If6"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-6544,1376],"id":"2c667d72-3de1-4d9e-bff9-88ce886f1c91","name":"No Operation, do nothing1"},{"parameters":{"operation":"delete","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6240,1024],"id":"31c060d8-e6c1-489f-924b-36ee33dce137","name":"Delete Redis","executeOnce":false,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $('Get Redis1').item.json.mensajes.join() }} y el lead viene de un anuncio : {{ $('RESUMIDOR ANUNCIOS').item.json.output }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Wait6').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.payload._data.Info.PushName }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6352,832],"id":"fa0d6541-f1f5-42a3-918d-072dec78f8be","name":"Edit Fields19","alwaysOutputData":true},{"parameters":{"operation":"get","propertyName":"mensajes","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","keyType":"list","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6960,1088],"id":"eb2e5436-c84c-4660-a049-366ff67222ee","name":"Get Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $json.anuncio }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Handler variables').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.conversation.messages[0].sender.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6368,992],"id":"a0199bbc-432c-4d05-a271-0c734eec08cd","name":"Edit Fields20","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3e8a5a20-c60c-48ef-a636-2b5e14a683a8","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6608,944],"id":"61e1b52d-148e-41fd-9b0b-7e4895ad7a0a","name":"If15"},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1136],"id":"edcdff4c-5e82-4bfe-8beb-45b771f8bed2","name":"METER_ANUNCIO","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1296],"id":"666f3eb7-d307-4a99-abd7-1f526c0907fd","name":"BAJAR_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}_ad","messageData":"={{ $('RESUMIDOR ANUNCIOS').item.json.output }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8064,1136],"id":"5a5ab926-f0b0-420f-ad66-6f99a6d9eb9f","name":"guarda_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3deed863-79f3-42e5-a32c-6cb7bb1028df","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7616,512],"id":"46ecb883-24f2-490a-a44c-a9e6dd7a5ab2","name":"If"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-7488,32],"id":"76495bc9-2132-42c6-8f98-7f222fbc58ab","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"8f567177-8b37-4a09-9a53-ac9fe424c843","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6240,576],"id":"49f7d2d6-bf9c-4b3f-bde9-d5b04db1203a","name":"If10"},{"parameters":{"operation":"get","propertyName":"anuncio","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6752,944],"id":"16a19e11-3a97-49d7-b868-7b84b7799dc7","name":"Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-6928,272],"id":"31f4a897-b5fc-4baa-a8ac-c4645d7e6b10","name":"Update a row4","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"Describe esta imagen\n","imageUrls":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].data_url }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8864,560],"id":"655bda6d-6ab1-42a8-85c1-736575210b9b","name":"OpenAI","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"437f223f-80c7-4c47-a50b-9d17a8614251","name":"imagen_caption","value":"={{ $json.content }} .\nEl captions del mensaje de imagen es: {{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8448,688],"id":"fa56722a-8385-4847-b719-f90a132dfbd1","name":"Edit Fields12"},{"parameters":{"url":"={{ $('Webhook').item.json.body.attachments[0].data_url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-8896,368],"id":"f1138959-5c6f-4058-a15b-6e56bdaab777","name":"HTTP Request"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"27bcc104-31e3-4687-b60b-a018c457a3a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"audio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2e8b532f-1f01-45f9-a647-e7a5c9e48aac","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"image","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Imagen"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"59f6b23a-3029-4225-8f9e-3744611a04a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"=text","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"28de146f-c104-4171-924a-29963c4f1970","leftValue":"={{ $('Webhook').item.json.body.content_type }}","rightValue":"text","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-9216,416],"id":"b138e8be-c1d3-4f8a-8423-93fb52834ba7","name":"Switch3"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8624,368],"id":"f26677a7-27a0-43ed-8071-3e3064e25db4","name":"AUDIO1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"276cbb8a-79f2-4f08-b24a-632f474c6013","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-8624,560],"id":"f29adecc-e9d9-4222-9ec3-107cac681c09","name":"If16"},{"parameters":{"assignments":{"assignments":[{"id":"c0a1b2f0-373e-4b86-ae91-25346b20b404","name":"mensajetexto","value":"=Texto mensaje: [{{ $('Webhook').item.json.body.conversation.messages[0].content }}]  ","type":"string"},{"id":"35cd9184-e37e-4d03-9dff-efb319dce478","name":"mensajeaudio","value":"={{ $json.text }}","type":"string"},{"id":"47e9bfe8-2c55-4b5d-b047-024871fc6c21","name":"mensajeimagen","value":"=Imagen analizada: [{{ $json.content }}{{ $json.imagen_caption }}]","type":"string"},{"id":"9926d346-600f-45af-adad-876e9f40ffa4","name":"imagenanalizada","value":"=Imagen de anuncio analizado: {{ $json.content }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8064,480],"id":"8a1f15fa-bf4b-4c01-adbb-7a1a21d7a706","name":"Edit Fields17","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $('Webhook').item.json.body.payload.body }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7120,400],"id":"7ab44ba1-258f-4193-929d-15aa68334a0f","name":"If11"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f05066b5-5a07-41fa-96b7-7a244e7345c8","leftValue":"={{ $json.body.payload.fromMe }}\n","rightValue":"true","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12384,608],"id":"d94743f2-3b7b-460b-bc26-33eae6240210","name":"If12"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $json.body.conversation.messages[0].content }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12224,752],"id":"23a75e86-d3fd-4b05-8d58-aa9da67a47d8","name":"If20"},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-12144,1008],"id":"a93457ed-fd5d-4186-b320-c1a49417136c","name":"Update a row6","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"name":"informacion","description":"utiliza esta tool cuando se necesite informaci√≥n seg√∫n las indicaciones del prompt principal.","workflowId":{"__rl":true,"value":"FB7us6cBaq7jWqB2","mode":"list","cachedResultUrl":"/workflow/FB7us6cBaq7jWqB2","cachedResultName":"informacion HEAL UP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}"},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-6080,784],"id":"e0e915c5-fd08-4168-be41-783aa4ce1390","name":"informacion_tratamientos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"987d5d07-58eb-4927-8e68-a137884b8100","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].message_type }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13248,608],"id":"5e339c78-27b7-41de-8774-f34bd2e49752","name":"If1"},{"parameters":{"jsCode":"// Tomamos todos los items que vienen del nodo anterior (Verificador1)\nconst items = $input.all();\n\nfor (const item of items) {\n  // Aqu√≠ est√° tu objeto con parte_uno, parte_dos, etc.\n  // Verifica la ruta: output.response\n  const resp = item.json.output?.response || {};\n\n  // Orden que quieres respetar\n  const orderedKeys = [\n    'parte_uno',\n    'parte_dos',\n    'parte_tres',\n    'parte_cuatro',\n    'imagen_uno',\n    'imagen_dos',\n    'video_mp4',\n  ];\n\n  // Armamos un nuevo objeto response en el orden deseado\n  const newResponse = {};\n  for (const key of orderedKeys) {\n    if (resp[key]) {\n      newResponse[key] = resp[key];\n    }\n  }\n\n  // Sobrescribimos manteniendo la estructura original\n  if (!item.json.output) item.json.output = {};\n  item.json.output.response = newResponse;\n}\n\n// Devolvemos los items modificados\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2752,352],"id":"24f0ff65-46ee-441c-a6d4-8f9095be5ae0","name":"ordenar"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $json.output.response.parte_uno ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2720,1088],"id":"88a82162-8ee2-4a01-8f95-a7350bae11d1","name":"Respuesta1","executeOnce":false},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1776,832],"id":"cce742aa-91d4-4fd6-971b-02494cc4941d","name":"Wait2","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_dos ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1600,928],"id":"6c953a90-8ee3-40d6-b6fd-f29c2e766496","name":"Respuesta2","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1312,848],"id":"0a8bc622-6c9b-472d-8735-328b027264ff","name":"If14"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1120,832],"id":"568f10ce-4d13-4754-843d-d05277b38f48","name":"Wait3","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_tres ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-912,896],"id":"3cb7de22-5651-4c25-b9eb-6132643c3bbe","name":"Respuesta3","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-496,752],"id":"af5809e5-112a-4632-aeaf-44bd7061fd9e","name":"If17"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-480,976],"id":"d9d3f88f-ef89-458a-8d83-ad4661e1b4e6","name":"Wait4","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=hcy6n6RAJTBAAYguVuewgp2A"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_cuatro ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-256,1008],"id":"319a272b-7a67-4de3-bcc3-381f609226df","name":"Respuesta4","executeOnce":false},{"parameters":{"promptType":"define","text":"=Te va a llegar esta descripcion de un anuncio: {{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","options":{"systemMessage":"ROL:\nTu rol es indicar el mismo input que te llega y enviarlo como output."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-7504,192],"id":"7dd13519-eebb-4cd8-9fbe-870c4eb2ea0b","name":"RESUMIDOR ANUNCIOS"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1a9dd789-5c10-4489-a344-6b7a0fd041ea","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51902215511","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"912d0724-5ef1-4f88-9d43-acbb38f48cee","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51993708540","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"e50ad623-45f5-4af7-bc5a-89708016ddf8","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51972619000","operator":{"type":"string","operation":"equals"}},{"id":"9ffd5afb-ec0c-49fc-a144-b682386c760c","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51960239280","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"50ddfe27-4e13-4e3c-8216-aca1f181f77a","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51936196001","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"7650a20c-4ba9-4e41-bd67-89e8f77278fc","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"14502413970","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"bdfe444d-b4d9-4789-971d-08420999d775","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51945157250","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"5f1e9684-e18d-4a9f-aad7-bef2235f631d","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51971119678","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13888,864],"id":"fc9e995e-943d-4cce-8e72-ee42d86cee6c","name":"If18"},{"parameters":{"description":"usa la tool supervisor seg√∫n el prompt principal","workflowId":{"__rl":true,"value":"xchwhR053ynGsZI4","mode":"list","cachedResultUrl":"/workflow/xchwhR053ynGsZI4","cachedResultName":"SUP SUNAT"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $json.id }}","conversation_id":"={{ $('If7').item.json.conversation_id }}","inbox_id":"={{ $('If12').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5616,832],"id":"5e99594b-abaa-47fe-872d-198f951381e9","name":"Supervisor"},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje1","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_uno }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"},{"fieldId":"account id","fieldValue":"={{ $('Webhook').item.json.body.account.id }}"},{"fieldId":"conversation id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2544,1088],"id":"476c18e7-85f6-493d-b3aa-14cfdf31bcc3","name":"Update a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje2","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1472,944],"id":"d7b09d89-120c-41de-af99-2ac3e43b9c64","name":"Update a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje3","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-720,896],"id":"87f26d37-d4e6-4022-b8e7-d0be58f20d22","name":"Update a row5","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"seguimiento_healup","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-15088,608],"id":"f952306b-6aab-4f21-ba58-cdd5dcebe32c","name":"Get a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}},"disabled":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"60e8198a-90ea-44a7-8f27-6e37021a1a02","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje1 }}","operator":{"type":"string","operation":"equals"}},{"id":"4541b27d-6dfa-47d7-bbff-d1a5c2e6ffd1","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje2 }}","operator":{"type":"string","operation":"equals"}},{"id":"20ce2efd-2509-40d0-b670-2c484246fa28","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje3 }}","operator":{"type":"string","operation":"equals"}},{"id":"b74b14df-879c-4427-8888-d7e1e3212ddc","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje4 }}","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-14880,608],"id":"5c2a2d65-e6b0-4eff-8611-1286cc5f3519","name":"If19","alwaysOutputData":true,"disabled":true},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje4","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[0,1008],"id":"3bfbc342-a045-4fb3-b813-77c25a76e4fd","name":"Update a row7","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"daeff2da-d88d-4aa7-b4d9-8b808c58b7c8","leftValue":"={{ $json.conversation_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7664,1824],"id":"4456591c-6e0e-41e1-8fe3-d6b190cf5b8a","name":"If7"},{"parameters":{"operation":"get","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","keyValue":"={{ $('Get a row3').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7920,1520],"id":"7eb28718-e96b-48aa-aaa6-9595b57209be","name":"Get a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"BRADA_followups","fieldsUi":{"fieldValues":[{"fieldId":"conversation_id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7232,1664],"id":"032dfeeb-7358-4670-bfc8-e64deb12607b","name":"Create a row1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"model":"gpt-5.1","options":{"reasoningEffort":"low"}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5440,496],"id":"ff0bf49f-19d4-4e02-92fc-84ddcb1a06e5","name":"RAZONADOR PLUS","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7536,1424],"id":"456e5e75-da23-4eaf-b219-2d0e6a4c9772","name":"Update a row9","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"pasar_supervisor_healup","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9872,1184],"id":"22e69871-698c-451d-97be-e15985b9f1ca","name":"Create a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"method":"POST","url":"=https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": \"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg\",\n  \"message_type\": \"outgoing\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3152,1440],"id":"1e6becc0-86ad-4636-968f-82b82ce1d008","name":"Respuesta6","executeOnce":false},{"parameters":{"url":"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3648,1424],"id":"c91882f6-4156-4928-83f4-db575130f873"},{"parameters":{"method":"POST","url":"https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content","value":"Aqu√≠ tienes la imagen adjunta üëá"}]},"options":{}},"name":"2. Enviar a Chatwoot","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3440,1408],"id":"bb8131d9-ee4a-4ce7-bfcd-6484ee58e6e9"},{"parameters":{"content":"## EJEMPLO IMAGENES\n","height":320,"width":560},"type":"n8n-nodes-base.stickyNote","position":[-3744,1328],"typeVersion":1,"id":"14ea41f0-1e70-47f8-ad8d-cad36bd5ba28","name":"Sticky Note"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2352,1056],"id":"da693219-5a37-4d6b-b186-6b04eb3a09a2","name":"If8"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1184,1440],"id":"00fb4ecc-2c2b-43c7-a5b0-3bc928404b03","name":"If23"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-976,1424],"id":"b350fa31-345e-420d-9213-4ccd1c603f30","name":"If26"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-624,1840],"id":"4b2323d7-ade6-4594-9192-1b4e2251a93b","name":"If27"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1248,1392],"typeVersion":1,"id":"ffa9ce31-0ae1-4e74-af8a-05d40968ab54","name":"Sticky Note2"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-752,1440],"id":"84b7f3b1-5259-47e9-976f-6a01df9ed583","name":"Wait","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-176,1648],"id":"acf88893-aecd-41e2-8a76-6b13efecaf2c","name":"If40"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[192,1856],"id":"324684bf-472a-4b17-a5fc-3b12d1f0e647","name":"If42"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1648],"id":"9da856cd-4d80-4b0d-84b5-9d412e3a3420","name":"Wait5","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1856],"id":"918310b1-c0da-46c2-80cf-8343bacd20a5","name":"Wait7","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[400,1872],"id":"30392c9c-d8a1-4a3a-8173-0ef149b4dadb","name":"Wait8","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-976,1600],"id":"3270bad6-15d8-4f71-a811-c3359fdab4e3","name":"Wait9","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[32,1664],"id":"e5ada578-5738-42b2-98f2-9c73991a85e8","name":"Wait10","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-608,1600],"id":"f693b423-1013-4d25-a66c-54422bfde206"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-2","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-784,1600],"id":"f2f64f92-df6b-4114-863d-2f5463a5bff7"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[0,1856],"id":"15cd3fea-5316-48c1-87b3-10b8b49c2919"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-3","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-176,1856],"id":"97e4385e-224d-4e1b-814b-55d7358b7f8e"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot34","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[720,1872],"id":"d96e4430-aea9-4374-b39b-75bec4c5b6dc"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-4","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[544,1872],"id":"d9dc6055-97c0-4412-8284-39dd78540a56"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot35","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[368,1664],"id":"e7946bf5-eb93-47a1-8f0a-788003fd3e1d"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-5","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[192,1664],"id":"b835a15f-edb3-45a2-b27b-a2905ade226f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot36","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-416,1440],"id":"97aa4aac-4a3b-4632-a2eb-32fe5486d166"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-6","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-592,1440],"id":"dd6f4397-190c-4511-84ba-a4ddb75136be"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":3},"conditions":[{"id":"b2a6d2d7-c61b-43ef-99fe-cc95d8413e94","leftValue":"={{ $json.body.conversation.messages[0].sender.phone_number }}","rightValue":51971119678,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-14480,592],"id":"65ea26bb-db5c-45f1-a288-c16501032d3c","name":"If5"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-14240,368],"id":"3b9693a6-6e3f-4174-9556-ba7477824248","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', ``, 'string') }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-13856,272],"id":"ff60e952-557a-4961-b575-24caf1329c1f","name":"pasar_supervisor","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $json.body.content }}\n\n","options":{"systemMessage":"=# üéØ ROL\nEres el Agente **Aura**. Tu √∫nica funci√≥n es extraer, **normalizar** y enviar un n√∫mero de tel√©fono a la tool \"pasar_supervisor\" El n√∫mero puede ser nacional (Per√∫) o extranjero, y debes procesarlo seg√∫n las reglas para que la tool reciba solo d√≠gitos.\n\n# üì• INPUT (Solicitud de Recepcionista)\nRecibir√°s una solicitud de la recepcionista para transferir un paciente.\nEl patr√≥n de la solicitud ser√° similar a: **Pasar a supervisor el n√∫mero: [N√∫mero variable]**\nEl n√∫mero puede llegar en formato completo (`519...`), solo el n√∫mero nacional (`9...`), o en formato internacional (`+1...`).\n\n# ‚öôÔ∏è INSTRUCCIONES ESTRICTAS (Funci√≥n sin Estado)\n\n1. Cada input es una solicitud √∫nica. Tu tarea finaliza con la ejecuci√≥n de la tool.\n\n2. **Identificaci√≥n:** Busca y extrae el n√∫mero que sigue inmediatamente al patr√≥n: **Pasar a supervisor el n√∫mero:** o **Manda a supervisor el n√∫mero**.\n\n3. **Normalizaci√≥n:** Antes de usar la tool, debes convertir el n√∫mero extra√≠do a un formato estandarizado de **solo d√≠gitos**, aplicando estas reglas en orden:\n    * **Limpieza:** Elimina todos los caracteres no num√©ricos (espacios, guiones, par√©ntesis, puntos, el signo `+`).\n    * **Normalizaci√≥n Per√∫ (9 d√≠gitos):** Si el n√∫mero tiene **9 d√≠gitos** y **no** comienza con `51`, asume que es un n√∫mero de Per√∫ y **precede** la cadena con `51`.\n    * **Normalizaci√≥n Internacional/Completo:** Si el n√∫mero comienza con `51` (11 d√≠gitos) o es cualquier otra longitud, √∫salo tal cual despu√©s de la limpieza.\n\n4. **Acci√≥n √önica:** Una vez extra√≠do y normalizado el n√∫mero, debes utilizar **exclusivamente** la tool **pasar_supervisor**.\n\n5. **Output:** Nunca respondas, expliques, ni devuelvas texto. Tu √∫nica acci√≥n es ejecutar la tool.\n\n### üìù EJEMPLO DE FLUJO DE TRABAJO\n\n| Input de la Recepcionista | L√≥gica de Normalizaci√≥n | Salida a la Tool |\n| :--- | :--- | :--- |\n| **Input 1 (Per√∫ Completo):** `Pasar a supervisor el n√∫mero: 51998765432` | N√∫mero original: `51998765432` (11 d√≠gitos). No requiere cambios. | `pasar_supervisor(51998765432)` |\n| **Input 2 (Internacional):** `Manda a supervisor el n√∫mero +1 (305) 417-1787` | Limpieza: `13054171787` (11 d√≠gitos). | `pasar_supervisor(13054171787)` |\n| **Input 3 (Per√∫ Corto):** `Manda a supervisor el n√∫mero 977571136` | 9 d√≠gitos. Se asume Per√∫. **Normaliza con 51**. | `pasar_supervisor(51977571136)` |\n\n## HERRAMIENTAS\n**Herramientas disponibles:** **pasar_supervisor**\n\n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-14256,192],"id":"ed307005-1e1d-4800-a494-8f1ee293347f","name":"supervisor"},{"parameters":{"workflowId":{"__rl":true,"value":"86itBT4QcMqbK21F","mode":"list","cachedResultUrl":"/workflow/86itBT4QcMqbK21F","cachedResultName":"[MANTENIMIENTO] Supwhatsapp"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('If19').item.json.body.conversation.messages[0].sender.phone_number }}","conversation_id":"={{ $('If19').item.json.body.conversation.messages[0].conversation_id }}","inbox_id":"={{ $('If19').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":[],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-14016,400],"id":"96b98de4-e095-42e3-83b8-8e9043aac552","name":"Call 'Supervisor healup'"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"Z1S8hBZOFvfBE7I5","mode":"list","cachedResultUrl":"/workflow/Z1S8hBZOFvfBE7I5","cachedResultName":"SUNAT | Enviar datos (General) | WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre', ``, 'string') }}","numero":"={{ $json.id }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},"matchingColumns":[],"schema":[{"id":"nombre","displayName":"nombre","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5664,752],"id":"39552a1a-a1b3-4538-a0c0-eefb20b529b8","name":"enviar_nombre"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    perfumes_full_size: [\n      \"9 pm\",\n      \"9 pm elixir\",\n      \"Aether extrait\",\n      \"Afeef Lattafa\",\n      \"Ajayeb Dubai\",\n      \"Ajwad pink to pink\",\n      \"Al Haramain Dubai Night\",\n      \"Al qiam golf\",\n      \"ALTHAIR PARFUMS de MARLY\",\n      \"Amber rouge\",\n      \"Amethyst\",\n      \"Amore caff√© Mancera\",\n      \"Aqua Dubai 100 ml\",\n      \"Art of nature II\",\n      \"Art of universe\",\n      \"Aruba gold\",\n      \"Atlas LATTAFA\",\n      \"Azzaro PARFUM\",\n      \"Azzaro the most wanted intense\",\n      \"Berry on top\",\n      \"Bharata chocolate\",\n      \"Bharata king EDP\",\n      \"Bharata king gold edition\",\n      \"Bharata Placid\",\n      \"BIANCO latte\",\n      \"CDN Intense man\",\n      \"CDN Sillage\",\n      \"CDN Urban Man Elixir\",\n      \"CDN woman\",\n      \"Champion goat\",\n      \"Champion money\",\n      \"Champion sugar\",\n      \"Chic Sonia\",\n      \"Choco overdose\",\n      \"Cloud Ariana grande\",\n      \"Club de nuit untold\",\n      \"Confidential\",\n      \"Cookie grave\",\n      \"Creed aventus\",\n      \"Creed millesime imperial\",\n      \"Creed silver mountain water\",\n      \"Decant\",\n      \"Diesel spirit\",\n      \"Eclaire\",\n      \"Eclaire banoffi\",\n      \"Eclaire pistache\",\n      \"EMEER\",\n      \"Erba gold\",\n      \"Erba pura\",\n      \"Fahkar Rose\",\n      \"Fakhar black\",\n      \"Fakhar gold\",\n      \"Fire on ice\",\n      \"GOS Blind bid\",\n      \"Gos bonus\",\n      \"GOS Boston\",\n      \"GOS Diamond\",\n      \"Gos Esmerald\",\n      \"GOS Full House\",\n      \"GOS Jackpot\",\n      \"GOS Moon\",\n      \"Gos no limit\",\n      \"GOS platinium\",\n      \"GOS Rouge\",\n      \"GOS Royale\",\n      \"GOS Wildcard\",\n      \"GOS Yellow Saphire\",\n      \"Haramain amber oud gold edition\",\n      \"HAWAS ice\",\n      \"Hawas malibu\",\n      \"Hayaati florence\",\n      \"Hayaati lataffa\",\n      \"Her confession\",\n      \"His Confession\",\n      \"Honor and glory\",\n      \"Invictus Parfum\",\n      \"INVICTUS VICTORY ELIXIR\",\n      \"Ishq al shuyukh silver\",\n      \"Island Khadlaj\",\n      \"Jean lowe azure\",\n      \"Jean lowe inmortel\",\n      \"JPG Le beau le parfum 120ml\",\n      \"JPG Le Male elixir 125ml\",\n      \"JPG LE MALE LE PARFUM\",\n      \"JPG Paradise Garden 125ml\",\n      \"Khamrah\",\n      \"Khamrah Dukhan\",\n      \"Kirk√© Tiziana Terenzi\",\n      \"Lataffa Ameer\",\n      \"Lattafa dynasty\",\n      \"LAYTON PARFUMS de MARLY\",\n      \"Mancera cedrat boise\",\n      \"Mancera coco vanille\",\n      \"Mancera Instant Crush\",\n      \"Mancera Red tobaco\",\n      \"Mandar√≠n elixir\",\n      \"Milestone\",\n      \"Montale Arabians Tonka\",\n      \"M√≥ntale intense caf√©\",\n      \"Nautica voyage\",\n      \"Naxos\",\n      \"Nitro Red\",\n      \"Nitro White\",\n      \"Noble blush\",\n      \"Now white\",\n      \"Now women\",\n      \"Odyssey artisto\",\n      \"Odyssey bahamas\",\n      \"Odyssey black forest\",\n      \"Odyssey Candee\",\n      \"Odyssey Eau de Montagne\",\n      \"Odyssey go mango\",\n      \"Odyssey Homme black EDP\",\n      \"Odyssey Homme white edition\",\n      \"Odyssey Limoni\",\n      \"Odyssey Mandarin sky\",\n      \"Odyssey mega edp\",\n      \"Odyssey revolution\",\n      \"Odyssey Spectra\",\n      \"Odyssey spectra blue\",\n      \"Odyssey toffe coffe\",\n      \"Odyssey Tyrant\",\n      \"Odyssey wild one\",\n      \"Orientica royal amber\",\n      \"Orientica Velvet Gold\",\n      \"OUD FOR GLORY\",\n      \"Qaed unlimited\",\n      \"Rave Now\",\n      \"Rayhaan Elixir\",\n      \"Rome Imagine\",\n      \"Rome paradox\",\n      \"Scandal intense\",\n      \"Scandal le parfum\",\n      \"Sehr\",\n      \"Shaheen\",\n      \"So candid\",\n      \"Spectre Malachite\",\n      \"Spectre wraith\",\n      \"Stronger with you intensly\",\n      \"Summer hammer/Lorenzo Pazzaglia\",\n      \"Sun-gria\",\n      \"Teriaq intense\",\n      \"Tharwah gold\",\n      \"The Kingdom\",\n      \"Turathi\",\n      \"Turathi Electric\",\n      \"Valentino born in Roma intense\",\n      \"Veneno\",\n      \"Versace Eros flame\",\n      \"Versace eros parfum\",\n      \"Vintage Radio\",\n      \"Winners trophy\",\n      \"Yara elixir\",\n      \"Yara lataffa\",\n      \"Yara Moi\",\n      \"Yara tous\",\n      \"Yves Saint Laurent Y EDP\"\n    ],\n\n    decants: [\n      \"BHARARA KING EDP\",\n      \"LATTAFA PRIDE PISA\",\n      \"HARANA\",\n      \"21:00:00\",\n      \"EJAAZI\",\n      \"CDN SILLAGE\",\n      \"GOS MOON\",\n      \"MANDARIN SKY\",\n      \"NAUTICA VOYAGE\",\n      \"ROYAL BLEU\",\n      \"ODYSSEY WHITE\",\n      \"JEAN LOWE MATIERE\",\n      \"SUBLIME\",\n      \"GOS ROUGE\",\n      \"9 PM REBEL\",\n      \"KHAMRAH\",\n      \"GOS YELLOW SAPPHIRE\",\n      \"GOS BOSTON\",\n      \"ASAD\",\n      \"TURATHI BLUE\",\n      \"CND SILLAGE\",\n      \"GOS ROYALE\",\n      \"OUD FOR GLORY\",\n      \"AL HARAMAIN GOLD EXTREME\",\n      \"ODYSSEY AOUD\",\n      \"VLO\",\n      \"EMEER\",\n      \"ISSEY MIYAKE\",\n      \"ODYSSEY TYRANT\",\n      \"ASAD ZANZIBAR\",\n      \"GOS BID\",\n      \"9AM\",\n      \"HAWAS ICE\",\n      \"GOS WILDCARD\",\n      \"YARA MOI\",\n      \"VENTANA ARMAF\",\n      \"CDN IMP√âRIALE\",\n      \"AL NASHAMA CAPRICE\",\n      \"YARA\",\n      \"BHARARA BLEU\",\n      \"GOS BLIND BID\",\n      \"GOS ACE\",\n      \"CDN MILESTONE\",\n      \"DETOUR NOIR\",\n      \"RAED LUXE\",\n      \"QAED UNLIMITED\",\n      \"AI HARAMAIN RUBY EDITION\",\n      \"HAWAS BLACK\",\n      \"HAYAATI\",\n      \"ODYSSEY HOMME BLACK\",\n      \"CDN URBAN MAN ELIXIR\",\n      \"CDN UNTOLD\",\n      \"MAAHIR LEGACY\",\n      \"LEGEND SPIRIT\",\n      \"SHAHEEN GOLD\",\n      \"YARA TOUS\",\n      \"FAKHAR ROSE\",\n      \"HONOR AND GLORY\",\n      \"DUBAI NIGHT\",\n      \"BHARARA KING PARFUM\",\n      \"LATTAFA JASOOR\",\n      \"GOS GOLD\",\n      \"CDN INTENSE MAN\",\n      \"GOS FULL HOUSE\",\n      \"ODYSSEY AQUA\",\n      \"HAYAATI AL MALEKY\",\n      \"GOS WIN\",\n      \"FAKHAR BLACK\",\n      \"GOS DIAMOND\",\n      \"KHAMRAH QAHWA\",\n      \"GOS HIGH ROLLER\",\n      \"THE KINGDOM\",\n      \"ODYSSEY MEGA\",\n      \"HAWAS FOR HIM\",\n      \"LATTAFA NEBRAS\",\n      \"AI HARAMAIN GOLD EDITION\",\n      \"AJWAD\",\n      \"RAVE NOW WHITE\",\n      \"ODYSSEY CANDEE\",\n      \"ODYSSEY SPECTRA\",\n      \"YARA CANDY\",\n      \"ODYSSEY LIMONI\",\n      \"AMBER ROUGE\",\n      \"SCEPTRE MALACHITE\",\n      \"VIKING KASHMIR\",\n      \"AI HARAMAIN PRIVATE EDITION\",\n      \"QAED AI FURSAN\",\n      \"GOS JACKPOT\",\n      \"VIKING DUBAI\",\n      \"ROYAL AMBER\",\n      \"BHARARA KING GOLD EDITION\",\n      \"HIS CONFESSION\",\n      \"VIKING CAIRO\",\n      \"BHARARA ELEGANCE\",\n      \"BHARARA PHARAOH 1\",\n      \"BHARARA PHARAOH 2\",\n      \"MAYAR\",\n      \"CLUB DE NUIT PRECIEUX\",\n      \"HER CONFESSION\",\n      \"AMETHYST LATTAFA\",\n      \"LATTAFA TERIAQ\",\n      \"AI HARAMAIN AQUA DUBAI\",\n      \"ASAD BOURBON\",\n      \"NITRO WHITE\",\n      \"LIQUID BURN\",\n      \"NITRO RED\",\n      \"NOBLE BLUSH\",\n      \"LATTAFA SEHR\",\n      \"ISLAND BLISS\",\n      \"LATTAFA ECLAIRE\",\n      \"AL HARAMAIN ROYAL MUSK\",\n      \"SUQRAAT\",\n      \"ISHQ AL SHUYUKH\",\n      \"LIAM BLUE\",\n      \"DUBAI CHOCOLAT\",\n      \"BHARARA CHOCOLATE\",\n      \"HAYA\",\n      \"ISHQ AL SHUYUKH GOLD\",\n      \"ANSAAM SILVER\",\n      \"VINTAGE RADIO\",\n      \"BHARARA ENCHANTED\",\n      \"GOS OPAL\",\n      \"ART OF UNIVERSE\",\n      \"LATTAFA CHIC\",\n      \"HAWAS ELIXIR\",\n      \"HAYA CRUSH\",\n      \"JEAN LOWE AZURE\",\n      \"ROME POUR HOMME\",\n      \"HAYAATI FLORENCE\",\n      \"VELVET GOLD\",\n      \"AJWAD PINK TO PINK\",\n      \"AL QIAM GOLD\",\n      \"ANGHAM LATTAFA\",\n      \"ARABIAN SKY\",\n      \"TAG UOMO ROSSO\",\n      \"TAG ART OF NATURE II\",\n      \"BHARARA PLACID\",\n      \"BHARARA SOLEIL\",\n      \"CDN WOMAN\",\n      \"CDN ICONIC\",\n      \"CONFIDENTIAL PRIVATE GOLD\",\n      \"DELILAH\",\n      \"GOS PLATINIUM OF SPADES\",\n      \"INTIMATION\",\n      \"ISLAND KHADLAJ\",\n      \"JEAN LOWE INMORTEL\",\n      \"JEAN LOWE VIBE\",\n      \"WINNERS TROPHY\",\n      \"KHANJAR EAU DE PARFUM\",\n      \"KISMET MAGIC\",\n      \"MANDARIN SKY ELIXIR\",\n      \"MAYAR CHERRY INTENSE\",\n      \"NITRO RED INTENSELY\",\n      \"NITRO NOW WOMEN\",\n      \"ODYSSEY ARTISTO\",\n      \"ODYSSEY WILD ONE\",\n      \"RAVE NOW RAYHAAN ELIXIR\",\n      \"NOW\",\n      \"SAKEENA\",\n      \"SO CANDID\",\n      \"TARWAH GOLD\",\n      \"LATTAFA TERIAQ INTENSE\",\n      \"VICTORIA LATTAFA\",\n      \"YUM YUM ARMAF\",\n      \"QISSA DELICIOUS\",\n      \"HAWAS TROPICAL\",\n      \"HAWAS FIRE\",\n      \"FAKHAR PLATIN\",\n      \"KHAMARAH DUKHAN\",\n      \"ODYSSEY EAU DE MONTAGNE\",\n      \"ODYSSEY REVOLUTION\",\n      \"ROME IMAGINE\",\n      \"TURATHI ELECTRIC\",\n      \"VULCAN NUE\",\n      \"SPECTRE WRAITH\",\n      \"GOS EMERALD OF SPADES\",\n      \"AFEEF\",\n      \"BHARARA ONYX\",\n      \"SCEPTRE DESERT\",\n      \"NITRO NEITHE\",\n      \"ODYSSEY BLACK FOREST\",\n      \"ODYSSEY TOFFEE COFFEE\",\n      \"ODYSSEY BAHAMAS\",\n      \"ODYSSEY MANGO\",\n      \"NITRO ELIXIR\",\n      \"ROME PARADOXE\",\n      \"ROME YUM YUM\",\n      \"ECLAIRE PISTACHE\",\n      \"ECLAIRE BANOFFEE\",\n      \"9PM ELIXIR\",\n      \"HAWAS MALIBU\",\n      \"HAWAS KOBRA\",\n      \"GOS BONUS DYNASTY FIRE\",\n      \"ON CIE\",\n      \"LOVELY CHERIE\"\n    ],\n\n    set_perfumes: [\n      \"Gos set\",\n      \"GOS Set 3 piezas jo milano\",\n      \"Set 9pm\",\n      \"Set art of universe\",\n      \"Set mandar√≠n\",\n      \"SET VERSACE NECESER + PERFUME + DECANT\",\n      \"Set YARA\",\n      \"Set Zadig & Voltaire this is her\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4736,416],"id":"8e853398-c1fd-4a9a-9894-11607d7d0832","name":"informacion_productos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"# ROL: \nEres un agente t√©cnico especializado en la verificaci√≥n de existencias y precios del cat√°logo de Brada Perfumes. Tu √∫nico objetivo es recibir nombres de perfumes, identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input y consultar la tool stock1 para obtener datos reales.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Productos: Los nombres de los perfumes en el input siempre vendr√°n entre comillas (ej. \"9 PM\", \"Hawas Ice\") para evitar confusi√≥n con el resto del mensaje.\nUso de la Tool stock1:\nDebes ejecutar la tool enviando el nombre exacto del perfume identificado en la variable perfume.\nSi el input contiene m√∫ltiples perfumes, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes mantener el nombre del perfume exactamente igual a como aparece en el cat√°logo, corrigiendo solo errores ortogr√°ficos evidentes seg√∫n tu conocimiento general.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo perfume\nVariable disponibilidad: Si la tool indica que el producto est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre de perfume): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s perfumes\nDebes listar cada perfume en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n# EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"Hola, revisa la disponibilidad de \"9 PM\" y \"Hawas Ice\".\"\nProceso interno:\nLlamada 1: stock1(perfume=\"9 PM\") -> Resultado: Disponible, S/ 140.\nLlamada 2: stock1(perfume=\"Hawas Ice\") -> Resultado: Agotado, S/ 180.\nOutput que debes enviar si son dos o m√°s perfumes: 9 PM: stock si y precio 140 soles. Hawas Ice: stock no y precio 180 soles.\n#NOTAS ADICIONALES\nNo inventes precios ni estados de stock.\nSi la tool no devuelve informaci√≥n para un nombre espec√≠fico, indica: (Nombre de perfume): stock no y precio (No disponible).\nTu respuesta debe ser exclusivamente la lista de stock solicitada, sin saludos ni despedidas adicionales\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5312,608],"id":"64458501-a4f8-45c4-aae9-17b34719c27a","name":"stock_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    \"distritos_permitidos\": [\n      \"Anc√≥n\", \"Ate\", \"Barranco\", \"Bre√±a\", \"Carabayllo\", \"Chaclacayo\", \n      \"Chorrillos\", \"Cieneguilla\", \"Comas\", \"El Agustino\", \"Independencia\", \n      \"Jes√∫s Mar√≠a\", \"La Molina\", \"La Victoria\", \"Lima\", \"Lince\", \n      \"Los Olivos\", \"Lurigancho\", \"Lur√≠n\", \"Magdalena del Mar\", \"Miraflores\", \n      \"Pachac√°mac\", \"Pucusana\", \"Pueblo Libre\", \"Puente Piedra\", \n      \"Punta Hermosa\", \"Punta Negra\", \"R√≠mac\", \"San Bartolo\", \"San Borja\", \n      \"San Isidro\", \"San Juan de Lurigancho\", \"San Juan de Miraflores\", \n      \"San Luis\", \"San Mart√≠n de Porres\", \"San Miguel\", \"Santa Anita\", \n      \"Santa Mar√≠a del Mar\", \"Santa Rosa\", \"Santiago de Surco\", \"Surquillo\", \n      \"Villa El Salvador\", \"Villa Mar√≠a del Triunfo\", \"Callao\", \"Bellavista\", \n      \"Carmen de la Legua Reynoso\", \"La Perla\", \"La Punta\", \"Ventanilla\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4432,400],"id":"09ca4414-ae98-4efb-aaa7-b0a7d4b68b45","name":"distritos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente especializado exclusivamente en la verificaci√≥n de existencias y precios de Decants (presentaciones de 5ml y 10ml) de Brada Perfumes. Tu objetivo es recibir el input del agente principal, identificar los perfumes y sus medidas, y consultar la tool stock_decants para devolver datos precisos.\n# INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Medidas: Debes prestar especial atenci√≥n a la cantidad solicitada (5ml o 10ml). Si el cliente no especifica la medida pero el contexto indica que es un decant, consulta ambas presentaciones.\nUso de la Tool stock_decants:\nDebes ejecutar la tool enviando el nombre del perfume y la medida identificada.\nSi el input contiene m√∫ltiples decants (ej. \"9 PM de 5ml y Hawas de 10ml\"), debes realizar una ejecuci√≥n de la tool por cada producto/medida individualmente.\nMantenimiento de Nomenclatura: Mant√©n el nombre t√©cnico del perfume (ej. \"Club de Nuit Intense\" en lugar de \"cnit\") seg√∫n la lista maestra.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato basado en los datos de la tool:\nCASO 1: Un solo decant\nVariable disponibilidad: Si la tool indica existencias, utiliza \"si\". Si no hay, utiliza \"no\".\nFormato de salida: (Nombre de perfume) ([Medida]): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s decants\nDebes listar cada decant en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad de decants: \"9 PM\" en 5ml y \"Hawas Ice\" en 10ml.\"\nProceso interno:\nLlamada 1: stock_decants(perfume=\"9 PM\", medida=\"5ml\") -> Resultado: Disponible, S/ 35.\nLlamada 2: stock_decants(perfume=\"Hawas Ice\", medida=\"10ml\") -> Resultado: Agotado, S/ 45.\nOutput (Lo que respondes): 9 PM (5ml): stock si y precio 35 soles. Hawas Ice (10ml): stock no y precio 45 soles.\n#REGLAS DE ORO\nProhibici√≥n de Inventar: No inventes precios. Si la tool no devuelve un precio para una medida espec√≠fica, responde: (Nombre de perfume) ([Medida]): stock no y precio (No disponible).\nExclusividad: Tu respuesta debe contener √∫nicamente la lista t√©cnica. No incluyas saludos, recomendaciones, ni frases de cierre.\nPrecisi√≥n de Medida: Aseg√∫rate de que el precio corresponda exactamente a la medida solicitada (un perfume de 10ml siempre es m√°s caro que uno de 5ml).\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5024,608],"id":"edf1ea9c-753a-4178-8823-ad4b5d276fde","name":"stock_decants"},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-4752,880],"id":"c65b6d98-6ca9-4850-a240-dc15d0e6f244","name":"OpenAI Chat Model5","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5008,880],"id":"f40c83eb-7af9-43d9-9718-23906d503917","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5328,848],"id":"4682821d-4ee5-4aa0-bfa8-6ee52c2d74b9","name":"OpenAI Chat Model6","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfumes","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-5168,816],"id":"db9c5a3b-41f0-489b-95b8-1818ea40b41b","name":"stock1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_decants","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4880,832],"id":"cca318d1-6e33-42b3-9253-f90ae5034239","name":"stock2","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfume_sets","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4592,880],"id":"6150c4ba-6b03-4325-b902-35091b0ac31b","name":"stock3","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente t√©cnico especializado exclusivamente en la verificaci√≥n de existencias y precios de los Sets de Perfumes (estuches de regalo o packs con complementos) de Brada Perfumes. Tu misi√≥n es recibir el nombre del set, validarlo contra la tool stock_set_perfumes y devolver la disponibilidad y precio real.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Sets: Los nombres de los sets suelen incluir la palabra \"Set\" (ej. \"Set Yara\", \"Set 9 PM\"). Debes identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input.\nUso de la Tool stock_set_perfumes:\nDebes ejecutar la tool enviando el nombre exacto del set en la variable nombre_set.\nSi el input contiene m√∫ltiples sets, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes respetar el nombre del set tal como aparece en el cat√°logo oficial de Brada Perfumes, asegur√°ndote de que se trate de la presentaci√≥n en estuche y no de la botella individual.\n#L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo Set\nVariable disponibilidad: Si la tool indica que el set est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre del Set): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s Sets\nDebes listar cada set en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad del SET: \"Set Yara\" y \"Set Art of Universe\".\"\nProceso interno:\nLlamada 1: stock_set_perfumes(nombre_set=\"Set Yara\") -> Resultado: Disponible, S/ 210.\nLlamada 2: stock_set_perfumes(nombre_set=\"Set Art of Universe\") -> Resultado: Disponible, S/ 250.\nOutput (Lo que respondes): Set Yara: stock si y precio 210 soles. Set Art of Universe: stock si y precio 250 soles.\n#REGLAS DE ORO\nPrecisi√≥n: No confundas un \"Perfume Full Size\" con un \"Set\". Si el input pide un Set, busca √∫nicamente en la categor√≠a de sets.\nProhibici√≥n de Inventar: No inventes precios ni disponibilidad. Si la tool no devuelve informaci√≥n para un set espec√≠fico, indica: (Nombre del Set): stock no y precio (No disponible).\nMinimalismo: Tu respuesta debe ser exclusivamente la lista t√©cnica solicitada. No incluyas saludos, despedidas ni comentarios sobre el contenido del set.\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-4736,656],"id":"6344ee20-9fcb-45bd-a342-5aaf79248763","name":"stock_set_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"bFX818cxJebYkS92","mode":"list","cachedResultUrl":"/workflow/bFX818cxJebYkS92","cachedResultName":"BRADA | WHATSAPP | compras confirmadas"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-4544,448],"id":"42a85e30-dd9d-47c7-af24-3eace4616f6f","name":"confirmacion_pedidos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1840,2160],"id":"86511a06-e0d8-496b-9161-edd28ac48fe2","name":"If24"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1632,2144],"id":"f6ed93e7-cd4c-4547-9b7c-9f3a9bd6174a","name":"If28"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1280,2560],"id":"6532091a-4da7-484e-bc59-551caaf8837a","name":"If29"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1904,2112],"typeVersion":1,"id":"4b346085-38b5-41dc-aa4e-0e5fd0d63b15","name":"Sticky Note3"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1408,2160],"id":"60a486b8-d8b9-45f7-bcc2-0237d9dacb35","name":"Wait1","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-832,2368],"id":"aec693f3-d181-42f6-96ef-f4259257f242","name":"If41"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-464,2576],"id":"d0bce6d9-8944-4f36-8369-887245578174","name":"If43"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2368],"id":"920f0b3f-260f-4a46-8f84-c7fafcb4e42d","name":"Wait11","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2576],"id":"9445a338-fa59-4652-b7a7-042da4ab0166","name":"Wait12","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-256,2592],"id":"1b4c198d-a84a-4886-bfee-45e03505844a","name":"Wait13","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1632,2320],"id":"985412b0-18a0-4a74-9383-848361eecf6d","name":"Wait14","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-624,2384],"id":"0b01e43e-8f88-4806-9aa3-aaafae23afa5","name":"Wait15","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1264,2320],"id":"455fc9a5-d692-424b-96af-4dc9dfb5ecfa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1440,2320],"id":"43ef0c39-d3b6-4ed3-9bbe-55b60f80b5a4"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-656,2576],"id":"71901a37-3c10-48e0-8c0d-ea488faf670e"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-7","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-832,2576],"id":"94b90b7c-2489-43c2-b38d-5f1d9ed48958"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot37","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[64,2592],"id":"70f90af3-d2d6-42bb-bbed-2a460fc13eb2"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-8","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-112,2592],"id":"79b9eee3-c9f3-43cc-945b-a659df940b42"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot38","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-288,2384],"id":"377a6011-2a90-4508-ad7a-18e8be515097"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-9","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-464,2384],"id":"4736c49f-51b0-433c-acaf-c5ec1975c27f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot39","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1072,2160],"id":"a211f2a4-e5b1-4b1b-b198-ecee0d6bdf3a"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-10","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1248,2160],"id":"e7fcf0ac-d57f-498d-84c2-efc72cefbb9c"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[336,720],"id":"2aaf0e50-945f-404a-a630-6c934c4bf678","name":"If25"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[544,704],"id":"db6e3976-9c81-410c-a089-cbbffed9a498","name":"If30"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[896,1120],"id":"3d9b40b9-6eb5-4641-9243-4acb6bbaab90","name":"If31"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[272,672],"typeVersion":1,"id":"9d6dc394-e9c9-47cf-bb8b-3ec6e169cd24","name":"Sticky Note4"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[768,720],"id":"e193f0ff-9818-4fff-ab4c-87a07ea2bc57","name":"Wait16","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1344,928],"id":"70a6f8d6-3ef1-45ad-be33-45e51b8b5bf7","name":"If44"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1712,1136],"id":"46e4e9c0-d629-4cae-a016-78122838bf5c","name":"If45"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,928],"id":"9005e0a0-7928-4432-afba-ecca82410842","name":"Wait17","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,1136],"id":"26654f8d-1377-49f2-b4ba-feefd58f29f5","name":"Wait18","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1920,1152],"id":"e5e9d5a8-676d-4787-ad0c-57a9cecb51e6","name":"Wait19","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[544,880],"id":"0a2148fa-6d21-4cef-85c9-2f9f7747051b","name":"Wait20","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1552,944],"id":"24a50f49-9fa7-444a-889d-b0a47dcdca22","name":"Wait21","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[912,880],"id":"73a2a9cb-96fa-4c67-b2c0-855467476004"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-11","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[736,880],"id":"2a355cf5-4023-4e5c-94cd-fb54d20ab48d"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot21","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1520,1136],"id":"e4e81844-daec-44fa-87e1-8a40c9f593e1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-12","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1344,1136],"id":"124b0253-10a5-4f3f-8b46-7e729f639b4b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot40","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2240,1152],"id":"d7a77253-dcf2-4e33-9699-ace3f5cf9843"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-13","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2064,1152],"id":"47d740d9-af91-4b47-a3d9-43f6089948ac"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot41","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1888,944],"id":"ba55a9c2-6648-4009-9d21-cbad56eea3fa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-14","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1712,944],"id":"09553178-8112-4313-b41f-7edb86da9bb2"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot42","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1104,720],"id":"a287f371-7d38-4b62-96ac-80a54a0f4a85"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-15","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[928,720],"id":"5a670fc0-4c1b-45d5-bf03-f2cce3d56697"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-144,0],"id":"21286fd2-eb14-4621-961c-daf1710c98db","name":"If32"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[64,-16],"id":"9298649c-49d2-4ef9-a38d-d1ecd699741a","name":"If33"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[416,400],"id":"0335f432-f2cb-43bf-9855-8b773b8fd74f","name":"If34"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-208,-48],"typeVersion":1,"id":"f7db0934-d8a5-4643-8ea5-3b74f9fd30ff","name":"Sticky Note5"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[288,0],"id":"edc5d3e6-6cb7-4e24-a395-5bfd2ec21e8f","name":"Wait22","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[864,208],"id":"3d08713e-6783-4344-835a-52021892fc79","name":"If46"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1232,416],"id":"a3ff7975-1b42-4ee2-8d28-a9e2530627ea","name":"If47"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,208],"id":"050e27ee-0dc9-4cfe-9b3b-4984fdb3c424","name":"Wait23","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,416],"id":"316376c3-954b-4325-ab08-caadfb880e67","name":"Wait24","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1440,432],"id":"cfc28de1-e1fa-4583-80c7-4806a6cd7ad1","name":"Wait25","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[64,160],"id":"e8d0be90-195b-413a-b96d-28c469da7d2a","name":"Wait26","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1072,224],"id":"83b77384-ab0f-442c-aa8e-20cbf18ba56b","name":"Wait27","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot22","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[432,160],"id":"91fe9d8e-e24c-4675-9a65-5c3b96805cd1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[256,160],"id":"b2aa295f-bb56-4faf-bc6e-2c244ae1b8b5"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot23","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1040,416],"id":"42af2c54-fd06-4e53-9b3e-386ae18aad48"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[864,416],"id":"334d03f2-3acd-4c43-9e5c-e5c9ec1fab6b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot43","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1760,432],"id":"a10b0be7-7ad4-4a67-b580-1f6c8f63dd0b"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1584,432],"id":"3ae52091-798e-4106-ad81-b391a548b061"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot44","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1408,224],"id":"634d84c9-0fb9-4dc6-a691-70a9eb6eaff6"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1232,224],"id":"4c0fbfdd-c75a-4058-9fb3-c934f00a1774"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot45","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[624,0],"id":"c8374285-c938-46a3-ab3d-a8987b53dafe"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[448,0],"id":"8a5f2626-93c0-485f-83b6-88d1b7969f67"}],"connections":{"AI Agent":{"main":[[{"node":"Verificador1","type":"main","index":0}]]},"Auto-fixing Output Parser1":{"ai_outputParser":[[{"node":"Verificador1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model8":{"ai_languageModel":[[{"node":"Auto-fixing Output Parser1","type":"ai_languageModel","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"Auto-fixing Output Parser1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model9":{"ai_languageModel":[[{"node":"Verificador1","type":"ai_languageModel","index":0}]]},"Verificador1":{"main":[[{"node":"ordenar","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Get a row3","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"If2":{"main":[[{"node":"Update a row1","type":"main","index":0}],[{"node":"If3","type":"main","index":0}]]},"If3":{"main":[[{"node":"Switch3","type":"main","index":0}],[{"node":"No Operation, do nothing4","type":"main","index":0}]]},"Edit Fields4":{"main":[[{"node":"If2","type":"main","index":0}]]},"If13":{"main":[[{"node":"Get a row1","type":"main","index":0}],[{"node":"Create a row","type":"main","index":0}]]},"Calendario":{"ai_tool":[[]]},"Create a row":{"main":[[{"node":"Get a row1","type":"main","index":0}]]},"Get a row1":{"main":[[{"node":"Edit Fields4","type":"main","index":0}]]},"Update a row1":{"main":[[{"node":"Switch3","type":"main","index":0}]]},"Get a row":{"main":[[{"node":"If13","type":"main","index":0}]]},"If4":{"main":[[{"node":"If11","type":"main","index":0}],[{"node":"Fecha","type":"main","index":0}]]},"Formatea fecha":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Handler variables":{"main":[[{"node":"If10","type":"main","index":0}]]},"Fecha":{"main":[[{"node":"Formatea fecha","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Handler variables","type":"main","index":0}]]},"Wait6":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"If6":{"main":[[{"node":"Redis1","type":"main","index":0}],[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"Delete Redis":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Edit Fields19":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"Get Redis1":{"main":[[{"node":"If6","type":"main","index":0}]]},"Edit Fields20":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"If15":{"main":[[{"node":"Edit Fields19","type":"main","index":0}],[{"node":"Edit Fields20","type":"main","index":0}]]},"METER_ANUNCIO":{"main":[[{"node":"guarda_ANUNCIO","type":"main","index":0}]]},"BAJAR_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"guarda_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"If":{"main":[[{"node":"RESUMIDOR ANUNCIOS","type":"main","index":0}],[{"node":"If4","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"RESUMIDOR ANUNCIOS","type":"ai_languageModel","index":0}]]},"If10":{"main":[[{"node":"METER_ANUNCIO","type":"main","index":0}],[{"node":"BAJAR_ANUNCIO","type":"main","index":0}]]},"Redis1":{"main":[[{"node":"If15","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"If16","type":"main","index":0}]]},"Edit Fields12":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"AUDIO1","type":"main","index":0}]]},"Switch3":{"main":[[{"node":"HTTP Request","type":"main","index":0}],[{"node":"OpenAI","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}]]},"AUDIO1":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"If16":{"main":[[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields12","type":"main","index":0}]]},"Edit Fields17":{"main":[[{"node":"If","type":"main","index":0}]]},"If11":{"main":[[{"node":"Update a row4","type":"main","index":0}]]},"If12":{"main":[[{"node":"Get a row","type":"main","index":0}],[{"node":"If20","type":"main","index":0}]]},"If20":{"main":[[{"node":"Update a row6","type":"main","index":0}]]},"If1":{"main":[[{"node":"If12","type":"main","index":0}]]},"ordenar":{"main":[[{"node":"Respuesta1","type":"main","index":0}]]},"Respuesta1":{"main":[[{"node":"Update a row","type":"main","index":0}]]},"Wait2":{"main":[[{"node":"Respuesta2","type":"main","index":0}]]},"Respuesta2":{"main":[[{"node":"Update a row3","type":"main","index":0}]]},"If14":{"main":[[{"node":"Wait3","type":"main","index":0}],[{"node":"If23","type":"main","index":0}]]},"Wait3":{"main":[[{"node":"Respuesta3","type":"main","index":0}]]},"Respuesta3":{"main":[[{"node":"Update a row5","type":"main","index":0}]]},"If17":{"main":[[{"node":"Wait4","type":"main","index":0}],[{"node":"If32","type":"main","index":0}]]},"Wait4":{"main":[[{"node":"Respuesta4","type":"main","index":0}]]},"Respuesta4":{"main":[[{"node":"Update a row7","type":"main","index":0}]]},"RESUMIDOR ANUNCIOS":{"main":[[{"node":"If4","type":"main","index":0}]]},"Supervisor":{"ai_tool":[[]]},"Update a row":{"main":[[{"node":"If8","type":"main","index":0}]]},"Update a row3":{"main":[[{"node":"If14","type":"main","index":0}]]},"Update a row5":{"main":[[{"node":"If17","type":"main","index":0}]]},"Get a row3":{"main":[[{"node":"If19","type":"main","index":0}]]},"If19":{"main":[[{"node":"If5","type":"main","index":0}]]},"Update a row7":{"main":[[{"node":"If25","type":"main","index":0}]]},"If7":{"main":[[{"node":"Update a row9","type":"main","index":0}],[{"node":"Create a row1","type":"main","index":0}]]},"Get a row2":{"main":[[{"node":"If7","type":"main","index":0}]]},"Create a row1":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"RAZONADOR PLUS":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Update a row9":{"main":[[{"node":"Wait6","type":"main","index":0}]]},"1. Descargar Imagen":{"main":[[{"node":"2. Enviar a Chatwoot","type":"main","index":0}]]},"If8":{"main":[[{"node":"Wait2","type":"main","index":0}],[{"node":"If24","type":"main","index":0}]]},"If23":{"main":[[{"node":"If26","type":"main","index":0}],[{"node":"Wait9","type":"main","index":0}]]},"If26":{"main":[[],[{"node":"Wait","type":"main","index":0}]]},"If27":{"main":[[{"node":"Wait5","type":"main","index":0}],[{"node":"Wait7","type":"main","index":0}]]},"Wait":{"main":[[{"node":"1. Descargar Imagen 1-6","type":"main","index":0}]]},"If40":{"main":[[],[{"node":"Wait10","type":"main","index":0}]]},"If42":{"main":[[],[{"node":"Wait8","type":"main","index":0}]]},"Wait5":{"main":[[{"node":"If40","type":"main","index":0}]]},"Wait7":{"main":[[{"node":"1. Descargar Imagen 1-3","type":"main","index":0}]]},"Wait8":{"main":[[{"node":"1. Descargar Imagen 1-4","type":"main","index":0}]]},"Wait9":{"main":[[{"node":"1. Descargar Imagen 1-2","type":"main","index":0}]]},"Wait10":{"main":[[{"node":"1. Descargar Imagen 1-5","type":"main","index":0}]]},"2. Enviar a Chatwoot16":{"main":[[{"node":"If27","type":"main","index":0}]]},"1. Descargar Imagen 1-2":{"main":[[{"node":"2. Enviar a Chatwoot16","type":"main","index":0}]]},"2. Enviar a Chatwoot19":{"main":[[{"node":"If42","type":"main","index":0}]]},"1. Descargar Imagen 1-3":{"main":[[{"node":"2. Enviar a Chatwoot19","type":"main","index":0}]]},"1. Descargar Imagen 1-4":{"main":[[{"node":"2. Enviar a Chatwoot34","type":"main","index":0}]]},"1. Descargar Imagen 1-5":{"main":[[{"node":"2. Enviar a Chatwoot35","type":"main","index":0}]]},"1. Descargar Imagen 1-6":{"main":[[{"node":"2. Enviar a Chatwoot36","type":"main","index":0}]]},"If5":{"main":[[{"node":"supervisor","type":"main","index":0}],[{"node":"If1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"supervisor","type":"ai_languageModel","index":0}]]},"pasar_supervisor":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"Call 'Supervisor healup'":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"enviar_nombre":{"ai_tool":[[]]},"informacion_productos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"distritos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_decants":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model5":{"ai_languageModel":[[{"node":"stock_set_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model6":{"ai_languageModel":[[{"node":"stock_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"stock_decants","type":"ai_languageModel","index":0}]]},"stock1":{"ai_tool":[[{"node":"stock_perfumes","type":"ai_tool","index":0}]]},"stock2":{"ai_tool":[[{"node":"stock_decants","type":"ai_tool","index":0}]]},"stock3":{"ai_tool":[[{"node":"stock_set_perfumes","type":"ai_tool","index":0}]]},"stock_set_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"confirmacion_pedidos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"If24":{"main":[[{"node":"If28","type":"main","index":0}],[{"node":"Wait14","type":"main","index":0}]]},"If28":{"main":[[],[{"node":"Wait1","type":"main","index":0}]]},"If29":{"main":[[{"node":"Wait11","type":"main","index":0}],[{"node":"Wait12","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"1. Descargar Imagen 1-10","type":"main","index":0}]]},"If41":{"main":[[],[{"node":"Wait15","type":"main","index":0}]]},"If43":{"main":[[],[{"node":"Wait13","type":"main","index":0}]]},"Wait11":{"main":[[{"node":"If41","type":"main","index":0}]]},"Wait12":{"main":[[{"node":"1. Descargar Imagen 1-7","type":"main","index":0}]]},"Wait13":{"main":[[{"node":"1. Descargar Imagen 1-8","type":"main","index":0}]]},"Wait14":{"main":[[{"node":"1. Descargar Imagen 1-","type":"main","index":0}]]},"Wait15":{"main":[[{"node":"1. Descargar Imagen 1-9","type":"main","index":0}]]},"2. Enviar a Chatwoot17":{"main":[[{"node":"If29","type":"main","index":0}]]},"1. Descargar Imagen 1-":{"main":[[{"node":"2. Enviar a Chatwoot17","type":"main","index":0}]]},"2. Enviar a Chatwoot20":{"main":[[{"node":"If43","type":"main","index":0}]]},"1. Descargar Imagen 1-7":{"main":[[{"node":"2. Enviar a Chatwoot20","type":"main","index":0}]]},"1. Descargar Imagen 1-8":{"main":[[{"node":"2. Enviar a Chatwoot37","type":"main","index":0}]]},"1. Descargar Imagen 1-9":{"main":[[{"node":"2. Enviar a Chatwoot38","type":"main","index":0}]]},"1. Descargar Imagen 1-10":{"main":[[{"node":"2. Enviar a Chatwoot39","type":"main","index":0}]]},"If25":{"main":[[{"node":"If30","type":"main","index":0}],[{"node":"Wait20","type":"main","index":0}]]},"If30":{"main":[[],[{"node":"Wait16","type":"main","index":0}]]},"If31":{"main":[[{"node":"Wait17","type":"main","index":0}],[{"node":"Wait18","type":"main","index":0}]]},"Wait16":{"main":[[{"node":"1. Descargar Imagen 1-15","type":"main","index":0}]]},"If44":{"main":[[],[{"node":"Wait21","type":"main","index":0}]]},"If45":{"main":[[],[{"node":"Wait19","type":"main","index":0}]]},"Wait17":{"main":[[{"node":"If44","type":"main","index":0}]]},"Wait18":{"main":[[{"node":"1. Descargar Imagen 1-12","type":"main","index":0}]]},"Wait19":{"main":[[{"node":"1. Descargar Imagen 1-13","type":"main","index":0}]]},"Wait20":{"main":[[{"node":"1. Descargar Imagen 1-11","type":"main","index":0}]]},"Wait21":{"main":[[{"node":"1. Descargar Imagen 1-14","type":"main","index":0}]]},"2. Enviar a Chatwoot18":{"main":[[{"node":"If31","type":"main","index":0}]]},"1. Descargar Imagen 1-11":{"main":[[{"node":"2. Enviar a Chatwoot18","type":"main","index":0}]]},"2. Enviar a Chatwoot21":{"main":[[{"node":"If45","type":"main","index":0}]]},"1. Descargar Imagen 1-12":{"main":[[{"node":"2. Enviar a Chatwoot21","type":"main","index":0}]]},"1. Descargar Imagen 1-13":{"main":[[{"node":"2. Enviar a Chatwoot40","type":"main","index":0}]]},"1. Descargar Imagen 1-14":{"main":[[{"node":"2. Enviar a Chatwoot41","type":"main","index":0}]]},"1. Descargar Imagen 1-15":{"main":[[{"node":"2. Enviar a Chatwoot42","type":"main","index":0}]]},"If32":{"main":[[{"node":"If33","type":"main","index":0}],[{"node":"Wait26","type":"main","index":0}]]},"If33":{"main":[[],[{"node":"Wait22","type":"main","index":0}]]},"If34":{"main":[[{"node":"Wait23","type":"main","index":0}],[{"node":"Wait24","type":"main","index":0}]]},"Wait22":{"main":[[{"node":"1. Descargar Imagen 1-20","type":"main","index":0}]]},"If46":{"main":[[],[{"node":"Wait27","type":"main","index":0}]]},"If47":{"main":[[],[{"node":"Wait25","type":"main","index":0}]]},"Wait23":{"main":[[{"node":"If46","type":"main","index":0}]]},"Wait24":{"main":[[{"node":"1. Descargar Imagen 1-17","type":"main","index":0}]]},"Wait25":{"main":[[{"node":"1. Descargar Imagen 1-18","type":"main","index":0}]]},"Wait26":{"main":[[{"node":"1. Descargar Imagen 1-16","type":"main","index":0}]]},"Wait27":{"main":[[{"node":"1. Descargar Imagen 1-19","type":"main","index":0}]]},"2. Enviar a Chatwoot22":{"main":[[{"node":"If34","type":"main","index":0}]]},"1. Descargar Imagen 1-16":{"main":[[{"node":"2. Enviar a Chatwoot22","type":"main","index":0}]]},"2. Enviar a Chatwoot23":{"main":[[{"node":"If47","type":"main","index":0}]]},"1. Descargar Imagen 1-17":{"main":[[{"node":"2. Enviar a Chatwoot23","type":"main","index":0}]]},"1. Descargar Imagen 1-18":{"main":[[{"node":"2. Enviar a Chatwoot43","type":"main","index":0}]]},"1. Descargar Imagen 1-19":{"main":[[{"node":"2. Enviar a Chatwoot44","type":"main","index":0}]]},"1. Descargar Imagen 1-20":{"main":[[{"node":"2. Enviar a Chatwoot45","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"acwebhook.alefcompany.online","user-agent":"rest-client/2.1.0 (linux-musl x86_64) ruby/3.4.4p34","content-length":"2304","accept":"application/json","accept-encoding":"gzip;q=1.0,deflate;q=0.6,identity;q=0.3","content-type":"application/json","x-forwarded-for":"173.249.43.27","x-forwarded-host":"acwebhook.alefcompany.online","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"6a57d0c37ad6","x-real-ip":"173.249.43.27"},"params":{},"query":{},"body":{"account":{"id":2,"name":"Healup"},"additional_attributes":{},"content_attributes":{},"content_type":"text","content":"a","conversation":{"additional_attributes":{},"can_reply":true,"channel":"Channel::Whatsapp","contact_inbox":{"id":4,"contact_id":4,"inbox_id":4,"source_id":"51972619000","created_at":"2026-01-02T16:51:45.640Z","updated_at":"2026-01-02T16:51:45.640Z","hmac_verified":false,"pubsub_token":"STv1xcrZw8Aeuyt1SPgxmVQm"},"id":1,"inbox_id":4,"messages":[{"id":18,"content":"a","account_id":2,"inbox_id":4,"conversation_id":1,"message_type":0,"created_at":1767380149,"updated_at":"2026-01-02T18:55:49.212Z","private":false,"status":"sent","source_id":"wamid.HBgLNTE5NzI2MTkwMDAVAgASGBYzRUIwQTY2M0JDMjQwOTg4NTdDQTg3AA==","content_type":"text","content_attributes":{},"sender_type":"Contact","sender_id":4,"external_source_ids":{},"additional_attributes":{},"processed_message_content":"a","sentiment":{},"conversation":{"assignee_id":null,"unread_count":1,"last_activity_at":1767380149,"contact_inbox":{"source_id":"51972619000"}},"sender":{"additional_attributes":{},"custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false,"type":"contact"}}],"labels":[],"meta":{"sender":{"additional_attributes":{},"custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false,"type":"contact"},"assignee":null,"assignee_type":null,"team":null,"hmac_verified":false},"status":"open","custom_attributes":{},"snoozed_until":null,"unread_count":1,"first_reply_created_at":null,"priority":null,"waiting_since":1767372705,"agent_last_seen_at":1767378677,"contact_last_seen_at":0,"last_activity_at":1767380149,"timestamp":1767380149,"created_at":1767372705,"updated_at":1767380149.2243187},"created_at":"2026-01-02T18:55:49.212Z","id":18,"inbox":{"id":4,"name":"Heal Up Lab WhatsApp"},"message_type":"incoming","private":false,"sender":{"account":{"id":2,"name":"Healup"},"additional_attributes":{},"avatar":"","custom_attributes":{},"email":null,"id":4,"identifier":null,"name":"Julio","phone_number":"+51972619000","thumbnail":"","blocked":false},"source_id":"wamid.HBgLNTE5NzI2MTkwMDAVAgASGBYzRUIwQTY2M0JDMjQwOTg4NTdDQTg3AA==","event":"message_created"},"webhookUrl":"https://acwebhook.alefcompany.online/webhook/healup2","executionMode":"production"}}]},"versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","activeVersionId":"becd5ca5-467d-415a-b311-83050fcb82cb","versionCounter":26,"triggerCount":1,"activeVersion":{"updatedAt":"2026-01-12T22:41:59.446Z","createdAt":"2026-01-12T22:41:59.446Z","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","workflowId":"bIVpE1aXwtICWRcyHjLUv","nodes":[{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $('Delete Redis').first().json.response }}\nCurrent date: {{ $('Formatea fecha').first().json.formattedDate }}\nEl numero del whatsapp del paciente es: {{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n\n## CLASIFICACI√ìN DE TEXTO:\nTe va a llegar los mensajes en parte de esta forma:\nTexto mensaje: [Mensaje]\nAudio transcripto: [audio trascripto]\nImagen analizada: [mensaje analizado]\nesto es para que sepas diferenciar los audios, imagenes, y textos que te manden.\n","options":{"systemMessage":"=#ROL\n1. IDENTIDAD Y VOCABULARIO (EL \"QUI√âN\" Y \"QU√â\" DECIR)\nEsta secci√≥n define su personalidad y el est√°ndar de lenguaje que debe utilizar para conectar con el cliente que desea comprar en Brada Perfumes.\nNombre: Diego.\nCargo: Asesor de ventas de la tienda ‚ÄúBrada Perfumes‚Äù, especializado en alta perfumer√≠a y fragancias √°rabes.\nTrato al Cliente: Uso de un tono simple, cercano y directo. Se evita la informalidad excesiva\nUso de \"Hermano\": El t√©rmino \"hermano\" queda restringido √∫nicamente al saludo inicial. No debe utilizarse en el resto de la conversaci√≥n para evitar un exceso de confianza.\nRestricci√≥n Cr√≠tica: Queda estrictamente prohibido el uso de apelativos exagerados como \"perfum√≥n\" o \"joyita\". Tambi√©n se proh√≠be el lenguaje rob√≥tico, el trato formal de \"Usted\" y el uso de diminutivos (ej. \"perfumito\", \"botellita\").\nEjemplo de Aplicaci√≥n: \nEntrada: \"hola que tal, precio de asad\" \nRespuesta de Diego: \"Hola hermano, que tal? El Lattafa Asad s√≠ lo tenemos disponible, aqu√≠ te paso los detalles...\"\n\n2. PROTOCOLOS DE COMUNICACI√ìN (EL \"C√ìMO\" HABLAR)\nEsta secci√≥n establece la mec√°nica de sus respuestas para garantizar una venta √°gil, persuasiva y aut√©ntica.\nRegla de Interacci√≥n: Responder mensaje por mensaje para mantener un ritmo de chat natural.\nRegla de Extensi√≥n Adaptativa:\nRespuestas Simples: M√°ximo 2 l√≠neas para saludos iniciales o confirmaciones de recepci√≥n.\nRespuestas de Cat√°logo: Entrega de la informaci√≥n clave (precio, disponibiidad y nombre del producto) bas√°ndose en las tres tools seg√∫n las reglas correspondientes a su uso en la secci√≥n: ‚Äú\nRegla de Estructura: Si el cliente pregunta por varias fragancias, responda de forma ordenada destacando lo mejor de cada una.\nRegla de Est√©tica: Uso din√°mico de 1 emoji por mensaje (üî•, üí®, ) para transmitir la energ√≠a y exclusividad de las fragancias.\nRegla de No-Repetici√≥n:\nNo repita el saludo de bienvenida si el cliente contin√∫a la conversaci√≥n m√°s tarde.\nSi el cliente no entiende una nota olfativa, use comparaciones sencillas (ej. \"huele a limpio\", \"es bien dulcecito\") sin perder la base t√©cnica.\n3. L√ìGICA DE OBJETIVOS (EL \"PARA QU√â\" ACTUAR)\nEsta secci√≥n rige sus decisiones estrat√©gicas, priorizando la asesor√≠a efectiva y el cierre de ventas seguro.\nMisi√≥n Principal: Identificar el nombre del perfume que desee el cliente) y resolver dudas sobre stock y env√≠os usando exclusivamente las tools.\nFiltro de Pago y Env√≠o: Prohibido solicitar datos de env√≠o o confirmar pedidos si el cliente no ha pasado por el \"Filtro de Validaci√≥n de Pago\" (An√°lisis de imagen del comprobante).\nFiltro de Asesor√≠a: Ante consultas sobre reclamos, devoluciones o pedidos de asesor√≠a m√©dica/piel muy complejos, debe derivar inmediatamente al supervisor.\nIntegridad de Stock: Prohibido inventar disponibilidad o precios. La √∫nica fuente v√°lida es el output de la tool stock_real.\n#CONOCIMIENTO GENERAL\n### ¬øQu√© es Brada Perfumes?\nEs una tienda especializada en alta perfumer√≠a y fragancias √°rabes exclusivas. Como asesor de ventas, tu objetivo es orientar a los clientes para encontrar su fragancia ideal y cerrar la venta de forma √°gil.\n### Cat√°logo de Productos\nBrada Perfumes ofrece tres categor√≠as de productos. Para conocer la lista actualizada de existencias, siempre debes ejecutar la tool informacion_perfumes al inicio de la consulta:\n**Perfumes Full Size**: Botellas completas en su presentaci√≥n original (ej. 100ml, 120ml).\nEjemplos clave: 9 PM, Hawas Ice, Khamrah, Asad, Creed Aventus.\n**Decants**: Perfumes originales trasvasados a presentaciones peque√±as de 5ml o 10ml. Son ideales para que el cliente pruebe la fragancia antes de comprar el frasco grande.\nEjemplos clave: YSL EDP, Club de Nuit Intense, Scandal.\n**Sets de Perfumes**: Estuches especiales que incluyen la fragancia principal y complementos (lociones, geles o miniaturas).\nEjemplos clave: Set Yara, Set 9pm, Set Art of Universe.\nNota Operativa: La tool informacion_perfumes es tu √∫nica fuente de verdad para nombres de productos. Si un cliente menciona un nombre que no est√° en la tool, verifica si existe un nombre similar por error ortogr√°fico antes de confirmar disponibilidad.\n# REGLAS DE ORO\n## **Regla de uso de la tool ‚Äúinformaci√≥n_perfumes‚Äù**.\nAl recibir el mensaje del cliente, SIEMPRE usa la tool ‚Äúinformacion_perfumes‚Äù antes de redactar la respuesta. Esta tool te devolver√° todos los productos que vende nuestra tienda ‚ÄúBrada Perfumes‚Äù los cuales est√°n divididos en tres categor√≠as: ‚ÄúPerfumes full size‚Äù, ‚ÄúDecants‚Äù y ‚Äúset de perfumes‚Äù\nRestricci√≥n de datos: Cabe aclarar que esta tool NO CONTIENE PRECIOS NI STOCK REAL. Su √∫nica funci√≥n es servir de gu√≠a de nomenclatura formal para identificar los productos que ofrecemos. \n## **Regla de ortograf√≠a**\nEsta regla rige c√≥mo Diego debe interpretar y responder a los mensajes con errores de escritura.\n* Inteligencia Sem√°ntica: Diego debe ignorar errores ortogr√°ficos, de puntuaci√≥n o de tildes del cliente para identificar la intenci√≥n real.\nMapeo Autom√°tico: Si el cliente escribe incorrectamente el nombre de un perfume (ej. \"habas ice\", \"9pm elicsir\", \"latifa asad\"), Diego debe asociarlo mentalmente con el producto correcto de la tool ‚ÄúInformacion_productos‚Äù sin pedir aclaraciones.\nNaturalidad en la Respuesta: Al responder, Diego debe escribir los nombres de los perfumes de forma correcta (seg√∫n la tool ‚ÄúInformacion_productos‚Äù) para mantener el profesionalismo, pero sin resaltar el error del cliente.\nEjemplo de Aplicaci√≥n:\n- Entrada del cliente: \"hola ermano presio del cnit untold\"\n- Acci√≥n de Diego: Identifica \"hermano\", \"precio\" y \"Club de Nuit Untold\".\n- Respuesta de Diego: \"Hola hermano, el Club de Nuit Untold s√≠ lo tenemos disponible. El precio es de S/...\"\n## **Regla de cierre variable**\nEsta regla evita que Diego suene como un robot de ventas insistente.\nFinalizaci√≥n Variable: No es obligatorio terminar cada mensaje con una pregunta. Diego debe evaluar si la conversaci√≥n requiere una pregunta para avanzar o si una afirmaci√≥n directa es m√°s natural seg√∫n el contexto.\nGu√≠a de Ejemplos: El agente debe seguir estrictamente la estructura de la secci√≥n \"EJEMPLOS DE CONVERSACI√ìN\" para identificar en qu√© fases se cierra con una pregunta y en cu√°les se cierra con una instrucci√≥n directa (ej. al pedir el comprobante o solicitar datos).\nCero Presi√≥n: Si el cliente muestra inter√©s general pero no intenci√≥n de compra, Diego debe responder de forma informativa y cerrar de manera amable sin presionar por una respuesta inmediata.\n## Regla de tiempo de entrega:\nEsta regla rige c√≥mo informar sobre la llegada del pedido utilizando la hora actual seg√∫n el input (current_date).\nPara Lima (env√≠o por motorizado): Si el pago se valida antes de las 10:00 am, el pedido llega el mismo d√≠a. De lo contrario, llega el d√≠a de ma√±ana.\nPara Provincia (env√≠o por la agencia Shalom): Si el pago se valida antes de las 4:00 pm, se entrega a la agencia el mismo d√≠a. El tiempo de viaje es de 2 a 5 d√≠as h√°biles.\nAplicaci√≥n: Responde siempre con seguridad seg√∫n la hora actual. No des rangos vagos si el cliente ya pas√≥ el l√≠mite de hora.\n## Regla de env√≠os\nPol√≠tica: Solo realizamos env√≠os a domicilio o agencia; no contamos con la opci√≥n de recojo en tienda f√≠sica.\nAplicaci√≥n: Si el cliente pregunta por una direcci√≥n f√≠sica para recoger su pedido, inf√≥rmele amablemente que operamos exclusivamente mediante env√≠os.\n## Regla de solicitudes presenciales\nAplica cuando el cliente desea visitar el local, ver los perfumes en persona o agendar una cita presencial.\nEjemplos de activaci√≥n: \"Quiero ir a ver los perfumes en persona\", \"Podemos programar una cita para ir de manera presencial con mi amigo\" o \"¬øD√≥nde est√°n ubicados para ir hoy?\".\nAcci√≥n: Utilice la tool pasar_supervisor.\nRespuesta obligatoria: \"Voy a comunicarme con mi compa√±ero para que te confirme el horario\".\n\n\n\n#FASES DE FLUJO DE FUNCIONAMIENTO\n## FASE 1: 1. SALUDO Y PROTOCOLO INICIAL\nEsta fase establece el primer contacto. El saludo se env√≠a una sola vez en toda la conversaci√≥n y no se solicita el nombre del cliente.\nL√≥gica de Inicio seg√∫n el mensaje del cliente:\nESCENARIO A: Mensaje gen√©rico o sin producto identificado Aplica cuando el cliente dice \"Hola\", \"Info\", \"Precios\", o env√≠a un mensaje que no menciona un producto de la Lista Maestra.\nAcci√≥n: Saludar de forma directa.\nRespuesta Obligatoria: \"Hola hermano, en qu√© perfume est√°s interesado?\".\nESCENARIO B: El cliente menciona un perfume o marca desde el inicio Aplica cuando el cliente consulta directamente por un producto (ej: \"precio del hawas\").\nAcci√≥n 1 : Asociar el t√©rmino con el nombre t√©cnico de la lista de ‚Äúperfumes_full_size‚Äù de la tool ‚Äúinformacion_productos‚Äù (ej: \"9pm\" ‚Üí \"9 PM\").\nAcci√≥n 2: Preparar el mensaje de saludo y luego pasa a la ‚ÄúFase 2:  2. IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)‚Äù\nEjemplo de respuesta: \"Hola hermano. (para responder sobre el perfume o sobre la intenci√≥n del cliente pasa a la fase 2)‚Äù.\n## FASE 2: IDENTIFICAR LA NECESIDAD DEL CLIENTE (L√ìGICA OPERATIVA)\nEsta fase es el n√∫cleo de la venta. Diego debe mapear el lenguaje del cliente a los productos reales y consultar la disponibilidad exacta.\nCASO A: Perfumes Full Size\nAplica cuando el cliente pide informaci√≥n, precio o disponibilidad de uno o varios perfumes de la lista.\nMapeo Sem√°ntico: Antes de usar la tool, asocia el nombre que diga el cliente con el nombre m√°s cercano de la Lista Maestra.\nUso de Tool: Activa stock_perfumes con el input: disponibilidad del perfume: [Nombre exacto].\nEl nombre del perfume env√≠alo entre comillas.\nEscenario 1: Consulta por un solo perfume\nAcci√≥n: Ejecuta ‚Äústock_perfumes‚Äù.\nLa tool devolver√° el nombre del perfume y con dos datos: \nstock: (si o no). \nStock = si : significa que est√° disponible el perfume\nStock = no : significa que esta agotado el perfume\nSi hay stock: Sigue el Ejemplo 1 de entrega de informaci√≥n.\nSi NO hay stock: La tool sugerir√° perfumes similares. Debes presentarlos de forma atractiva siguiendo el Ejemplo 2.\nEscenario 2: Consulta por m√∫ltiples perfumes\nAcci√≥n: Ejecuta la tool para todos los perfumes mencionados en un solo input: ‚Äúdisponibilidad de los perfumes: 1. [Nombre], 2. [Nombre]...‚Äù\nEnv√≠a cada nombre de los perfumes entre comillas.\nResultados Mixtos:\nSi hay de todos: Sigue el Ejemplo 3.\nSi falta alguno: Sigue el Ejemplo 4 (confirmas lo que hay y ofreces alternativas para lo que no).\nCASO B: Decants (Presentaciones de 5ml o 10ml)\nAplica cuando el cliente busca probar fragancias o indica cantidades peque√±as. Generalmente los clientes piden varios a la vez.\nEjemplos de Entrada del Cliente:\n‚Äúhawas 5ml, harana 10ml, asad 10ml y gos diamond 5ml‚Äù\n\"¬øTienes el 9pm en 5ml?\"\n\"Quiero probar el Hawas y el Asad en 10ml cada uno\".\n\"P√°same precio de decants de 5ml\". En este caso consultar sobre cual desea.\nIdentificaci√≥n: Si el cliente menciona \"5ml\", \"10ml\", \"peque√±o\" o \"para probar\", tr√°talo como Decant.\nUso de Tool: Activa ‚Äústock_decants‚Äù seg√∫n la cantidad de decants que solicita adquirir:\nSi es un solo decant, envia el input: ‚Äúdisponibilidad de decant: [Nombre del perfume] en [Cantidad].‚Äù\nSi es m√°s de un decant, env√≠a el input ‚Äúdisponibilidad de decants: [Nombre del perfume] en [Cantidad]. [Nombre del perfume] en [Cantidad]....‚Äù\nCASO C: Sets de Perfumes\nAplica cuando el cliente busca estuches de regalo o packs que incluyen complementos.\nEjemplo \nAcci√≥n: Revisa la secci√≥n \"Set de perfumes\" del Conocimiento General para validar si el nombre coincide con un set real.\nUso de Tool: Activa ‚Äústock_set_perfumes‚Äù con el input: disponibilidad del SET: [Nombre del Set].\nSi consulta sobre m√°s de un set, env√≠a el input: ‚Äúdisponibilidad del SET: [Nombre del Set]. disponibilidad del SET: [Nombre del Set].‚Äù\nNota: Si el cliente pregunta por un perfume y un set al mismo tiempo, consulta ambos en la misma ejecuci√≥n de la tool.\n## FASE 3: CONFIRMACI√ìN Y LOG√çSTICA DE ENV√çO\nEsta fase se activa cuando el cliente muestra una Intenci√≥n Real de Compra (ej. \"¬øC√≥mo pago?\", \"Lo quiero\", \"P√°same tu cuenta\") o despu√©s de que Diego presente la disponibilidad y precios.\n1. Generaci√≥n del Resumen\nDiego debe presentar un resumen estructurado basado en la secci√≥n #EJEMPLOS DE RESUMEN DE COMPRA.\nRegla de Oro: El total NO incluye el env√≠o todav√≠a. El env√≠o se suma en la Fase 4.\nPregunta de Cierre: Siempre debe terminar con la pregunta: \"¬øPara qu√© distrito o ciudad ser√≠a el env√≠o?\"\n2. Validaci√≥n de Ubicaci√≥n (Uso de Tool)\nUna vez que el cliente responde con un lugar, Diego debe ejecutar la tool distritos.\nL√≥gica de Clasificaci√≥n:\nCASO LIMA: Si el distrito indicado est√° en la lista de la tool distritos (Lima Metropolitana y Callao), se clasifica como Escenario A.\nCASO PROVINCIA: Si el lugar indicado NO est√° en la lista (ej. Piura, Cusco, Trujillo, o distritos de otras regiones), se clasifica autom√°ticamente como Escenario B.\n\n## FASE 4. M√âTODOS DE PAGO Y VALIDACI√ìN\nDiego presentar√° los m√©todos de pago bas√°ndose estrictamente en la ubicaci√≥n identificada. El costo de env√≠o es de S/12 en todos los casos.\nEscenario A: Lima Metropolitana (Distritos indicados)\nRegla: El cliente tiene la opci√≥n de pagar solo el env√≠o (S/12) por adelantado para confirmar, y el saldo del perfume lo cancela al recibirlo.\nMensaje: \"Para Lima puedes confirmar tu pedido pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Si prefieres, tambi√©n puedes pagar el monto total.\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante.‚Äù\nRegla de Flexibilidad: El cliente puede elegir pagar solo el env√≠o o el total.\nEscenario B: Provincia / Env√≠os por Shalom\nRegla: El pago debe realizarse por el monto completo (Perfume + S/12 de env√≠o) antes de despachar.\nMensaje: \"Para enviarte a provincia, el pago es por el monto total: son S/ [Precio del perfume] del perfume + S/ 12 del env√≠o por Shalom. En total ser√≠a S/ [Suma de ambos].\\n\\n‚úÖYape/Plin: 987108094 a nombre de Brandon Quelopana.\\n‚úÖTransferencia BCP:\\nCuenta Soles: 19197964496033\\nCCI: 00219119796449603352\\nNombre: Brandon Quelopana Rosales. Para validar tu pedido, por favor env√≠ame la captura del comprobante..‚Äù\nReglas Cr√≠ticas de Validaci√≥n:\nSolo Imagen: La compra √öNICAMENTE se valida mediante el input Imagen_analizada. No aceptes confirmaci√≥n por texto (\"ya pagu√©\") ni por audio.\nC√°lculo de Montos: * Si el cliente est√° en Lima y env√≠a un comprobante de S/ 12, Diego debe decir: \"Reserva de S/ 12 verificada. El saldo de S/ [Monto del Perfume] lo cancelas al recibir.\" y pasar a pedir datos.\nSi el cliente env√≠a el pago en partes (ej. dos capturas de Yape), Diego debe sumar ambos montos mentalmente. Solo cuando la suma sea igual al total acordado (o al menos a los S/ 12 en Lima), se da por validado.\n\n## FASE 5. SOLICITUD DE DATOS Y FINALIZACI√ìN\nTras validar el pago exitosamente seg√∫n el input ‚Äúimagen_analizada‚Äù, Diego solicita los datos para la confirmaci√≥n del env√≠o, seg√∫n el caso A o el caso B\nCASO A) Si el env√≠o es para los distritos permitidos de Lima Metropolitana.\n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Direcci√≥n exacta.‚Äù\n2) Validaci√≥n: Diego acepta cualquier formato de nombre y direcci√≥n que el cliente proporcione. No debe cuestionar la direcci√≥n, solo recopilarla.\n3) Utilizar tool: Una vez que tengas ambos datos utiliza la tool ‚Äúconfirmacion_pedido‚Äù y env√≠a las siguientes variables:\n‚ÄúNombre‚Äù\n‚ÄúDireccion exacta‚Äù\n‚Äúproductos‚Äù: el producto o los productos env√≠alos de esta forma: \"Producto 1: [Categor√≠a: Full Size/Decant/Set] [Nombre del Perfume] - [Precio] - [Cantidad]. (Repetir si hay m√°s productos)\".\n4) Confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: Tu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada\nCASO B) Si es de Provincia: \n1) Solicitud de datos: ‚ÄúSu pago ha sido verificado correctamente, ahora por favor indiqueme:\\n\\n- Nombre\\n- Apellidos\\n- DNI\\n- Ciudad/provincia\\n- Nombre de la agencia Shalom donde recoger√°‚Äù\n2) Validaci√≥n: Diego acepta los datos tal cual los env√≠e el cliente (no corregir DNI ni nombres). \n3) Utilizar tool: Una vez identificado todo los datos que solicitaste, utiliza la tool ‚Äúconfirmacion_pedido‚Äù con las siguientes variables:\n\n‚ÄúNombre‚Äù\n‚ÄúApellidos‚Äù\n‚ÄúDNI‚Äù\n‚ÄúCiudad/provincia‚Äù\n‚ÄúNombre_agencia_shalom‚Äù\n‚Äúproductos‚Äù: (Misma l√≥gica del CASO A: Categor√≠a, Nombre, Precio y Cantidad)\nNota: en este caso la variable ‚Äúdireccion_exacta‚Äù coloca ‚Äúnull‚Äù.\n4) confirmaci√≥n: Luego de utilizar la tool ‚Äúconfirmacion_pedido‚Äù  indica: ‚ÄúTu compra ha sido realizada con √©xito. En breve, un asesor se comunicar√° contigo para indicarte el tiempo estimado de llegada.‚Äù\n\n###SECCI√ìN: EJEMPLO DE ENTREGA DE INFORMACI√ìN DE PERFUME\nEjemplo 1 (Un perfume con stock):\n\"El Hawas Ice s√≠ lo tengo en stock. El precio es de S/ 180. Es un perfume ultra fresco y potente, de los que m√°s piden.\"\nEjemplo 2 (Sin stock + Similares sugeridos):\n‚ÄúEl Valentino est√° agotado. Tengo estos que son de la misma vibra y huelen incre√≠ble:\\nJPG Le Male Elixir a S/ 450\\n\\nScandal Le Parfum a S/ 420 ¬øAlguna de esas opciones te llama la atenci√≥n?\"\nEjemplo 3 (M√∫ltiples perfumes con stock):\n\"Tengo los dos disponibles:\\n\\n9 PM a S/ 140\\nKhamrah Dukhan a S/ 175\"\nEjemplo 4 (Stock mixto):\n\"Hermano, te confirmo: el CDN Intense s√≠ lo tengo listo para enviar a S/ 190. El Azzaro lo tenemos sin stock. ¬øQu√© otro perfume te gustar√≠a?\nEjemplo 5 (Decants m√∫ltiples):\n\"Los tengo disponible:\\n\\n9pm Elixir (5ml): S/ 35\\nYara (10ml): S/ 45\\nKhamrah (5ml): S/ 40\\n\\n¬øTe armo el pack con estos tres o quieres chequear alguno m√°s?\"\n\n#EJEMPLOS DE RESUMEN DE COMPRA\n## EJEMPLOS SOLO PERFUMES FULL SIZE\n### Ejemplo 1: Si es solo un perfume\n\"Resumen de compra:\\n- Hawas Ice\\nüì¶ Cantidad: 1\\nüí∞ Precio unitario: S/ 180\\n\\nüíµ Total: S/ 180\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s perfumes Resumen de compra:\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah Dukhan\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 175\\n\\nüíµ Total: S/ 315\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS SOLO PERFUMES DECANTS\n### Ejemplo 1: Si es solo un decant Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- 9 PM Elixir (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 35\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Si son varios decants Resumen de compra de Decants:\n\"Resumen de compra (Decants):\\n- Yara (10ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 45\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\nüíµ Total: S/ 125\\n\\n¬øMe indicas el distrito para continuar?\"\n## EJEMPLOS SOLO SET DE PERFUMES\n### Ejemplo 1: Si es solo un set Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 220\\n\\nüíµ Total: S/ 220\\n\\n¬øPara qu√© distrito deseas el env√≠o?\"\n### Ejemplo 2: Si son dos o m√°s sets Resumen de compra:\n\"Resumen de compra (Set de perfumes):\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\n- GOS Set\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 240\\n\\nüíµ Total: S/ 450\\n\\n¬øMe confirmas el distrito para coordinar el env√≠o?\"\n## EJEMPLOS DE PEDIDOS COMBINADOS\n### Ejemplo 1: Perfume Full Size + Decants\n\"Resumen de compra:\\n- Lattafa Asad\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 150\\n\\n- Hawas Ice (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Yara (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 35\\n\\nüíµ Total: S/ 225\\n\\n¬øPara qu√© distrito ser√≠a el env√≠o?\"\n### Ejemplo 2: Compra Integral (Full Size + Decant + Set)\n\"Resumen de compra:\\n- 9 PM\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 140\\n\\n- Khamrah (5ml)\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 40\\n\\n- Set YARA\\nüì¶ Cantidad: 1\\nüí∞ Precio: S/ 210\\n\\nüíµ Total: S/ 390\\n\\n¬øMe confirmas el distrito para avanzar con el pago?\" \n\n# EJEMPLOS DE FLUJO DE CONVERSACI√ìN CORRECTO\n## EJEMPLOS SI EL CLIENTE DESEA EL ENV√çO PARA LIMA\n1) Pago completo (Perfume + Env√≠o)\nCliente: Hola, quiero el Hawas Ice para Miraflores.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Hawas Ice s√≠ est√° disponible y cuesta S/180. ¬øDeseas agregar algo m√°s a tu compra?.\nCliente: No, solo eso. ¬øC√≥mo hago el pago?.\nDiego: Para Lima puedes confirmar pagando solo S/12 del env√≠o y el saldo al recibir, o pagar el monto total de S/192. Puedes yapear al 987108094 a nombre de Brandon Quelopana o por transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/192).\nDiego (Tras validar Imagen_analizada): Pago de S/192 verificado. P√°same tu nombre, celular y direcci√≥n exacta para programar el env√≠o. Como pagaste antes de las 10:00 am, llega hoy mismo.\n2) Pago parcial (Solo env√≠o S/12 + Saldo contra entrega)\nCliente: Precio del 9 PM. Estoy en San Borja.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El 9 PM cuesta S/140. ¬øQuieres agregar algo m√°s o solo ese?.\nCliente: Solo ese. Quiero pagar solo el env√≠o ahora.\nDiego: Entendido. Para Lima puedes confirmar pagando solo los S/12 del env√≠o y cancelas el perfume al recibirlo. Yapea al 987108094 (Brandon Quelopana) y me mandas la captura.\nCliente: (Env√≠a captura por S/12).\nDiego (Tras validar Imagen_analizada): Reserva de S/12 verificada. P√°same tu nombre, celular y direcci√≥n exacta. El saldo de S/140 lo pagas al recibir el producto.\n## EJEMPLO SI EL CLIENTE DESEA EL ENV√çO PARA PROVINCIA\n3) Pago total obligatorio para Provincia (V√≠a Shalom)\nCliente: Hola, precio de Asad para Piura.\nDiego: Hola hermano, te saluda Diego de Brada Perfumes. El Lattafa Asad cuesta S/150. ¬øDeseas agregar alg√∫n decant o solo el perfume?.\nCliente: Solo el perfume. ¬øCu√°l es el m√©todo?\nDiego: Para env√≠os a provincia el pago se realiza por el monto total de S/162, que incluye los S/12 de env√≠o por Shalom. Puedes pagar por Yape al 987108094 (Brandon Quelopana) o transferencia BCP. Env√≠ame la captura del comprobante.\nCliente: (Env√≠a captura por S/162).\nDiego (Tras validar Imagen_analizada): Pago de S/162 verificado. P√°same tu nombre, apellidos, DNI, celular, ciudad y el nombre de la agencia Shalom donde lo recoger√°s. \n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-5136,288],"id":"87ad49a4-0b30-4cf2-bd78-475265d05fe3","name":"AI Agent"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","typeVersion":1,"position":[-3472,528],"id":"0af2d781-c62f-4cfa-8636-6576d2801773","name":"Auto-fixing Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3504,704],"id":"0be267ba-446a-4cd1-8c35-ea2e696d7e8b","name":"OpenAI Chat Model8","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"response\": {\n    \"parte_uno\": \"Texto correspondiente a la primera parte de la respuesta.\",\n    \"parte_dos\": \"Texto correspondiente a la segunda parte de la respuesta.\",\n    \"parte_tres\": \"Texto correspondiente a la tercera parte de la respuesta (opcional).\",\n    \"parte_cuatro\": \"Texto correspondiente a la cuarta parte de la respuesta (opcional).\",\n    \"imagen_uno\": \"Imagen correspondiente\",\n    \"imagen_dos\": \"Imagen correspondiente (opcional).\",\n    \"video_mp4\": \"Video .mp4 (opcional)\"\n}\n  }"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-3328,704],"id":"05f11a4e-1bcc-4829-a163-8b4e3e1f1534","name":"Structured Output Parser1"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-3744,624],"id":"f2dd9e17-523b-4e58-9b8e-5f00f8fa704f","name":"OpenAI Chat Model9","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"={{ $json.output }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Obtener el texto de entrada:\n\nRecupera el texto de la variable items\n{{ $json.output }}\nLimpieza y normalizaci√≥n del texto:\n\nCrea una funci√≥n que limpie el texto eliminando los siguientes caracteres: ¬ø, ¬°, @, \", *, #.\n\nElimina los espacios en blanco al inicio y al final del texto.\nNo Elimines los emojis, ni los markdown para que los mensajes esten limpios.\nDivisi√≥n del texto en partes:\n\nImplementa una funci√≥n que divida el texto limpio en fragmentos de m√°ximo 800 caracteres sin cortar palabras. Si necesitas cortar uno de los fragementos del mensaje antes de 800 Caracteres para que no se corten mensajes hazlo. Los mensajes deben quedar completo y coherentes\nLa funci√≥n debe asegurarse de que cada fragmento se corte en espacios para no dividir palabras a la mitad.\nSi tienes que aumentar la cantidad de caracteres para que parte del mensaje no quede cortado o quede mal puedes hacerlo sin un limite de caracteres. Esto para que los mensajes sean mas organicos y funcionen bien. Tambien al identificar una imagen necesito que el link lo separes para que se mande separado.\n\n*SIEMPRE* que haiga un Link del video de youtube del tratamiento o presentaci√≥n, mandalo como parte del texto con su contexto, *NUNCA* lo pongas en la parte de imagen uno y dos.\n\n*NUNCA* pongas el link del video.mp4 en las partes de texto e imagen, *SIEMPRE* si es que tienes algun video con .mp4 ponlo en video_mp4.\n\nDeber√°s de enviarlo siempre a la √∫ltima parte pero solo eso.\nConstrucci√≥n de la respuesta:\n\nCrea un objeto JSON con la siguiente estructura:\n\n{\n  \"response\": {\n    \"parte_uno\": \"<primer fragmento>\",\n    \"parte_dos\": \"<segundo fragmento>\",\n    \"parte_tres\": \"<tercer fragmento>\",\n    \"parte_cuatro\": \"<cuarto fragmento>\",\n    \"imagen_uno\": \"<primera imagen>\",\n    \"imagen_dos\": \"<segunda imagen>\",\n    \"video_mp4\": \"<video.mp4>\"\n\n  }\n\n- Si hay un emoji como un check o algo por el estilo que desmuestre un enlistado, opciones o variantes similares, dale salto de linea para que parezca natural, recuerda reemplazar el \"\\n\" por un enter.\n\nSi alguna parte no existe, asigna una cadena vac√≠a (\"\").\n\n\n### Notas \n\n- Nunca debes hacer saltos de linea que no sean naturales evita si en algun momento un mensaje tiene un \":\" que el mensaje que le siga este en la otra parte del mensaje. debe ser lo mas natural posible.\n\n- S√≠ el texto tiene un saludo de bienvenida o algo parecido, *SIEMPRE* separalo en una parte y las siguientes partes separalos de tal forma que se vea ordenada y estructuradas tus respuestas.\n- En caso veas una palabra en asteriscos, ejemplo: **Botox:** deber√°s de quitarle los dos de los extremos y deber√° de quedar as√≠ *Botox:*.\n- *NUNCA* deber√°s de cortar el contexto del mensaje, quiero decir que si ves que el mensaje trata de un tema en espec√≠fico o seccion no deber√°s de cortarlo.\n\nEs Obligatorio reemplazarlo, no eliminarlo. NUNCA DEJAR NINGUNA PARTE VAC√çA OBLIGATORIAMENTE.\n\n- *SIEMPRE* REEMPLAZA \"\\n\" por un salto de linea normal (enter) ejemplo:\n{\n  \"response\": {\n    - opcion 1\n    - opcion 2\n    - opcion 3  \n  }\n}\n\n- *SIEMPRE* y cuando te lleguen dos links de Video.mp4, agarra el primero y no pongas los 2 juntos, si es posible, elimina uno para que solo quede uno.\n\n- *regla adicional* cuando llegue un link que est√© en .jgp .jpeg y .PNG a√±adelo a la parte de imagen, y si est√° en .mp4 a√±adelo al apartado de video "}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-3600,256],"id":"7ca03140-46dd-4d3c-a332-e3ee2072ded6","name":"Verificador1","onError":"continueErrorOutput"},{"parameters":{"httpMethod":"POST","path":"BRADA","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-15296,608],"id":"dbcc07c3-6246-4bdb-878b-af891629f8c8","name":"Webhook","webhookId":"fb43e7b4-c71f-4cad-bebd-32a81374fc49"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}\n","tableName":"healup","contextWindowLength":12},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-5200,48],"id":"39798e20-26eb-4032-ae59-7f5d5b5f7d8b","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"NzQUFXQpp2MvRekP","name":"CUENTA ALEGRATED"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8fa70db3-09c3-4e87-8fc9-4052751fad3f","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9840,512],"id":"d53b946f-7849-4a0c-91b8-673d822caa58","name":"If2","alwaysOutputData":false,"retryOnFail":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"576350e5-ed67-4ce9-815e-0f0a0ef0b1c7","leftValue":"={{ $json.pasar_supervisor }}","rightValue":"no","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-9616,688],"id":"3d169320-db83-4f3e-b8ec-cf4189ac8d7a","name":"If3"},{"parameters":{"assignments":{"assignments":[{"id":"1aa91b6d-c441-4496-beee-4af2457332ac","name":"pasar_supervisor","value":"={{ $json.pasar_supervisor }}","type":"string"},{"id":"34e35c66-589c-4146-ab9c-3d08b024a7c1","name":"n√∫mero","value":"={{ $json.numero }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-9984,512],"id":"e5878ba6-1987-4774-811f-c2cee034cb0a","name":"Edit Fields4"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-9184,992],"id":"02219ac8-19fd-463b-b35f-8880e0676c67","name":"No Operation, do nothing4"},{"parameters":{"name":"pasar_supervisor","description":"Llama esta herramienta cuando desees pasar a supervisor.","workflowId":{"__rl":true,"value":"2lPoYs00jPGwaBxq","mode":"list","cachedResultUrl":"/workflow/2lPoYs00jPGwaBxq","cachedResultName":"Supervisor Solari"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('Edit Fields20').item.json.id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-7248,464],"id":"b5e6fa52-fde1-4c70-b3ba-07a042587076","name":"Supervisor2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"98601c0c-949c-4f3d-99f2-40305665d58a","leftValue":"={{ $json.numero }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-10704,576],"id":"40fc0c0b-0829-40fc-81d5-3da1f46a7a9b","name":"If13"},{"parameters":{"name":"=Agendar","description":"=Agendar citas ","source":"=database","workflowId":{"__rl":true,"value":"konppOdwditJvoJQ","mode":"list","cachedResultUrl":"/workflow/konppOdwditJvoJQ","cachedResultName":"agendarSUNAT WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre_completo":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre_completo', ``, 'string') }}","DNI":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('DNI', ``, 'string') }}","numerotelefono":"={{ $json.id }}","inicio_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('inicio_cita', ``, 'string') }}","fin_cita":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fin_cita', ``, 'string') }}","tratamiento(s)":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('tratamiento_s_', `Coloca el tratamiento que se haya mencionado durante la conversaci√≥n, seg√∫n esta lista de tratamientos:\n\n- Lipopapada & Afinamiento Facial Enzim√°tico\n- Natural Lips\n- Bratz Lips\n- Perfilamiento de nariz\n- Rinomodelaci√≥n completa\n- Exosomas + Esperma de Salm√≥n\n- Proyecci√≥n de Ment√≥n con √Åcido Hialur√≥nico\n- Baby Botox\n- Botox Full Face\n- Marcaci√≥n mandibular\n- Masseter Botox\n- Surcos Nasogenianos\n- Sustentaci√≥n pomular\n- √Åcido Hialur√≥nico para ojeras\n- NCTF\n- Hidralips con Dermapen\n- Plasma Rico en Plaquetas (PRP)\n- Armonizaci√≥n Facial \n\n- Glass Skin Babe\n- CalmBabe\n- Pure Babe Skin\n- Heal Up Babe Ritual\n- Prime Skin Clean\n- Eternal Glow Boost\n- Prestige Glow Ritual\n- Heal Up Signature Glow\n\n- Lipo Start Protocol\n- Lipo Sculpt Protocol\n- Lipo Intensive Shape Protocol\n- Heal Up Lipo 360‚Äù.\n\nNota: Si el paciente consult√≥ sobre m√°s de 1 tratamiento, a√±adelo con una coma. por ejemplo: Rinomodelaci√≥n completa, Baby Botox.\n`, 'string') }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","red_social":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('red_social', `Coloca esta palabra: WhatsApp`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"nombre_completo","displayName":"nombre_completo","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"inicio_cita","displayName":"inicio_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"fin_cita","displayName":"fin_cita","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"numerotelefono","displayName":"numerotelefono","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"DNI","displayName":"DNI","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"red_social","displayName":"red_social","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"tratamiento(s)","displayName":"tratamiento(s)","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-5504,784],"id":"5334487f-6a0c-48f2-8833-2cece4f6c66e","name":"Calendario"},{"parameters":{"tableId":"pasar_supervisor_BRADA","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"},{"fieldId":"conversation_id","fieldValue":"={{ $('If12').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10480,832],"id":"6da92ad7-7496-46b2-ad7a-af1302bdca1b","name":"Create a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10192,512],"id":"e01e05d9-2c86-4f10-8067-8d296b347400","name":"Get a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9536,416],"id":"08f4c79d-67de-4997-8b28-3d94436c885c","name":"Update a row1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-10960,592],"id":"0383d00f-4ae0-4f14-850a-4ee2703bbc58","name":"Get a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2acc3e64-d51a-4e98-84a5-e2b17c788fa2","leftValue":"={{ $('Webhook').item.json.body.payload.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7312,592],"id":"645bde3e-f301-4b37-a037-b78f2c234bab","name":"If4"},{"parameters":{"operation":"formatDate","date":"={{ $json.currentDate }}","format":"custom","customFormat":"DDDD tt","options":{"timezone":true}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-6896,576],"id":"c0cfb4f3-987c-429b-9a57-9f8b58dd70a2","name":"Formatea fecha"},{"parameters":{"assignments":{"assignments":[{"id":"d78c89a3-c878-48b7-aa84-4b2674c0667b","name":"data.remoteJid","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation.contact_inbox.source_id }}","type":"string"},{"id":"432a9602-e38b-4880-a64d-b832d120edda","name":"data.id","value":"={{ $('Webhook').item.json.body.id }}","type":"string"},{"id":"d2f45efc-03ac-4c74-b70e-959b06cd2a0b","name":"data.text","value":"={{ $('Edit Fields17').item.json.mensajetexto }}{{ $('Edit Fields17').item.json.mensajeaudio }}{{ $('Edit Fields17').item.json.mensajeimagen }}","type":"string"},{"id":"d77208a8-161b-4ef3-96fa-261a87cf1f39","name":"conversation_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}","type":"string"},{"id":"8c279598-20f0-4012-a4ee-8c7898ceaba4","name":"account_id","value":"={{ $('Webhook').item.json.body.conversation.messages[0].account_id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6448,576],"id":"e0ece9a2-acd1-450f-9e2f-a45df7d9021e","name":"Handler variables"},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-7072,576],"id":"34435b05-c9a2-4759-b275-a239d12bbcb1","name":"Fecha"},{"parameters":{"jsCode":"// 1. Obtener la fecha de entrada\nconst inputDateString = $input.item.json.formattedDate; \nconst date = new Date(inputDateString);\n\n// 2. Obtener hora actual para la l√≥gica\nconst currentHour = date.getHours();\n\n// Clonamos la fecha para calcular el env√≠o\nlet scheduledDate = new Date(date);\n\n// 3. L√≥gica de Negocio (Reglas de horario)\nif (currentHour >= 19 || currentHour < 5) {\n  // Caso Nocturno (19:00 - 04:59): Programar para las 09:00 AM\n  scheduledDate.setHours(9, 0, 0, 0);\n  \n  // Si es >= 19:00, pasa al d√≠a siguiente.\n  if (currentHour >= 19) {\n    scheduledDate.setDate(scheduledDate.getDate() + 1);\n  }\n} else {\n  // Caso Diurno (05:00 - 18:59): Sumar 4 horas\n  scheduledDate.setHours(scheduledDate.getHours() + 4);\n  // Reiniciamos minutos y segundos a 0 para mantener limpieza (opcional, pero recomendado)\n  scheduledDate.setMinutes(0);\n  scheduledDate.setSeconds(0);\n}\n\n// 4. FORMATEO DE SALIDA \"dd/mm/yyyy HH\"\n// Usamos .padStart(2, '0') para asegurar dos d√≠gitos (09, 05, etc.)\n\nconst day = scheduledDate.getDate().toString().padStart(2, '0');\nconst month = (scheduledDate.getMonth() + 1).toString().padStart(2, '0');\nconst year = scheduledDate.getFullYear();\nconst hourFormatted = scheduledDate.getHours().toString().padStart(2, '0');\n\n// CONSTRUCCI√ìN FINAL: dd/mm/yyyy HH\n// Nota: Eliminamos los minutos (:${minuteFormatted}) de esta l√≠nea\nconst fecha_final = `${day}/${month}/${year} ${hourFormatted}`;\n\nreturn {\n  json: {\n    original_input: inputDateString,\n    // Variable solicitada con el formato exacto\n    fecha_lora_formateada: fecha_final,\n    // Variable extra por si necesitas solo la hora aislada\n    solo_hora: hourFormatted\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6640,576],"id":"7235933b-bf69-4698-9133-cfe47b370ffc","name":"Code2"},{"parameters":{"amount":30},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-7312,1072],"id":"6e3e7abf-d38f-40b1-b0c4-a8e166fc036c","name":"Wait6","webhookId":"5696ca8f-19ae-4cd6-8008-6132ce1cf272"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8a313a41-eadc-4ada-bc2a-feff79845de9","leftValue":"={{ $json.mensajes[0] }}","rightValue":"={{ $('Handler variables').item.json.data.text }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6864,1296],"id":"76729177-6c0d-4ec2-bf0a-0604e5bbf8a9","name":"If6"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-6544,1376],"id":"2c667d72-3de1-4d9e-bff9-88ce886f1c91","name":"No Operation, do nothing1"},{"parameters":{"operation":"delete","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6240,1024],"id":"31c060d8-e6c1-489f-924b-36ee33dce137","name":"Delete Redis","executeOnce":false,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $('Get Redis1').item.json.mensajes.join() }} y el lead viene de un anuncio : {{ $('RESUMIDOR ANUNCIOS').item.json.output }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Wait6').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.payload._data.Info.PushName }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6352,832],"id":"fa0d6541-f1f5-42a3-918d-072dec78f8be","name":"Edit Fields19","alwaysOutputData":true},{"parameters":{"operation":"get","propertyName":"mensajes","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","keyType":"list","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6960,1088],"id":"eb2e5436-c84c-4660-a049-366ff67222ee","name":"Get Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"assignments":{"assignments":[{"id":"d5f82380-4858-4361-908e-98e45c98f092","name":"response","value":"={{ $json.anuncio }}","type":"string"},{"id":"ad4d9354-f95c-4a9f-befe-ce39975dd2d1","name":"id","value":"={{ $('Handler variables').item.json.data.remoteJid }}","type":"string"},{"id":"4a3efba4-ba7d-414f-806f-eb6fba7bdf66","name":"nombre","value":"={{ $('Webhook').item.json.body.conversation.messages[0].sender.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-6368,992],"id":"a0199bbc-432c-4d05-a271-0c734eec08cd","name":"Edit Fields20","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3e8a5a20-c60c-48ef-a636-2b5e14a683a8","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6608,944],"id":"61e1b52d-148e-41fd-9b0b-7e4895ad7a0a","name":"If15"},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1136],"id":"edcdff4c-5e82-4bfe-8beb-45b771f8bed2","name":"METER_ANUNCIO","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","messageData":"={{ $json.data.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8192,1296],"id":"666f3eb7-d307-4a99-abd7-1f526c0907fd","name":"BAJAR_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"push","list":"={{ $('numero').item.json.numero }}_ad","messageData":"={{ $('RESUMIDOR ANUNCIOS').item.json.output }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-8064,1136],"id":"5a5ab926-f0b0-420f-ad66-6f99a6d9eb9f","name":"guarda_ANUNCIO","alwaysOutputData":true,"credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"3deed863-79f3-42e5-a32c-6cb7bb1028df","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7616,512],"id":"46ecb883-24f2-490a-a44c-a9e6dd7a5ab2","name":"If"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-7488,32],"id":"76495bc9-2132-42c6-8f98-7f222fbc58ab","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"8f567177-8b37-4a09-9a53-ac9fe424c843","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6240,576],"id":"49f7d2d6-bf9c-4b3f-bde9-d5b04db1203a","name":"If10"},{"parameters":{"operation":"get","propertyName":"anuncio","key":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-6752,944],"id":"16a19e11-3a97-49d7-b868-7b84b7799dc7","name":"Redis1","credentials":{"redis":{"id":"8uKVCAx2Azrg6z3X","name":"Redis account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-6928,272],"id":"31f4a897-b5fc-4baa-a8ac-c4645d7e6b10","name":"Update a row4","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"Describe esta imagen\n","imageUrls":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].data_url }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8864,560],"id":"655bda6d-6ab1-42a8-85c1-736575210b9b","name":"OpenAI","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"437f223f-80c7-4c47-a50b-9d17a8614251","name":"imagen_caption","value":"={{ $json.content }} .\nEl captions del mensaje de imagen es: {{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8448,688],"id":"fa56722a-8385-4847-b719-f90a132dfbd1","name":"Edit Fields12"},{"parameters":{"url":"={{ $('Webhook').item.json.body.attachments[0].data_url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-8896,368],"id":"f1138959-5c6f-4058-a15b-6e56bdaab777","name":"HTTP Request"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"27bcc104-31e3-4687-b60b-a018c457a3a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"audio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2e8b532f-1f01-45f9-a647-e7a5c9e48aac","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"image","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Imagen"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"59f6b23a-3029-4225-8f9e-3744611a04a9","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].attachments[0].file_type }}","rightValue":"=text","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"28de146f-c104-4171-924a-29963c4f1970","leftValue":"={{ $('Webhook').item.json.body.content_type }}","rightValue":"text","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-9216,416],"id":"b138e8be-c1d3-4f8a-8423-93fb52834ba7","name":"Switch3"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[-8624,368],"id":"f26677a7-27a0-43ed-8071-3e3064e25db4","name":"AUDIO1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"276cbb8a-79f2-4f08-b24a-632f474c6013","leftValue":"={{ $('Webhook').item.json.body.payload._data.Message.imageMessage.caption }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-8624,560],"id":"f29adecc-e9d9-4222-9ec3-107cac681c09","name":"If16"},{"parameters":{"assignments":{"assignments":[{"id":"c0a1b2f0-373e-4b86-ae91-25346b20b404","name":"mensajetexto","value":"=Texto mensaje: [{{ $('Webhook').item.json.body.conversation.messages[0].content }}]  ","type":"string"},{"id":"35cd9184-e37e-4d03-9dff-efb319dce478","name":"mensajeaudio","value":"={{ $json.text }}","type":"string"},{"id":"47e9bfe8-2c55-4b5d-b047-024871fc6c21","name":"mensajeimagen","value":"=Imagen analizada: [{{ $json.content }}{{ $json.imagen_caption }}]","type":"string"},{"id":"9926d346-600f-45af-adad-876e9f40ffa4","name":"imagenanalizada","value":"=Imagen de anuncio analizado: {{ $json.content }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-8064,480],"id":"8a1f15fa-bf4b-4c01-adbb-7a1a21d7a706","name":"Edit Fields17","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $('Webhook').item.json.body.payload.body }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7120,400],"id":"7ab44ba1-258f-4193-929d-15aa68334a0f","name":"If11"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f05066b5-5a07-41fa-96b7-7a244e7345c8","leftValue":"={{ $json.body.payload.fromMe }}\n","rightValue":"true","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12384,608],"id":"d94743f2-3b7b-460b-bc26-33eae6240210","name":"If12"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"944a2657-94f8-45aa-95fd-e3ba40a9955a","leftValue":"={{ $json.body.conversation.messages[0].content }}","rightValue":"Hola, te saluda la administradora","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12224,752],"id":"23a75e86-d3fd-4b05-8d58-aa9da67a47d8","name":"If20"},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $json.body.conversation.meta.sender.phone_number }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-12144,1008],"id":"a93457ed-fd5d-4186-b320-c1a49417136c","name":"Update a row6","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"name":"informacion","description":"utiliza esta tool cuando se necesite informaci√≥n seg√∫n las indicaciones del prompt principal.","workflowId":{"__rl":true,"value":"FB7us6cBaq7jWqB2","mode":"list","cachedResultUrl":"/workflow/FB7us6cBaq7jWqB2","cachedResultName":"informacion HEAL UP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}"},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-6080,784],"id":"e0e915c5-fd08-4168-be41-783aa4ce1390","name":"informacion_tratamientos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"987d5d07-58eb-4927-8e68-a137884b8100","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].message_type }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13248,608],"id":"5e339c78-27b7-41de-8774-f34bd2e49752","name":"If1"},{"parameters":{"jsCode":"// Tomamos todos los items que vienen del nodo anterior (Verificador1)\nconst items = $input.all();\n\nfor (const item of items) {\n  // Aqu√≠ est√° tu objeto con parte_uno, parte_dos, etc.\n  // Verifica la ruta: output.response\n  const resp = item.json.output?.response || {};\n\n  // Orden que quieres respetar\n  const orderedKeys = [\n    'parte_uno',\n    'parte_dos',\n    'parte_tres',\n    'parte_cuatro',\n    'imagen_uno',\n    'imagen_dos',\n    'video_mp4',\n  ];\n\n  // Armamos un nuevo objeto response en el orden deseado\n  const newResponse = {};\n  for (const key of orderedKeys) {\n    if (resp[key]) {\n      newResponse[key] = resp[key];\n    }\n  }\n\n  // Sobrescribimos manteniendo la estructura original\n  if (!item.json.output) item.json.output = {};\n  item.json.output.response = newResponse;\n}\n\n// Devolvemos los items modificados\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2752,352],"id":"24f0ff65-46ee-441c-a6d4-8f9095be5ae0","name":"ordenar"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $json.output.response.parte_uno ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2720,1088],"id":"88a82162-8ee2-4a01-8f95-a7350bae11d1","name":"Respuesta1","executeOnce":false},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1776,832],"id":"cce742aa-91d4-4fd6-971b-02494cc4941d","name":"Wait2","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_dos ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1600,928],"id":"6c953a90-8ee3-40d6-b6fd-f29c2e766496","name":"Respuesta2","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1312,848],"id":"0a8bc622-6c9b-472d-8735-328b027264ff","name":"If14"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1120,832],"id":"568f10ce-4d13-4754-843d-d05277b38f48","name":"Wait3","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_tres ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-912,896],"id":"3cb7de22-5651-4c25-b9eb-6132643c3bbe","name":"Respuesta3","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-496,752],"id":"af5809e5-112a-4632-aeaf-44bd7061fd9e","name":"If17"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-480,976],"id":"d9d3f88f-ef89-458a-8d83-ad4661e1b4e6","name":"Wait4","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Webhook').item.json.body.account.id }}/conversations/{{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}/messages\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=hcy6n6RAJTBAAYguVuewgp2A"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {{ JSON.stringify( $('Verificador1').item.json.output.response.parte_cuatro ) }},\n  \"message_type\": \"outgoing\",\n  \"content_type\": \"text\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-256,1008],"id":"319a272b-7a67-4de3-bcc3-381f609226df","name":"Respuesta4","executeOnce":false},{"parameters":{"promptType":"define","text":"=Te va a llegar esta descripcion de un anuncio: {{ $('Webhook').item.json.body.payload._data.Message.extendedTextMessage.contextInfo.externalAdReply.body }}","options":{"systemMessage":"ROL:\nTu rol es indicar el mismo input que te llega y enviarlo como output."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-7504,192],"id":"7dd13519-eebb-4cd8-9fbe-870c4eb2ea0b","name":"RESUMIDOR ANUNCIOS"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1a9dd789-5c10-4489-a344-6b7a0fd041ea","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51902215511","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"912d0724-5ef1-4f88-9d43-acbb38f48cee","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51993708540","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"e50ad623-45f5-4af7-bc5a-89708016ddf8","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51972619000","operator":{"type":"string","operation":"equals"}},{"id":"9ffd5afb-ec0c-49fc-a144-b682386c760c","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51960239280","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"50ddfe27-4e13-4e3c-8216-aca1f181f77a","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51936196001","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"7650a20c-4ba9-4e41-bd67-89e8f77278fc","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"14502413970","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"bdfe444d-b4d9-4789-971d-08420999d775","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51945157250","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"5f1e9684-e18d-4a9f-aad7-bef2235f631d","leftValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}","rightValue":"51971119678","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-13888,864],"id":"fc9e995e-943d-4cce-8e72-ee42d86cee6c","name":"If18"},{"parameters":{"description":"usa la tool supervisor seg√∫n el prompt principal","workflowId":{"__rl":true,"value":"xchwhR053ynGsZI4","mode":"list","cachedResultUrl":"/workflow/xchwhR053ynGsZI4","cachedResultName":"SUP SUNAT"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $json.id }}","conversation_id":"={{ $('If7').item.json.conversation_id }}","inbox_id":"={{ $('If12').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":["numero"],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5616,832],"id":"5e99594b-abaa-47fe-872d-198f951381e9","name":"Supervisor"},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje1","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_uno }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"},{"fieldId":"account id","fieldValue":"={{ $('Webhook').item.json.body.account.id }}"},{"fieldId":"conversation id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2544,1088],"id":"476c18e7-85f6-493d-b3aa-14cfdf31bcc3","name":"Update a row","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje2","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1472,944],"id":"d7b09d89-120c-41de-af99-2ac3e43b9c64","name":"Update a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje3","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_tres }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-720,896],"id":"87f26d37-d4e6-4022-b8e7-d0be58f20d22","name":"Update a row5","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"operation":"get","tableId":"seguimiento_healup","filters":{"conditions":[{"keyName":"numero","keyValue":"={{ $json.body.conversation.contact_inbox.source_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-15088,608],"id":"f952306b-6aab-4f21-ba58-cdd5dcebe32c","name":"Get a row3","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}},"disabled":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"60e8198a-90ea-44a7-8f27-6e37021a1a02","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje1 }}","operator":{"type":"string","operation":"equals"}},{"id":"4541b27d-6dfa-47d7-bbff-d1a5c2e6ffd1","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje2 }}","operator":{"type":"string","operation":"equals"}},{"id":"20ce2efd-2509-40d0-b670-2c484246fa28","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje3 }}","operator":{"type":"string","operation":"equals"}},{"id":"b74b14df-879c-4427-8888-d7e1e3212ddc","leftValue":"={{ $('Webhook').item.json.body.conversation.messages[0].processed_message_content }}","rightValue":"={{ $json.ult_mensaje4 }}","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-14880,608],"id":"5c2a2d65-e6b0-4eff-8611-1286cc5f3519","name":"If19","alwaysOutputData":true,"disabled":true},{"parameters":{"operation":"update","tableId":"seguimiento_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"ult_mensaje4","fieldValue":"={{ $('Verificador1').item.json.output.response.parte_cuatro }}"},{"fieldId":"hora","fieldValue":"={{ $('Code2').item.json.fecha_lora_formateada }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[0,1008],"id":"3bfbc342-a045-4fb3-b813-77c25a76e4fd","name":"Update a row7","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"daeff2da-d88d-4aa7-b4d9-8b808c58b7c8","leftValue":"={{ $json.conversation_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7664,1824],"id":"4456591c-6e0e-41e1-8fe3-d6b190cf5b8a","name":"If7"},{"parameters":{"operation":"get","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","keyValue":"={{ $('Get a row3').item.json.body.conversation.messages[0].conversation_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7920,1520],"id":"7eb28718-e96b-48aa-aaa6-9595b57209be","name":"Get a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"BRADA_followups","fieldsUi":{"fieldValues":[{"fieldId":"conversation_id","fieldValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7232,1664],"id":"032dfeeb-7358-4670-bfc8-e64deb12607b","name":"Create a row1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"model":"gpt-5.1","options":{"reasoningEffort":"low"}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5440,496],"id":"ff0bf49f-19d4-4e02-92fc-84ddcb1a06e5","name":"RAZONADOR PLUS","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"BRADA_followups","filters":{"conditions":[{"keyName":"conversation_id","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"followup1_sent_at","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7536,1424],"id":"456e5e75-da23-4eaf-b219-2d0e6a4c9772","name":"Update a row9","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"tableId":"pasar_supervisor_healup","fieldsUi":{"fieldValues":[{"fieldId":"numero","fieldValue":"={{ $('Webhook').item.json.body.conversation.contact_inbox.source_id }}"},{"fieldId":"pasar_supervisor","fieldValue":"no"},{"fieldId":"numero de veces","fieldValue":"1"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9872,1184],"id":"22e69871-698c-451d-97be-e15985b9f1ca","name":"Create a row2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"method":"POST","url":"=https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"=4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": \"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg\",\n  \"message_type\": \"outgoing\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3152,1440],"id":"1e6becc0-86ad-4636-968f-82b82ce1d008","name":"Respuesta6","executeOnce":false},{"parameters":{"url":"https://qzmgizrvdukyxvpgclvd.supabase.co/storage/v1/object/public/IMAGENES-HEALUP/BRATZ.jpg","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3648,1424],"id":"c91882f6-4156-4928-83f4-db575130f873"},{"parameters":{"method":"POST","url":"https://web.wazend.net/api/v1/accounts/43/conversations/593/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"4vkPdUh1XXM3aqdrUtj9zjuo"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content","value":"Aqu√≠ tienes la imagen adjunta üëá"}]},"options":{}},"name":"2. Enviar a Chatwoot","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-3440,1408],"id":"bb8131d9-ee4a-4ce7-bfcd-6484ee58e6e9"},{"parameters":{"content":"## EJEMPLO IMAGENES\n","height":320,"width":560},"type":"n8n-nodes-base.stickyNote","position":[-3744,1328],"typeVersion":1,"id":"14ea41f0-1e70-47f8-ad8d-cad36bd5ba28","name":"Sticky Note"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"651db568-502a-4d41-bc6d-20627bb1ad7f","leftValue":"={{ $('Verificador1').item.json.output.response.parte_dos }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2352,1056],"id":"da693219-5a37-4d6b-b186-6b04eb3a09a2","name":"If8"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1184,1440],"id":"00fb4ecc-2c2b-43c7-a5b0-3bc928404b03","name":"If23"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-976,1424],"id":"b350fa31-345e-420d-9213-4ccd1c603f30","name":"If26"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-624,1840],"id":"4b2323d7-ade6-4594-9192-1b4e2251a93b","name":"If27"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1248,1392],"typeVersion":1,"id":"ffa9ce31-0ae1-4e74-af8a-05d40968ab54","name":"Sticky Note2"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-752,1440],"id":"84b7f3b1-5259-47e9-976f-6a01df9ed583","name":"Wait","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-176,1648],"id":"acf88893-aecd-41e2-8a76-6b13efecaf2c","name":"If40"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[192,1856],"id":"324684bf-472a-4b17-a5fc-3b12d1f0e647","name":"If42"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1648],"id":"9da856cd-4d80-4b0d-84b5-9d412e3a3420","name":"Wait5","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-368,1856],"id":"918310b1-c0da-46c2-80cf-8343bacd20a5","name":"Wait7","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[400,1872],"id":"30392c9c-d8a1-4a3a-8173-0ef149b4dadb","name":"Wait8","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-976,1600],"id":"3270bad6-15d8-4f71-a811-c3359fdab4e3","name":"Wait9","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[32,1664],"id":"e5ada578-5738-42b2-98f2-9c73991a85e8","name":"Wait10","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-608,1600],"id":"f693b423-1013-4d25-a66c-54422bfde206"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-2","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-784,1600],"id":"f2f64f92-df6b-4114-863d-2f5463a5bff7"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[0,1856],"id":"15cd3fea-5316-48c1-87b3-10b8b49c2919"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-3","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-176,1856],"id":"97e4385e-224d-4e1b-814b-55d7358b7f8e"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot34","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[720,1872],"id":"d96e4430-aea9-4374-b39b-75bec4c5b6dc"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-4","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[544,1872],"id":"d9dc6055-97c0-4412-8284-39dd78540a56"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot35","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[368,1664],"id":"e7946bf5-eb93-47a1-8f0a-788003fd3e1d"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-5","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[192,1664],"id":"b835a15f-edb3-45a2-b27b-a2905ade226f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot36","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-416,1440],"id":"97aa4aac-4a3b-4632-a2eb-32fe5486d166"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-6","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-592,1440],"id":"dd6f4397-190c-4511-84ba-a4ddb75136be"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":3},"conditions":[{"id":"b2a6d2d7-c61b-43ef-99fe-cc95d8413e94","leftValue":"={{ $json.body.conversation.messages[0].sender.phone_number }}","rightValue":51971119678,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-14480,592],"id":"65ea26bb-db5c-45f1-a288-c16501032d3c","name":"If5"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-14240,368],"id":"3b9693a6-6e3f-4174-9556-ba7477824248","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"operation":"update","tableId":"pasar_supervisor_BRADA","filters":{"conditions":[{"keyName":"numero","condition":"eq","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', ``, 'string') }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"pasar_supervisor","fieldValue":"si"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-13856,272],"id":"ff60e952-557a-4961-b575-24caf1329c1f","name":"pasar_supervisor","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"promptType":"define","text":"=Mensaje completo: {{ $json.body.content }}\n\n","options":{"systemMessage":"=# üéØ ROL\nEres el Agente **Aura**. Tu √∫nica funci√≥n es extraer, **normalizar** y enviar un n√∫mero de tel√©fono a la tool \"pasar_supervisor\" El n√∫mero puede ser nacional (Per√∫) o extranjero, y debes procesarlo seg√∫n las reglas para que la tool reciba solo d√≠gitos.\n\n# üì• INPUT (Solicitud de Recepcionista)\nRecibir√°s una solicitud de la recepcionista para transferir un paciente.\nEl patr√≥n de la solicitud ser√° similar a: **Pasar a supervisor el n√∫mero: [N√∫mero variable]**\nEl n√∫mero puede llegar en formato completo (`519...`), solo el n√∫mero nacional (`9...`), o en formato internacional (`+1...`).\n\n# ‚öôÔ∏è INSTRUCCIONES ESTRICTAS (Funci√≥n sin Estado)\n\n1. Cada input es una solicitud √∫nica. Tu tarea finaliza con la ejecuci√≥n de la tool.\n\n2. **Identificaci√≥n:** Busca y extrae el n√∫mero que sigue inmediatamente al patr√≥n: **Pasar a supervisor el n√∫mero:** o **Manda a supervisor el n√∫mero**.\n\n3. **Normalizaci√≥n:** Antes de usar la tool, debes convertir el n√∫mero extra√≠do a un formato estandarizado de **solo d√≠gitos**, aplicando estas reglas en orden:\n    * **Limpieza:** Elimina todos los caracteres no num√©ricos (espacios, guiones, par√©ntesis, puntos, el signo `+`).\n    * **Normalizaci√≥n Per√∫ (9 d√≠gitos):** Si el n√∫mero tiene **9 d√≠gitos** y **no** comienza con `51`, asume que es un n√∫mero de Per√∫ y **precede** la cadena con `51`.\n    * **Normalizaci√≥n Internacional/Completo:** Si el n√∫mero comienza con `51` (11 d√≠gitos) o es cualquier otra longitud, √∫salo tal cual despu√©s de la limpieza.\n\n4. **Acci√≥n √önica:** Una vez extra√≠do y normalizado el n√∫mero, debes utilizar **exclusivamente** la tool **pasar_supervisor**.\n\n5. **Output:** Nunca respondas, expliques, ni devuelvas texto. Tu √∫nica acci√≥n es ejecutar la tool.\n\n### üìù EJEMPLO DE FLUJO DE TRABAJO\n\n| Input de la Recepcionista | L√≥gica de Normalizaci√≥n | Salida a la Tool |\n| :--- | :--- | :--- |\n| **Input 1 (Per√∫ Completo):** `Pasar a supervisor el n√∫mero: 51998765432` | N√∫mero original: `51998765432` (11 d√≠gitos). No requiere cambios. | `pasar_supervisor(51998765432)` |\n| **Input 2 (Internacional):** `Manda a supervisor el n√∫mero +1 (305) 417-1787` | Limpieza: `13054171787` (11 d√≠gitos). | `pasar_supervisor(13054171787)` |\n| **Input 3 (Per√∫ Corto):** `Manda a supervisor el n√∫mero 977571136` | 9 d√≠gitos. Se asume Per√∫. **Normaliza con 51**. | `pasar_supervisor(51977571136)` |\n\n## HERRAMIENTAS\n**Herramientas disponibles:** **pasar_supervisor**\n\n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-14256,192],"id":"ed307005-1e1d-4800-a494-8f1ee293347f","name":"supervisor"},{"parameters":{"workflowId":{"__rl":true,"value":"86itBT4QcMqbK21F","mode":"list","cachedResultUrl":"/workflow/86itBT4QcMqbK21F","cachedResultName":"[MANTENIMIENTO] Supwhatsapp"},"workflowInputs":{"mappingMode":"defineBelow","value":{"numero":"={{ $('If19').item.json.body.conversation.messages[0].sender.phone_number }}","conversation_id":"={{ $('If19').item.json.body.conversation.messages[0].conversation_id }}","inbox_id":"={{ $('If19').item.json.body.conversation.contact_inbox.inbox_id }}"},"matchingColumns":[],"schema":[{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"conversation_id","displayName":"conversation_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"inbox_id","displayName":"inbox_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-14016,400],"id":"96b98de4-e095-42e3-83b8-8e9043aac552","name":"Call 'Supervisor healup'"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"Z1S8hBZOFvfBE7I5","mode":"list","cachedResultUrl":"/workflow/Z1S8hBZOFvfBE7I5","cachedResultName":"SUNAT | Enviar datos (General) | WHATSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{"nombre":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre', ``, 'string') }}","numero":"={{ $json.id }}","ID":"={{ $('Webhook').item.json.body.conversation.messages[0].conversation_id }}"},"matchingColumns":[],"schema":[{"id":"nombre","displayName":"nombre","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-5664,752],"id":"39552a1a-a1b3-4538-a0c0-eefb20b529b8","name":"enviar_nombre"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    perfumes_full_size: [\n      \"9 pm\",\n      \"9 pm elixir\",\n      \"Aether extrait\",\n      \"Afeef Lattafa\",\n      \"Ajayeb Dubai\",\n      \"Ajwad pink to pink\",\n      \"Al Haramain Dubai Night\",\n      \"Al qiam golf\",\n      \"ALTHAIR PARFUMS de MARLY\",\n      \"Amber rouge\",\n      \"Amethyst\",\n      \"Amore caff√© Mancera\",\n      \"Aqua Dubai 100 ml\",\n      \"Art of nature II\",\n      \"Art of universe\",\n      \"Aruba gold\",\n      \"Atlas LATTAFA\",\n      \"Azzaro PARFUM\",\n      \"Azzaro the most wanted intense\",\n      \"Berry on top\",\n      \"Bharata chocolate\",\n      \"Bharata king EDP\",\n      \"Bharata king gold edition\",\n      \"Bharata Placid\",\n      \"BIANCO latte\",\n      \"CDN Intense man\",\n      \"CDN Sillage\",\n      \"CDN Urban Man Elixir\",\n      \"CDN woman\",\n      \"Champion goat\",\n      \"Champion money\",\n      \"Champion sugar\",\n      \"Chic Sonia\",\n      \"Choco overdose\",\n      \"Cloud Ariana grande\",\n      \"Club de nuit untold\",\n      \"Confidential\",\n      \"Cookie grave\",\n      \"Creed aventus\",\n      \"Creed millesime imperial\",\n      \"Creed silver mountain water\",\n      \"Decant\",\n      \"Diesel spirit\",\n      \"Eclaire\",\n      \"Eclaire banoffi\",\n      \"Eclaire pistache\",\n      \"EMEER\",\n      \"Erba gold\",\n      \"Erba pura\",\n      \"Fahkar Rose\",\n      \"Fakhar black\",\n      \"Fakhar gold\",\n      \"Fire on ice\",\n      \"GOS Blind bid\",\n      \"Gos bonus\",\n      \"GOS Boston\",\n      \"GOS Diamond\",\n      \"Gos Esmerald\",\n      \"GOS Full House\",\n      \"GOS Jackpot\",\n      \"GOS Moon\",\n      \"Gos no limit\",\n      \"GOS platinium\",\n      \"GOS Rouge\",\n      \"GOS Royale\",\n      \"GOS Wildcard\",\n      \"GOS Yellow Saphire\",\n      \"Haramain amber oud gold edition\",\n      \"HAWAS ice\",\n      \"Hawas malibu\",\n      \"Hayaati florence\",\n      \"Hayaati lataffa\",\n      \"Her confession\",\n      \"His Confession\",\n      \"Honor and glory\",\n      \"Invictus Parfum\",\n      \"INVICTUS VICTORY ELIXIR\",\n      \"Ishq al shuyukh silver\",\n      \"Island Khadlaj\",\n      \"Jean lowe azure\",\n      \"Jean lowe inmortel\",\n      \"JPG Le beau le parfum 120ml\",\n      \"JPG Le Male elixir 125ml\",\n      \"JPG LE MALE LE PARFUM\",\n      \"JPG Paradise Garden 125ml\",\n      \"Khamrah\",\n      \"Khamrah Dukhan\",\n      \"Kirk√© Tiziana Terenzi\",\n      \"Lataffa Ameer\",\n      \"Lattafa dynasty\",\n      \"LAYTON PARFUMS de MARLY\",\n      \"Mancera cedrat boise\",\n      \"Mancera coco vanille\",\n      \"Mancera Instant Crush\",\n      \"Mancera Red tobaco\",\n      \"Mandar√≠n elixir\",\n      \"Milestone\",\n      \"Montale Arabians Tonka\",\n      \"M√≥ntale intense caf√©\",\n      \"Nautica voyage\",\n      \"Naxos\",\n      \"Nitro Red\",\n      \"Nitro White\",\n      \"Noble blush\",\n      \"Now white\",\n      \"Now women\",\n      \"Odyssey artisto\",\n      \"Odyssey bahamas\",\n      \"Odyssey black forest\",\n      \"Odyssey Candee\",\n      \"Odyssey Eau de Montagne\",\n      \"Odyssey go mango\",\n      \"Odyssey Homme black EDP\",\n      \"Odyssey Homme white edition\",\n      \"Odyssey Limoni\",\n      \"Odyssey Mandarin sky\",\n      \"Odyssey mega edp\",\n      \"Odyssey revolution\",\n      \"Odyssey Spectra\",\n      \"Odyssey spectra blue\",\n      \"Odyssey toffe coffe\",\n      \"Odyssey Tyrant\",\n      \"Odyssey wild one\",\n      \"Orientica royal amber\",\n      \"Orientica Velvet Gold\",\n      \"OUD FOR GLORY\",\n      \"Qaed unlimited\",\n      \"Rave Now\",\n      \"Rayhaan Elixir\",\n      \"Rome Imagine\",\n      \"Rome paradox\",\n      \"Scandal intense\",\n      \"Scandal le parfum\",\n      \"Sehr\",\n      \"Shaheen\",\n      \"So candid\",\n      \"Spectre Malachite\",\n      \"Spectre wraith\",\n      \"Stronger with you intensly\",\n      \"Summer hammer/Lorenzo Pazzaglia\",\n      \"Sun-gria\",\n      \"Teriaq intense\",\n      \"Tharwah gold\",\n      \"The Kingdom\",\n      \"Turathi\",\n      \"Turathi Electric\",\n      \"Valentino born in Roma intense\",\n      \"Veneno\",\n      \"Versace Eros flame\",\n      \"Versace eros parfum\",\n      \"Vintage Radio\",\n      \"Winners trophy\",\n      \"Yara elixir\",\n      \"Yara lataffa\",\n      \"Yara Moi\",\n      \"Yara tous\",\n      \"Yves Saint Laurent Y EDP\"\n    ],\n\n    decants: [\n      \"BHARARA KING EDP\",\n      \"LATTAFA PRIDE PISA\",\n      \"HARANA\",\n      \"21:00:00\",\n      \"EJAAZI\",\n      \"CDN SILLAGE\",\n      \"GOS MOON\",\n      \"MANDARIN SKY\",\n      \"NAUTICA VOYAGE\",\n      \"ROYAL BLEU\",\n      \"ODYSSEY WHITE\",\n      \"JEAN LOWE MATIERE\",\n      \"SUBLIME\",\n      \"GOS ROUGE\",\n      \"9 PM REBEL\",\n      \"KHAMRAH\",\n      \"GOS YELLOW SAPPHIRE\",\n      \"GOS BOSTON\",\n      \"ASAD\",\n      \"TURATHI BLUE\",\n      \"CND SILLAGE\",\n      \"GOS ROYALE\",\n      \"OUD FOR GLORY\",\n      \"AL HARAMAIN GOLD EXTREME\",\n      \"ODYSSEY AOUD\",\n      \"VLO\",\n      \"EMEER\",\n      \"ISSEY MIYAKE\",\n      \"ODYSSEY TYRANT\",\n      \"ASAD ZANZIBAR\",\n      \"GOS BID\",\n      \"9AM\",\n      \"HAWAS ICE\",\n      \"GOS WILDCARD\",\n      \"YARA MOI\",\n      \"VENTANA ARMAF\",\n      \"CDN IMP√âRIALE\",\n      \"AL NASHAMA CAPRICE\",\n      \"YARA\",\n      \"BHARARA BLEU\",\n      \"GOS BLIND BID\",\n      \"GOS ACE\",\n      \"CDN MILESTONE\",\n      \"DETOUR NOIR\",\n      \"RAED LUXE\",\n      \"QAED UNLIMITED\",\n      \"AI HARAMAIN RUBY EDITION\",\n      \"HAWAS BLACK\",\n      \"HAYAATI\",\n      \"ODYSSEY HOMME BLACK\",\n      \"CDN URBAN MAN ELIXIR\",\n      \"CDN UNTOLD\",\n      \"MAAHIR LEGACY\",\n      \"LEGEND SPIRIT\",\n      \"SHAHEEN GOLD\",\n      \"YARA TOUS\",\n      \"FAKHAR ROSE\",\n      \"HONOR AND GLORY\",\n      \"DUBAI NIGHT\",\n      \"BHARARA KING PARFUM\",\n      \"LATTAFA JASOOR\",\n      \"GOS GOLD\",\n      \"CDN INTENSE MAN\",\n      \"GOS FULL HOUSE\",\n      \"ODYSSEY AQUA\",\n      \"HAYAATI AL MALEKY\",\n      \"GOS WIN\",\n      \"FAKHAR BLACK\",\n      \"GOS DIAMOND\",\n      \"KHAMRAH QAHWA\",\n      \"GOS HIGH ROLLER\",\n      \"THE KINGDOM\",\n      \"ODYSSEY MEGA\",\n      \"HAWAS FOR HIM\",\n      \"LATTAFA NEBRAS\",\n      \"AI HARAMAIN GOLD EDITION\",\n      \"AJWAD\",\n      \"RAVE NOW WHITE\",\n      \"ODYSSEY CANDEE\",\n      \"ODYSSEY SPECTRA\",\n      \"YARA CANDY\",\n      \"ODYSSEY LIMONI\",\n      \"AMBER ROUGE\",\n      \"SCEPTRE MALACHITE\",\n      \"VIKING KASHMIR\",\n      \"AI HARAMAIN PRIVATE EDITION\",\n      \"QAED AI FURSAN\",\n      \"GOS JACKPOT\",\n      \"VIKING DUBAI\",\n      \"ROYAL AMBER\",\n      \"BHARARA KING GOLD EDITION\",\n      \"HIS CONFESSION\",\n      \"VIKING CAIRO\",\n      \"BHARARA ELEGANCE\",\n      \"BHARARA PHARAOH 1\",\n      \"BHARARA PHARAOH 2\",\n      \"MAYAR\",\n      \"CLUB DE NUIT PRECIEUX\",\n      \"HER CONFESSION\",\n      \"AMETHYST LATTAFA\",\n      \"LATTAFA TERIAQ\",\n      \"AI HARAMAIN AQUA DUBAI\",\n      \"ASAD BOURBON\",\n      \"NITRO WHITE\",\n      \"LIQUID BURN\",\n      \"NITRO RED\",\n      \"NOBLE BLUSH\",\n      \"LATTAFA SEHR\",\n      \"ISLAND BLISS\",\n      \"LATTAFA ECLAIRE\",\n      \"AL HARAMAIN ROYAL MUSK\",\n      \"SUQRAAT\",\n      \"ISHQ AL SHUYUKH\",\n      \"LIAM BLUE\",\n      \"DUBAI CHOCOLAT\",\n      \"BHARARA CHOCOLATE\",\n      \"HAYA\",\n      \"ISHQ AL SHUYUKH GOLD\",\n      \"ANSAAM SILVER\",\n      \"VINTAGE RADIO\",\n      \"BHARARA ENCHANTED\",\n      \"GOS OPAL\",\n      \"ART OF UNIVERSE\",\n      \"LATTAFA CHIC\",\n      \"HAWAS ELIXIR\",\n      \"HAYA CRUSH\",\n      \"JEAN LOWE AZURE\",\n      \"ROME POUR HOMME\",\n      \"HAYAATI FLORENCE\",\n      \"VELVET GOLD\",\n      \"AJWAD PINK TO PINK\",\n      \"AL QIAM GOLD\",\n      \"ANGHAM LATTAFA\",\n      \"ARABIAN SKY\",\n      \"TAG UOMO ROSSO\",\n      \"TAG ART OF NATURE II\",\n      \"BHARARA PLACID\",\n      \"BHARARA SOLEIL\",\n      \"CDN WOMAN\",\n      \"CDN ICONIC\",\n      \"CONFIDENTIAL PRIVATE GOLD\",\n      \"DELILAH\",\n      \"GOS PLATINIUM OF SPADES\",\n      \"INTIMATION\",\n      \"ISLAND KHADLAJ\",\n      \"JEAN LOWE INMORTEL\",\n      \"JEAN LOWE VIBE\",\n      \"WINNERS TROPHY\",\n      \"KHANJAR EAU DE PARFUM\",\n      \"KISMET MAGIC\",\n      \"MANDARIN SKY ELIXIR\",\n      \"MAYAR CHERRY INTENSE\",\n      \"NITRO RED INTENSELY\",\n      \"NITRO NOW WOMEN\",\n      \"ODYSSEY ARTISTO\",\n      \"ODYSSEY WILD ONE\",\n      \"RAVE NOW RAYHAAN ELIXIR\",\n      \"NOW\",\n      \"SAKEENA\",\n      \"SO CANDID\",\n      \"TARWAH GOLD\",\n      \"LATTAFA TERIAQ INTENSE\",\n      \"VICTORIA LATTAFA\",\n      \"YUM YUM ARMAF\",\n      \"QISSA DELICIOUS\",\n      \"HAWAS TROPICAL\",\n      \"HAWAS FIRE\",\n      \"FAKHAR PLATIN\",\n      \"KHAMARAH DUKHAN\",\n      \"ODYSSEY EAU DE MONTAGNE\",\n      \"ODYSSEY REVOLUTION\",\n      \"ROME IMAGINE\",\n      \"TURATHI ELECTRIC\",\n      \"VULCAN NUE\",\n      \"SPECTRE WRAITH\",\n      \"GOS EMERALD OF SPADES\",\n      \"AFEEF\",\n      \"BHARARA ONYX\",\n      \"SCEPTRE DESERT\",\n      \"NITRO NEITHE\",\n      \"ODYSSEY BLACK FOREST\",\n      \"ODYSSEY TOFFEE COFFEE\",\n      \"ODYSSEY BAHAMAS\",\n      \"ODYSSEY MANGO\",\n      \"NITRO ELIXIR\",\n      \"ROME PARADOXE\",\n      \"ROME YUM YUM\",\n      \"ECLAIRE PISTACHE\",\n      \"ECLAIRE BANOFFEE\",\n      \"9PM ELIXIR\",\n      \"HAWAS MALIBU\",\n      \"HAWAS KOBRA\",\n      \"GOS BONUS DYNASTY FIRE\",\n      \"ON CIE\",\n      \"LOVELY CHERIE\"\n    ],\n\n    set_perfumes: [\n      \"Gos set\",\n      \"GOS Set 3 piezas jo milano\",\n      \"Set 9pm\",\n      \"Set art of universe\",\n      \"Set mandar√≠n\",\n      \"SET VERSACE NECESER + PERFUME + DECANT\",\n      \"Set YARA\",\n      \"Set Zadig & Voltaire this is her\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4736,416],"id":"8e853398-c1fd-4a9a-9894-11607d7d0832","name":"informacion_productos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"# ROL: \nEres un agente t√©cnico especializado en la verificaci√≥n de existencias y precios del cat√°logo de Brada Perfumes. Tu √∫nico objetivo es recibir nombres de perfumes, identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input y consultar la tool stock1 para obtener datos reales.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Productos: Los nombres de los perfumes en el input siempre vendr√°n entre comillas (ej. \"9 PM\", \"Hawas Ice\") para evitar confusi√≥n con el resto del mensaje.\nUso de la Tool stock1:\nDebes ejecutar la tool enviando el nombre exacto del perfume identificado en la variable perfume.\nSi el input contiene m√∫ltiples perfumes, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes mantener el nombre del perfume exactamente igual a como aparece en el cat√°logo, corrigiendo solo errores ortogr√°ficos evidentes seg√∫n tu conocimiento general.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo perfume\nVariable disponibilidad: Si la tool indica que el producto est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre de perfume): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s perfumes\nDebes listar cada perfume en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n# EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"Hola, revisa la disponibilidad de \"9 PM\" y \"Hawas Ice\".\"\nProceso interno:\nLlamada 1: stock1(perfume=\"9 PM\") -> Resultado: Disponible, S/ 140.\nLlamada 2: stock1(perfume=\"Hawas Ice\") -> Resultado: Agotado, S/ 180.\nOutput que debes enviar si son dos o m√°s perfumes: 9 PM: stock si y precio 140 soles. Hawas Ice: stock no y precio 180 soles.\n#NOTAS ADICIONALES\nNo inventes precios ni estados de stock.\nSi la tool no devuelve informaci√≥n para un nombre espec√≠fico, indica: (Nombre de perfume): stock no y precio (No disponible).\nTu respuesta debe ser exclusivamente la lista de stock solicitada, sin saludos ni despedidas adicionales\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5312,608],"id":"64458501-a4f8-45c4-aae9-17b34719c27a","name":"stock_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","jsCode":"return [\n  {\n    \"distritos_permitidos\": [\n      \"Anc√≥n\", \"Ate\", \"Barranco\", \"Bre√±a\", \"Carabayllo\", \"Chaclacayo\", \n      \"Chorrillos\", \"Cieneguilla\", \"Comas\", \"El Agustino\", \"Independencia\", \n      \"Jes√∫s Mar√≠a\", \"La Molina\", \"La Victoria\", \"Lima\", \"Lince\", \n      \"Los Olivos\", \"Lurigancho\", \"Lur√≠n\", \"Magdalena del Mar\", \"Miraflores\", \n      \"Pachac√°mac\", \"Pucusana\", \"Pueblo Libre\", \"Puente Piedra\", \n      \"Punta Hermosa\", \"Punta Negra\", \"R√≠mac\", \"San Bartolo\", \"San Borja\", \n      \"San Isidro\", \"San Juan de Lurigancho\", \"San Juan de Miraflores\", \n      \"San Luis\", \"San Mart√≠n de Porres\", \"San Miguel\", \"Santa Anita\", \n      \"Santa Mar√≠a del Mar\", \"Santa Rosa\", \"Santiago de Surco\", \"Surquillo\", \n      \"Villa El Salvador\", \"Villa Mar√≠a del Triunfo\", \"Callao\", \"Bellavista\", \n      \"Carmen de la Legua Reynoso\", \"La Perla\", \"La Punta\", \"Ventanilla\"\n    ]\n  }\n];"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[-4432,400],"id":"09ca4414-ae98-4efb-aaa7-b0a7d4b68b45","name":"distritos"},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente especializado exclusivamente en la verificaci√≥n de existencias y precios de Decants (presentaciones de 5ml y 10ml) de Brada Perfumes. Tu objetivo es recibir el input del agente principal, identificar los perfumes y sus medidas, y consultar la tool stock_decants para devolver datos precisos.\n# INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Medidas: Debes prestar especial atenci√≥n a la cantidad solicitada (5ml o 10ml). Si el cliente no especifica la medida pero el contexto indica que es un decant, consulta ambas presentaciones.\nUso de la Tool stock_decants:\nDebes ejecutar la tool enviando el nombre del perfume y la medida identificada.\nSi el input contiene m√∫ltiples decants (ej. \"9 PM de 5ml y Hawas de 10ml\"), debes realizar una ejecuci√≥n de la tool por cada producto/medida individualmente.\nMantenimiento de Nomenclatura: Mant√©n el nombre t√©cnico del perfume (ej. \"Club de Nuit Intense\" en lugar de \"cnit\") seg√∫n la lista maestra.\n# L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato basado en los datos de la tool:\nCASO 1: Un solo decant\nVariable disponibilidad: Si la tool indica existencias, utiliza \"si\". Si no hay, utiliza \"no\".\nFormato de salida: (Nombre de perfume) ([Medida]): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s decants\nDebes listar cada decant en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad de decants: \"9 PM\" en 5ml y \"Hawas Ice\" en 10ml.\"\nProceso interno:\nLlamada 1: stock_decants(perfume=\"9 PM\", medida=\"5ml\") -> Resultado: Disponible, S/ 35.\nLlamada 2: stock_decants(perfume=\"Hawas Ice\", medida=\"10ml\") -> Resultado: Agotado, S/ 45.\nOutput (Lo que respondes): 9 PM (5ml): stock si y precio 35 soles. Hawas Ice (10ml): stock no y precio 45 soles.\n#REGLAS DE ORO\nProhibici√≥n de Inventar: No inventes precios. Si la tool no devuelve un precio para una medida espec√≠fica, responde: (Nombre de perfume) ([Medida]): stock no y precio (No disponible).\nExclusividad: Tu respuesta debe contener √∫nicamente la lista t√©cnica. No incluyas saludos, recomendaciones, ni frases de cierre.\nPrecisi√≥n de Medida: Aseg√∫rate de que el precio corresponda exactamente a la medida solicitada (un perfume de 10ml siempre es m√°s caro que uno de 5ml).\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-5024,608],"id":"edf1ea9c-753a-4178-8823-ad4b5d276fde","name":"stock_decants"},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-4752,880],"id":"c65b6d98-6ca9-4850-a240-dc15d0e6f244","name":"OpenAI Chat Model5","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5008,880],"id":"f40c83eb-7af9-43d9-9718-23906d503917","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"model":"gpt-5-mini","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[-5328,848],"id":"4682821d-4ee5-4aa0-bfa8-6ee52c2d74b9","name":"OpenAI Chat Model6","credentials":{"openAiApi":{"id":"byAJ6ieSg6DkIa3a","name":"OpenAi account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfumes","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-5168,816],"id":"db9c5a3b-41f0-489b-95b8-1818ea40b41b","name":"stock1","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_decants","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4880,832],"id":"cca318d1-6e33-42b3-9253-f90ae5034239","name":"stock2","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"descriptionType":"manual","toolDescription":"usa esta tool para ver datos de un perfume en especifico","operation":"get","tableId":"brada_perfume_sets","filters":{"conditions":[{"keyName":"perfume","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-4592,880],"id":"6150c4ba-6b03-4325-b902-35091b0ac31b","name":"stock3","credentials":{"supabaseApi":{"id":"QRe5FlGkzOw84FZ5","name":"SUPABASE.COM 1"}}},{"parameters":{"toolDescription":"Usa esta tool para obtener disponibilidad de un perfume o varios y sus precios.","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}","options":{"systemMessage":"#ROL\nEres un agente t√©cnico especializado exclusivamente en la verificaci√≥n de existencias y precios de los Sets de Perfumes (estuches de regalo o packs con complementos) de Brada Perfumes. Tu misi√≥n es recibir el nombre del set, validarlo contra la tool stock_set_perfumes y devolver la disponibilidad y precio real.\n#INSTRUCCIONES OPERATIVAS CR√çTICAS\nIdentificaci√≥n de Sets: Los nombres de los sets suelen incluir la palabra \"Set\" (ej. \"Set Yara\", \"Set 9 PM\"). Debes identificarlos mediante los delimitadores de comillas (\" \") proporcionados en el input.\nUso de la Tool stock_set_perfumes:\nDebes ejecutar la tool enviando el nombre exacto del set en la variable nombre_set.\nSi el input contiene m√∫ltiples sets, debes realizar una ejecuci√≥n de la tool por cada producto individualmente.\nMantenimiento de Nomenclatura: Debes respetar el nombre del set tal como aparece en el cat√°logo oficial de Brada Perfumes, asegur√°ndote de que se trate de la presentaci√≥n en estuche y no de la botella individual.\n#L√ìGICA DE RESPUESTA (OUTPUT)\nTu respuesta debe ser t√©cnica y seguir estrictamente este formato seg√∫n los datos devueltos por la tool:\nCASO 1: Un solo Set\nVariable disponibilidad: Si la tool indica que el set est√° en almac√©n, utiliza \"si\". Si indica que no hay existencias, utiliza \"no\".\nFormato de salida: (Nombre del Set): stock (si/no) y precio (monto en soles).\nCASO 2: Dos o m√°s Sets\nDebes listar cada set en una l√≠nea distinta siguiendo el mismo formato del Caso 1.\n#EJEMPLOS DE PROCESAMIENTO\nInput del sistema: \"disponibilidad del SET: \"Set Yara\" y \"Set Art of Universe\".\"\nProceso interno:\nLlamada 1: stock_set_perfumes(nombre_set=\"Set Yara\") -> Resultado: Disponible, S/ 210.\nLlamada 2: stock_set_perfumes(nombre_set=\"Set Art of Universe\") -> Resultado: Disponible, S/ 250.\nOutput (Lo que respondes): Set Yara: stock si y precio 210 soles. Set Art of Universe: stock si y precio 250 soles.\n#REGLAS DE ORO\nPrecisi√≥n: No confundas un \"Perfume Full Size\" con un \"Set\". Si el input pide un Set, busca √∫nicamente en la categor√≠a de sets.\nProhibici√≥n de Inventar: No inventes precios ni disponibilidad. Si la tool no devuelve informaci√≥n para un set espec√≠fico, indica: (Nombre del Set): stock no y precio (No disponible).\nMinimalismo: Tu respuesta debe ser exclusivamente la lista t√©cnica solicitada. No incluyas saludos, despedidas ni comentarios sobre el contenido del set.\n\n"}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":3,"position":[-4736,656],"id":"6344ee20-9fcb-45bd-a342-5aaf79248763","name":"stock_set_perfumes"},{"parameters":{"description":"usa esta tool seg√∫n las indicaciones del prompt principal","workflowId":{"__rl":true,"value":"bFX818cxJebYkS92","mode":"list","cachedResultUrl":"/workflow/bFX818cxJebYkS92","cachedResultName":"BRADA | WHATSAPP | compras confirmadas"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-4544,448],"id":"42a85e30-dd9d-47c7-af24-3eace4616f6f","name":"confirmacion_pedidos"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1840,2160],"id":"86511a06-e0d8-496b-9161-edd28ac48fe2","name":"If24"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1632,2144],"id":"f6ed93e7-cd4c-4547-9b7c-9f3a9bd6174a","name":"If28"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1280,2560],"id":"6532091a-4da7-484e-bc59-551caaf8837a","name":"If29"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-1904,2112],"typeVersion":1,"id":"4b346085-38b5-41dc-aa4e-0e5fd0d63b15","name":"Sticky Note3"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1408,2160],"id":"60a486b8-d8b9-45f7-bcc2-0237d9dacb35","name":"Wait1","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-832,2368],"id":"aec693f3-d181-42f6-96ef-f4259257f242","name":"If41"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-464,2576],"id":"d0bce6d9-8944-4f36-8369-887245578174","name":"If43"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2368],"id":"920f0b3f-260f-4a46-8f84-c7fafcb4e42d","name":"Wait11","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1024,2576],"id":"9445a338-fa59-4652-b7a7-042da4ab0166","name":"Wait12","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-256,2592],"id":"1b4c198d-a84a-4886-bfee-45e03505844a","name":"Wait13","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1632,2320],"id":"985412b0-18a0-4a74-9383-848361eecf6d","name":"Wait14","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-624,2384],"id":"0b01e43e-8f88-4806-9aa3-aaafae23afa5","name":"Wait15","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1264,2320],"id":"455fc9a5-d692-424b-96af-4dc9dfb5ecfa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1440,2320],"id":"43ef0c39-d3b6-4ed3-9bbe-55b60f80b5a4"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-656,2576],"id":"71901a37-3c10-48e0-8c0d-ea488faf670e"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-7","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-832,2576],"id":"94b90b7c-2489-43c2-b38d-5f1d9ed48958"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot37","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[64,2592],"id":"70f90af3-d2d6-42bb-bbed-2a460fc13eb2"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-8","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-112,2592],"id":"79b9eee3-c9f3-43cc-945b-a659df940b42"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot38","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-288,2384],"id":"377a6011-2a90-4508-ad7a-18e8be515097"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-9","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-464,2384],"id":"4736c49f-51b0-433c-acaf-c5ec1975c27f"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot39","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1072,2160],"id":"a211f2a4-e5b1-4b1b-b198-ecee0d6bdf3a"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-10","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1248,2160],"id":"e7fcf0ac-d57f-498d-84c2-efc72cefbb9c"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[336,720],"id":"2aaf0e50-945f-404a-a630-6c934c4bf678","name":"If25"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[544,704],"id":"db6e3976-9c81-410c-a089-cbbffed9a498","name":"If30"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[896,1120],"id":"3d9b40b9-6eb5-4641-9243-4acb6bbaab90","name":"If31"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[272,672],"typeVersion":1,"id":"9d6dc394-e9c9-47cf-bb8b-3ec6e169cd24","name":"Sticky Note4"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[768,720],"id":"e193f0ff-9818-4fff-ab4c-87a07ea2bc57","name":"Wait16","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1344,928],"id":"70a6f8d6-3ef1-45ad-be33-45e51b8b5bf7","name":"If44"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1712,1136],"id":"46e4e9c0-d629-4cae-a016-78122838bf5c","name":"If45"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,928],"id":"9005e0a0-7928-4432-afba-ecca82410842","name":"Wait17","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1152,1136],"id":"26654f8d-1377-49f2-b4ba-feefd58f29f5","name":"Wait18","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1920,1152],"id":"e5e9d5a8-676d-4787-ad0c-57a9cecb51e6","name":"Wait19","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[544,880],"id":"0a2148fa-6d21-4cef-85c9-2f9f7747051b","name":"Wait20","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1552,944],"id":"24a50f49-9fa7-444a-889d-b0a47dcdca22","name":"Wait21","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[912,880],"id":"73a2a9cb-96fa-4c67-b2c0-855467476004"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-11","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[736,880],"id":"2a355cf5-4023-4e5c-94cd-fb54d20ab48d"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot21","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1520,1136],"id":"e4e81844-daec-44fa-87e1-8a40c9f593e1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-12","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1344,1136],"id":"124b0253-10a5-4f3f-8b46-7e729f639b4b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot40","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2240,1152],"id":"d7a77253-dcf2-4e33-9699-ace3f5cf9843"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-13","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2064,1152],"id":"47d740d9-af91-4b47-a3d9-43f6089948ac"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot41","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1888,944],"id":"ba55a9c2-6648-4009-9d21-cbad56eea3fa"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-14","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1712,944],"id":"09553178-8112-4313-b41f-7edb86da9bb2"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot42","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1104,720],"id":"a287f371-7d38-4b62-96ac-80a54a0f4a85"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-15","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[928,720],"id":"5a670fc0-4c1b-45d5-bf03-f2cce3d56697"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"2b903a25-4e9f-49b4-a7b0-fe676aad5506","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-144,0],"id":"21286fd2-eb14-4621-961c-daf1710c98db","name":"If32"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"f526554d-81dd-4030-8849-b93195966ffb","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[64,-16],"id":"9298649c-49d2-4ef9-a38d-d1ecd699741a","name":"If33"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"8c687f60-94a2-4faf-b4df-de1d8ca1054d","leftValue":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[416,400],"id":"0335f432-f2cb-43bf-9855-8b773b8fd74f","name":"If34"},{"parameters":{"content":"imagenes y videos","height":672,"width":2128},"type":"n8n-nodes-base.stickyNote","position":[-208,-48],"typeVersion":1,"id":"f7db0934-d8a5-4643-8ea5-3b74f9fd30ff","name":"Sticky Note5"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[288,0],"id":"edc5d3e6-6cb7-4e24-a395-5bfd2ec21e8f","name":"Wait22","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[864,208],"id":"3d08713e-6783-4344-835a-52021892fc79","name":"If46"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"32c54bb1-d64c-4936-aaef-63093c7712ee","leftValue":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1232,416],"id":"a3ff7975-1b42-4ee2-8d28-a9e2530627ea","name":"If47"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,208],"id":"050e27ee-0dc9-4cfe-9b3b-4984fdb3c424","name":"Wait23","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,416],"id":"316376c3-954b-4325-ab08-caadfb880e67","name":"Wait24","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1440,432],"id":"cfc28de1-e1fa-4583-80c7-4806a6cd7ad1","name":"Wait25","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[64,160],"id":"e8d0be90-195b-413a-b96d-28c469da7d2a","name":"Wait26","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"amount":3},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1072,224],"id":"83b77384-ab0f-442c-aa8e-20cbf18ba56b","name":"Wait27","webhookId":"79326f49-5318-4607-9367-b503b5df0fc0"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot22","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[432,160],"id":"91fe9d8e-e24c-4675-9a65-5c3b96805cd1"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_uno }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-16","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[256,160],"id":"b2aa295f-bb56-4faf-bc6e-2c244ae1b8b5"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot23","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1040,416],"id":"42af2c54-fd06-4e53-9b3e-386ae18aad48"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.imagen_dos }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-17","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[864,416],"id":"334d03f2-3acd-4c43-9e5c-e5c9ec1fab6b"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot43","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1760,432],"id":"a10b0be7-7ad4-4a67-b580-1f6c8f63dd0b"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-18","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1584,432],"id":"3ae52091-798e-4106-ad81-b391a548b061"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot44","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1408,224],"id":"634d84c9-0fb9-4dc6-a691-70a9eb6eaff6"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-19","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1232,224],"id":"4c0fbfdd-c75a-4058-9fb3-c934f00a1774"},{"parameters":{"method":"POST","url":"=https://chats.alef.company/api/v1/accounts/{{ $('Handler variables').item.json.account_id }}/conversations/{{ $('Handler variables').item.json.conversation_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"api_access_token","value":"Lh7eSCzHPSDNEUfRwUsRDFqL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message_type","value":"outgoing"},{"parameterType":"formBinaryData","name":"attachments[]","inputDataFieldName":"data"},{"name":"content"}]},"options":{}},"name":"2. Enviar a Chatwoot45","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[624,0],"id":"c8374285-c938-46a3-ab3d-a8987b53dafe"},{"parameters":{"url":"={{ $('Verificador1').item.json.output.response.video_mp4 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"name":"1. Descargar Imagen 1-20","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[448,0],"id":"8a5f2626-93c0-485f-83b6-88d1b7969f67"}],"connections":{"AI Agent":{"main":[[{"node":"Verificador1","type":"main","index":0}]]},"Auto-fixing Output Parser1":{"ai_outputParser":[[{"node":"Verificador1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model8":{"ai_languageModel":[[{"node":"Auto-fixing Output Parser1","type":"ai_languageModel","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"Auto-fixing Output Parser1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model9":{"ai_languageModel":[[{"node":"Verificador1","type":"ai_languageModel","index":0}]]},"Verificador1":{"main":[[{"node":"ordenar","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Get a row3","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"If2":{"main":[[{"node":"Update a row1","type":"main","index":0}],[{"node":"If3","type":"main","index":0}]]},"If3":{"main":[[{"node":"Switch3","type":"main","index":0}],[{"node":"No Operation, do nothing4","type":"main","index":0}]]},"Edit Fields4":{"main":[[{"node":"If2","type":"main","index":0}]]},"If13":{"main":[[{"node":"Get a row1","type":"main","index":0}],[{"node":"Create a row","type":"main","index":0}]]},"Calendario":{"ai_tool":[[]]},"Create a row":{"main":[[{"node":"Get a row1","type":"main","index":0}]]},"Get a row1":{"main":[[{"node":"Edit Fields4","type":"main","index":0}]]},"Update a row1":{"main":[[{"node":"Switch3","type":"main","index":0}]]},"Get a row":{"main":[[{"node":"If13","type":"main","index":0}]]},"If4":{"main":[[{"node":"If11","type":"main","index":0}],[{"node":"Fecha","type":"main","index":0}]]},"Formatea fecha":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Handler variables":{"main":[[{"node":"If10","type":"main","index":0}]]},"Fecha":{"main":[[{"node":"Formatea fecha","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Handler variables","type":"main","index":0}]]},"Wait6":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"If6":{"main":[[{"node":"Redis1","type":"main","index":0}],[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"Delete Redis":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Edit Fields19":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"Get Redis1":{"main":[[{"node":"If6","type":"main","index":0}]]},"Edit Fields20":{"main":[[{"node":"Delete Redis","type":"main","index":0}]]},"If15":{"main":[[{"node":"Edit Fields19","type":"main","index":0}],[{"node":"Edit Fields20","type":"main","index":0}]]},"METER_ANUNCIO":{"main":[[{"node":"guarda_ANUNCIO","type":"main","index":0}]]},"BAJAR_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"guarda_ANUNCIO":{"main":[[{"node":"Get a row2","type":"main","index":0}]]},"If":{"main":[[{"node":"RESUMIDOR ANUNCIOS","type":"main","index":0}],[{"node":"If4","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"RESUMIDOR ANUNCIOS","type":"ai_languageModel","index":0}]]},"If10":{"main":[[{"node":"METER_ANUNCIO","type":"main","index":0}],[{"node":"BAJAR_ANUNCIO","type":"main","index":0}]]},"Redis1":{"main":[[{"node":"If15","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"If16","type":"main","index":0}]]},"Edit Fields12":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"AUDIO1","type":"main","index":0}]]},"Switch3":{"main":[[{"node":"HTTP Request","type":"main","index":0}],[{"node":"OpenAI","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields17","type":"main","index":0}]]},"AUDIO1":{"main":[[{"node":"Edit Fields17","type":"main","index":0}]]},"If16":{"main":[[{"node":"Edit Fields17","type":"main","index":0}],[{"node":"Edit Fields12","type":"main","index":0}]]},"Edit Fields17":{"main":[[{"node":"If","type":"main","index":0}]]},"If11":{"main":[[{"node":"Update a row4","type":"main","index":0}]]},"If12":{"main":[[{"node":"Get a row","type":"main","index":0}],[{"node":"If20","type":"main","index":0}]]},"If20":{"main":[[{"node":"Update a row6","type":"main","index":0}]]},"If1":{"main":[[{"node":"If12","type":"main","index":0}]]},"ordenar":{"main":[[{"node":"Respuesta1","type":"main","index":0}]]},"Respuesta1":{"main":[[{"node":"Update a row","type":"main","index":0}]]},"Wait2":{"main":[[{"node":"Respuesta2","type":"main","index":0}]]},"Respuesta2":{"main":[[{"node":"Update a row3","type":"main","index":0}]]},"If14":{"main":[[{"node":"Wait3","type":"main","index":0}],[{"node":"If23","type":"main","index":0}]]},"Wait3":{"main":[[{"node":"Respuesta3","type":"main","index":0}]]},"Respuesta3":{"main":[[{"node":"Update a row5","type":"main","index":0}]]},"If17":{"main":[[{"node":"Wait4","type":"main","index":0}],[{"node":"If32","type":"main","index":0}]]},"Wait4":{"main":[[{"node":"Respuesta4","type":"main","index":0}]]},"Respuesta4":{"main":[[{"node":"Update a row7","type":"main","index":0}]]},"RESUMIDOR ANUNCIOS":{"main":[[{"node":"If4","type":"main","index":0}]]},"Supervisor":{"ai_tool":[[]]},"Update a row":{"main":[[{"node":"If8","type":"main","index":0}]]},"Update a row3":{"main":[[{"node":"If14","type":"main","index":0}]]},"Update a row5":{"main":[[{"node":"If17","type":"main","index":0}]]},"Get a row3":{"main":[[{"node":"If19","type":"main","index":0}]]},"If19":{"main":[[{"node":"If5","type":"main","index":0}]]},"Update a row7":{"main":[[{"node":"If25","type":"main","index":0}]]},"If7":{"main":[[{"node":"Update a row9","type":"main","index":0}],[{"node":"Create a row1","type":"main","index":0}]]},"Get a row2":{"main":[[{"node":"If7","type":"main","index":0}]]},"Create a row1":{"main":[[{"node":"Get Redis1","type":"main","index":0}]]},"RAZONADOR PLUS":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Update a row9":{"main":[[{"node":"Wait6","type":"main","index":0}]]},"1. Descargar Imagen":{"main":[[{"node":"2. Enviar a Chatwoot","type":"main","index":0}]]},"If8":{"main":[[{"node":"Wait2","type":"main","index":0}],[{"node":"If24","type":"main","index":0}]]},"If23":{"main":[[{"node":"If26","type":"main","index":0}],[{"node":"Wait9","type":"main","index":0}]]},"If26":{"main":[[],[{"node":"Wait","type":"main","index":0}]]},"If27":{"main":[[{"node":"Wait5","type":"main","index":0}],[{"node":"Wait7","type":"main","index":0}]]},"Wait":{"main":[[{"node":"1. Descargar Imagen 1-6","type":"main","index":0}]]},"If40":{"main":[[],[{"node":"Wait10","type":"main","index":0}]]},"If42":{"main":[[],[{"node":"Wait8","type":"main","index":0}]]},"Wait5":{"main":[[{"node":"If40","type":"main","index":0}]]},"Wait7":{"main":[[{"node":"1. Descargar Imagen 1-3","type":"main","index":0}]]},"Wait8":{"main":[[{"node":"1. Descargar Imagen 1-4","type":"main","index":0}]]},"Wait9":{"main":[[{"node":"1. Descargar Imagen 1-2","type":"main","index":0}]]},"Wait10":{"main":[[{"node":"1. Descargar Imagen 1-5","type":"main","index":0}]]},"2. Enviar a Chatwoot16":{"main":[[{"node":"If27","type":"main","index":0}]]},"1. Descargar Imagen 1-2":{"main":[[{"node":"2. Enviar a Chatwoot16","type":"main","index":0}]]},"2. Enviar a Chatwoot19":{"main":[[{"node":"If42","type":"main","index":0}]]},"1. Descargar Imagen 1-3":{"main":[[{"node":"2. Enviar a Chatwoot19","type":"main","index":0}]]},"1. Descargar Imagen 1-4":{"main":[[{"node":"2. Enviar a Chatwoot34","type":"main","index":0}]]},"1. Descargar Imagen 1-5":{"main":[[{"node":"2. Enviar a Chatwoot35","type":"main","index":0}]]},"1. Descargar Imagen 1-6":{"main":[[{"node":"2. Enviar a Chatwoot36","type":"main","index":0}]]},"If5":{"main":[[{"node":"supervisor","type":"main","index":0}],[{"node":"If1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"supervisor","type":"ai_languageModel","index":0}]]},"pasar_supervisor":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"Call 'Supervisor healup'":{"ai_tool":[[{"node":"supervisor","type":"ai_tool","index":0}]]},"enviar_nombre":{"ai_tool":[[]]},"informacion_productos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"distritos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"stock_decants":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model5":{"ai_languageModel":[[{"node":"stock_set_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model6":{"ai_languageModel":[[{"node":"stock_perfumes","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"stock_decants","type":"ai_languageModel","index":0}]]},"stock1":{"ai_tool":[[{"node":"stock_perfumes","type":"ai_tool","index":0}]]},"stock2":{"ai_tool":[[{"node":"stock_decants","type":"ai_tool","index":0}]]},"stock3":{"ai_tool":[[{"node":"stock_set_perfumes","type":"ai_tool","index":0}]]},"stock_set_perfumes":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"confirmacion_pedidos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"If24":{"main":[[{"node":"If28","type":"main","index":0}],[{"node":"Wait14","type":"main","index":0}]]},"If28":{"main":[[],[{"node":"Wait1","type":"main","index":0}]]},"If29":{"main":[[{"node":"Wait11","type":"main","index":0}],[{"node":"Wait12","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"1. Descargar Imagen 1-10","type":"main","index":0}]]},"If41":{"main":[[],[{"node":"Wait15","type":"main","index":0}]]},"If43":{"main":[[],[{"node":"Wait13","type":"main","index":0}]]},"Wait11":{"main":[[{"node":"If41","type":"main","index":0}]]},"Wait12":{"main":[[{"node":"1. Descargar Imagen 1-7","type":"main","index":0}]]},"Wait13":{"main":[[{"node":"1. Descargar Imagen 1-8","type":"main","index":0}]]},"Wait14":{"main":[[{"node":"1. Descargar Imagen 1-","type":"main","index":0}]]},"Wait15":{"main":[[{"node":"1. Descargar Imagen 1-9","type":"main","index":0}]]},"2. Enviar a Chatwoot17":{"main":[[{"node":"If29","type":"main","index":0}]]},"1. Descargar Imagen 1-":{"main":[[{"node":"2. Enviar a Chatwoot17","type":"main","index":0}]]},"2. Enviar a Chatwoot20":{"main":[[{"node":"If43","type":"main","index":0}]]},"1. Descargar Imagen 1-7":{"main":[[{"node":"2. Enviar a Chatwoot20","type":"main","index":0}]]},"1. Descargar Imagen 1-8":{"main":[[{"node":"2. Enviar a Chatwoot37","type":"main","index":0}]]},"1. Descargar Imagen 1-9":{"main":[[{"node":"2. Enviar a Chatwoot38","type":"main","index":0}]]},"1. Descargar Imagen 1-10":{"main":[[{"node":"2. Enviar a Chatwoot39","type":"main","index":0}]]},"If25":{"main":[[{"node":"If30","type":"main","index":0}],[{"node":"Wait20","type":"main","index":0}]]},"If30":{"main":[[],[{"node":"Wait16","type":"main","index":0}]]},"If31":{"main":[[{"node":"Wait17","type":"main","index":0}],[{"node":"Wait18","type":"main","index":0}]]},"Wait16":{"main":[[{"node":"1. Descargar Imagen 1-15","type":"main","index":0}]]},"If44":{"main":[[],[{"node":"Wait21","type":"main","index":0}]]},"If45":{"main":[[],[{"node":"Wait19","type":"main","index":0}]]},"Wait17":{"main":[[{"node":"If44","type":"main","index":0}]]},"Wait18":{"main":[[{"node":"1. Descargar Imagen 1-12","type":"main","index":0}]]},"Wait19":{"main":[[{"node":"1. Descargar Imagen 1-13","type":"main","index":0}]]},"Wait20":{"main":[[{"node":"1. Descargar Imagen 1-11","type":"main","index":0}]]},"Wait21":{"main":[[{"node":"1. Descargar Imagen 1-14","type":"main","index":0}]]},"2. Enviar a Chatwoot18":{"main":[[{"node":"If31","type":"main","index":0}]]},"1. Descargar Imagen 1-11":{"main":[[{"node":"2. Enviar a Chatwoot18","type":"main","index":0}]]},"2. Enviar a Chatwoot21":{"main":[[{"node":"If45","type":"main","index":0}]]},"1. Descargar Imagen 1-12":{"main":[[{"node":"2. Enviar a Chatwoot21","type":"main","index":0}]]},"1. Descargar Imagen 1-13":{"main":[[{"node":"2. Enviar a Chatwoot40","type":"main","index":0}]]},"1. Descargar Imagen 1-14":{"main":[[{"node":"2. Enviar a Chatwoot41","type":"main","index":0}]]},"1. Descargar Imagen 1-15":{"main":[[{"node":"2. Enviar a Chatwoot42","type":"main","index":0}]]},"If32":{"main":[[{"node":"If33","type":"main","index":0}],[{"node":"Wait26","type":"main","index":0}]]},"If33":{"main":[[],[{"node":"Wait22","type":"main","index":0}]]},"If34":{"main":[[{"node":"Wait23","type":"main","index":0}],[{"node":"Wait24","type":"main","index":0}]]},"Wait22":{"main":[[{"node":"1. Descargar Imagen 1-20","type":"main","index":0}]]},"If46":{"main":[[],[{"node":"Wait27","type":"main","index":0}]]},"If47":{"main":[[],[{"node":"Wait25","type":"main","index":0}]]},"Wait23":{"main":[[{"node":"If46","type":"main","index":0}]]},"Wait24":{"main":[[{"node":"1. Descargar Imagen 1-17","type":"main","index":0}]]},"Wait25":{"main":[[{"node":"1. Descargar Imagen 1-18","type":"main","index":0}]]},"Wait26":{"main":[[{"node":"1. Descargar Imagen 1-16","type":"main","index":0}]]},"Wait27":{"main":[[{"node":"1. Descargar Imagen 1-19","type":"main","index":0}]]},"2. Enviar a Chatwoot22":{"main":[[{"node":"If34","type":"main","index":0}]]},"1. Descargar Imagen 1-16":{"main":[[{"node":"2. Enviar a Chatwoot22","type":"main","index":0}]]},"2. Enviar a Chatwoot23":{"main":[[{"node":"If47","type":"main","index":0}]]},"1. Descargar Imagen 1-17":{"main":[[{"node":"2. Enviar a Chatwoot23","type":"main","index":0}]]},"1. Descargar Imagen 1-18":{"main":[[{"node":"2. Enviar a Chatwoot43","type":"main","index":0}]]},"1. Descargar Imagen 1-19":{"main":[[{"node":"2. Enviar a Chatwoot44","type":"main","index":0}]]},"1. Descargar Imagen 1-20":{"main":[[{"node":"2. Enviar a Chatwoot45","type":"main","index":0}]]}},"authors":"Juan Pablo Jesus Bazan Ramos","name":null,"description":null,"autosaved":false,"workflowPublishHistory":[{"createdAt":"2026-01-21T02:18:44.974Z","id":708,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"activated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"},{"createdAt":"2026-01-21T02:48:48.349Z","id":711,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"deactivated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"},{"createdAt":"2026-01-21T04:06:49.280Z","id":721,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"deactivated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"},{"createdAt":"2026-01-21T04:51:47.390Z","id":724,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"activated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"},{"createdAt":"2026-01-21T02:21:39.965Z","id":709,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"deactivated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"},{"createdAt":"2026-01-21T04:13:41.322Z","id":722,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"activated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"},{"createdAt":"2026-01-21T02:40:10.134Z","id":710,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"activated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"},{"createdAt":"2026-01-21T04:04:45.436Z","id":720,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"activated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"},{"createdAt":"2026-01-21T04:49:20.992Z","id":723,"workflowId":"bIVpE1aXwtICWRcyHjLUv","versionId":"becd5ca5-467d-415a-b311-83050fcb82cb","event":"deactivated","userId":"4423001a-8ae6-45ae-b4e5-774853e1a949"}]}}
